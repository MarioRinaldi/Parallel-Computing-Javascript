var G_INCOMPAT = false;function GScript(src) {document.write('<' + 'script src="' + src + '"' +' type="text/javascript"><' + '/script>');}function GBrowserIsCompatible() {if (G_INCOMPAT) return false;return true;}function GApiInit() {if (GApiInit.called) return;GApiInit.called = true;window.GAddMessages && GAddMessages({160: '\x3cH1\x3eServer Error\x3c/H1\x3eThe server encountered a temporary error and could not complete your request.\x3cp\x3ePlease try again in a minute or so.\x3c/p\x3e',1415: '.',1416: ',',1547: 'mi',1616: 'km',4100: 'm',4101: 'ft',10018: 'Loading...',10021: 'Zoom In',10022: 'Zoom Out',10024: 'Drag to zoom',10029: 'Return to the last result',10049: 'Map',10050: 'Satellite',10093: 'Terms of Use',10111: 'Map',10112: 'Sat',10116: 'Hybrid',10117: 'Hyb',10120: 'We are sorry, but we don\x27t have maps at this zoom level for this region.\x3cp\x3eTry zooming out for a broader look.\x3c/p\x3e',10121: 'We are sorry, but we don\x27t have imagery at this zoom level for this region.\x3cp\x3eTry zooming out for a broader look.\x3c/p\x3e',10507: 'Pan left',10508: 'Pan right',10509: 'Pan up',10510: 'Pan down',10511: 'Show street map',10512: 'Show satellite imagery',10513: 'Show imagery with street names',10806: 'Click to see this area on Google Maps',10807: 'Traffic',10808: 'Show Traffic',10809: 'Hide Traffic',12150: '%1$s on %2$s',12151: '%1$s on %2$s at %3$s',12152: '%1$s on %2$s between %3$s and %4$s',10985: 'Zoom in',10986: 'Zoom out',11047: 'Center map here',11089: '\x3ca href\x3d\x22javascript:void(0);\x22\x3eZoom In\x3c/a\x3e to see traffic for this region',11259: 'Full-screen',11751: 'Show street map with terrain',11752: 'Style:',11757: 'Change map style',11758: 'Terrain',11759: 'Ter',11794: 'Show labels',11303: 'Street View Help',11274: 'To use street view, you need Adobe Flash Player version %1$d or newer.',11382: 'Get the latest Flash Player.',11314: 'We\x27re sorry, street view is currently unavailable due to high demand.\x3cbr\x3ePlease try again later!',1559: 'N',1560: 'S',1561: 'W',1562: 'E',1608: 'NW',1591: 'NE',1605: 'SW',1606: 'SE',11907: 'This image is no longer available',10041: 'Help',12471: 'Current Location',12492: 'Earth',12823: 'Google has disabled usage of the Maps API for this application. See the Terms of Service for more information: %1$s.',12822: 'http://code.google.com/apis/maps/terms.html',12915: 'Improve the map',12916: 'Google, Europa Technologies',13171: 'Hybrid 3D',0: ''});}var GLoad;(function() {var jslinker={version:"182",jsbinary:[{id:"maps2",url:"http://maps.gstatic.com/intl/en_us/mapfiles/193c/maps2/main.js"},{id:"maps2.api",url:"http://maps.gstatic.com/intl/en_us/mapfiles/193c/maps2.api/main.js"},{id:"gc",url:"http://maps.gstatic.com/intl/en_us/mapfiles/193c/gc.js"},{id:"suggest",url:"http://maps.gstatic.com/intl/en_us/mapfiles/193c/suggest/main.js"},{id:"pphov",url:"http://maps.gstatic.com/intl/en_us/mapfiles/193c/pphov.js"}]};GLoad = function(callback) {var callee = arguments.callee;var apiCallback = callback;GApiInit();var opts = {public_api:true,export_legacy_names:true,tile_override:[{maptype:0,min_zoom:7,max_zoom:7,rect:[{lo:{lat_e7:330000000,lng_e7:1246050000},hi:{lat_e7:386200000,lng_e7:1293600000}},{lo:{lat_e7:366500000,lng_e7:1297000000},hi:{lat_e7:386200000,lng_e7:1320034790}}],uris:["http://mt0.gmaptiles.co.kr/mt/v=kr1.12\x26hl=en\x26src=api\x26","http://mt1.gmaptiles.co.kr/mt/v=kr1.12\x26hl=en\x26src=api\x26","http://mt2.gmaptiles.co.kr/mt/v=kr1.12\x26hl=en\x26src=api\x26","http://mt3.gmaptiles.co.kr/mt/v=kr1.12\x26hl=en\x26src=api\x26"],mapprint_url:"http://www.gmaptiles.co.kr/mapprint"},{maptype:0,min_zoom:8,max_zoom:9,rect:[{lo:{lat_e7:330000000,lng_e7:1246050000},hi:{lat_e7:386200000,lng_e7:1279600000}},{lo:{lat_e7:345000000,lng_e7:1279600000},hi:{lat_e7:386200000,lng_e7:1286700000}},{lo:{lat_e7:348900000,lng_e7:1286700000},hi:{lat_e7:386200000,lng_e7:1293600000}},{lo:{lat_e7:354690000,lng_e7:1293600000},hi:{lat_e7:386200000,lng_e7:1320034790}}],uris:["http://mt0.gmaptiles.co.kr/mt/v=kr1.12\x26hl=en\x26src=api\x26","http://mt1.gmaptiles.co.kr/mt/v=kr1.12\x26hl=en\x26src=api\x26","http://mt2.gmaptiles.co.kr/mt/v=kr1.12\x26hl=en\x26src=api\x26","http://mt3.gmaptiles.co.kr/mt/v=kr1.12\x26hl=en\x26src=api\x26"],mapprint_url:"http://www.gmaptiles.co.kr/mapprint"},{maptype:0,min_zoom:10,max_zoom:19,rect:[{lo:{lat_e7:329890840,lng_e7:1246055600},hi:{lat_e7:386930130,lng_e7:1284960940}},{lo:{lat_e7:344646740,lng_e7:1284960940},hi:{lat_e7:386930130,lng_e7:1288476560}},{lo:{lat_e7:350277470,lng_e7:1288476560},hi:{lat_e7:386930130,lng_e7:1310531620}},{lo:{lat_e7:370277730,lng_e7:1310531620},hi:{lat_e7:386930130,lng_e7:1320034790}}],uris:["http://mt0.gmaptiles.co.kr/mt/v=kr1.12\x26hl=en\x26src=api\x26","http://mt1.gmaptiles.co.kr/mt/v=kr1.12\x26hl=en\x26src=api\x26","http://mt2.gmaptiles.co.kr/mt/v=kr1.12\x26hl=en\x26src=api\x26","http://mt3.gmaptiles.co.kr/mt/v=kr1.12\x26hl=en\x26src=api\x26"],mapprint_url:"http://www.gmaptiles.co.kr/mapprint"},{maptype:3,min_zoom:7,max_zoom:7,rect:[{lo:{lat_e7:330000000,lng_e7:1246050000},hi:{lat_e7:386200000,lng_e7:1293600000}},{lo:{lat_e7:366500000,lng_e7:1297000000},hi:{lat_e7:386200000,lng_e7:1320034790}}],uris:["http://mt0.gmaptiles.co.kr/mt/v=kr1p.12\x26hl=en\x26src=api\x26","http://mt1.gmaptiles.co.kr/mt/v=kr1p.12\x26hl=en\x26src=api\x26","http://mt2.gmaptiles.co.kr/mt/v=kr1p.12\x26hl=en\x26src=api\x26","http://mt3.gmaptiles.co.kr/mt/v=kr1p.12\x26hl=en\x26src=api\x26"]},{maptype:3,min_zoom:8,max_zoom:9,rect:[{lo:{lat_e7:330000000,lng_e7:1246050000},hi:{lat_e7:386200000,lng_e7:1279600000}},{lo:{lat_e7:345000000,lng_e7:1279600000},hi:{lat_e7:386200000,lng_e7:1286700000}},{lo:{lat_e7:348900000,lng_e7:1286700000},hi:{lat_e7:386200000,lng_e7:1293600000}},{lo:{lat_e7:354690000,lng_e7:1293600000},hi:{lat_e7:386200000,lng_e7:1320034790}}],uris:["http://mt0.gmaptiles.co.kr/mt/v=kr1p.12\x26hl=en\x26src=api\x26","http://mt1.gmaptiles.co.kr/mt/v=kr1p.12\x26hl=en\x26src=api\x26","http://mt2.gmaptiles.co.kr/mt/v=kr1p.12\x26hl=en\x26src=api\x26","http://mt3.gmaptiles.co.kr/mt/v=kr1p.12\x26hl=en\x26src=api\x26"]},{maptype:3,min_zoom:10,rect:[{lo:{lat_e7:329890840,lng_e7:1246055600},hi:{lat_e7:386930130,lng_e7:1284960940}},{lo:{lat_e7:344646740,lng_e7:1284960940},hi:{lat_e7:386930130,lng_e7:1288476560}},{lo:{lat_e7:350277470,lng_e7:1288476560},hi:{lat_e7:386930130,lng_e7:1310531620}},{lo:{lat_e7:370277730,lng_e7:1310531620},hi:{lat_e7:386930130,lng_e7:1320034790}}],uris:["http://mt0.gmaptiles.co.kr/mt/v=kr1p.12\x26hl=en\x26src=api\x26","http://mt1.gmaptiles.co.kr/mt/v=kr1p.12\x26hl=en\x26src=api\x26","http://mt2.gmaptiles.co.kr/mt/v=kr1p.12\x26hl=en\x26src=api\x26","http://mt3.gmaptiles.co.kr/mt/v=kr1p.12\x26hl=en\x26src=api\x26"]}],jsmain:"http://maps.gstatic.com/intl/en_us/mapfiles/193c/maps2.api/main.js",sensor:"false",log_info_window_ratio:0.0099999997764825821,log_fragment_count:10,log_fragment_seed:1,obliques_urls:["http://khmdb0.google.com/kh?v=25\x26","http://khmdb1.google.com/kh?v=25\x26"],token:3404841739,jsmodule_base_url:"http://maps.gstatic.com/intl/en_us/mapfiles/193c/maps2.api",transit_allowed:false,generic_tile_urls:["http://mt0.google.com/vt?hl=en\x26src=api\x26","http://mt1.google.com/vt?hl=en\x26src=api\x26"]};var pageArgs = {};apiCallback(["http://mt0.google.com/vt/lyrs\x3dm@118\x26hl\x3den\x26src\x3dapi\x26","http://mt1.google.com/vt/lyrs\x3dm@118\x26hl\x3den\x26src\x3dapi\x26"], ["http://khm0.google.com/kh/v\x3d56\x26","http://khm1.google.com/kh/v\x3d56\x26"], ["http://mt0.google.com/vt/lyrs\x3dh@118\x26hl\x3den\x26src\x3dapi\x26","http://mt1.google.com/vt/lyrs\x3dh@118\x26hl\x3den\x26src\x3dapi\x26"],"ABQIAAAALwQiU3peqAXUIcejQciDOhQxPI_3sheoXqkznc--aWwZLihkTxQfCzOEVRK5IMcDZ5VBKRhkCfrTzg","","",true,"google.maps.",opts,["http://mt0.google.com/vt/v\x3dapp.118\x26hl\x3den\x26src\x3dapi\x26","http://mt1.google.com/vt/v\x3dapp.118\x26hl\x3den\x26src\x3dapi\x26"],jslinker,pageArgs);if (!callee.called) {callee.called = true;}}})();function GUnload() {if (window.GUnloadApi) {GUnloadApi();}}var _mIsRtl = false;var _mF = [ ,,false,,,20,4096,"bounds_cippppt.txt","cities_cippppt.txt","local/add/flagStreetView",true,,400,,,,,,,"/maps/c/ui/HovercardLauncher/dommanifest.js",,,,false,false,,,,,,true,,,,,,,,"http://maps.google.com/maps/stk/fetch",0,,true,,,,true,,,,"http://maps.google.com/maps/stk/style",,"107485602240773805043.00043dadc95ca3874f1fa",,,false,1000,,"http://cbk0.google.com",false,,"ar,iw",,,,,,,,,"http://pagead2.googlesyndication.com/pagead/imgad?id\x3dCMKp3NaV5_mE1AEQEBgQMgieroCd6vHEKA",,,false,false,,false,,,,,"SS","en,fr,ja",,,,,,,true,,,false,,,true,,,,,"","1",,false,false,,false,,,,"AU,BE,FR,NZ,US",,,false,true,500,"http://chart.apis.google.com/chart?cht\x3dqr\x26chs\x3d80x80\x26chld\x3d|0\x26chl\x3d",,,,true,,,,,false,,,false,false,true,,,true,,,,,,,,10,,true,true,,,false,30,"infowindow_v1","",false,true,22,'http://khm.google.com/vt/lbw/lyrs\x3dm\x26hl\x3den\x26','http://khm.google.com/vt/lbw/lyrs\x3ds\x26hl\x3den\x26','http://khm.google.com/vt/lbw/lyrs\x3dy\x26hl\x3den\x26','http://khm.google.com/vt/lbw/lyrs\x3dp\x26hl\x3den\x26',,,false,"US,AU,NZ,FR,DK,MX,BE,CA,DE,GB,IE,PR,PT,RU,SG,JM,HK,TW,MY,TH,AT,CZ,CN,IN,KR",,,"windows-ie,windows-firefox,windows-chrome,macos-safari,macos-firefox",true,false,20000,600,30,,,,,,false,false,,,"maps.google.com",,,true,true,"",true,,false,,true,"4:http://gt%1$d.google.com/mt?v\x3dgwm.fresh\x26","4:http://gt%1$d.google.com/mt?v\x3dgwh.fresh\x26",true,false,false,,0.25,,"107485602240773805043.0004561b22ebdc3750300",false,,,,false,,,true,,8,,,,,false,"https://cbks0.google.com",false,true,,,,,,false,,,,,,,,false,,,true,true,false,,,,true,"http://mt0.google.com/vt/ft",false,,"http://chart.apis.google.com/chart",true,,,,,,'0.25',false,true,,,,false,,2,160,,,false,true,false,,,true,false,,,45,true,,false,true,true,,,,false,false,false,,false,false,,false,,false,false,true,true,,,false,true,false,false,false,true,,"DE,CH,LI,AT,BE,PL,NL,HU,GR,HR,CZ,SK,TR,BR,EE,ES,AD,SE,NO,DK,FI,IT,VA,SM,IL,CL,MX,AR,BG,PT",false,,"25",true,25,"Home for sale",,false,false,true,false,false,false,"4:https://gt%1$d.google.com/mt?v\x3dgwm.fresh\x26","4:https://gt%1$d.google.com/mt?v\x3dgwh.fresh\x26",,,,true,"",true,true,false,true,true,,,false,"1.x",false,false,false,,true,5000,false,true,,"US",true,true,false,true,false,false,false,24,6,2,false,true,0,false,false,false,false,false,false,false,false,false,true,false,false,true,false,false,"/maps/c",false ];var _mHost = "http://maps.google.com";var _mUri = "/maps";var _mDomain = "google.com";var _mStaticPath = "http://maps.gstatic.com/intl/en_us/mapfiles/";var _mRelativeStaticPath = "/intl/en_us/mapfiles/";var _mJavascriptVersion = G_API_VERSION = "193c";var _mTermsUrl = "http://www.google.com/intl/en_us/help/terms_maps.html";var _mLocalSearchUrl = "http://www.google.com/uds/solutions/localsearch/gmlocalsearch.js";var _mHL = "en";var _mGL = "us";var _mTrafficEnableApi = true;var _mTrafficTileServerUrls = ["http://mt0.google.com/mapstt","http://mt1.google.com/mapstt","http://mt2.google.com/mapstt","http://mt3.google.com/mapstt"];var _mTrafficCameraLayerIds = ["msid:103669521412303283270.000470c7965f9af525967","msid:111496436295867409379.00047329600bf6daab897"];var _mCityblockLatestFlashUrl = "http://maps.google.com/local_url?q=http://www.adobe.com/shockwave/download/download.cgi%3FP1_Prod_Version%3DShockwaveFlash&amp;dq=&amp;file=api&amp;v=2&amp;sensor=false&amp;key=ABQIAAAALwQiU3peqAXUIcejQciDOhQxPI_3sheoXqkznc--aWwZLihkTxQfCzOEVRK5IMcDZ5VBKRhkCfrTzg&amp;s=ANYYN7manSNIV_th6k0SFvGB4jz36is1Gg";var _mCityblockFrogLogUsage = false;var _mCityblockInfowindowLogUsage = false;var _mCityblockDrivingDirectionsLogUsage =false;var _mCityblockPrintwindowLogUsage =false;var _mCityblockPrintwindowImpressionLogUsage =false;var _mCityblockUseSsl = false;var _mAddressBookUrl = "/maps?file\x3dapi\x26v\x3d2\x26sensor\x3dfalse\x26key\x3dABQIAAAALwQiU3peqAXUIcejQciDOhQxPI_3sheoXqkznc--aWwZLihkTxQfCzOEVRK5IMcDZ5VBKRhkCfrTzg\x26ie\x3dUTF8\x26hl\x3den\x26sidr\x3d1\x26oi\x3dsl_menu_edit";var _mWizActions = {hyphenSep: 1,breakSep: 2,dir: 3,searchNear: 6,savePlace: 9};var _mIGoogleUseXSS = false;var _mIGoogleEt = "4b884af4qHpyQdiX";var _mIGoogleServerTrustedUrl = "";var _mMMEnablePanelTab = true;var _mIdcRouterPath = true;var _mIGoogleServerUntrustedUrl = "http://maps.gmodules.com";var _mMplGGeoXml = 100;var _mMplGPoly = 100;var _mMplMapViews = 100;var _mMplGeocoding = 100;var _mMplDirections = 100;var _mMplEnableGoogleLinks = true;var _mMMEnableAddContent = true;var _mMSEnablePublicView = true;var _mMSSurveyUrl = "";var _mMMLogPanelLoad = true;var _mSatelliteToken = "fzwq2qY6BqjPHQ5kJMl8N7UWue2Nynpzzfv1fw";var _mMapCopy = "Map data \x26#169;2010 ";var _mSatelliteCopy = "Imagery \x26#169;2010 ";var _mGoogleCopy = "\x26#169;2010 Google";var _mPreferMetric = false;var _mMapPrintUrl = 'http://www.google.com/mapprint';var _mSvgForced = true;var _mLogPanZoomClks = false;var _mSXBmwAssistUrl = '';var _mSXCarEnabled = true;var _mSXServices = {};var _mSXPhoneEnabled = true;var _mSXQRCodeEnabled = false;var _mLyrcItems = [{label:"12102",layer_id:"com.panoramio.all",featurelet:{feature_id:"layers.panoramio",feature_url:"http://maps.gstatic.com/mapfiles/ftr/layers/panoramio.3.js"}},{label:"12103",layer_id:"com.youtube.all",featurelet:{feature_id:"layers.youtube",feature_url:"http://maps.gstatic.com/mapfiles/ftr/layers/youtube.0.js"}},{label:"12210",layer_id:"org.wikipedia.en"},{label:"12953",layer_id:"com.google.webcams",featurelet:{feature_id:"layers.webcams",feature_url:"http://maps.gstatic.com/mapfiles/ftr/layers/webcams.0.js"}}];var _mAttrInpNumMap = {'hundred': 100,'thousand': 1000,'k': 1000,'million': 1000000,'m': 1000000,'billion': 1000000000,'b': 1000000000};var _mMSMarker = 'Placemark';var _mMSLine = 'Line';var _mMSPolygon = 'Shape';var _mMSImage = 'Image';var _mDirectionsDragging = true;var _mDirectionsEnableCityblock = true;var _mDirectionsEnableApi = true;var _mAdSenseForMapsEnable = "true";var _mAdSenseForMapsFeedUrl = "http://pagead2.googlesyndication.com/afmaps/ads";var _mReviewsWidgetUrl = "http://www.google.com/reviews/scripts/annotations_bootstrap.js?hl\x3den\x26amp;gl\x3dus";var _mLayersTileBaseUrls = ['http://mt0.google.com/mapslt','http://mt1.google.com/mapslt','http://mt2.google.com/mapslt','http://mt3.google.com/mapslt'];var _mLayersFeaturesBaseUrl = "http://mt0.google.com/mapslt/ft";var _mPerTileBase = "http://mt0.google.com/vt/pt";function GLoadMapsScript() {if (!GLoadMapsScript.called && GBrowserIsCompatible()) {GLoadMapsScript.called = true;GScript("http://maps.gstatic.com/intl/en_us/mapfiles/193c/maps2.api/main.js");}}(function() {if (!window.google) window.google = {};if (!window.google.maps) window.google.maps = {};var ns = window.google.maps;ns.BrowserIsCompatible = GBrowserIsCompatible;ns.Unload = GUnload;})();GLoadMapsScript();var _mObfuscatedGaiaId = "104607409716829822249";



(function(){function aa(a){throw a;}
var e=true,i=null,j=false,l,ba=Number.MAX_VALUE,ca="",da="*",ea=":",fa=",",ga=".";var ha="blur",ia="change",m="click",ja="contextmenu",ka="dblclick",la="focus",oa="gesturechange",pa="gestureend",qa="keyup",ra="load",sa="mousemove",ta="mousewheel",ua="DOMMouseScroll",wa="paste",xa="unload",ya="focusin",za="focusout",Aa="updatejson",Ba="construct",Ca="maptypechanged",Da="moveend",Ea="resize",Fa="zoom",Ga="zoomend",Ha="infowindowbeforeclose",Ia="infowindowprepareopen",Ja="infowindowclose",Ka="infowindowopen",La="tilesloaded",Na="visibletilesloaded",Oa="clearlisteners",Pa="softstateurlhook",
Qa="visibilitychanged",Ra="logclick",Sa="moduleloaded";var Ta=1,Ua=2,Va=4,Wa=1,Xa=1,Za=2,$a=1,ab=2,cb=3,db=4,eb=5;var fb="mapsapi";var gb=_mF[38],hb=_mF[39],ib=_mF[57],jb=_mF[60],kb=_mF[69],lb=_mF[99],mb=_mF[100],nb=_mF[105],ob=_mF[119],pb=_mF[149],qb=_mF[150],rb=_mF[151],sb=_mF[152],tb=_mF[153],ub=_mF[154],vb=_mF[155],wb=_mF[156],xb=_mF[163],zb=_mF[166],Ab=_mF[167],Bb=_mF[168],Cb=_mF[174],Db=_mF[183],Eb=_mF[188],Fb=_mF[189],Gb=_mF[190],Hb=_mF[192],Ib=_mF[212],Jb=_mF[213],Kb=_mF[233],Lb=_mF[234],Mb=_mF[238],Nb=_mF[239],Ob=_mF[249],Pb=_mF[257],Qb=_mF[262],Rb=_mF[271],Sb=_mF[280],Ub=_mF[283],Vb=_mF[288],Wb=_mF[289],Xb=_mF[294],
Yb=_mF[299],Zb=_mF[315],$b=_mF[316],ac=_mF[325];var bc=bc||{},cc=this,gc=function(a){if(a.hasOwnProperty&&a.hasOwnProperty(ec))return a[ec];a[ec]||(a[ec]=++fc);return a[ec]},
ec="closure_hashCode_"+Math.floor(Math.random()*2147483648).toString(36),fc=0,n=function(a,b){var c=b||cc;if(arguments.length>2){var d=Array.prototype.slice.call(arguments,2);return function(){var f=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(f,d);return a.apply(c,f)}}else return function(){return a.apply(c,
arguments)}},
p=function(a,b){function c(){}
c.prototype=b.prototype;a.sW=b.prototype;a.prototype=new c;a.prototype.constructor=a};var hc=i,ic=i,jc=i,kc=i;function lc(a,b){window[a]=b}
function mc(a,b){for(var c=0;c<b.length;++c){var d=b[c],f=d[1];if(d[0]){var g=nc(a,d[0]);if(g.length==1)window[g[0]]=f;else{for(var h=window,k=0;k<g.length-1;++k){var o=g[k];h[o]||(h[o]={});h=h[o]}h[g[g.length-1]]=f}}if(g=d[2])for(k=0;k<g.length;++k)f.prototype[g[k][0]]=g[k][1];if(d=d[3])for(k=0;k<d.length;++k)f[d[k][0]]=d[k][1]}}
function nc(a,b){if(b.charAt(0)=="_")return[b];return(/^[A-Z][A-Z0-9_]*$/.test(b)&&a&&a.indexOf(".")==-1?a+"_"+b:a+b).split(".")}
function oc(a,b,c){a=nc(a,b);if(a.length==1)window[a[0]]=c;else{for(b=window;r(a)>1;){var d=a.shift();b[d]||(b[d]={});b=b[d]}b[a[0]]=c}}
function pc(a){for(var b={},c=0,d=r(a);c<d;++c){var f=a[c];b[f[0]]=f[1]}return b}
function sc(a,b,c,d,f,g,h,k){var o=pc(h),q=pc(d);tc(o,function(M,Y){Y=o[M];(M=q[M])&&oc(a,M,Y)});
var s=pc(f),u=pc(b);tc(s,function(M,Y){(M=u[M])&&oc(a,M,Y)});
b=pc(g);var H=pc(c),G={},I={};t(k,function(M){var Y=M[0];G[M[1]]=Y;t(M[2]||[],function(Ma){G[Ma]=Y});
t(M[3]||[],function(Ma){I[Ma]=Y})});
tc(b,function(M,Y){var Ma=H[M],O=j,va=G[M];if(!va){va=I[M];O=e}if(!va)aa(new Error("No class for method: id "+M+", name "+Ma));M=s[va];if(!M)aa(new Error("No constructor for class id: "+va));if(Ma)if(O)M[Ma]=Y;else if(O=M.prototype)O[Ma]=Y;else aa(new Error("No prototype for class id: "+va))})}
;function uc(a,b){this.PV=a;this.fW=b}
;var vc=[],wc,xc,yc=new Image,zc={};function Ac(a){if(typeof _mCityblockUseSsl=="undefined"||!_mCityblockUseSsl)yc.src=a}
window.GVerify=Ac;var Bc=[],Cc=[],Dc,Ec,Fc,Gc,Hc=[0,90,180,270],Ic=["NORTH","EAST","SOUTH","WEST"],Jc="ab1",Kc="mt0",Lc="mt1",Mc="plt",Nc="vt1";function Oc(a,b,c,d,f,g,h,k,o,q,s,u){v(Pc,Ba,function(H){Cc.push(H)});
if(typeof wc!="object"){o=o||{export_legacy_names:e,public_api:e};hc=d||i;ic=f||i;jc=g||i;kc=o.sensor||i;xc=!!h;Dc=o.bcp47_language_code;Ec=o.log_info_window_ratio||0;Fc=o.log_fragment_count||0;Gc=o.log_fragment_seed||0;new uc(1729,131071);Qc(Rc,i);k=k||"G";f=o.export_legacy_names;q=q||[];d=o.public_api;g=Sc(o);h=Tc(o);Uc(a,b,c,q,k,d,g,h,!!o.load_tileshift,f,o.obliques_urls||[]);vc.push(k);f&&vc.push("G");t(vc,function(H){Vc(H)});
Wc(Xc(o.jsmain,o.module_override),Yc);(a=o.experiment_ids)&&Zc(a.join(","));if(d){$c(fb);ad(u?u.timers:undefined)}}}
function bd(a){var b=a.getTick(Nc),c=a.getTick("jsd.drag");if(!b||!c)a.branch();if(b&&c){var d=a.getTick(Kc),f=a.getTick(Jc);a.tick(Mc,Math.max(b,c)-d+f);a.done()}}
function ad(a){var b=new cd("apiboot");a&&b.adopt(a);b.tick(Jc);dd(b);var c=0;if(a)c=ed()-a.start;var d=v(Pc,Ba,function(f){w(d);d=i;var g=new cd("maptiles"),h={};h.start=ed()-c;g.adopt(h);if(b){h=f.O();b.Xg("ms",h.width+"x"+h.height);b.tick(Kc);g.tick(Kc);fd(f,La,function(){b.done(Lc);g.done(Lc);dd(i)});
fd(f,Na,function(o){b.Xg("nvt",""+o);b.tick(Nc);g.tick(Nc);bd(b)});
var k=v(x(gd),Sa,function(o){if(o=="drag"){w(k);k=i;bd(b)}})}else{g.tick(Kc);
fd(f,La,function(){hd(g,f);g.done(Lc)});
fd(f,Na,function(){g.tick(Nc)})}});
setTimeout(function(){if(d){b.done();b=i;dd(i)}},
10000)}
function Sc(a){var b=[];if(a)if((a=a.zoom_override)&&a.length)for(var c=0;c<a.length;++c)for(var d=b[a[c].maptype]=[],f=a[c].override,g=0;g<f.length;++g){var h=f[g].rect;h=new id(new z(h.lo.lat_e7/10000000,h.lo.lng_e7/10000000),new z(h.hi.lat_e7/10000000,h.hi.lng_e7/10000000));d.push([h,f[g].max_zoom])}return b}
function Tc(a){var b=[];if(a)if((a=a.tile_override)&&a.length)for(var c=0;c<a.length;++c){b[a[c].maptype]||(b[a[c].maptype]=[]);b[a[c].maptype].push({minZoom:a[c].min_zoom,maxZoom:a[c].max_zoom,rect:a[c].rect,uris:a[c].uris,mapprintUrl:a[c].mapprint_url})}return b}
function jd(){for(var a=[],b=x(kd).Z,c=0,d=r(b);c<d;++c){var f=b[c],g=f.Wb;if(g&&!g.__tag__){g.__tag__=e;A(g,Oa);a.push(g)}f.remove()}for(c=0;c<r(a);++c){g=a[c];if(g.__tag__)try{delete g.__tag__;delete g.__e_}catch(h){g.__tag__=j;g.__e_=i}}x(kd).clear();ld(document.body)}
function Uc(a,b,c,d,f,g,h,k,o,q,s){var u=new md(_mMapCopy),H=new md(_mSatelliteCopy),G=new md(_mMapCopy),I=new md;lc("GAddCopyright",nd(u,H,G));window.GAppFeatures=od;var M=[];wc=[];M.push(["DEFAULT_MAP_TYPES",wc]);var Y=new pd(B(30,30)+1),Ma=f=="G";function O(qc,ag,kf,rh){zc[kf]=qc;ag&&wc.push(qc);M.push([kf,qc]);rh&&Ma&&M.push([rh,qc])}
D.initializeLowBandwidthMapLayers();var va,Ya,Tb;if(r(a)){va=qd(a,u,Y,h,k,g);O(va,e,"NORMAL_MAP","MAP_TYPE")}if(r(b)){var dc=[];ac&&t(Hc,function(qc){dc.push(new rd(30,qc))});
a=new sd;Ya=td(b,H,Y,h,a);O(Ya,e,"SATELLITE_MAP","SATELLITE_TYPE");b=[];if(ac)b=ud(s,I,a,dc,M);if(o){var rc=Ya.getTileLayers()[0];vd("tlsf",Xa,function(qc){qc(rc)});
lc("GTileShiftUpdateOffset",wd("tlsf",Za))}if(r(c)){o=new sd;Tb=xd(c,u,Y,h,k,Ya,g,o);ac&&yd(c,u,o,b,M);O(Tb,e,"HYBRID_MAP","HYBRID_TYPE")}}r(d)&&O(zd(d,G,Y,h,k),!g,"PHYSICAL_MAP");c=!g&&nb&&E.bC(xb);O(Ad(),c,"SATELLITE_3D_MAP");O(Bd(),c,"HYBRID_3D_MAP");if(g&&Eb&&va&&Ya&&Tb)M=M.concat(Cd(va,Ya,Tb,Y));mc(f,M);q&&mc("G",M)}
function qd(a,b,c,d,f,g){var h={shortName:F(10111),urlArg:"m",errorMessage:F(10120),alt:F(10511),tileSize:256,lbw:D.mapTileLayer},k=i;k=Rb?new Dd(a,b,17):new Ed(a,b,17);k.ip(d[0]);k.fp(Fd(f[0],c,256,17));!g&&Wb&&Gd(k);return new Hd([k],c,F(10049),h)}
function td(a,b,c,d,f){f={shortName:F(10112),urlArg:"k",textColor:"white",linkColor:"white",errorMessage:F(10121),alt:F(10512),lbw:D.satTileLayer,maxZoomEnabled:e,rmtc:f,isDefault:e};a=new Id(a,b,19,_mSatelliteToken,_mDomain);a.ip(d[1]);return new Hd([a],c,F(10050),f)}
function ud(a,b,c,d,f){var g=[];t(Hc,function(h,k){var o=Jd(a,function(s){return s+"deg="+h+"&"});
o=new Id(o,b,21,_mSatelliteToken,_mDomain);var q={shortName:"Aer",textColor:"white",linkColor:"white",errorMessage:F(10121),alt:F(10512),heading:h,rmtc:c};o=new Hd([o],d[k],"Aerial",q);g.push(o);f.push(["AERIAL_"+Ic[k]+"_MAP",o]);f.push(["OBLIQUE_SATELLITE_"+Ic[k]+"_MAP",o])});
f.push(["AERIAL_MAP",g[0]]);return g}
function xd(a,b,c,d,f,g,h,k){k={shortName:F(10117),urlArg:"h",textColor:"white",linkColor:"white",errorMessage:F(10121),alt:F(10513),tileSize:256,lbw:D.hybTileLayer,maxZoomEnabled:e,rmtc:k,isDefault:e};g=g.getTileLayers()[0];var o=i;o=Rb?new Dd(a,b,17,e):new Ed(a,b,17,e);o.ip(d[2]);o.fp(Fd(f[2],c,256,17));!h&&Wb&&Gd(o);return new Hd([g,o],c,F(10116),k)}
function yd(a,b,c,d,f){var g=[];t(Hc,function(h,k){var o=d[k].getTileLayers()[0],q=Jd(a,function(H){return H+"opts=o&deg="+h+"&"}),
s=i;s=Rb?new Dd(q,b,21,e):new Ed(q,b,21,e);q={shortName:"Aer Hyb",textColor:"white",linkColor:"white",errorMessage:F(10121),alt:F(10513),heading:h,rmtc:c};var u=d[k].getProjection();o=new Hd([o,s],u,"Aerial Hybrid",q);g.push(o);f.push(["AERIAL_HYBRID_"+Ic[k]+"_MAP",o]);f.push(["OBLIQUE_HYBRID_"+Ic[k]+"_MAP",o])});
f.push(["AERIAL_HYBRID_MAP",g[0]]);return g}
function zd(a,b,c,d,f){var g={shortName:F(11759),urlArg:"p",errorMessage:F(10120),alt:F(11751),tileSize:256,lbw:D.terTileLayer};a=new Ed(a,b,15,j);a.ip(d[3]);a.fp(Fd(f[3],c,256,15));return new Hd([a],c,F(11758),g)}
function Fd(a,b,c,d){for(var f=[],g=0;g<r(a);++g){for(var h={minZoom:a[g].minZoom||1,maxZoom:a[g].maxZoom||d,uris:a[g].uris,rect:[]},k=0;k<r(a[g].rect);++k){h.rect[k]=[];for(var o=h.minZoom;o<=h.maxZoom;++o){var q=b.fromLatLngToPixel(new z(a[g].rect[k].lo.lat_e7/10000000,a[g].rect[k].lo.lng_e7/10000000),o),s=b.fromLatLngToPixel(new z(a[g].rect[k].hi.lat_e7/10000000,a[g].rect[k].hi.lng_e7/10000000),o);h.rect[k][o]={n:Kd(s.y/c),w:Kd(q.x/c),s:Kd(q.y/c),e:Kd(s.x/c)}}}f.push(h)}return f?new Ld(f):i}
function Md(a,b,c){var d=B(30,30),f=new pd(d+1),g=new Hd([],f,a,{maxResolution:d,urlArg:b});t(wc,function(h){h.getUrlArg()==c&&g.YS(h)});
return g}
var Nd;function Ad(){return Nd=Md(F(12492),"e","k")}
var Od;function Bd(){return Od=Md(F(13171),"f","h")}
function nd(a,b,c){return function(d,f,g,h,k,o,q,s,u,H,G){var I=a;if(d=="k")I=b;else if(d=="p")I=c;d=new id(new z(g,h),new z(k,o));I.Oi(new Qd(f,d,q,s,u,H,G))}}
function Vc(a){t(Bc,function(b){b(a)})}
window.GUnloadApi=jd;function Rd(a){if(!a)return"";var b="";if(a.nodeType==3||a.nodeType==4||a.nodeType==2)b+=a.nodeValue;else if(a.nodeType==1||a.nodeType==9||a.nodeType==11)for(var c=0;c<r(a.childNodes);++c)b+=arguments.callee(a.childNodes[c]);return b}
function Sd(a){if(typeof ActiveXObject!="undefined"&&typeof GetObject!="undefined"){var b=new ActiveXObject("Microsoft.XMLDOM");b.loadXML(a);return b}if(typeof DOMParser!="undefined")return(new DOMParser).parseFromString(a,"text/xml");return J("div",i)}
function Td(a){return new Ud(a)}
function Ud(a){this.qH=a}
Ud.prototype.$U=function(a,b){if(E.type==1){Vd(b,a.transformNode(this.qH));return e}else if(XSLTProcessor&&XSLTProcessor.prototype.importStylesheet){var c=new XSLTProcessor;c.importStylesheet(this.qH);a=c.transformToFragment(a,window.document);Wd(b);b.appendChild(a);return e}else return j};function Xd(){return typeof Dc=="string"?Dc:"en"}
;var Yd={},Zd="__ticket__";function $d(a,b,c){this.AG=a;this.FU=b;this.zG=c}
$d.prototype.toString=function(){return""+this.zG+"-"+this.AG};
$d.prototype.sc=function(){return this.FU[this.zG]==this.AG};
function ae(a){var b=arguments.callee;if(!b.Lq)b.Lq=1;var c=(a||"")+b.Lq;b.Lq++;return c}
function be(a,b){var c;if(typeof a=="string"){c=Yd;a=a}else{c=a;a=(b||"")+Zd}c[a]||(c[a]=0);b=++c[a];return new $d(b,c,a)}
function ce(a){if(typeof a=="string")Yd[a]&&Yd[a]++;else a[Zd]&&a[Zd]++}
;var de=window._mStaticPath,Rc=de+"transparent.png",ee=Math.PI,fe=Math.abs,ge=Math.asin,he=Math.atan,je=Math.atan2,ke=Math.ceil,le=Math.cos,Kd=Math.floor,B=Math.max,me=Math.min,ne=Math.pow,K=Math.round,oe=Math.sin,pe=Math.sqrt,qe=Math.tan,re="function";function r(a){return a?a.length:0}
function se(a,b,c){if(b!=i)a=B(a,b);if(c!=i)a=me(a,c);return a}
function te(a,b,c){if(a==Number.POSITIVE_INFINITY)return c;else if(a==Number.NEGATIVE_INFINITY)return b;for(;a>c;)a-=c-b;for(;a<b;)a+=c-b;return a}
function ue(a){return typeof a!="undefined"}
function ve(a){return typeof a=="number"}
function we(a){return typeof a=="string"}
function xe(a,b,c){for(var d=0,f=0;f<r(a);++f)if(a[f]===b||c&&a[f]==b){a.splice(f--,1);d++}return d}
function ye(a,b,c){for(var d=0;d<r(a);++d)if(a[d]===b||c&&a[d]==b)return j;a.push(b);return e}
function ze(a,b,c){for(var d=0;d<r(a);++d)if(c(a[d],b)){a.splice(d,0,b);return e}a.push(b);return e}
function Ce(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return e;return j}
function De(a,b,c){tc(b,function(d){a[d]=b[d]},
c)}
function Ee(a){for(var b in a)return j;return e}
function Fe(a){for(var b in a)delete a[b]}
function Ge(a,b,c){t(c,function(d){if(!b.hasOwnProperty||b.hasOwnProperty(d))a[d]=b[d]})}
function t(a,b){if(a)for(var c=0,d=r(a);c<d;++c)b(a[c],c)}
function tc(a,b,c){if(a)for(var d in a)if(c||!a.hasOwnProperty||a.hasOwnProperty(d))b(d,a[d])}
function He(a,b){var c=0;tc(a,function(){++c},
b);return c}
function Ie(a,b){if(a.hasOwnProperty)return a.hasOwnProperty(b);else{for(var c in a)if(c==b)return e;return j}}
function Je(a,b,c){for(var d,f=r(a),g=0;g<f;++g){var h=b.call(a[g]);d=g==0?h:c(d,h)}return d}
function Jd(a,b){for(var c=[],d=r(a),f=0;f<d;++f)c.push(b(a[f],f));return c}
function Ke(a,b,c,d){c=Le(c,0);var f=r(b);d=Le(d,f);for(c=c;c<d;++c)a.push(b[c])}
function Me(a){return Array.prototype.slice.call(a,0)}
function Ne(){return j}
function Oe(){return e}
function Pe(){return i}
function Qe(a){return a*(ee/180)}
function Re(a){return a/(ee/180)}
function Se(a,b,c){return fe(a-b)<=(c||1.0E-9)}
var Te="&amp;",Ue="&lt;",Ve="&gt;",We="&",Xe="<",Ye=">",Ze=/&/g,$e=/</g,af=/>/g;function cf(a){if(a.indexOf(We)!=-1)a=a.replace(Ze,Te);if(a.indexOf(Xe)!=-1)a=a.replace($e,Ue);if(a.indexOf(Ye)!=-1)a=a.replace(af,Ve);return a}
function df(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")}
function ef(a,b){var c=r(a),d=r(b);return d==0||d<=c&&a.lastIndexOf(b)==c-d}
function ff(a){a.length=0}
function gf(){return Function.prototype.call.apply(Array.prototype.slice,arguments)}
function hf(a){return parseInt(a,10)}
function jf(a){return parseInt(a,16)}
function Le(a,b){return ue(a)&&a!=i?a:b}
function L(a,b,c){return(c?c:de)+a+(b?".gif":".png")}
function N(){}
function lf(a,b){if(a)return function(){--a||b()};
else{b();return N}}
function mf(a){var b=[],c=i;return function(d){d=d||N;if(c)d.apply(this,c);else{b.push(d);r(b)==1&&a.call(this,function(){for(c=Me(arguments);r(b);)b.shift().apply(this,c)})}}}
function nf(a){return!!a&&(a instanceof Array||Object.prototype.toString.call(a)=="[object Array]")}
function x(a){if(!a.Wb)a.Wb=new a;return a.Wb}
function of(a,b,c){var d=[];tc(a,function(f,g){d.push(f+b+g)});
return d.join(c)}
function pf(){var a=Me(arguments);a.unshift(i);return qf.apply(i,a)}
function rf(a,b){var c=gf(arguments,2);return function(){var d=Me(arguments);if(r(d)<b)d.length=b;Array.prototype.splice.apply(d,Array.prototype.concat.apply([],[[b,0],c]));return a.apply(this,d)}}
function qf(a,b){if(arguments.length>2){var c=gf(arguments,2);return function(){return b.apply(a||this,arguments.length>0?c.concat(Me(arguments)):c)}}else return function(){return b.apply(a||this,
arguments)}}
function sf(){return qf.apply(i,arguments)}
function tf(){return qf.apply(i,arguments)}
function uf(a,b){var c=gf(arguments,2);return function(){return b.apply(a,c)}}
;var vf=["opera","msie","chrome","applewebkit","firefox","camino","mozilla"],wf=["x11;","macintosh","windows"];
function xf(a){this.agent=a;this.cpu=this.os=this.type=-1;this.revision=this.version=0;a=a.toLowerCase();for(var b=0;b<r(vf);b++){var c=vf[b];if(a.indexOf(c)!=-1){this.type=b;if((new RegExp(c+"[ /]?([0-9]+(.[0-9]+)?)")).exec(a))this.version=parseFloat(RegExp.$1);break}}if(this.type==6)if(/^Mozilla\/.*Gecko\/.*(Minefield|Shiretoko)[ \/]?([0-9]+(.[0-9]+)?)/.exec(this.agent)){this.type=4;this.version=parseFloat(RegExp.$2)}for(b=0;b<r(wf);b++){c=wf[b];if(a.indexOf(c)!=-1){this.os=b;break}}if(this.os==
1&&a.indexOf("intel")!=-1)this.cpu=0;if(this.Na()&&/\brv:\s*(\d+\.\d+)/.exec(a))this.revision=parseFloat(RegExp.$1)}
l=xf.prototype;l.Na=function(){return this.type==4||this.type==6||this.type==5};
l.pb=function(){return this.type==2||this.type==3};
l.Jn=function(){return this.type==1&&this.version<7};
l.gO=function(){return this.type==4&&this.version>=3};
l.ox=function(){return this.Jn()};
l.px=function(){if(this.type==1)return e;if(this.pb())return j;if(this.Na())return!this.revision||this.revision<1.9;return e};
l.aC=function(){return this.type==1?"CSS1Compat"!=this.qA():j};
l.qA=function(){return Le(document.compatMode,"")};
l.Dh=function(){return this.type==3&&(this.agent.indexOf("iPhone")!=-1||this.agent.indexOf("iPod")!=-1||this.agent.indexOf("Android")!=-1)};
l.bC=function(a){var b=this.qM()+"-"+this.QM();return a.indexOf(b)!=-1};
var yf={};yf[2]="windows";yf[1]="macos";yf[0]="unix";yf[-1]="other";var zf={};zf[1]="ie";zf[4]="firefox";zf[2]="chrome";zf[3]="safari";zf[0]="opera";zf[5]="camino";zf[6]="mozilla";zf[-1]="other";xf.prototype.qM=function(){return yf[this.os]};
xf.prototype.QM=function(){return zf[this.type]};
var E=new xf(navigator.userAgent);function J(a,b,c,d,f,g,h){var k;if(E.type==1&&g){a="<"+a+" ";for(k in g)a+=k+"='"+g[k]+"' ";a+=">";g=i}a=Af(b).createElement(a);if(g)for(k in g)a.setAttribute(k,g[k]);c&&Bf(a,c,h);d&&Cf(a,d);b&&!f&&Df(b,a);return a}
function Ef(a,b){a=Af(b).createTextNode(a);b&&Df(b,a);return a}
function Af(a){return a?a.nodeType==9?a:a.ownerDocument||document:document}
function Q(a){return K(a)+"px"}
function Ff(a){return a+"em"}
function Bf(a,b,c){Gf(a);c?Hf(a,b.x):If(a,b.x);Jf(a,b.y)}
function If(a,b){a.style.left=Q(b)}
function Hf(a,b){a.style.right=Q(b)}
function Jf(a,b){a.style.top=Q(b)}
function Cf(a,b){a=a.style;a.width=b.getWidthString();a.height=b.getHeightString()}
function Kf(a){return new R(a.offsetWidth,a.offsetHeight)}
function Lf(a,b){a.style.width=Q(b)}
function Mf(a,b){a.style.height=Q(b)}
function Nf(a,b){return b&&Af(b)?Af(b).getElementById(a):document.getElementById(a)}
function Of(a,b){a.style.display=b?"":"none"}
function Pf(a,b){a.style.visibility=b?"":"hidden"}
function Qf(a){Of(a,j)}
function Rf(a){Of(a,e)}
function Sf(a){return a.style.display=="none"}
function Tf(a){Pf(a,j)}
function Uf(a){Pf(a,e)}
function Vf(a){a.style.visibility="visible"}
function Wf(a){a.style.position="relative"}
function Gf(a){a.style.position="absolute"}
function Xf(a){Yf(a,"hidden")}
function Zf(a){Yf(a,"auto")}
function Yf(a,b){a.style.overflow=b}
function $f(a,b){if(ue(b))try{a.style.cursor=b}catch(c){b=="pointer"&&$f(a,"hand")}}
function bg(a){cg(a,"gmnoscreen");dg(a,"gmnoprint")}
function eg(a){cg(a,"gmnoprint");dg(a,"gmnoscreen")}
function fg(a,b){a.style.zIndex=b}
function ed(){return(new Date).getTime()}
function Df(a,b){a.appendChild(b)}
function gg(a){if(E.Na())a.style.MozUserSelect="none";else if(E.pb())a.style.KhtmlUserSelect="none";else{a.unselectable="on";a.onselectstart=Ne}}
function hg(a,b){if(E.type==1)a.style.filter="alpha(opacity="+K(b*100)+")";else a.style.opacity=b}
function ig(a){var b=Af(a);if(a.currentStyle)return a.currentStyle;if(b.defaultView&&b.defaultView.getComputedStyle)return b.defaultView.getComputedStyle(a,"")||{};return a.style}
function jg(a,b){var c=hf(b);if(!isNaN(c)){if(b==c||b==c+"px")return c;if(a){c=a.style;var d=c.width;c.width=b;a=a.clientWidth;c.width=d;return a}}return 0}
function kg(a,b){b=ig(a)[b];return jg(a,b)}
function lg(a){return a.replace(/%3A/gi,":").replace(/%20/g,"+").replace(/%2C/gi,",")}
function mg(a,b){var c=[];tc(a,function(d,f){f!=i&&c.push(encodeURIComponent(d)+"="+lg(encodeURIComponent(f)))});
a=c.join("&");return b?a?"?"+a:"":a}
function ng(a){a=a.split("&");for(var b={},c=0;c<r(a);c++){var d=a[c].split("=");if(r(d)==2){var f=d[1].replace(/,/gi,"%2C").replace(/[+]/g,"%20").replace(/:/g,"%3A");try{b[decodeURIComponent(d[0])]=decodeURIComponent(f)}catch(g){}}}return b}
function og(a){var b=a.indexOf("?");return b!=-1?a.substr(b+1):""}
function pg(a){try{return eval("["+a+"][0]")}catch(b){return i}}
function qg(a,b,c,d){rg(d);return window.setTimeout(function(){b.call(a);sg(d)},
c)}
;function Qd(){Qd.g.apply(this,arguments)}
function tg(){tg.g.apply(this,arguments)}
function md(){md.g.apply(this,arguments)}
;Qd.g=function(a,b,c,d,f,g,h){this.id=a;this.minZoom=c;this.bounds=b;this.text=d;this.maxZoom=f;this.kJ=g;this.featureTriggers=h};
md.g=function(a){this.Nw=[];this.fh={};this.qR=a||""};
md.prototype.Oi=function(a){if(this.fh[a.id])return j;for(var b=this.Nw,c=a.minZoom;r(b)<=c;)b.push([]);b[c].push(a);this.fh[a.id]=1;A(this,"newcopyright",a);return e};
md.prototype.as=function(a){for(var b=[],c=this.Nw,d=0;d<r(c);d++)for(var f=0;f<r(c[d]);f++){var g=c[d][f];g.bounds.contains(a)&&b.push(g)}return b};
tg.g=function(a,b,c){this.prefix=a;this.copyrightTexts=b;this.featureTriggers=c};
tg.prototype.toString=function(){return this.prefix+" "+this.copyrightTexts.join(", ")};
md.prototype.kA=function(a,b){for(var c={},d={},f=[],g=[],h=this.Nw,k=i,o=me(b,r(h)-1);o>=0;o--){for(var q=h[o],s=j,u=j,H=0;H<r(q);H++){var G=q[H];if(!(typeof G.maxZoom=="number"&&G.maxZoom<b)){var I=G.bounds,M=G.text;if(I.intersects(a)){if(M&&!c[M]){f.push(M);c[M]=1}t(G.featureTriggers||[],function(Y){if(!d[Y[0]]&&(r(Y)<2||b>=Y[1])&&(r(Y)<3||b<=Y[2])){g.push(Y[0]);d[Y[0]]=1}});
if(G.kJ)u=e;else if(k===i)k=new id(I.nb(),I.mb());else k.union(I);if(!u&&k.kc(a))s=e}}}if(s)break}return[f,g]};
md.prototype.getCopyrights=function(a,b){return this.kA(a,b)[0]};
md.prototype.$r=function(a,b){a=this.kA(a,b);if(r(a[0])>0||r(a[1])>0)return new tg(this.qR,a[0],a[1]);return i};var ug="Status",vg="code";function wg(){wg.g.apply(this,arguments)}
;var xg="_xdc_";wg.g=function(a,b,c){c=c||{};this.Mb=a;this.lj=b;this.LG=Le(c.timeout,10000);this.EI=Le(c.callback,"callback");this.FI=Le(c.suffix,"");this.rD=Le(c.neat,j);this.mT=Le(c.locale,j);this.DI=c.callbackNameGenerator||n(this.TJ,this)};
var yg=0;
wg.prototype.send=function(a,b,c,d,f){f=f||{};var g=this.lj.getElementsByTagName("head")[0];if(g){rg(d,"xdc0");var h=this.DI(a);window[xg]||(window[xg]={});var k=this.lj.createElement("script"),o=0;if(this.LG>0){o=zg(h,k,a,c,d);o=window.setTimeout(o,this.LG)}c="?";if(this.Mb&&this.Mb.indexOf("?")!=-1)c="&";a=this.Mb+c+Ag(a,this.rD);if(this.mT){a=a;c=this.rD;var q={};q.hl=window._mHL;q.country=window._mGL;a=a+"&"+Ag(q,c)}if(b){b=Bg(h,k,b,o,d);window[xg][h]=b;a+="&"+this.EI+"="+xg+"."+h}k.setAttribute("type","text/javascript");
k.setAttribute("id",h);k.setAttribute("charset","UTF-8");k.setAttribute("src",a);g.appendChild(k);f.id=h;f.timeout=o;f.stats=d}else c&&c(a)};
wg.prototype.cancel=function(a){var b=a.id,c=a.timeout;a=a.stats;c&&window.clearTimeout(c);if(b)if((c=this.lj.getElementById(b))&&c.tagName=="SCRIPT"&&typeof window[xg][b]=="function"){Cg(c);delete window[xg][b];sg(a,"xdcc")}};
wg.prototype.TJ=function(){return"_"+(yg++).toString(36)+ed().toString(36)+this.FI};
function zg(a,b,c,d,f){return function(){Dg(a,b);Eg(f,"xdce");d&&d(c);sg(f)}}
function Bg(a,b,c,d,f){return function(g){window.clearTimeout(d);Dg(a,b);Eg(f,"xdc1");c(g);sg(f)}}
function Dg(a,b){window.setTimeout(function(){Cg(b);window[xg][a]&&delete window[xg][a]},
0)}
function Ag(a,b){var c=[];tc(a,function(d,f){var g=[f];if(nf(f))g=f;t(g,function(h){if(h!=i){h=b?lg(encodeURIComponent(h)):encodeURIComponent(h);c.push(encodeURIComponent(d)+"="+h)}})});
return c.join("&")}
;function Fg(){}
;function Gg(a,b,c){c=c&&c.dynamicCss;var d=J("style",i);d.setAttribute("type","text/css");if(d.styleSheet)d.styleSheet.cssText=b;else{b=document.createTextNode(b);d.appendChild(b)}a:{d.originalName=a;b=Hg();for(var f=b.getElementsByTagName(d.nodeName),g=0;g<r(f);g++){var h=f[g],k=h.originalName;if(!(!k||k<a)){if(k==a)c&&h.parentNode.replaceChild(d,h);else h.parentNode.insertBefore(d,h);break a}}b.appendChild(d)}}
window.__gcssload__=Gg;function Ig(a,b){(new Jg(b)).run(a)}
function Jg(a){this.Ge=a}
Jg.prototype.run=function(a){for(this.Xc=[a];r(this.Xc);)this.BR(this.Xc.shift())};
Jg.prototype.BR=function(a){this.Ge(a);for(a=a.firstChild;a;a=a.nextSibling)a.nodeType==1&&this.Xc.push(a)};
function Kg(a,b,c){a.setAttribute(b,c)}
function Lg(a,b){a.removeAttribute(b)}
function dg(a,b){var c=a.className?String(a.className):"";if(c){c=c.split(/\s+/);for(var d=j,f=0;f<r(c);++f)if(c[f]==b){d=e;break}d||c.push(b);a.className=c.join(" ")}else a.className=b}
function cg(a,b){var c=a.className?String(a.className):"";if(!(!c||c.indexOf(b)==-1)){c=c.split(/\s+/);for(var d=0;d<r(c);++d)c[d]==b&&c.splice(d--,1);a.className=c.join(" ")}}
function Mg(a){return a.parentNode.removeChild(a)}
function Hg(){if(!Ng){var a=document.getElementsByTagName("base")[0];if(!document.body&&a&&r(a.childNodes))return a;Ng=document.getElementsByTagName("head")[0]}return Ng}
var Ng;function Og(){Og.g.apply(this,arguments)}
;function Cg(a){if(a.parentNode){a.parentNode.removeChild(a);Pg(a)}ld(a)}
function ld(a){Ig(a,function(b){if(b.nodeType!=3){b.onselectstart=i;b.imageFetcherOpts=i}})}
function Wd(a){for(var b;b=a.firstChild;){Pg(b);a.removeChild(b)}}
function Vd(a,b){if(a.innerHTML!=b){Wd(a);a.innerHTML=b}}
function Qg(a){if((a=a.srcElement||a.target)&&a.nodeType==3)a=a.parentNode;return a}
function Pg(a,b){Ig(a,function(c){Rg(c,b)})}
function Sg(a){a.type==m&&A(document,Ra,a);if(E.type==1){a.cancelBubble=e;a.returnValue=j}else{a.preventDefault();a.stopPropagation()}}
function Tg(a){a.type==m&&A(document,Ra,a);if(E.type==1)a.cancelBubble=e;else a.stopPropagation()}
function Ug(a){if(E.type==1)a.returnValue=j;else a.preventDefault()}
;var Vg="pixels";function S(a,b){this.x=a;this.y=b}
var Xg=new S(0,0);S.prototype.toString=function(){return"("+this.x+", "+this.y+")"};
S.prototype.equals=function(a){if(!a)return j;return a.x==this.x&&a.y==this.y};
function R(a,b,c,d){this.width=a;this.height=b;this.CV=c||"px";this.uN=d||"px"}
var Yg=new R(0,0);R.prototype.getWidthString=function(){return this.width+this.CV};
R.prototype.getHeightString=function(){return this.height+this.uN};
R.prototype.toString=function(){return"("+this.width+", "+this.height+")"};
R.prototype.equals=function(a){if(!a)return j;return a.width==this.width&&a.height==this.height};
function Zg(a){this.minX=this.minY=ba;this.maxX=this.maxY=-ba;var b=arguments;if(r(a))t(a,n(this.extend,this));else if(r(b)>=4){this.minX=b[0];this.minY=b[1];this.maxX=b[2];this.maxY=b[3]}}
l=Zg.prototype;l.min=function(){return new S(this.minX,this.minY)};
l.max=function(){return new S(this.maxX,this.maxY)};
l.O=function(){return new R(this.maxX-this.minX,this.maxY-this.minY)};
l.mid=function(){return new S((this.minX+this.maxX)/2,(this.minY+this.maxY)/2)};
l.toString=function(){return"("+this.min()+", "+this.max()+")"};
l.ma=function(){return this.minX>this.maxX||this.minY>this.maxY};
l.kc=function(a){var b=this;return b.minX<=a.minX&&b.maxX>=a.maxX&&b.minY<=a.minY&&b.maxY>=a.maxY};
l.Kf=function(a){var b=this;return b.minX<=a.x&&b.maxX>=a.x&&b.minY<=a.y&&b.maxY>=a.y};
l.jJ=function(a){return this.maxX>=a.x&&this.minY<=a.y&&this.maxY>=a.y};
l.extend=function(a){if(this.ma()){this.minX=this.maxX=a.x;this.minY=this.maxY=a.y}else{this.minX=me(this.minX,a.x);this.maxX=B(this.maxX,a.x);this.minY=me(this.minY,a.y);this.maxY=B(this.maxY,a.y)}};
l.EK=function(a){if(!a.ma()){this.minX=me(this.minX,a.minX);this.maxX=B(this.maxX,a.maxX);this.minY=me(this.minY,a.minY);this.maxY=B(this.maxY,a.maxY)}};
var $g=function(a,b){a=new Zg(B(a.minX,b.minX),B(a.minY,b.minY),me(a.maxX,b.maxX),me(a.maxY,b.maxY));if(a.ma())return new Zg;return a},
ah=function(a,b){if(a.minX>b.maxX)return j;if(b.minX>a.maxX)return j;if(a.minY>b.maxY)return j;if(b.minY>a.maxY)return j;return e};
Zg.prototype.equals=function(a){return this.minX==a.minX&&this.minY==a.minY&&this.maxX==a.maxX&&this.maxY==a.maxY};
Zg.prototype.copy=function(){return new Zg(this.minX,this.minY,this.maxX,this.maxY)};
function bh(a,b,c,d){this.point=new S(a,b);this.xunits=c||Vg;this.yunits=d||Vg}
function ch(a,b,c,d){this.size=new R(a,b);this.xunits=c||Vg;this.yunits=d||Vg}
;var dh="iframeshim";var eh="BODY";
function fh(a,b){var c=new S(0,0);if(a==b)return c;var d=Af(a);if(a.getBoundingClientRect){d=a.getBoundingClientRect();c.x+=d.left;c.y+=d.top;gh(c,ig(a));if(b){a=fh(b);c.x-=a.x;c.y-=a.y}return c}else if(d.getBoxObjectFor&&window.pageXOffset==0&&window.pageYOffset==0){if(b){var f=ig(b);c.x-=jg(i,f.borderLeftWidth);c.y-=jg(i,f.borderTopWidth)}else b=d.documentElement;f=d.getBoxObjectFor(a);b=d.getBoxObjectFor(b);c.x+=f.screenX-b.screenX;c.y+=f.screenY-b.screenY;gh(c,ig(a));return c}else return hh(a,b)}
function hh(a,b){var c=new S(0,0),d=ig(a);a=a;var f=e;if(E.pb()||E.type==0&&E.version>=9){gh(c,d);f=j}for(;a&&a!=b;){c.x+=a.offsetLeft;c.y+=a.offsetTop;f&&gh(c,d);a.nodeName==eh&&ih(c,a,d);var g=a.offsetParent,h=i;if(g){h=ig(g);E.Na()&&E.revision>=1.8&&g.nodeName!=eh&&h.overflow!="visible"&&gh(c,h);c.x-=g.scrollLeft;c.y-=g.scrollTop;if(E.type!=1&&jh(a,d,h)){if(E.Na()){d=ig(g.parentNode);if(E.qA()!="BackCompat"||d.overflow!="visible"){c.x-=window.pageXOffset;c.y-=window.pageYOffset}gh(c,d)}break}}a=
g;d=h}if(E.type==1&&document.documentElement){c.x+=document.documentElement.clientLeft;c.y+=document.documentElement.clientTop}if(b&&a==i){b=hh(b);c.x-=b.x;c.y-=b.y}return c}
function jh(a,b,c){if(a.offsetParent.nodeName==eh&&c.position=="static"){a=b.position;return E.type==0?a!="static":a=="absolute"}return j}
function ih(a,b,c){var d=b.parentNode,f=j;if(E.Na()){var g=ig(d);f=c.overflow!="visible"&&g.overflow!="visible";var h=c.position!="static";if(h||f){a.x+=jg(i,c.marginLeft);a.y+=jg(i,c.marginTop);gh(a,g)}if(h){a.x+=jg(i,c.left);a.y+=jg(i,c.top)}a.x-=b.offsetLeft;a.y-=b.offsetTop}if((E.Na()||E.type==1)&&document.compatMode!="BackCompat"||f)if(window.pageYOffset){a.x-=window.pageXOffset;a.y-=window.pageYOffset}else{a.x-=d.scrollLeft;a.y-=d.scrollTop}}
function gh(a,b){a.x+=jg(i,b.borderLeftWidth);a.y+=jg(i,b.borderTopWidth)}
function kh(a,b){if(ue(a.offsetX)&&!E.pb()&&!(E.type==1&&E.version>=8)){var c=Qg(a);a=new S(a.offsetX,a.offsetY);b=fh(c,b);return b=new S(b.x+a.x,b.y+a.y)}else if(ue(a.clientX)){c=E.pb()?new S(a.pageX-window.pageXOffset,a.pageY-window.pageYOffset):new S(a.clientX,a.clientY);b=fh(b);return b=new S(c.x-b.x,c.y-b.y)}else return Xg}
;var lh=e;function kd(){this.Z=[]}
kd.prototype.Pk=function(a){var b=a.Fa;if(!(b<0)){var c=this.Z.pop();if(b<this.Z.length){this.Z[b]=c;c.Zo(b)}a.Zo(-1)}};
kd.prototype.CR=function(a){this.Z.push(a);a.Zo(this.Z.length-1)};
kd.prototype.clear=function(){for(var a=0;a<this.Z.length;++a)this.Z[a].Zo(-1);this.Z=[]};
function v(a,b,c,d){return x(mh).make(a,b,c,0,d)}
function nh(a,b){return r(oh(a,b,j))>0}
function w(a){a.remove();x(kd).Pk(a)}
function ph(a,b,c){A(a,Oa,b);t(qh(a,b),function(d){if(!c||d.RC(c)){d.remove();x(kd).Pk(d)}})}
function Rg(a,b){A(a,Oa);t(qh(a),function(c){if(!b||c.RC(b)){c.remove();x(kd).Pk(c)}})}
function qh(a,b){var c=[];if(a=a.__e_)if(b)a[b]&&Ke(c,a[b]);else tc(a,function(d,f){Ke(c,f)});
return c}
function oh(a,b,c){var d=i,f=a.__e_;if(f){d=f[b];if(!d){d=[];if(c)f[b]=d}}else{d=[];if(c){a.__e_={};a.__e_[b]=d}}return d}
function A(a,b){var c=gf(arguments,2);t(qh(a,b),function(d){if(lh)d.bt(c);else try{d.bt(c)}catch(f){}})}
function sh(a,b,c,d){if(a.addEventListener){var f=j;if(b==ya){b=la;f=e}else if(b==za){b=ha;f=e}var g=f?4:1;a.addEventListener(b,c,f);c=x(mh).make(a,b,c,g,d)}else if(a.attachEvent){c=x(mh).make(a,b,c,2,d);a.attachEvent("on"+b,c.zJ())}else{a["on"+b]=c;c=x(mh).make(a,b,c,3,d)}if(a!=window||b!=xa)x(kd).CR(c);return c}
function T(a,b,c,d){c=th(c,d);return sh(a,b,c)}
function uh(a,b,c,d,f){c=th(c,d);return sh(a,b,c,f)}
function th(a,b){return function(c){return b.call(a,c,this)}}
function vh(a,b,c){var d=[];d.push(T(a,m,b,c));E.type==1&&d.push(T(a,ka,b,c));return d}
function U(a,b,c,d){return v(a,b,n(d,c),c)}
function wh(a,b,c,d,f){return v(a,b,n(d,c),f)}
function fd(a,b,c,d){rg(d);var f=v(a,b,function(){c.apply(a,arguments);w(f);sg(d)});
return f}
function xh(a,b,c,d,f){return fd(a,b,n(d,c),f)}
function yh(a,b,c){return v(a,b,zh(b,c))}
function zh(a,b){return function(){var c=[b,a];Ke(c,arguments);A.apply(this,c)}}
function Ah(a,b){return function(c){A(b,a,c)}}
function mh(){this.Ts=i}
mh.prototype.gT=function(a){this.Ts=a};
mh.prototype.make=function(a,b,c,d,f){return this.Ts?new this.Ts(a,b,c,d,f):i};
Og.g=function(a,b,c,d,f){this.Wb=a;this.yj=b;this.xh=c;this.Gs=i;this.RR=d;this.Dd=f||i;this.Fa=-1;oh(a,b,e).push(this)};
l=Og.prototype;l.zJ=function(){return this.Gs=n(function(a){if(!a)a=window.event;if(a&&!a.target)try{a.target=a.srcElement}catch(b){}var c=this.bt([a]);if(a&&m==a.type)if((a=a.srcElement)&&"A"==a.tagName&&"javascript:void(0)"==a.href)return j;return c},
this)};
l.remove=function(){if(this.Wb){switch(this.RR){case 1:this.Wb.removeEventListener(this.yj,this.xh,j);break;case 4:this.Wb.removeEventListener(this.yj,this.xh,e);break;case 2:this.Wb.detachEvent("on"+this.yj,this.Gs);break;case 3:this.Wb["on"+this.yj]=i;break}xe(oh(this.Wb,this.yj),this);this.Gs=this.xh=this.Wb=i}};
l.Zo=function(a){this.Fa=a};
l.RC=function(a){return this.Dd===a};
l.bt=function(a){if(this.Wb)return this.xh.apply(this.Wb,a)};
x(mh).gT(Og);function Bh(a,b){this.moduleUrlsFn=a;this.moduleDependencies=b}
function Ch(){this.ac=[]}
Ch.prototype.init=function(a,b){var c=this.Ra=new Bh(a,b);t(this.ac,function(d){d(c)});
ff(this.ac)};
Ch.prototype.iA=function(a){this.Ra?a(this.Ra):this.ac.push(a)};
function gd(){this.NE={};this.Hu={};this.ac={};this.St={};this.Eq=new Ch;this.Ac={};this.dr=i}
l=gd.prototype;l.init=function(a,b){this.Eq.init(a,b)};
l.kM=function(a,b){var c=this.Ac;this.Eq.iA(function(d){(d=d.moduleUrlsFn(a))&&b(d,c[a])})};
l.tS=function(a,b,c,d,f){A(this,"modulerequired",a,b);if(this.Hu[a])c(this.St[a]);else{this.ac[a]||(this.ac[a]=[]);this.ac[a].push(c);f||this.BC(a,b,d)}};
l.BC=function(a,b,c){if(!this.Hu[a]){c&&this.Qz(a,c);if(!this.NE[a]){this.NE[a]=e;A(this,"moduleload",a,b);this.dr&&this.Qz(a,this.dr);this.Eq.iA(n(function(d){t(d.moduleDependencies[a],n(function(f){this.BC(f,undefined,c)},
this));this.iw(a,"jss");this.kM(a,Dh)},
this))}}};
l.require=function(a,b,c,d,f){this.tS(a,b,function(g){c(g[b])},
d,f)};
l.provide=function(a,b,c){var d=this.St;d[a]||(d[a]={});if(typeof this.hw=="number"){this.iw(a,"jsl",this.hw);delete this.hw}if(ue(b))d[a][b]=c;else this.mN(a)};
l.mN=function(a){this.Hu[a]=e;var b=this.St[a];t(this.ac[a],function(c){c(b)});
delete this.ac[a];this.iw(a,"jsd");A(this,Sa,a)};
l.XS=function(a){this.dr=a};
l.Qz=function(a,b){var c=this.Ac;if(c[a]){for(var d=0;d<r(c[a]);++d)if(c[a][d]==b)return;c[a].push(b)}else c[a]=[b];b.branch()};
l.iw=function(a,b,c){var d=this.Ac;if(!d[a]&&b=="jss")d[a]=[new cd("jsloader-"+a)];else{var f=d[a];if(f){for(var g=0;g<r(f);++g)f[g].tick(b+"."+a,c);if(b=="jsd"){for(g=0;g<r(f);++g)f[g].done();delete d[a]}}}};
l.EU=function(){this.hw=ed()};
function Eh(a){x(gd).EU();eval(a)}
window.__gjsload_maps2_api__=Eh;function vd(a,b,c,d,f){x(gd).require(a,b,c,d,f)}
function V(a,b,c){x(gd).provide(a,b,c)}
function Wc(a,b){x(gd).init(a,b)}
function wd(a,b,c){return function(){var d=arguments;vd(a,b,function(f){f.apply(i,d)},
c)}}
function dd(a){x(gd).XS(a)}
;function Fh(a,b){a.prototype&&Gh(a.prototype,Hh(b));Gh(a,b)}
function Gh(a,b){tc(a,function(d,f){if(typeof f==re)var g=a[d]=function(){var h=arguments,k;b(n(function(o){if((o=(o||a)[d])&&o!=g)k=o.apply(this,h);else aa(new Error("No implementation for ."+d))},
this),f.defer===e);c||(k=f.apply(this,h));return k}},
j);var c=j;b(function(d){c=e;d!=a&&De(a,d,e)},
e)}
function Ih(a,b,c){function d(f,g){vd(b,c,f,undefined,g)}
Fh(a,d)}
function Jh(a){var b=function(){return a.apply(this,arguments)};
p(b,a);b.defer=e;return b}
function Hh(a){return function(b,c,d){a(function(f){f?b(f.prototype):b(undefined)},
c,d)}}
function Kh(a,b,c,d,f){function g(h,k,o){vd(b,c,h,o,k)}
Lh(a.prototype,d,Hh(g));Lh(a,f||{},g)}
function Lh(a,b,c){tc(b,function(d,f){a[d]=function(){var g=arguments,h=undefined;c(n(function(k){h=k[d].apply(this,g)},
this),f);return h}})}
;function Mh(){Mh.g.apply(this,arguments)}
function Nh(){Nh.g.apply(this,arguments)}
p(Nh,Mh);Mh.g=function(a){if(a){this.left=a.offsetLeft;this.top=a.offsetTop}};
var Oh=function(){},
Ph=function(){};
Mh.qe=Oh;Mh.Yk=Oh;Mh.Xf=N;Mh.Dj=N;l=Mh.prototype;l.qe=Oh;l.Yk=Oh;l.Xf=N;l.Dj=N;l.moveBy=Oh;l.uc=Ph;l.moveTo=Oh;l.Vt=Ph;l.disable=N;l.enable=N;l.enabled=N;l.dragging=N;l.gm=N;l.Fu=Oh;Ih(Mh,"drag",1);Kh(Nh,"drag",2,{},{g:j});function Qh(){}
;var Rh="hideWhileLoading",Sh="__src__",Th="isPending";function Uh(){this.ca={};this.zf=new Vh;this.zf.pT(20);this.zf.To(e);this.DB=i;Db&&vd("urir",Wa,n(function(a){this.DB=new a(Db)},
this))}
var Wh=function(){this.ob=new Image};
Wh.prototype.SF=function(a){this.ob.src=a};
Wh.prototype.KF=function(a){this.ob.onload=a};
Wh.prototype.JF=function(a){this.ob.onerror=a};
Wh.prototype.O=function(){return new R(this.ob.width,this.ob.height)};
var Xh=function(a,b){this.Gn(a,b)};
l=Xh.prototype;l.Gn=function(a,b){this.Da=a;this.Ef=[b];this.qp=0;this.Vd=new R(NaN,NaN)};
l.We=function(){return this.qp};
l.GH=function(a){this.Ef.push(a)};
l.load=function(){this.qp=1;this.ob=new Wh;this.ob.KF(uf(this,this.ur,2));this.ob.JF(uf(this,this.ur,3));var a=be(this),b=n(function(){a.sc()&&this.ob.SF(this.Da)},
this);x(Uh).zf.Cf(b)};
l.ur=function(a){this.qp=a;if(this.complete())this.Vd=this.ob.O();delete this.ob;a=0;for(var b=r(this.Ef);a<b;++a)this.Ef[a](this);ff(this.Ef)};
l.HI=function(){ce(this);this.ob.KF(i);this.ob.JF(i);this.ob.SF(Rc);this.ur(4)};
l.complete=function(){return this.qp==2};
Uh.prototype.fetch=function(a,b){var c=this.ca[a];if(c)switch(c.We()){case 0:case 1:c.GH(b);return;case 2:b(c,e);return}c=this.ca[a]=new Xh(a,b);c.load()};
Uh.prototype.remove=function(a){this.rG(a);delete this.ca[a]};
Uh.prototype.rG=function(a){var b=this.ca[a];if(b&&b.We()==1){b.HI();delete this.ca[a]}};
Uh.prototype.nn=function(a){return!!this.ca[a]&&this.ca[a].complete()};
var Zh=function(a,b,c){c=c||{};var d=x(Uh);if(a[Rh])if(a.tagName=="DIV")a.style.filter="";else a.src=Rc;a[Sh]=b;a[Th]=e;var f=be(a),g=function(k){d.fetch(k,function(o,q){Yh(f,a,o,k,q,c)})},
h=d.DB;h!=i?h.renderUriAsync(b,g):g(b)},
Yh=function(a,b,c,d,f,g){var h=function(){if(a.sc())a:{var k=g;k=k||{};b[Th]=j;b.preCached=f;switch(c.We()){case 3:k.onErrorCallback&&k.onErrorCallback(d,b);break a;case 4:break a;case 2:break;default:break a}var o=E.type==1&&ef(b.src,Rc);if(b.tagName=="DIV"){$h(b,d,k.scale);o=e}if(o)Cf(b,k.size||c.Vd);b.src=d;k.onLoadCallback&&k.onLoadCallback(d,b)}};
E.Jn()?h():x(Uh).zf.Cf(h)};
function ai(a,b,c){return function(d,f){a||x(Uh).remove(d);b&&b(d,f);sg(c)}}
function Qc(a,b,c,d,f,g){f=f||{};var h=f.cache!==j;rg(g);var k=ai(h,f.onLoadCallback,g);h=ai(h,f.onErrorCallback,g);g=d&&f.scale;k={scale:g,size:d,onLoadCallback:k,onErrorCallback:h};if(f.alpha&&E.ox()){c=J("div",b,c,d,e);c.scaleMe=g;Xf(c)}else{c=J("img",b,c,d,e);c.src=Rc}if(f.hideWhileLoading)c[Rh]=e;c.imageFetcherOpts=k;Zh(c,a,k);f.printOnly&&eg(c);gg(c);if(E.type==1)c.galleryImg="no";if(f.styleClass)dg(c,f.styleClass);else{c.style.border="0px";c.style.padding="0px";c.style.margin="0px"}sh(c,ja,
Ug);b&&Df(b,c);return c}
function bi(a){return!!a[Sh]&&a[Sh]==a.src}
function ci(a){x(Uh).rG(a[Sh]);a[Th]=j}
function di(a){return we(a)&&ef(a.toLowerCase(),".png")}
function ei(a){fi||(fi=new RegExp('"',"g"));return a.replace(fi,"\\000022")}
var fi;function gi(a){var b=og(a);return a.replace(b,escape(b))}
function $h(a,b,c){a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod="+(c?"scale":"crop")+',src="'+gi(ei(b))+'")'}
function hi(a,b,c,d,f,g,h,k){b=J("div",b,f,d);Xf(b);if(c)c=new S(-c.x,-c.y);if(!h){h=new Qh;h.alpha=e}Qc(a,b,c,g,h,k).style["-khtml-user-drag"]="none";return b}
function ii(a,b,c){Cf(a,b);Bf(a.firstChild,new S(0-c.x,0-c.y))}
var ji=0,ki=new Qh;ki.alpha=e;ki.cache=e;function li(a,b,c){b=(b.charAt(0)==ga?b.substr(1):b).split(ga);a=a;for(var d=r(b),f=0,g=d-1;f<g;++f){var h=b[f];a[h]||(a[h]={});a=a[h]}a[b[d-1]]=c}
;function mi(){mi.g.apply(this,arguments)}
Kh(mi,"kbrd",1,{},{g:j});function ni(a){var b={};tc(a,function(c,d){c=encodeURIComponent(c);d=encodeURIComponent(d);b[c]=d});
return of(b,ea,fa)}
;function oi(){}
;l=oi.prototype;l.initialize=function(){aa("Required interface method not implemented: initialize")};
l.remove=function(){aa("Required interface method not implemented: remove")};
l.copy=function(){aa("Required interface method not implemented: copy")};
l.redraw=function(){aa("Required interface method not implemented: redraw")};
l.Ea=function(){return"Overlay"};
function pi(a){return K(a*-100000)<<5}
oi.prototype.show=function(){aa("Required interface method not implemented: show")};
oi.prototype.hide=function(){aa("Required interface method not implemented: hide")};
oi.prototype.I=function(){aa("Required interface method not implemented: isHidden")};
oi.prototype.ya=function(){return j};
oi.re=function(a,b){a.XQ=b};
oi.rd=function(a){return a.XQ};function qi(){}
l=qi.prototype;l.initialize=function(){aa("Required interface method not implemented")};
l.ba=function(){aa("Required interface method not implemented")};
l.ka=function(){aa("Required interface method not implemented")};
l.Vf=function(){};
l.Lj=function(){return j};
l.oB=function(){return i};function ri(){this.hx={};this.uj=[];this.mW={};this.ak=i}
ri.prototype.CC=function(a,b){if(b)for(var c=0;c<r(this.uj);++c){var d=this.uj[c];if(d.url==a){Ke(d.ui,b);break}}if(!this.hx[a]){this.hx[a]=e;c=[];b&&Ke(c,b);this.uj.push({url:a,ui:c});if(!this.ak)this.ak=qg(this,this.QO,0)}};
ri.prototype.TO=function(a,b){for(var c=0;c<r(a);++c)this.CC(a[c],b)};
ri.prototype.QO=function(){var a=this.iJ();this.ak&&clearTimeout(this.ak);this.ak=i;var b=Hg();b&&t(a,n(function(c){var d=c.url;si(c.ui);c=document.createElement("script");T(c,"error",this,function(){});
c.setAttribute("type","text/javascript");c.setAttribute("charset","UTF-8");c.setAttribute("src",d);b.appendChild(c)},
this))};
var si=function(a){t(a,function(b){if(!b.WE){b.WE=e;for(var c=0;b.getTick("sf_"+c);)c++;b.tick("sf_"+c)}});
t(a,function(b){delete b.WE})};
ri.prototype.iJ=function(){var a=r("/cat_js")+6,b=[],c=[],d=[],f,g,h;t(this.uj,function(o){var q=o.url,s=o.ui,u=ti(q)[4];if(ui(u)){o=q.substr(0,q.indexOf(u));var H=u.substr(0,u.lastIndexOf(".")).split("/");if(r(c)){for(var G=0;r(H)>G&&g[G]==H[G];)++G;u=g.slice(0,G);var I=g.slice(G).join("/"),M=H.slice(G).join("/"),Y=h+1+r(M);if(I)Y+=(r(c)-1)*(r(I)+1);if(o==f&&r(c)<30&&G>1&&ui(u.join("/"),e)&&Y<=2048){if(I){q=0;for(o=r(c);q<o;++q)c[q]=I+"/"+c[q]}c.push(M);Ke(d,s);h=Y;g=u;return}else{u=vi(f,g,c,h);
b.push({url:u,ui:d})}}c=[H.pop()];d=[];Ke(d,s);f=o;g=H;h=r(q)+a}else{if(r(c)){u=vi(f,g,c,h);b.push({url:u,ui:d});c=[];d=[]}b.push(o)}});
if(r(c)){var k=vi(f,g,c,h);b.push({url:k,ui:d})}ff(this.uj);return b};
var ui=function(a,b){if(!ob)return j;var c=ui;if(!c.VD){c.VD=/^(?:\/intl\/[^\/]+)?\/mapfiles(?:\/|$)/;c.GK=/.js$/}return c.VD.test(a)&&(b||c.GK.test(a))},
vi=function(a,b,c,d){if(r(c)>1){a=a+"/cat_js"+b.join("/")+"/%7B"+c.join(",")+"%7D.js";d==r(a);return a}return a+b.join("/")+"/"+c[0]+".js"};
function Dh(a,b){var c=x(ri);typeof a=="string"?c.CC(a,b):c.TO(a,b)}
;function Ai(){this.aF={};this.jD={}}
l=Ai.prototype;l.fM=function(a,b,c){var d=[],f=lf(r(a),function(){b.apply(i,d)});
t(a,n(function(g,h){this.get(g,function(k){d[h]=k;f()},
c)},
this))};
l.set=function(a,b){this.WA(a).set(b)};
l.get=function(a,b,c){a=this.WA(a);a.get(b,c);a.init(this)};
l.AM=function(a,b){return this.sM(a,b)};
l.sM=function(a,b){b=b||0;var c=a+"."+b,d=this.jD[c];if(!d){d=new Bi;d.rT(a,b);this.jD[c]=d}return d};
l.WA=function(a){if(a instanceof Bi)return a;var b=this.aF[gc(a)];if(!b){b=new Bi;this.wT(a,b)}return b};
l.wT=function(a,b){this.aF[gc(a)]=b};
function Bi(){this.ov=i;this.wo=[];this.WD=[];this.Rt=i;this.ew=0;this.mH=j}
l=Bi.prototype;l.set=function(a){this.ov=a;for(var b=0,c=r(this.wo);b<c;b++){this.wo[b](a);sg(this.WD[b])}this.wo=[]};
l.get=function(a,b){if(this.ov)a(this.ov);else{this.wo.push(a);rg(b);this.WD.push(b)}};
l.rT=function(a,b){this.Rt=a;this.ew=b};
l.init=function(a){if(this.Rt&&!this.mH){this.mH=e;vd(this.Rt,this.ew,n(this.BQ,this,a))}};
l.BQ=function(a,b){b&&b(a,this);this.ew==0&&a.set(this,{})};function Ci(a){this.ticks=a;this.tick=0}
Ci.prototype.reset=function(){this.tick=0};
Ci.prototype.next=function(){this.tick++;return(Math.sin(Math.PI*(this.tick/this.ticks-0.5))+1)/2};
Ci.prototype.more=function(){return this.tick<this.ticks};
Ci.prototype.extend=function(){if(this.tick>this.ticks/3)this.tick=K(this.ticks/3)};function Di(a){this.jl=ed();this.Dm=a;this.Tt=e}
Di.prototype.reset=function(){this.jl=ed();this.Tt=e};
Di.prototype.next=function(){var a=ed()-this.jl;if(a>=this.Dm){this.Tt=j;return 1}else return(Math.sin(Math.PI*(a/this.Dm-0.5))+1)/2};
Di.prototype.more=function(){return this.Tt};
Di.prototype.extend=function(){var a=ed();if(a-this.jl>this.Dm/3)this.jl=a-K(this.Dm/3)};function Ei(a){if(r(arguments)<1)return"";var b=/([^%]*)%(\d*)\$([#|-|0|+|\x20|\'|I]*|)(\d*|)(\.\d+|)(h|l|L|)(s|c|d|i|b|o|u|x|X|f)(.*)/,c;switch(F(1415)){case ".":c=/(\d)(\d\d\d\.|\d\d\d$)/;break;default:c=new RegExp("(\\d)(\\d\\d\\d"+F(1415)+"|\\d\\d\\d$)")}var d;switch(F(1416)){case ".":d=/(\d)(\d\d\d\.)/;break;default:d=new RegExp("(\\d)(\\d\\d\\d"+F(1416)+")")}for(var f="$1"+F(1416)+"$2",g="",h=a,k=b.exec(a);k;){h=k[3];var o=-1;if(k[5].length>1)o=Math.max(0,hf(k[5].substr(1)));var q=k[7],s="",
u=hf(k[2]);if(u<r(arguments))s=arguments[u];u="";switch(q){case "s":u+=s;break;case "c":u+=String.fromCharCode(hf(s));break;case "d":case "i":u+=hf(s).toString();break;case "b":u+=hf(s).toString(2);break;case "o":u+=hf(s).toString(8).toLowerCase();break;case "u":u+=Math.abs(hf(s)).toString();break;case "x":u+=hf(s).toString(16).toLowerCase();break;case "X":u+=hf(s).toString(16).toUpperCase();break;case "f":u+=o>=0?Math.round(parseFloat(s)*Math.pow(10,o))/Math.pow(10,o):parseFloat(s);break;default:break}if(h.search(/I/)!=
-1&&h.search(/\'/)!=-1&&(q=="i"||q=="d"||q=="u"||q=="f")){h=u=u.replace(/\./g,F(1415));u=h.replace(c,f);if(u!=h){do{h=u;u=h.replace(d,f)}while(h!=u)}}g+=k[1]+u;h=k[8];k=b.exec(h)}return g+h}
;function cd(){cd.g.apply(this,arguments)}
;var Fi=/[~.,?&]/g,Gi=j;cd.g=function(a,b){this.Uf=a.replace(Fi,"-");this.yi=[];this.BG={};this.cD=this.ue=b||ed();this.Jr=1;this.LE=0;this.Af={};this.Wi={};this.Bn={};this.hj="";this.WV={};this.Up=j};
l=cd.prototype;l.CH=function(){this.Up=e};
l.getTick=function(a){if(a=="start")return this.ue;return this.BG[a]};
l.adopt=function(a){if(!(!a||typeof a.start=="undefined")){this.ue=a.start;this.oP(a)}};
l.oP=function(a){a&&tc(a,n(function(b,c){b!="start"&&this.tick(b,c)},
this))};
l.tick=function(a,b){window.gErrorLogger&&window.gErrorLogger.tick&&window.gErrorLogger.tick(this.Uf,a);b=b||ed();if(b>this.cD)this.cD=b;for(var c=b-this.ue,d=r(this.yi);d>0&&this.yi[d-1][1]>c;)d--;this.yi.splice(d||0,0,[a,c]);this.BG[a]=b};
l.done=function(a,b){a&&this.tick(a);this.Jr--;this.LE>0&&this.Uf.indexOf("-LATE")==-1&&this.bT(this.Uf+"-LATE");if(this.Jr<=0){this.LE++;if(this.hj)this.OJ(b||document);r(this.yi)>0&&this.oS();if(!Ee(this.Af)||!Ee(this.Bn))this.kS();this.Pr()}};
l.Pr=function(){};
l.branch=function(a){a&&this.tick(a);this.Jr++};
l.timers=function(){return this.yi};
l.oS=function(){if(!this.Up){A(this,"beforereport");A(cd,"report",this.Uf,this.yi,this.Wi)}};
l.kS=function(){if(!this.Up){if(!Ee(this.Af)&&!Ee(this.Wi))this.Af.cad=ni(this.Wi);A(cd,"reportaction",this.Af,this.Bn);Fe(this.Af);Fe(this.Wi);Fe(this.Bn)}};
l.bT=function(a){this.Uf=a.replace(Fi,"-")};
l.action=function(a){var b=[],c=i,d=j;Hi(a,function(f){var g=Ii(f);if(g){b.unshift(g);c||(c=f.getAttribute("jsinstance"))}if(!d&&f.getAttribute("jstrack"))d=e});
if(d){this.Af.ct=this.Uf;r(b)>0&&this.Xg("oi",b.join(ga));if(c){c=c.charAt(0)==da?hf(c.substr(1)):hf(c);this.Af.cd=c}}};
l.Xg=function(a,b){this.Wi[a]=b};
l.impression=function(a){this.tick("imp0");var b=[];a.parentNode&&Hi(a.parentNode,function(d){(d=Ii(d))&&b.unshift(d)});
var c=this.Bn;Ji(a,function(d){if(d=Ii(d)){b.push(d);d=b.join(ga);c[d]||(c[d]=0);c[d]++;return e}return j},
function(){b.pop()});
this.tick("imp1")};
l.OJ=function(a){if(this.hj){a.cookie="TR=; path=/; domain=.google.com; expires=01/01/1970 00:00:00";A(cd,"dapperreport",this.hj,this.ue,ed(),this.Uf)}Gi=j};
var Hi=function(a,b){for(a=a;a&&a!=document.body;a=a.parentNode)b(a)},
Ji=function(a,b,c){if(!(a.nodeType!=1||ig(a).display=="none"||ig(a).visibility=="hidden")){for(var d=b(a),f=a.firstChild;f;f=f.nextSibling)arguments.callee(f,b,c);d&&c()}},
Ii=function(a){if(!a.__oi&&a.getAttribute)a.__oi=a.getAttribute("oi");return a.__oi},
Eg=function(a,b,c){a&&a.tick(b,c)},
rg=function(a,b){a&&a.branch(b)},
sg=function(a,b,c){a&&a.done(b,c)};function Ki(){Ki.g.apply(this,arguments)}
;Ki.g=function(){this.Gd={}};
l=Ki.prototype;l.set=function(a,b){this.Gd[a]=b;return this};
l.sT=function(a){De(this.Gd,a)};
l.remove=function(a){delete this.Gd[a]};
l.get=function(a){return this.Gd[a]};
l.Xe=function(a,b,c){if(c){this.set("hl",_mHL);_mGL&&this.set("gl",_mGL)}c=this.wM();b=b?b:_mUri;return c?(a?"":_mHost)+b+"?"+c:(a?"":_mHost)+b};
l.wM=function(){return mg(this.Gd)};Ki.prototype.Cv=function(a){a.ha()&&Li(this.Gd,a,e,e,"m");hc!=i&&hc!=""&&this.set("key",hc);ic!=i&&ic!=""&&this.set("client",ic);jc!=i&&jc!=""&&this.set("channel",jc);kc!=i&&kc!=""&&this.set("sensor",kc);this.set("mapclient","jsapi")};
Ki.prototype.Pv=function(a,b){this.set("ll",a);this.set("spn",b)};function Mi(a,b){this.f=a;this.Jp=b;b={};b.neat=e;this.Ha=new wg(_mHost+"/maps/vp",window.document,b);U(a,Da,this,this.Sh);var c=n(this.Sh,this);U(a,Ca,i,function(){window.setTimeout(c,0)});
U(a,Ea,this,this.po)}
l=Mi.prototype;l.Sh=function(){var a=this.f;if(this.Ul!=a.F()||this.o!=a.o){this.WJ();this.zg();this.Zg(0,0,e)}else{var b=a.T(),c=a.H().sb();a=K((b.lat()-this.qx.lat())/c.lat());b=K((b.lng()-this.qx.lng())/c.lng());this.Me="p";this.Zg(a,b,e)}};
l.po=function(){this.zg();this.Zg(0,0,j)};
l.zg=function(){var a=this.f;this.qx=a.T();this.o=a.o;this.Ul=a.F();this.j={}};
l.WJ=function(){var a=this.f,b=a.F();if(this.Ul&&this.Ul!=b)this.Me=this.Ul<b?"zi":"zo";if(this.o){a=a.o.getUrlArg();b=this.o.getUrlArg();if(b!=a)this.Me=b+a}};
l.Zg=function(a,b,c){if(!(this.f.allowUsageLogging&&!this.f.allowUsageLogging())){a=a+","+b;if(!this.j[a]){this.j[a]=1;if(c){var d=new Ki;d.Cv(this.f);d.set("vp",d.get("ll"));d.remove("ll");this.Jp!="m"&&d.set("mapt",this.Jp);if(this.Me){d.set("ev",this.Me);this.Me=""}this.f.Pf&&d.set("output","embed");c={};Ge(c,ng(og(document.location.href)),["host","e","expid","source_ip"]);A(this.f,"reportpointhook",c);tc(c,function(f,g){g!=i&&d.set(f,g)});
this.Ha.send(d.Gd);A(this.f,"viewpointrequest")}}}};
l.wE=function(){var a=new Ki;a.Cv(this.f);a.set("vp",a.get("ll"));a.remove("ll");this.Jp!="m"&&a.set("mapt",this.Jp);window._mUrlHostParameter&&a.set("host",window._mUrlHostParameter);this.f.Pf&&a.set("output","embed");a.set("ev","r");var b={};A(this.f,"refreshpointhook",b);tc(b,function(c,d){d!=i&&a.set(c,d)});
this.Ha.send(a.Gd);A(this.f,"viewpointrequest")};function ti(a){Ni||(Ni=/^(?:([^:\/?#]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/);(a=a.match(Ni))&&a.shift();return a}
var Ni;var Oi=new RegExp("[\u0591-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]"),Pi=new RegExp("^[^A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufe00-\ufe6f\ufefd-\uffff]*[\u0591-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]"),Qi=new RegExp("^[\u0000- !-@[-`{-\u00bf\u00d7\u00f7\u02b9-\u02ff\u2000-\u2bff]*$|^http://");var Ri,Si,Ti=["q_d","l_d","l_near","d_d","d_daddr"],Ui,Vi=j;function Wi(){return typeof _mIsRtl=="boolean"?_mIsRtl:j}
function Xi(a,b){if(!a)return Wi();if(b)return Oi.test(a);var c=b=0;a=a.split(" ");for(var d=0;d<a.length;d++)if(Pi.test(a[d])){b++;c++}else Qi.test(a[d])||c++;return(c==0?0:b/c)>0.4}
function Yi(a,b){return Xi(a,b)?"rtl":"ltr"}
function Zi(a,b){return Xi(a,b)?"right":"left"}
function $i(a,b){return Xi(a,b)?"left":"right"}
function aj(a){var b=a.target||a.srcElement;setTimeout(function(){if(Vi){var c=Yi(b.value),d=Zi(b.value);b.setAttribute("dir",c);b.style.textAlign=d}},
0)}
function bj(a){a=Nf(a);if(a!=i){sh(a,qa,aj);sh(a,wa,aj)}}
function cj(a,b){return Xi(a,b)?"\u200f":"\u200e"}
function dj(a,b){return'<span dir="'+Yi(a,b)+'">'+(b?a:cf(a))+"</span>"+cj()}
function ej(a){if(!Ui)return a;return(Xi(a)?"\u202b":"\u202a")+a+"\u202c"+cj()}
if(typeof jb=="string"&&typeof _mHL=="string"){var fj=jb.split(",");if(Ce(fj,_mHL)){t(Ti,bj);Vi=e}}Wi();var gj=Wi()?"Left":"Right";Ri=Wi()?"right":"left";Wi();Si="margin"+gj;Ui=E.os!=2||E.type==4||Wi();function hj(){try{if(typeof ActiveXObject!="undefined")return new ActiveXObject("Microsoft.XMLHTTP");else if(window.XMLHttpRequest)return new XMLHttpRequest}catch(a){}return i}
function ij(a,b,c,d,f){var g=hj();if(!g)return j;if(b){rg(f);g.onreadystatechange=function(){if(g.readyState==4){var h;h=-1;var k=i;try{h=g.status;k=g.responseText}catch(o){}h={status:h,responseText:k};b(h.responseText,h.status);g.onreadystatechange=N;sg(f)}}}if(c){g.open("POST",
a,e);(a=d)||(a="application/x-www-form-urlencoded");g.setRequestHeader("Content-Type",a);g.send(c)}else{g.open("GET",a,e);g.send(i)}return e}
;function Vh(){this.Xc=[];this.ol=i;this.iv=j;this.Pp=0;this.$C=100;this.hR=0;this.nx=j}
l=Vh.prototype;l.pT=function(a){this.$C=a};
l.To=function(a){this.nx=a};
l.XP=function(a,b){aa(b)};
l.Cf=function(a,b){this.Xc.push([a,b]);rg(b);this.VE();this.nx&&this.nE()};
l.cancel=function(){this.nU();for(var a=0;a<this.Xc.length;++a)sg(this.Xc[a][1]);ff(this.Xc)};
l.nU=function(){window.clearTimeout(this.ol);this.ol=i};
l.nE=function(){if(!this.iv){this.iv=e;try{for(;r(this.Xc)&&this.Pp<this.$C;){var a=this.Xc.shift();this.IS(a[0]);sg(a[1])}}finally{this.iv=j;if(this.Pp||r(this.Xc))this.VE()}}};
l.VE=function(){if(!this.ol)this.ol=qg(this,this.JQ,this.hR)};
l.JQ=function(){this.ol=i;this.Pp=0;this.nE()};
l.IS=function(a){var b=ed();try{a(this)}catch(c){this.XP(a,c)}this.Pp+=ed()-b};function z(){z.g.apply(this,arguments)}
function id(){id.g.apply(this,arguments)}
;function jj(a,b){if(a==-ee&&b!=ee)a=ee;if(b==-ee&&a!=ee)b=ee;this.lo=a;this.hi=b}
l=jj.prototype;l.Yd=function(){return this.lo>this.hi};
l.ma=function(){return this.lo-this.hi==2*ee};
l.ZB=function(){return this.hi-this.lo==2*ee};
l.intersects=function(a){var b=this.lo,c=this.hi;if(this.ma()||a.ma())return j;if(this.Yd())return a.Yd()||a.lo<=this.hi||a.hi>=b;else{if(a.Yd())return a.lo<=c||a.hi>=b;return a.lo<=c&&a.hi>=b}};
l.Hq=function(a){var b=this.lo,c=this.hi;if(this.Yd()){if(a.Yd())return a.lo>=b&&a.hi<=c;return(a.lo>=b||a.hi<=c)&&!this.ma()}else{if(a.Yd())return this.ZB()||a.ma();return a.lo>=b&&a.hi<=c}};
l.contains=function(a){if(a==-ee)a=ee;var b=this.lo,c=this.hi;return this.Yd()?(a>=b||a<=c)&&!this.ma():a>=b&&a<=c};
l.extend=function(a){if(!this.contains(a))if(this.ma())this.lo=this.hi=a;else if(this.distance(a,this.lo)<this.distance(this.hi,a))this.lo=a;else this.hi=a};
l.equals=function(a){if(this.ma())return a.ma();return fe(a.lo-this.lo)%2*ee+fe(a.hi-this.hi)%2*ee<=1.0E-9};
l.distance=function(a,b){var c=b-a;if(c>=0)return c;return b+ee-(a-ee)};
l.span=function(){return this.ma()?0:this.Yd()?2*ee-(this.lo-this.hi):this.hi-this.lo};
l.center=function(){var a=(this.lo+this.hi)/2;if(this.Yd()){a+=ee;a=te(a,-ee,ee)}return a};
function kj(a,b){this.lo=a;this.hi=b}
l=kj.prototype;l.ma=function(){return this.lo>this.hi};
l.intersects=function(a){var b=this.lo,c=this.hi;return b<=a.lo?a.lo<=c&&a.lo<=a.hi:b<=a.hi&&b<=c};
l.Hq=function(a){if(a.ma())return e;return a.lo>=this.lo&&a.hi<=this.hi};
l.contains=function(a){return a>=this.lo&&a<=this.hi};
l.extend=function(a){if(this.ma())this.hi=this.lo=a;else if(a<this.lo)this.lo=a;else if(a>this.hi)this.hi=a};
l.equals=function(a){if(this.ma())return a.ma();return fe(a.lo-this.lo)+fe(this.hi-a.hi)<=1.0E-9};
l.span=function(){return this.ma()?0:this.hi-this.lo};
l.center=function(){return(this.hi+this.lo)/2};z.g=function(a,b,c){a-=0;b-=0;if(!c){a=se(a,-90,90);b=te(b,-180,180)}this.df=a;this.x=this.Ua=b;this.y=a};
l=z.prototype;l.toString=function(){return"("+this.lat()+", "+this.lng()+")"};
l.equals=function(a){if(!a)return j;return Se(this.lat(),a.lat())&&Se(this.lng(),a.lng())};
l.copy=function(){return new z(this.lat(),this.lng())};
l.Cp=function(a){return new z(this.df,this.Ua+a,e)};
l.Zt=function(a){return this.Cp(K((a.Ua-this.Ua)/360)*360)};
function lj(a,b){b=Math.pow(10,b);return Math.round(a*b)/b}
l=z.prototype;l.Aa=function(a){a=ue(a)?a:6;return lj(this.lat(),a)+","+lj(this.lng(),a)};
l.lat=function(){return this.df};
l.lng=function(){return this.Ua};
l.lT=function(a){a-=0;this.y=this.df=a};
l.yF=function(a){a-=0;this.x=this.Ua=a};
l.$d=function(){return Qe(this.df)};
l.ff=function(){return Qe(this.Ua)};
l.Pb=function(a,b){return this.rx(a)*(b||6378137)};
l.rx=function(a){var b=this.$d(),c=a.$d(),d=b-c;a=this.ff()-a.ff();return 2*ge(pe(ne(oe(d/2),2)+le(b)*le(c)*ne(oe(a/2),2)))};
z.fromUrlValue=function(a){a=a.split(",");return new z(parseFloat(a[0]),parseFloat(a[1]))};
var mj=function(a,b,c){return new z(Re(a),Re(b),c)};
z.prototype.MG=function(){return this.lng()+","+this.lat()};
id.g=function(a,b){if(a&&!b)b=a;if(a){var c=se(a.$d(),-ee/2,ee/2),d=se(b.$d(),-ee/2,ee/2);this.Ia=new kj(c,d);a=a.ff();b=b.ff();if(b-a>=ee*2)this.Ja=new jj(-ee,ee);else{a=te(a,-ee,ee);b=te(b,-ee,ee);this.Ja=new jj(a,b)}}else{this.Ia=new kj(1,-1);this.Ja=new jj(ee,-ee)}};
l=id.prototype;l.T=function(){return mj(this.Ia.center(),this.Ja.center())};
l.toString=function(){return"("+this.nb()+", "+this.mb()+")"};
l.Aa=function(a){var b=this.nb(),c=this.mb();return[b.Aa(a),c.Aa(a)].join(",")};
l.equals=function(a){return this.Ia.equals(a.Ia)&&this.Ja.equals(a.Ja)};
l.contains=function(a){return this.Ia.contains(a.$d())&&this.Ja.contains(a.ff())};
l.intersects=function(a){return this.Ia.intersects(a.Ia)&&this.Ja.intersects(a.Ja)};
l.kc=function(a){return this.Ia.Hq(a.Ia)&&this.Ja.Hq(a.Ja)};
l.extend=function(a){this.Ia.extend(a.$d());this.Ja.extend(a.ff())};
l.union=function(a){this.extend(a.nb());this.extend(a.mb())};
l.Oc=function(){return Re(this.Ia.hi)};
l.qc=function(){return Re(this.Ia.lo)};
l.rc=function(){return Re(this.Ja.lo)};
l.pc=function(){return Re(this.Ja.hi)};
l.nb=function(){return mj(this.Ia.lo,this.Ja.lo)};
l.XA=function(){return mj(this.Ia.lo,this.Ja.hi)};
l.gs=function(){return mj(this.Ia.hi,this.Ja.lo)};
l.mb=function(){return mj(this.Ia.hi,this.Ja.hi)};
l.sb=function(){return mj(this.Ia.span(),this.Ja.span(),e)};
l.iO=function(){return this.Ja.ZB()};
l.hO=function(){return this.Ia.hi>=ee/2&&this.Ia.lo<=-ee/2};
l.ma=function(){return this.Ia.ma()||this.Ja.ma()};
l.lO=function(a){var b=this.sb();a=a.sb();return b.lat()>a.lat()&&b.lng()>a.lng()};
function nj(){this.yf=Number.MAX_VALUE;this.Ke=-Number.MAX_VALUE;this.qf=90;this.hf=-90;for(var a=0,b=r(arguments);a<b;++a)this.extend(arguments[a])}
l=nj.prototype;l.extend=function(a){if(a.Ua<this.yf)this.yf=a.Ua;if(a.Ua>this.Ke)this.Ke=a.Ua;if(a.df<this.qf)this.qf=a.df;if(a.df>this.hf)this.hf=a.df};
l.nb=function(){return new z(this.qf,this.yf,e)};
l.mb=function(){return new z(this.hf,this.Ke,e)};
l.qc=function(){return this.qf};
l.Oc=function(){return this.hf};
l.pc=function(){return this.Ke};
l.rc=function(){return this.yf};
l.intersects=function(a){return a.pc()>this.yf&&a.rc()<this.Ke&&a.Oc()>this.qf&&a.qc()<this.hf};
l.T=function(){return new z((this.qf+this.hf)/2,(this.yf+this.Ke)/2,e)};
l.contains=function(a){var b=a.lat();a=a.lng();return b>=this.qf&&b<=this.hf&&a>=this.yf&&a<=this.Ke};
l.kc=function(a){return a.rc()>=this.yf&&a.pc()<=this.Ke&&a.qc()>=this.qf&&a.Oc()<=this.hf};
function oj(a,b){var c=a.$d();a=a.ff();var d=le(c);b[0]=le(a)*d;b[1]=oe(a)*d;b[2]=oe(c)}
function pj(a,b){var c=je(a[2],pe(a[0]*a[0]+a[1]*a[1]));a=je(a[1],a[0]);b.lT(Re(c));b.yF(Re(a))}
function qj(){var a=Me(arguments);a.push(a[0]);for(var b=[],c=0,d=0;d<3;++d){b[d]=a[d].rx(a[d+1]);c+=b[d]}c/=2;a=qe(0.5*c);for(d=0;d<3;++d)a*=qe(0.5*(c-b[d]));return 4*he(pe(B(0,a)))}
function rj(){for(var a=Me(arguments),b=[[],[],[]],c=0;c<3;++c)oj(a[c],b[c]);a=0;a+=b[0][0]*b[1][1]*b[2][2];a+=b[1][0]*b[2][1]*b[0][2];a+=b[2][0]*b[0][1]*b[1][2];a-=b[0][0]*b[2][1]*b[1][2];a-=b[1][0]*b[0][1]*b[2][2];a-=b[2][0]*b[1][1]*b[0][2];b=Number.MIN_VALUE*10;return a>b?1:a<-b?-1:0}
;function sj(){}
;function tj(){aa("Required interface method not implemented")}
l=sj.prototype;l.fromLatLngToPixel=tj;l.fromPixelToLatLng=tj;l.getNearestImage=function(a,b,c){b=this.getWrapWidth(b);c=K((c.x-a.x)/b);a.x+=b*c;return c};
l.tileCheckRange=function(){return e};
l.getWrapWidth=function(){return Infinity};function pd(a){this.yu=[];this.zu=[];this.wu=[];this.xu=[];for(var b=256,c=0;c<a;c++){var d=b/2;this.yu.push(b/360);this.zu.push(b/(2*ee));this.wu.push(new S(d,d));this.xu.push(b);b*=2}}
pd.prototype=new sj;pd.prototype.fromLatLngToPixel=function(a,b){var c=this.wu[b],d=K(c.x+a.lng()*this.yu[b]);a=se(Math.sin(Qe(a.lat())),-0.9999,0.9999);b=K(c.y+0.5*Math.log((1+a)/(1-a))*-this.zu[b]);return new S(d,b)};
pd.prototype.fromPixelToLatLng=function(a,b,c){var d=this.wu[b],f=(a.x-d.x)/this.yu[b];a=Re(2*Math.atan(Math.exp((a.y-d.y)/-this.zu[b]))-ee/2);return new z(a,f,c)};
pd.prototype.tileCheckRange=function(a,b,c){b=this.xu[b];if(a.y<0||a.y*c>=b)return j;if(a.x<0||a.x*c>=b){c=Kd(b/c);a.x%=c;if(a.x<0)a.x+=c}return e};
pd.prototype.getWrapWidth=function(a){return this.xu[a]};var uj=pe(2);function rd(a,b,c){this.Ot=c||new pd(a);this.ym=b%360;this.NU=new S(0,0)}
p(rd,sj);l=rd.prototype;l.fromLatLngToPixel=function(a,b){a=this.Ot.fromLatLngToPixel(a,b);b=this.getWrapWidth(b);var c=b/2,d=a.x,f=a.y;switch(this.ym){case 0:break;case 90:a.x=f;a.y=b-d;break;case 180:a.x=b-d;a.y=b-f;break;case 270:a.x=b-f;a.y=d;break}a.y=(a.y-c)/uj+c;return a};
l.getNearestImage=function(a,b,c){b=this.getWrapWidth(b);if(this.ym%180==90){c=K((c.y-a.y)/b);a.y+=b*c}else{c=K((c.x-a.x)/b);a.x+=b*c}return c};
l.fromPixelToLatLng=function(a,b,c){var d=this.getWrapWidth(b),f=d/2,g=a.x;a=(a.y-f)*uj+f;f=this.NU;switch(this.ym){case 0:f.x=g;f.y=a;break;case 90:f.x=d-a;f.y=g;break;case 180:f.x=d-g;f.y=d-a;break;case 270:f.x=a;f.y=d-g;break}return this.Ot.fromPixelToLatLng(f,b,c)};
l.tileCheckRange=function(a,b,c){b=this.getWrapWidth(b);if(this.ym%180==90){if(a.x<0||a.x*c>=b)return j;if(a.y<0||a.y*c>=b){c=Kd(b/c);a.y%=c;if(a.y<0)a.y+=c}}else{if(a.y<0||a.y*c>=b)return j;if(a.x<0||a.x*c>=b){c=Kd(b/c);a.x%=c;if(a.x<0)a.x+=c}}return e};
l.getWrapWidth=function(a){return this.Ot.getWrapWidth(a)};var vj=vj||{},wj=function(a,b,c){var d=window.google;d&&d.test&&d.test.report&&d.test.report(a,i,b,c)},
xj=function(a){var b=window.google;b&&b.test&&b.test.checkpoint&&b.test.checkpoint(a)};var yj={};yj.initialize=N;yj.redraw=N;yj.remove=N;yj.copy=function(){return this};
yj.wa=j;yj.ya=Oe;yj.show=function(){this.wa=j};
yj.hide=function(){this.wa=e};
yj.I=function(){return this.wa};
function zj(a,b,c){Aj(a.prototype,yj);Ih(a,b,c)}
function Aj(a,b){tc(b,function(c){a.hasOwnProperty(c)||(a[c]=b[c])})}
;function Bj(){Bj.g.apply(this,arguments)}
;Bj.g=function(a){if(a){this.controls=a.width<400||a.height<150?{smallzoomcontrol3d:e,menumaptypecontrol:e}:{largemapcontrol3d:e,hierarchicalmaptypecontrol:e,scalecontrol:e};if(Sb&&a.width>=500&&a.height>=500)this.controls.googlebar=e;this.maptypes={normal:e,satellite:e,hybrid:e,physical:e};this.zoom={scrollwheel:e,doubleclick:e};this.keyboard=e}};function Cj(){Cj.g.apply(this,arguments)}
;function Hd(){Hd.g.apply(this,arguments)}
;Hd.g=function(a,b,c,d){d=d||{};this.Gb=d.heading||0;if(this.Gb<0||this.Gb>=360)aa("Heading out of bounds.");(this.fv=d.rmtc||i)&&this.fv.Pl(this,!!d.isDefault);this.hb=a||[];this.HP=c||"";this.of=b||new sj;this.MT=d.shortName||c||"";this.xV=d.urlArg||"c";this.nk=d.maxResolution||Je(this.hb,function(){return this.maxResolution()},
Math.max)||0;this.vk=d.minResolution||Je(this.hb,function(){return this.minResolution()},
Math.min)||0;this.DU=d.textColor||"black";this.JO=d.linkColor||"#7777cc";this.Jm=d.errorMessage||"";this.nl=d.tileSize||256;this.GR=d.radius||6378137;this.It=0;this.eI=d.alt||"";this.aP=d.lbw||i;this.iP=d.maxZoomEnabled||j;this.Ez=this;for(a=0;a<r(this.hb);++a)U(this.hb[a],"newcopyright",this,this.nu)};
l=Hd.prototype;l.getName=function(a){return a?this.MT:this.HP};
l.getAlt=function(){return this.eI};
l.getProjection=function(){return this.of};
l.getTileLayers=function(){return this.hb};
l.getCopyrights=function(a,b){for(var c=this.hb,d=[],f=0;f<r(c);f++){var g=c[f].getCopyright(a,b);g&&d.push(g)}return d};
l.getMinimumResolution=function(){return this.vk};
l.getMaximumResolution=function(a){return a?this.es(a):this.nk};
l.JM=function(a,b){b=this.getProjection().fromLatLngToPixel(a,b);a=Math.floor(b.x/this.getTileSize());b=Math.floor(b.y/this.getTileSize());return new S(a,b)};
var Dj=function(a){var b=[];tc(a,function(c,d){d&&b.push(d)});
return"cb"+b.join("_").replace(/\W/g,"$")};
l=Hd.prototype;l.CJ=function(a,b){var c="";if(r(this.hb)){c=this.hb[0].getTileUrl(a,b);a=ti(c)[4];c=c.substr(0,c.lastIndexOf(a))}a={};a.callbackNameGenerator=Dj;this.eD=new wg(c+"/mz",document,a)};
l.getMaxZoomAtLatLng=function(a,b,c){if(this.iP){var d=22;if(c!==undefined)if(c<1)d=1;else if(c<22)d=c;a=this.JM(a,d);c={};c.x=a.x;c.y=a.y;c.z=d;c.v=this.aB(0);var f=function(g){var h={};if(g.zoom){h.zoom=g.zoom;h.status=200}else h.status=500;b(h)};
this.eD||this.CJ(a,d);this.eD.send(c,f,f)}else{d={};d.zoom=c==undefined?this.es(a):Math.min(this.es(a),c);d.estimated=e;d.status=200;b(d)}};
l.getTextColor=function(){return this.DU};
l.getLinkColor=function(){return this.JO};
l.getErrorMessage=function(){return this.Jm};
l.getUrlArg=function(){return this.xV};
l.aB=function(a,b,c){var d=i;a=a||-1;if(a==-1)d=this.hb[this.hb.length-1];else if(a<r(this.hb))d=this.hb[a];else return"";b=b||new S(0,0);c=c||0;var f;if(r(this.hb))f=d.getTileUrl(b,c).match(/[&?\/](?:v|lyrs)=([^&]*)/);return f&&f[1]?f[1]:""};
l.mC=function(a,b){if(r(this.hb)){var c=this.getTileSize();a=this.hb[this.hb.length-1].getTileUrl(new S(Kd(a.x/c),Kd(a.y/c)),b);return a.indexOf("/vt?")>=0||a.indexOf("/vt/")>=0}return j};
l.getTileSize=function(){return this.nl};
l.getSpanZoomLevel=function(a,b,c){var d=this.of,f=this.getMaximumResolution(a),g=this.vk,h=K(c.width/2),k=K(c.height/2);for(f=f;f>=g;--f){var o=d.fromLatLngToPixel(a,f);o=new S(o.x-h-3,o.y+k+3);var q=new S(o.x+c.width+3,o.y-c.height-3);o=(new id(d.fromPixelToLatLng(o,f),d.fromPixelToLatLng(q,f))).sb();if(o.lat()>=b.lat()&&o.lng()>=b.lng())return f}return 0};
l.getBoundsZoomLevel=function(a,b){var c=this.of,d=this.getMaximumResolution(a.T()),f=this.vk,g=a.nb();for(a=a.mb();g.lng()>a.lng();)g.yF(g.lng()-360);for(d=d;d>=f;--d){var h=c.fromLatLngToPixel(g,d),k=c.fromLatLngToPixel(a,d);if(fe(k.x-h.x)<=b.width&&fe(k.y-h.y)<=b.height)return d}return 0};
l.nu=function(){A(this,"newcopyright")};
l.es=function(a){for(var b=this.hb,c=[0,j],d=0;d<r(b);d++)b[d].hP(a,c);return c[1]?c[0]:B(this.nk,B(this.It,c[0]))};
l.BF=function(a){this.It=a};
l.YS=function(a){this.Ez=a};
l.getHeading=function(){return this.Gb};
l.getRotatableMapTypeCollection=function(){return this.fv};function Ej(a){this.Zb=a||0;this.on={};this.Bh=[]}
l=Ej.prototype;l.qi=function(a){this.Zb=a};
l.gM=function(){return Jd(this.Bh,n(function(a){return this.on[a]},
this))};
l.Pl=function(a,b){if(b)this.Py=a;else{this.on[a.getHeading()]=a;this.Bh.push(a.getHeading())}};
l.isImageryVisible=function(a,b,c){c(b>=this.Zb)};
l.Tm=function(){if(!this.Py)aa("No default map type available.");return this.Py};
l.rs=function(a){if(!r(this.Bh))aa("No rotated map types available.");return this.on[this.nM(a)]};
l.nM=function(a){a%=360;if(this.on[a])return a;for(var b=this.Bh.concat(this.Bh[0]+360),c=0,d=r(b)-1;c<d-1;){var f=K((c+d)/2);if(a<this.Bh[f])d=f;else c=f}c=b[c];b=b[d];return a<(c+b)/2?c:b%360};function sd(){Ej.call(this,14)}
p(sd,Ej);sd.prototype.isImageryVisible=function(a,b,c){if(b>=this.Zb)if(x(Fj).sN("ob"))x(Fj).Lm("ob",a,c,i,b);else var d=v(x(Fj),"appfeaturesdata",function(f){if(f=="ob"){w(d);x(Fj).Lm("ob",a,c,i,b)}});
else c(j)};var Gj={};function Hj(a){for(var b in a)b in Gj||(Gj[b]=a[b])}
function F(a){return ue(Gj[a])?Gj[a]:""}
window.GAddMessages=Hj;function Ij(a,b){this.gw=a;this.cO=b||a;this.Gh=i;this.tm=[]}
var Jj=[Na,La],Kj=["movestart","panbyuser","zoominbyuser","zoomoutbyuser","zoomto"];l=Ij.prototype;l.nw=function(a,b,c,d){this.Gh&&this.Gh.sc()&&this.TB();this.Gh=be(this);d?fd(this.gw,d,n(this.mG,this,a,b,c,this.Gh)):this.mG(a,b,c,this.Gh)};
l.TB=function(){ce(this);if(this.Yq){this.Yq();this.Yq=i}this.Wx()};
l.Wx=function(){t(this.tm,function(a){w(a)});
this.tm=[]};
l.mG=function(a,b,c,d){if(this.Gh.sc()){a();this.GT(b,c,d)}};
l.GT=function(a,b,c){var d=this,f=this.gw,g=this.cO;t(Jj,n(function(h){this.tm.push(fd(f,h,n(function(k){if(c.sc()){ce(d);b(h,k);this.Wx()}},
this)))},
this));this.Yq=function(){a()};
t(Kj,n(function(h){this.tm.push(fd(g,h,n(function(){c.sc()&&this.TB()},
this)))},
this))};function Ld(a){this.$Q=a}
Ld.prototype.getTileUrl=function(a,b){var c=this.Yr(a,b);return c&&Lj(c,a,b)};
Ld.prototype.Yr=function(a,b){var c=this.$Q;if(!c)return i;for(var d=0;d<c.length;++d)if(!(c[d].minZoom>b||c[d].maxZoom<b)){var f=r(c[d].rect);if(f==0)return c[d].uris;for(var g=0;g<f;++g){var h=c[d].rect[g][b];if(h.n<=a.y&&h.s>=a.y&&h.w<=a.x&&h.e>=a.x)return c[d].uris}}return i};Cj.g=function(a,b,c,d){this.fh=a||new md;this.vk=b||0;this.nk=c||0;U(this.fh,"newcopyright",this,this.nu);a=d||{};this.ng=Le(a.opacity,1);this.cg=Le(a.isPng,j);this.GG=a.tileUrlTemplate;this.DO=a.kmlUrl};
l=Cj.prototype;l.minResolution=function(){return this.vk};
l.maxResolution=function(){return this.nk};
l.ip=function(a){this.Ow=a};
l.hP=function(a,b){var c=j;if(this.Ow)for(var d=0;d<this.Ow.length;++d){var f=this.Ow[d];if(f[0].contains(a)){b[0]=B(b[0],f[1]);c=e}}if(!c){a=this.as(a);if(r(a)>0)for(d=0;d<r(a);d++){if(a[d].maxZoom)b[0]=B(b[0],a[d].maxZoom)}else b[0]=this.nk}b[1]=c};
l.getTileUrl=function(a,b){return this.GG?this.GG.replace("{X}",a.x).replace("{Y}",a.y).replace("{Z}",b).replace("{V1_Z}",17-b):Rc};
l.isPng=function(){return this.cg};
l.getOpacity=function(){return this.ng};
l.getCopyright=function(a,b){return this.fh.$r(a,b)};
l.as=function(a){return this.fh.as(a)};
l.nu=function(){A(this,"newcopyright")};
l.zT=function(a){this.FG=a};
l.ZQ=function(a,b,c,d,f){this.FG&&this.FG(a,b,c,d,f)};function Lj(a,b,c){var d=(b.x+2*b.y)%a.length,f="Galileo".substr(0,(b.x*3+b.y)%8),g="";if(b.y>=10000&&b.y<100000)g="&s=";return[a[d],"x=",b.x,g,"&y=",b.y,"&z=",c,"&s=",f].join("")}
;function Ed(a,b,c,d){var f={};f.isPng=d;Cj.call(this,b,0,c,f);this.Ec=a;this.Mg=i}
p(Ed,Cj);Ed.prototype.getTileUrl=function(a,b){var c=this.Mg&&this.Mg.Yr(a,b)||this.Ec;return Lj(c,a,b)};
Ed.prototype.fp=function(a){this.Mg=a};function Mj(a,b){if(!a)return e;try{b=b||document;Nj(a,"testcookie","1","","",b);if(b.cookie.indexOf("testcookie")!=-1){Nj(a,"testcookie","1","","Thu, 01-Jan-1970 00:00:01 GMT",b);return e}}catch(c){}return j}
function Nj(a,b,c,d,f,g){(g||document).cookie=[b,"=",c,"; domain=.",a,d?"; path=/"+d:"",f?"; expires="+f:""].join("")}
;function Id(a,b,c,d,f){Ed.call(this,a,b,c);d&&this.vT(d,f)}
p(Id,Ed);Id.prototype.vT=function(a,b){if(!(Math.round(Math.random()*100)<=hb)&&Mj(b)){Nj(b,"khcookie",a,"kh");if(rb){Nj(b,"khcookie",a,"maptilecompress");Nj(b,"khcookie",a,"vt/lbw")}}else for(b=0;b<r(this.Ec);++b)this.Ec[b]+="cookie="+a+"&"};function Gd(a){var b=n(a.getTileUrl,a);a.getTileUrl=function(c,d){var f=b(c,d);if(c=Oj(c,d))f+="&opts="+c;return f}}
var Pj=new Zg(53324,34608,60737,41615);function Oj(a,b){if(b<16)return i;b=1<<b-16;a=new S(a.x/b,a.y/b);if(!Pj.Kf(a))return i;if(Wb){if(Vb)return"bs";return"b"}return i}
;function Qj(){this.Ha=i;this.Ap=[]}
l=Qj.prototype;l.bO=j;l.jv=j;l.ot=0;l.vj=i;l.initialize=function(a,b){this.Ha=new wg(b,window.document);this.bO=e;this.jS=tf(this,this.PH);U(a,Da,this,this.fH);U(a,Ga,this,this.fH)};
l.QG=function(a){Ce(this.Ap,a)||this.Ap.push(a)};
l.fH=function(){if(!this.jv){var a=120000-(ed()-this.ot);if(a<=0){this.ot=ed();this.li()}else{this.jv=e;function b(){this.jv=j;this.ot=ed();this.li()}
setTimeout(n(b,this),a)}}};
l.li=function(){if(r(this.Ap)!=0){var a={};a.x=0;a.y=0;a.z=0;a.lyrs=this.Ap.join(",");this.Ha.send(a,this.jS)}};
l.PH=function(a){if(a&&a.yW==0)if(!this.vj||this.vj<a.e){this.vj=a.e;A(this,"pt_update")}};
l.tA=function(){return this.vj};
l.vv=function(a){this.vj=a};function Dd(a,b,c,d){var f={};f.isPng=d;Cj.call(this,b,0,c,f);this.Ec=a;a=a[0].match(this.Dz);this.Xq=parseInt(a[2],10);this.Xb=a[1];x(Qj).vv(this.Xq,this.Xb,new S(0,0),0);x(Qj).QG(this.Xb);this.Mg=i}
p(Dd,Cj);l=Dd.prototype;l.Dz=new RegExp(/(m|h|r)@(\d+)/);l.vv=function(a){this.Xq=a;a=this.eM();for(var b=0,c=r(this.Ec);b<c;++b)this.Ec[b]=this.Ec[b].replace(this.Dz,a)};
l.getTileUrl=function(a,b){var c=this.Mg&&this.Mg.Yr(a,b)||this.Ec;return Lj(c,a,b)};
l.eM=function(){return this.Xb+"@"+this.Xq};
l.fp=function(a){this.Mg=a};function Pc(){Pc.g.apply(this,arguments)}
;var Rj="__mal_";
Pc.g=function(a,b){b=b||new Sj;Eg(b.stats,"mctr0");this.So=b.nW||new Ai;b.gW||Wd(a);this.A=a;this.Ca=[];Ke(this.Ca,b.mapTypes||wc);Fg(r(this.Ca));this.o=b.jk?b.jk.mapType:this.Ca[0];this.rB=j;t(this.Ca,n(this.kD,this));U(x(Qj),"pt_update",this,this.jR);this.qU=b.vG;if(b.jk)this.Za=b.jk.zoom;if(b.size){this.ze=b.size;Cf(a,b.size)}else this.ze=Kf(a);ig(a).position!="absolute"&&Wf(a);a.style.backgroundColor=b.backgroundColor||"#e5e3df";var c=this.EJ(a,b.vW);this.Hn=c;Xf(c);c.style.width="100%";c.style.height=
"100%";this.l=Tj(0,this.Hn);this.mP();Uj(a);this.nK={draggableCursor:b.draggableCursor,draggingCursor:b.draggingCursor};this.tD=b.noResize;this.ic=b.jk?b.jk.center:b.center||i;this.Kc=i;this.Vv=Hb;this.Ii=[];Eg(b.stats,"mczl0");for(a=0;a<2;++a)this.Ii.push(new Vj(this.l,this.ze,this));Eg(b.stats,"mczl1");this.fa=this.Ii[1];this.bc=this.Ii[0];this.EG=new Ij(this);U(this,"zoomto",this,this.ow);U(this,"zoominbyuser",this,this.ow);U(this,"zoomoutbyuser",this,this.ow);this.HT();this.Vh=[];this.lf=this.Cd=
i;this.FT();this.HG=yh(this.fa,La,this);this.Dx=yh(this.fa,"beforetilesload",this);this.lH=yh(this.fa,Na,this);this.mj=e;this.Ay=this.bj=j;this.qm=mf(n(function(d){vd("zoom",1,n(function(f){this.Ay=e;d(new f(this))},
this))},
this));this.Zb=0;this.be=B(30,30);this.wr=e;this.Wc=[];this.fq=[];this.Uh=[];this.ro={};this.Uc=[];this.ON();this.$c=[];this.eh=[];this.Z=[];this.xa(window);this.Wq=i;this.gH=new Mi(this,b.hH);this.Ha=new wg(_mHost+"/maps/gen_204",window.document);this.Pf=b.eO||j;b.ml||this.JN(b);this.gB=b.googleBarOptions;this.xs=j;this.ZO=b.logoPassive;this.zz();this.sy=j;A(Pc,Ba,this);Eg(b.stats,"mctr1")};
Pc.prototype.EJ=function(a,b){var c=i;if(b)c=Nf(b);if(c)Bf(c,Xg);else c=J("DIV",a,Xg);return c};
Pc.prototype.ON=function(){for(var a=0;a<8;++a)this.Uc.push(Tj(100+a,this.l));Wj([this.Uc[4],this.Uc[6],this.Uc[7]]);$f(this.Uc[4],"default");$f(this.Uc[7],"default")};
Pc.prototype.JN=function(a){var b=i;if(xc||a.eO)this.$p(a.logoPassive);else b=a.copyrightOptions?a.copyrightOptions:{googleCopyright:e,allowSetVisibility:!hc};a=this.Gc=new Xj(b);var c;if(b=Nf("overview-toggle"))c=new Yj(3,new R(3+b.offsetWidth,2));this.$a(a,c)};
Pc.prototype.mP=function(){if(E.pb()&&Wi()){this.Hn.setAttribute("dir","ltr");this.l.setAttribute("dir","rtl")}};
var Uj=function(a){var b=ig(a).dir||ig(a).direction;E.type==1&&!Wi()&&b=="rtl"&&Kg(a,"dir","ltr")};
l=Pc.prototype;l.$p=function(a){this.$a(new Zj(a))};
l.xJ=function(a,b){a=new Mh(a,b);b=[U(a,"dragstart",this,this.lg),U(a,"drag",this,this.jf),U(a,"move",this,this.uQ),U(a,"dragend",this,this.kg),U(a,m,this,this.RP),U(a,ka,this,this.fu)];Ke(this.Z,b);return a};
l.xa=function(a,b){t(this.Z,w);ff(this.Z);if(b)if(ue(b.noResize))this.tD=b.noResize;this.G=this.xJ(this.l,this.nK);var c=[T(this.A,ja,this,this.GD),T(this.A,sa,this,this.mg),T(this.A,"mouseover",this,this.tQ),T(this.A,"mouseout",this,this.AD),U(this,Ca,this,this.nP),U(this,ka,this,this.QJ)];Ke(this.Z,c);this.UN();this.tD||this.Z.push(T(a,Ea,this,this.$i));t(this.eh,function(d){d.control.xa(a)});
this.Ub().xa(a,b)};
l.mi=function(a,b){if(b||!this.Eh())this.Kc=a};
l.T=function(){return this.ic};
l.Ga=function(a,b,c,d,f){Yb&&this.IF(Hb);this.He()&&this.qm(function(k){k.cancelContinuousZoom()});
if(b){var g=c||this.o||this.Ca[0],h=se(b,0,B(30,30));g.BF(h)}d&&A(this,"panbyuser");this.aj(a,b,c,f)};
l.fF=function(a){this.ic=a};
l.aj=function(a,b,c,d){var f=!this.ha();b&&this.tn();this.am(d);var g=[],h=i,k=i;if(a){k=a;h=this.xb();this.ic=a}else{var o=this.bh();k=o.latLng;h=o.divPixel;this.ic=o.newCenter}if(c&&this.qU)c=c.Ez;var q=c||this.o||this.Ca[0];c=0;if(ue(b)&&ve(b))c=b;else if(this.Za)c=this.Za;var s=this.At(c,q,this.bh().latLng);if(s!=this.Za){g.push([this,Ga,this.Za,s,d]);this.Za=s}d&&this.YU(d,f);if(q!=this.o||f){this.o=q;Eg(d,"zlsmt0");t(this.Ii,function(H){H.Bb(q)});
Eg(d,"zlsmt1");g.push([this,Ca,d])}c=this.fa;var u=this.zb();Eg(d,"pzcfg0");c.configure(k,h,s,u);Eg(d,"pzcfg1");c.show();t(this.$c,function(H){var G=H.La;G.configure(k,h,s,u);H.I()||G.show()});
if(!this.ic)this.ic=this.X(this.xb());this.Ku(e);if(a||b!=i||f){g.push([this,"move"]);g.push([this,Da])}if(f){this.UE();g.push([this,ra]);this.sy=e}for(a=0;a<r(g);++a)A.apply(i,g[a])};
l.nG=function(a,b,c){var d=function(){b.branch();c.oG==0&&b.tick("tlol0");c.oG++},
f=function(){b.tick("tlolim");b.done()},
g=n(function(){if(c.pl==1){b.tick("tlol1");this.lf=this.Cd=i}b.done();c.pl--},
this);a.nw(d,f,g);delete d;delete f;delete g};
l.XU=function(a){this.Cd={oG:0,pl:r(this.Vh)};this.lf=a;t(this.Vh,n(function(b){this.nG(b,a,this.Cd)},
this))};
l.YU=function(a){this.XU(a);var b=function(){a.tick("t0");a.branch()},
c=function(){a.done("tim")},
d=n(function(f,g){f==Na&&a.Xg("nvt",""+g);hd(a,this);a.tick("t1");a.done()},
this);this.EG.nw(b,c,d);delete b;delete c;delete d};
l.qb=function(a,b,c){var d=this.xb(),f=this.J(a),g=d.x-f.x;d=d.y-f.y;f=this.O();this.am(c);if(fe(g)==0&&fe(d)==0)this.ic=a;else if(fe(g)<=f.width&&fe(d)<f.height){this.to(new R(g,d),b,c);xj("panned-to")}else this.Ga(a,undefined,undefined,b,c)};
l.F=function(){return K(this.Za)};
l.te=function(a){this.aj(undefined,a)};
l.$F=function(a){this.Za=a};
l.Dc=function(a,b,c){A(this,"zoominbyuser");this.Sp(1,e,a,b,c)};
l.bd=function(a,b){A(this,"zoomoutbyuser");this.Sp(-1,e,a,j,b)};
l.NV=function(a,b,c){this.Sp(a,j,b,j,c)};
l.tH=function(a,b,c){this.Sp(a,j,b,e,c)};
l.Sp=function(a,b,c,d,f){this.He()&&f?this.qm(function(g){g.zoomContinuously(a,b,c,d)}):this.KV(a,
b,c,d)};
l.Lc=function(){var a=this.zb(),b=this.O();return new Zg([new S(a.x,a.y),new S(a.x+b.width,a.y+b.height)])};
l.H=function(){var a=this.Lc(),b=new S(a.minX,a.maxY);a=new S(a.maxX,a.minY);return this.gL(b,a)};
l.gL=function(a,b){var c=this.X(a,e),d=this.X(b,e),f=d.lat(),g=d.lng(),h=c.lat(),k=c.lng();if(d.lat()<c.lat()){f=c.lat();h=d.lat()}c=new id(new z(h,k),new z(f,g));a=this.X(new S((a.x+b.x)/2,(a.y+b.y)/2),e);c.contains(a)||(c=new id(new z(h,g),new z(f,k)));return c};
l.RM=function(){var a=this.Lc(),b=new S(a.minX,a.maxY);a=new S(a.maxX,a.minY);return new nj(this.X(b,e),this.X(a,e))};
l.O=function(){return this.ze};
l.AL=function(){return this.o};
l.hM=function(){return this.Ca};
l.Bb=function(a,b){if(this.ha())this.Yf().Rk()?this.Yf().oT(a,b):this.aj(undefined,undefined,a,b);else this.o=a};
l.Pl=function(a){if(this.oO(a))if(ye(this.Ca,a)){this.kD(a);A(this,"addmaptype",a)}};
l.CE=function(a){if(!(r(this.Ca)<=1))if(xe(this.Ca,a)){this.o==a&&this.Bb(this.Ca[0]);this.II(a);A(this,"removemaptype",a)}};
l.oO=function(a){return a==Nd||a==Od?E.bC(xb):e};
l.Yf=function(){if(!this.SE)this.SE=new $j(this);return this.SE};
l.em=function(a){this.Yf().em(a)};
l.Wj=function(){return this.Yf().Wj()};
l.Er=function(){this.Yf().Er()};
l.or=function(){this.Yf().or()};
l.Rk=function(){return this.Yf().Rk()};
l.AE=function(a,b){var c=this.ro;t(a,function(d){c[d]=b});
this.Uh.push(b);b.initialize(this)};
l.Fj=function(a){return this.ro[a]};
l.ba=function(a,b){var c=this.ro[a.Ea?a.Ea():""];this.fq.push(a);if(c)c.ba(a,b);else{if(a instanceof ak){b=0;for(c=r(this.$c);b<c&&this.$c[b].zPriority<=a.zPriority;)++b;this.$c.splice(b,0,a);a.initialize(this);for(b=0;b<=c;++b)this.$c[b].La.ri(b);b=this.bh();c=a.La;c.configure(b.latLng,b.divPixel,this.Za,this.zb());a.I()||c.show()}else{this.Wc.push(a);a.initialize(this,undefined,b);a.redraw(e)}this.Yw(a)}A(this,"addoverlay",a)};
l.Yw=function(a){var b=v(a,m,n(function(c){A(this,m,a,undefined,c)},
this));this.Ol(b,a);b=v(a,ja,n(function(c){this.GD(c,a);Tg(c)},
this));this.Ol(b,a);b=v(a,Aa,n(function(c){A(this,"markerload",c,a.UD);if(!a.Pk)a.Pk=fd(a,"remove",n(function(){A(this,"markerunload",a)},
this))},
this));this.Ol(b,a)};
function bk(a){if(a[Rj]){t(a[Rj],function(b){w(b)});
a[Rj]=i}}
l=Pc.prototype;l.ka=function(a,b){var c=this.ro[a.Ea?a.Ea():""];xe(this.fq,a);if(c){c.ka(a,b);A(this,"removeoverlay",a)}else if(xe(a instanceof ak?this.$c:this.Wc,a)){a.remove();bk(a);A(this,"removeoverlay",a)}};
l.Vf=function(a){t(this.Wc,a);t(this.Uh,function(b){b.Vf(a)})};
l.XI=function(a){var b=(a||{}).Dd,c=[],d=function(g){oi.rd(g)==b&&c.push(g)};
t(this.Wc,d);t(this.$c,d);t(this.Uh,function(g){g.Vf(d)});
a=0;for(var f=r(c);a<f;++a)this.ka(c[a])};
l.Zx=function(a){var b=this.oa();b&&this.YQ(b.rd(),a)&&this.da();this.XI(a);this.KC=this.LC=i;this.mi(i);A(this,"clearoverlays")};
l.$a=function(a,b){this.ge(a);var c=a.initialize(this);b=b||a.getDefaultPosition();a.printable()||bg(c);a.selectable()||gg(c);vh(c,i,Tg);if(!a.Jq||!a.Jq())sh(c,ja,Sg);c.style.zIndex==""&&fg(c,0);yh(a,"zoomto",this);b&&b.apply(c);this.Wq&&a.allowSetVisibility()&&this.Wq(c);ze(this.eh,{control:a,element:c,position:b},function(d,f){return d.position&&f.position&&d.position.anchor<f.position.anchor})};
l.jA=function(){return Jd(this.eh,function(a){return a.control})};
l.uL=function(a){return(a=this.Zr(a))&&a.element?a.element:i};
l.ge=function(a,b){for(var c=this.eh,d=0;d<r(c);++d){var f=c[d];if(f.control==a){b||Cg(f.element);c.splice(d,1);a.Jk();a.clear();return}}};
l.TS=function(a,b){(a=this.Zr(a))&&b.apply(a.element)};
l.vL=function(a){return(a=this.Zr(a))&&a.position?a.position:i};
l.Zr=function(a){for(var b=this.eh,c=0;c<r(b);++c)if(b[c].control==a)return b[c];return i};
l.rn=function(){this.kF(Tf)};
l.ti=function(){this.kF(Uf)};
l.kF=function(a){var b=this.eh;this.Wq=a;for(var c=0;c<r(b);++c){var d=b[c];d.control.allowSetVisibility()&&a(d.element)}};
l.$i=function(){var a=Kf(this.A);if(!a.equals(this.O())){this.ze=a;E.type==1&&Cf(this.Hn,a);if(this.ha()){this.ic=this.X(this.xb());t(this.Ii,function(c){c.ZF(a)});
t(this.$c,function(c){c.La.ZF(a)});
var b=this.getBoundsZoomLevel(this.vA());b<this.Nc()&&this.qi(B(0,b));A(this,Ea)}}};
l.vA=function(){if(!this.Xz)this.Xz=new id(new z(-85,-180),new z(85,180));return this.Xz};
l.getBoundsZoomLevel=function(a){return(this.o||this.Ca[0]).getBoundsZoomLevel(a,this.ze)};
l.UE=function(){this.KS=this.T();this.LS=this.F()};
l.QE=function(){var a=this.KS,b=this.LS;if(a)b==this.F()?this.qb(a,e):this.Ga(a,b,i,e)};
l.ha=function(){return this.sy};
l.nc=function(){this.G.disable()};
l.Ic=function(){this.G.enable()};
l.qj=function(){return this.G.enabled()};
l.At=function(a,b,c){return se(a,this.Nc(b),this.Mc(b,c))};
l.qi=function(a){a=se(a,0,B(30,30));if(a!=this.Zb)if(!(a>this.Mc())){var b=this.Nc();this.Zb=a;if(this.Zb>this.Za)this.te(this.Zb);else this.Zb!=b&&A(this,"zoomrangechange")}};
l.Nc=function(a){a=(a||this.o||this.Ca[0]).getMinimumResolution();return B(a,this.Zb)};
l.Ev=function(a){var b=se(a,0,B(30,30));if(a!=this.be)if(!(b<this.Nc())){a=this.Mc();this.be=b;if(this.be<this.Za)this.te(this.be);else this.be!=a&&A(this,"zoomrangechange")}};
l.Mc=function(a,b){a=(a||this.o||this.Ca[0]).getMaximumResolution(b||this.ic);return me(a,this.be)};
l.Ya=function(a){return this.Uc[a]};
l.TD=function(a){return Sf(this.Uc[a])};
l.R=function(){return this.A};
l.rA=function(){return this.G};
l.HT=function(){v(this,"beforetilesload",n(function(){this.xr&&this.Ov(new cd("pan_drag"))},
this))};
l.lg=function(){this.am();this.xr=e};
l.jf=function(){if(this.xr)if(this.lh)A(this,"drag");else{A(this,"dragstart");A(this,"movestart");this.lh=e}};
l.kg=function(a){if(this.lh){A(this,"dragend");A(this,Da);this.AD(a);var b={};a=kh(a,this.A);var c=this.oh(a),d=this.O();b.infoWindow=this.Sj();b.mll=this.T();b.cll=c;b.cp=a;b.ms=d;A(this,"panto","mdrag",b);this.xr=this.lh=j}};
l.GD=function(a,b){if(!a.cancelContextMenu){var c=kh(a,this.A),d=this.oh(c);if(!b||b==this.R())b=this.Fj("Polygon").oB(d);if(this.mj)if(this.Sg){this.Sg=j;this.bd(i,e);clearTimeout(this.AS);A(this,"zoomto","drclk")}else{this.Sg=e;var f=Qg(a);this.AS=qg(this,n(function(){this.Sg=j;A(this,"singlerightclick",c,f,b)},
this),250)}else A(this,"singlerightclick",c,Qg(a),b);Ug(a);if(E.type==4&&E.os==0)a.cancelBubble=e}};
l.fu=function(a){a.button>1||this.qj()&&this.wr&&this.tl(a,ka)};
l.Eh=function(){var a=j;this.He()&&this.qm(function(b){a=b.Eh()});
return a};
l.QJ=function(a,b){if(b)if(this.mj){if(!this.Eh()){this.Dc(b,e,e);A(this,"zoomto","dclk")}}else this.qb(b,e)};
l.RP=function(a){var b=ed();if(!ue(this.rC)||b-this.rC>100)this.tl(a,m);this.rC=b};
l.hh=i;l.tl=function(a,b,c){c=c||kh(a,this.A);var d;this.hh=d=this.ha()?ck(c,this):new z(0,0);for(var f=0,g=this.Uh.length;f<g;++f)if(this.Uh[f].Lj(a,b,c,d))return;b==m||b==ka?A(this,b,i,d):A(this,b,d)};
l.mg=function(a){this.lh||this.tl(a,sa)};
l.AD=function(a){if(!this.lh){var b=kh(a,this.A);if(!this.qO(b)){this.eC=j;this.tl(a,"mouseout",b)}}};
l.qO=function(a){var b=this.O();return a.x>=2&&a.y>=2&&a.x<b.width-2&&a.y<b.height-2};
l.tQ=function(a){if(!(this.lh||this.eC)){this.eC=e;this.tl(a,"mouseover")}};
function ck(a,b){var c=b.zb();return b.X(new S(c.x+a.x,c.y+a.y))}
l=Pc.prototype;l.uQ=function(){this.ic=this.X(this.xb());var a=this.zb();this.fa.RE(a);t(this.$c,function(b){b.La.RE(a)});
this.Ku(j);A(this,"move")};
l.Ku=function(a){function b(c){c&&c.redraw(a)}
t(this.Wc,b);t(this.Uh,function(c){c.Vf(b)})};
l.to=function(a,b,c){var d=Math.sqrt(a.width*a.width+a.height*a.height);d=B(5,K(d/20));this.Xh=new Ci(d);this.Xh.reset();this.bp(a);A(this,"movestart");b&&A(this,"panbyuser");this.ez(c)};
l.bp=function(a){this.aR=new R(a.width,a.height);a=this.G;this.cR=new S(a.left,a.top)};
l.FT=function(){v(this,"addoverlay",n(function(a){if(a instanceof ak){a=new Ij(a.La,this);this.Vh.push(a);if(this.Cd&&this.lf){this.Cd.pl++;this.nG(a,this.lf,this.Cd)}}},
this));v(this,"removeoverlay",n(function(a){if(a instanceof ak)for(var b=0;b<r(this.Vh);++b)if(this.Vh[b].gw==a.La){this.Vh.splice(b,1);if(this.Cd&&this.lf){this.Cd.pl--;if(this.Cd.pl==0){this.lf.done("tlol1");this.Cd=this.lf=i}else this.lf.done()}break}},
this))};
l.Ov=function(a,b){var c=function(g){g.branch("t0");g.done()},
d=function(g){g.CH()},
f=function(g,h,k){h==Na&&g.Xg("nvt",""+k);g.done("t1")};
this.EG.nw(pf(c,a),pf(d,a),pf(f,a),b);delete c;delete d;delete f};
l.ow=function(){this.Ov(new cd("zoom"))};
l.WU=function(){this.Ov(new cd("pan_ctrl"),"panbyuser")};
l.db=function(a,b){this.WU();var c=this.O(),d=K(c.width*0.3);c=K(c.height*0.3);this.to(new R(a*d,b*c),e)};
l.ez=function(a){!this.pg&&a&&a.branch();this.pg=a;this.NF(this.Xh.next());if(this.Xh.more())this.vo=setTimeout(n(this.ez,this,a),10);else{this.pg=this.vo=i;a&&a.done();A(this,Da)}};
l.NF=function(a){var b=this.cR,c=this.aR;this.G.uc(b.x+c.width*a,b.y+c.height*a)};
l.am=function(a){if(this.vo){clearTimeout(this.vo);this.vo=i;A(this,Da);if(this.pg&&this.pg!==a)this.pg.done();else this.pg&&setTimeout(function(){a.done()},
0);this.pg=i}};
l.fL=function(a){var b=this.zb();return this.fa.Nm(new S(a.x+b.x,a.y+b.y))};
l.oh=function(a){return ck(a,this)};
l.Tz=function(a){a=this.J(a);var b=this.zb();return new S(a.x-b.x,a.y-b.y)};
l.X=function(a,b){return this.fa.X(a,b)};
l.Sd=function(a){return this.fa.Sd(a)};
l.J=function(a,b){var c=this.fa;b=b||this.xb();return c.J(a,undefined,b)};
l.Uz=function(a){return this.fa.J(a)};
l.vM=function(a,b,c){var d=this.o.getProjection();c=c==i?this.F():c;a=d.fromLatLngToPixel(a,c);b=d.fromLatLngToPixel(b,c);b=new S(b.x-a.x,b.y-a.y);return Math.sqrt(b.x*b.x+b.y*b.y)};
l.ws=function(){return this.fa.ws()};
l.zb=function(){return new S(-this.G.left,-this.G.top)};
l.xb=function(){var a=this.zb(),b=this.O();a.x+=K(b.width/2);a.y+=K(b.height/2);return a};
l.bh=function(){return this.Kc&&this.H().contains(this.Kc)?{latLng:this.Kc,divPixel:this.J(this.Kc),newCenter:i}:{latLng:this.ic,divPixel:this.xb(),newCenter:this.ic}};
function Tj(a,b){b=J("div",b,Xg);fg(b,a);return b}
l=Pc.prototype;l.KV=function(a,b,c,d){a=b?this.F()+a:a;if(this.At(a,this.o,this.T())==a)if(c&&d)this.Ga(c,a,this.o);else if(c){A(this,"zoomstart",a-this.F(),c,d);b=this.Kc;this.Kc=c;this.te(a);this.Kc=b}else this.te(a);else c&&d&&this.qb(c)};
l.yN=function(){t(this.$c,function(a){a.La.hide()})};
l.hJ=function(a){var b=this.bh(),c=this.F(),d=this.zb();t(this.$c,function(f){var g=f.La;g.configure(b.latLng,a,c,d);f.I()||g.show()})};
l.De=function(a){return a};
l.UN=function(){this.Z.push(T(document,m,this,this.NI))};
l.NI=function(a){var b=this.oa();for(a=Qg(a);a;a=a.parentNode){if(a==this.A){this.XL();return}if(a==this.Uc[7]&&b&&b.bg())break}this.$O()};
l.$O=function(){this.Is=j};
l.XL=function(){this.Is=e};
l.jT=function(a){this.Is=a};
l.rN=function(){return this.Is||j};
l.tT=function(a){this.fa=a;w(this.HG);w(this.Dx);w(this.lH);this.HG=yh(this.fa,La,this);this.Dx=yh(this.fa,"beforetilesload",this);this.lH=yh(this.fa,Na,this)};
l.uT=function(a){this.bc=a};
l.tn=function(){Qf(this.bc.l)};
l.xK=function(){if(!this.bj){this.bj=e;this.qm(n(function(){this.ha()&&this.aj()},
this))}};
l.YJ=function(){this.bj=j};
l.lJ=function(){return this.bj};
l.He=function(){return this.Ay&&this.bj};
l.uz=function(){this.mj=e};
l.jr=function(){this.mj=j};
l.jK=function(){return this.mj};
l.yK=function(){this.wr=e};
l.ZJ=function(){this.wr=j};
l.xN=function(){t(this.Uc,Tf)};
l.XT=function(){t(this.Uc,Uf)};
l.qQ=function(a){this.rB=e;if(a==(this.mapType||this.Ca[0]))A(this,"zoomrangechange")};
l.kD=function(a){this.Ol(U(a,"newcopyright",this,function(){this.qQ(a)}),
a)};
l.Ol=function(a,b){if(b[Rj])b[Rj].push(a);else b[Rj]=[a]};
l.II=function(a){a[Rj]&&t(a[Rj],function(b){w(b)})};
l.Bz=function(){if(!this.kv()){this.Ro=mf(n(function(a){vd("scrwh",1,n(function(b){a(new b(this))},
this))},
this));this.Ro(n(function(a){yh(a,"zoomto",this);this.magnifyingGlassControl=new dk;this.$a(this.magnifyingGlassControl)},
this))}};
l.Wy=function(){if(this.kv()){this.Ro(function(a){a.disable()});
this.Ro=i;this.ge(this.bP);this.bP=i}};
l.kv=function(){return!!this.Ro};
l.zz=function(){if(E.Dh()&&!this.uu()){this.Wn=mf(n(function(a){vd("touch",5,n(function(b){a(new b(this))},
this))},
this));this.Wn(n(function(a){yh(a,oa,this.l);yh(a,pa,this.l)},
this))}};
l.aK=function(){if(this.uu()){this.Wn(n(function(a){a.disable();ph(a,oa);ph(a,pa)},
this));this.Wn=i}};
l.uu=function(){return!!this.Wn};
l.nP=function(a){if(this.o==Nd||this.o==Od)this.ld||this.Fy(a)};
l.Fy=function(a,b){vd("earth",1,n(function(c){if(!this.ld){this.ld=new c(this);this.ld.initialize(a)}b&&b(this.ld)},
this),a)};
l.PM=function(a){this.ld?this.ld.SA(a):this.Fy(i,function(b){b.SA(a)})};
l.getEventContract=function(){if(!this.Ma)this.Ma=new ek;return this.Ma};
l.DJ=function(a,b,c){c=c||{};var d=ve(c.zoomLevel)?c.zoomLevel:15,f=c.mapType||this.o,g=c.mapTypes||this.Ca,h=c.size||new R(217,200);Cf(a,h);var k=new Sj;k.mapTypes=g;k.size=h;k.ml=ue(c.ml)?c.ml:e;k.copyrightOptions=c.copyrightOptions;k.hH="p";k.noResize=c.noResize;k.vG=e;a=new Pc(a,k);if(c.staticMap)a.nc();else{a.$a(new fk);r(a.Ca)>1&&a.$a(new gk(e))}a.Ga(b,d,f);var o=c.overlays;if(!o){o=[];this.Vf(function(q){q instanceof hk||o.push(q)})}for(b=0;b<r(o);++b)if(o[b]!=this.oa())if(!(o[b].ya()&&o[b].I()))if(c=
o[b].copy()){c instanceof ik&&c.nc();
a.ba(c)}return a};
l.Ub=function(){if(!this.ik){this.ik=new jk(this,this.So);for(var a=["maxtab","markerload",Ka,Ja,"infowindowupdate",Ha,Ia,"maximizedcontentadjusted","iwopenfrommarkerjsonapphook"],b=0,c=r(a);b<c;++b)yh(this.ik,a[b],this)}return this.ik};
l.GN=function(){return this.TD(7)&&this.TD(5)?e:j};
l.ja=function(a,b,c,d){this.Ub().ja(a,b,c,d)};
l.Hp=function(a,b,c,d,f){this.Ub().Hp(a,b,c,d,f)};
l.Gp=function(a,b,c){this.Ub().Gp(a,b,c)};
l.cl=function(a){this.Ub().cl(a)};
l.YQ=function(a,b){b=(b||{}).Dd;if(Ce(this.Wc,a))return oi.rd(a)==b;return e};
l.da=function(){this.Ub().da()};
l.Ej=function(){return this.Ub().Ej()};
l.oa=function(){return this.Ub().oa()};
l.Sj=function(){var a=this.oa();return!!a&&!a.I()};
l.Kb=function(a,b){return this.Ub().Kb(a,b)};
l.qu=function(a,b,c,d,f){this.Ub().qu(a,b,c,d,f)};
l.jR=function(){t(this.Ca,function(a){t(a.getTileLayers(),function(b){if(b instanceof Dd){var c=x(Qj).tA(b.Xb,new S(0,0),0);b.vv(c)}})});
t(this.Ii,function(a){a.refresh()})};
l.it=function(){var a=this.o;return a==Nd||a==Od};
l.IF=function(a){this.Vv=a};
function Li(a,b,c,d,f){if(c){a.ll=b.T().Aa();a.spn=b.H().sb().Aa()}if(d){c=b.o.getUrlArg();if(c!=f)a.t=c;else delete a.t}a.z=b.F();A(b,Pa,a)}
;var $j=function(a){this.f=a;this.Sk=this.Kn=j;this.Gb=a.o.getHeading();this.Cs=e};
l=$j.prototype;l.Wj=function(){return this.Kn};
l.em=function(a){var b=this.f,c=this.f.o;if(this.Kn){var d=c.getRotatableMapTypeCollection(),f=this.Gb;if(d){c=d.rs(a);if(f!=c.getHeading()){this.Gb=c.getHeading();this.$o(c)}}else this.Gb=c.getHeading();f!=a&&A(b,"headingchanged")}};
l.Sx=function(){if(this.Cs){var a=this.f.o;a.getRotatableMapTypeCollection()?this.AF(a.getRotatableMapTypeCollection().Tm()):this.Dp(a.getHeading(),j)}};
l.oT=function(a,b){var c=a.getRotatableMapTypeCollection();if(c&&a==c.Tm())this.AF(a,b);else{this.$o(a,b);this.Dp(a.getHeading(),j)}};
l.AF=function(a,b){var c=this.f,d=a.getRotatableMapTypeCollection();d.isImageryVisible(c.H(),c.F(),n(function(f){if(f)a=d.rs(c.o.getHeading());this.$o(a,b);this.Dp(c.o.getHeading(),f)},
this))};
l.$o=function(a,b){this.Cs=j;this.f.aj(undefined,undefined,a,b);this.Cs=e};
l.Dp=function(a,b){if(this.Gb!=a){this.Gb=a;A(this.f,"headingchanged")}if(this.Kn!=b){this.Kn=b;A(this.f,"rotatabilitychanged")}};
l.Er=function(){if(!this.Sk){this.Sk=e;this.FS=Jd([Ga,Ca],n(function(a){return U(this.f,a,this,this.Sx)},
this));this.Sx()}};
l.or=function(){if(this.Sk){this.Sk=j;t(this.FS,w);var a=this.f,b=a.o.getRotatableMapTypeCollection();b&&this.$o(b.Tm());this.Dp(a.o.getHeading(),j)}};
l.Rk=function(){return this.Sk};function Sj(){}
;function Vj(a,b,c,d,f){this.A=a;this.f=c;this.kl=f;this.Ig=i;this.dt=j;this.l=J("div",this.A,Xg);this.no=0;sh(this.l,ja,Ug);Qf(this.l);this.wg=new R(0,0);this.Ka=[];this.tc=0;this.dc=i;if(this.f.He())this.Jl=i;this.fc=[];this.Ae=[];this.gk=[];this.Po=this.Jf=j;this.Ps=0;this.ze=b;this.Qo=0;this.o=i;this.kt=!!d;d||this.Bb(c.o);U(D,ia,this,this.QP)}
l=Vj.prototype;l.yh=e;l.gf=0;l.Oh=0;l.configure=function(a,b,c,d){this.Qo=this.tc=c;if(this.f.He())this.Jl=a;a=this.Sd(a);this.wg=new R(a.x-b.x,a.y-b.y);this.dc=kk(d,this.wg,this.o.getTileSize());for(b=0;b<r(this.Ka);b++)Uf(this.Ka[b].pane);this.refresh();this.dt=e};
l.ry=function(a,b,c,d){x(Uh).zf.To(j);this.configure(a,b,c,d);x(Uh).zf.To(e)};
l.RE=function(a){this.gf=this.Oh=0;this.Mz();a=kk(a,this.wg,this.o.getTileSize());if(!a.equals(this.dc)){this.Jf=e;Ee(this.fc)&&A(this,"beforetilesload");for(var b=this.dc.topLeftTile,c=this.dc.gridTopLeft,d=a.topLeftTile,f=this.o.getTileSize(),g=b.x;g<d.x;++g){b.x++;c.x+=f;this.oc(this.DS)}for(g=b.x;g>d.x;--g){b.x--;c.x-=f;this.oc(this.CS)}for(g=b.y;g<d.y;++g){b.y++;c.y+=f;this.oc(this.BS)}for(g=b.y;g>d.y;--g){b.y--;c.y-=f;this.oc(this.ES)}a.equals(this.dc);this.Po=e;this.TG();this.Jf=j}};
l.Mz=function(){if(this.f.Vv&&this.dc){this.f.IF(j);this.refresh()}};
l.ZF=function(a){this.ze=a;this.oc(this.wt);this.Mz();a=i;if(!this.kt&&D.isInLowBandwidthMode())a=this.Yb;for(var b=0;b<r(this.Ka);b++){a&&this.Ka[b].Hv(a);a=this.Ka[b]}};
l.Bb=function(a){if(a!=this.o){this.o=a;this.by();a=a.getTileLayers();r(a)<=100;for(var b=i,c=0;c<r(a);++c){this.TH(a[c],c,b);b=this.Ka[c]}this.Id=this.Ka[0];if(!this.kt&&D.isInLowBandwidthMode())this.aG();else this.Id=this.Ka[0]}};
l.aG=function(){var a=this.o.aP;if(a){if(!this.Yb)this.Yb=new lk(this.l,a,-1);a=this.Id=this.Yb;this.wt(a,e);this.Ka[0].Hv(a);this.Rz(n(function(b){if(!b.isLowBandwidthTile)if(bi(b)&&!ef(b[Sh],Rc)){b.bandwidthAllowed=D.ALLOW_KEEP;Rf(b)}else this.hr(b)},
this));this.dc&&this.refresh()}};
l.hr=function(a){a.bandwidthAllowed=D.DENY;delete this.Ae[a[Sh]];delete this.fc[a[Sh]];ci(a);this.dl(a,Rc,j);Qf(a)};
l.IO=function(){this.Ka[0].YI();this.Id=this.Ka[0];this.Rz(Rf);this.dc&&this.refresh();this.Yb&&this.Yb.Rr(n(function(a){this.dl(a,Rc,j)},
this))};
l.Rz=function(a){this.oc(function(b){b.Rr(a)})};
l.remove=function(){this.by();Cg(this.l)};
l.show=function(){Rf(this.l)};
l.J=function(a,b,c){if(this.f.He()&&this.Jl){b=b||this.ln(this.Qo);var d=this.Vz(this.Jl),f=i;if(c)f=this.Nm(this.Sz(c,d,b));a=this.Sd(a,i,f);return this.Wz(this.Tr(a),d,b)}else{f=c?this.Nm(c):i;a=this.Sd(a,i,f);return this.Tr(a)}};
l.ws=function(){return(this.f.He()?this.ln(this.Qo):1)*this.o.getProjection().getWrapWidth(this.tc)};
l.X=function(a,b){if(this.f.He()&&this.Jl){var c=this.ln(this.Qo),d=this.Vz(this.Jl);a=this.Sz(a,d,c)}else a=a;a=this.Nm(a);return this.o.getProjection().fromPixelToLatLng(a,this.tc,b)};
l.Sd=function(a,b,c){var d=this.o.getProjection();b=b||this.tc;a=d.fromLatLngToPixel(a,b);c&&d.getNearestImage(a,b,c);return a};
l.Nm=function(a){return new S(a.x+this.wg.width,a.y+this.wg.height)};
l.Tr=function(a){return new S(a.x-this.wg.width,a.y-this.wg.height)};
l.Vz=function(a){return this.Tr(this.Sd(a))};
l.oc=function(a){var b=this;t(this.Ka,function(c){a.call(b,c)});
this.Yb&&D.isInLowBandwidthMode()&&a.call(this,this.Yb)};
l.fJ=function(a){var b=a.tileLayer;a=this.lG(a);for(var c=this.no=0;c<r(a);++c){var d=a[c];this.If(d,b,new S(d.coordX,d.coordY))}};
l.gU=function(){this.oc(this.lG);this.Po=j};
l.lG=function(a){var b=this.f.bh().latLng;this.hU(a.images,b,a.sortedImages);return a.sortedImages};
l.If=function(a,b,c){var d;if(a.errorTile){Cg(a.errorTile);a.errorTile=i;d=e}if(a.baseTileHasError){a.baseTileHasError=i;d=e}var f=this.o,g=this.f.O(),h=f.getTileSize(),k=this.dc.gridTopLeft;k=new S(k.x+c.x*h,k.y+c.y*h);var o=this.dc.topLeftTile;o=new S(o.x+c.x,o.y+c.y);b.ZQ(k,o,h,this.f.H(),this.tc);if(k.x!=a.offsetLeft||k.y!=a.offsetTop)Bf(a,k);Cf(a,new R(h,h));var q=this.tc;c=e;if(f.getProjection().tileCheckRange(o,q,h)){if(a.isLowBandwidthTile&&a.imageAbove&&bi(a.imageAbove)&&!ef(a.imageAbove[Sh],
Rc))b=a.imageAbove[Sh];else{b=b.getTileUrl(o,q);if(b==i){b=Rc;c=j}}f=e;k=new S(k.x+kg(this.A,"left"),k.y+kg(this.A,"top"));if(!(new Zg(-h,-h,g.width,g.height)).Kf(k)){if(this.f.Vv)b=Rc;f=j}if(b!=a[Sh]){if(D.isInLowBandwidthMode()){if(this.Yb&&a.bandwidthAllowed==D.DENY){this.hr(a);return j}if(a.bandwidthAllowed==D.ALLOW_KEEP&&!Ee(this.fc)){this.hr(a);return j}else if(a.bandwidthAllowed==D.ALLOW_ONE)a.bandwidthAllowed=D.ALLOW_KEEP}this.dl(a,b,f)}}else{this.dl(a,Rc,j);c=j}if(Sf(a)&&(bi(a)||d))a.bandwidthWaitToShow&&
D.isInLowBandwidthMode()||Rf(a);return c};
l.refresh=function(){A(this,"beforetilesload");if(this.dc){this.Jf=e;this.Oh=this.gf=0;if(this.kl&&!this.Ig)this.Ig=new cd(this.kl);this.oc(this.fJ);this.Po=j;this.TG();this.Jf=j}};
l.TG=function(){Ee(this.Ae)&&A(this,Na,this.Oh);Ee(this.fc)&&A(this,La,this.gf)};
function mk(a,b){this.topLeftTile=a;this.gridTopLeft=b}
mk.prototype.equals=function(a){if(!a)return j;return a.topLeftTile.equals(this.topLeftTile)&&a.gridTopLeft.equals(this.gridTopLeft)};
function kk(a,b,c){var d=new S(a.x+b.width,a.y+b.height);a=Kd(d.x/c-Ob);d=Kd(d.y/c-Ob);var f=a*c-b.width;b=d*c-b.height;return new mk(new S(a,d),new S(f,b))}
Vj.prototype.by=function(){this.oc(function(a){a.clear()});
this.Ka.length=0;if(this.Yb){this.Yb.clear();this.Yb=i}this.Id=i};
function lk(a,b,c){this.images=[];this.pane=Tj(c,a);this.tileLayer=b;this.sortedImages=[];this.index=c}
lk.prototype.clear=function(){var a=this.images;if(a){for(var b=r(a),c=0;c<b;++c)for(var d=a.pop(),f=r(d),g=0;g<f;++g)nk(d.pop());delete this.tileLayer;delete this.images;delete this.sortedImages;Cg(this.pane)}};
var nk=function(a){if(a.errorTile){Cg(a.errorTile);a.errorTile=i}Cg(a);if(a.imageAbove)a.imageAbove=i;if(a.imageBelow)a.imageBelow=i};
lk.prototype.Hv=function(a){for(var b=this.images,c=r(b)-1;c>=0;c--)for(var d=r(b[c])-1;d>=0;d--){b[c][d].imageBelow=a.images[c][d];a.images[c][d].imageAbove=b[c][d]}};
lk.prototype.Rr=function(a){t(this.images,function(b){t(b,function(c){a(c)})})};
lk.prototype.YI=function(){this.Rr(function(a){var b=a.imageBelow;a.imageBelow=i;if(b)b.imageAbove=i})};
l=Vj.prototype;l.TH=function(a,b,c){a=new lk(this.l,a,b);this.wt(a,e);c&&a.Hv(c);this.Ka.push(a)};
l.pi=function(a){this.yh=a;a=0;for(var b=r(this.Ka);a<b;++a)for(var c=this.Ka[a],d=0,f=r(c.images);d<f;++d)for(var g=c.images[d],h=0,k=r(g);h<k;++h)g[h][Rh]=this.yh};
l.GU=function(a,b,c){a==this.Id?this.nI(b,c):this.JV(b,c)};
l.wt=function(a,b){var c=this.o.getTileSize(),d=new R(c,c),f=a.tileLayer,g=a.images,h=a.pane,k=sf(this,this.GU,a),o=new Qh;o.alpha=f.isPng();o.hideWhileLoading=e;o.onLoadCallback=sf(this,this.up);o.onErrorCallback=k;var q=this.ze,s=Ob*2+1;k=ke(q.width/c+s);c=ke(q.height/c+s);for(b=!b&&r(g)>0&&this.dt;r(g)>k;){s=g.pop();for(q=0;q<r(s);++q)nk(s[q])}for(q=r(g);q<k;++q)g.push([]);for(q=0;q<r(g);++q){for(;r(g[q])>c;)nk(g[q].pop());for(k=r(g[q]);k<c;++k){s=Qc(Rc,h,Xg,d,o);if(rb)if(a==this.Yb){s.bandwidthAllowed=
D.ALLOW_ALL;s.isLowBandwidthTile=e}else s.bandwidthAllowed=D.DENY;b&&this.If(s,f,new S(q,k));var u=f.getOpacity();u<1&&hg(s,u);g[q].push(s)}}};
l.hU=function(a,b,c){var d=this.o.getTileSize();b=this.Sd(b);b.x=b.x/d-0.5;b.y=b.y/d-0.5;d=this.dc.topLeftTile;for(var f=0,g=r(a),h=0;h<g;++h)for(var k=r(a[h]),o=0;o<k;++o){var q=a[h][o];q.coordX=h;q.coordY=o;var s=d.x+h-b.x,u=d.y+o-b.y;q.sqdist=s*s+u*u;c[f++]=q}c.length=f;c.sort(function(H,G){return H.sqdist-G.sqdist})};
l.DS=function(a){var b=a.tileLayer,c=a.images;a=c.shift();c.push(a);c=r(c)-1;for(var d=0;d<r(a);++d)this.If(a[d],b,new S(c,d))};
l.CS=function(a){var b=a.tileLayer,c=a.images;if(a=c.pop()){c.unshift(a);for(c=0;c<r(a);++c)this.If(a[c],b,new S(0,c))}};
l.ES=function(a){var b=a.tileLayer;a=a.images;for(var c=0;c<r(a);++c){var d=a[c].pop();a[c].unshift(d);this.If(d,b,new S(c,0))}};
l.BS=function(a){var b=a.tileLayer;a=a.images;for(var c=r(a[0])-1,d=0;d<r(a);++d){var f=a[d].shift();a[d].push(f);this.If(f,b,new S(d,c))}};
l.mS=function(a){if("http://"+window.location.host==_mHost){var b=ng(og(a));b=Ei("x:%1$s,y:%2$s,zoom:%3$s",b.x,b.y,b.zoom);if(a.match("transparent.png"))b="transparent";ij("/maps/gen_204?ev=failed_tile&cad="+b)}};
l.nI=function(a,b){if(a.indexOf("tretry")==-1&&this.o.getUrlArg()=="m"&&!ef(a,Rc)){var c=!!this.Ae[a];delete this.fc[a];delete this.Ae[a];delete this.gk[a];this.mS(a);a+="&tretry=1";this.dl(b,a,c)}else{this.up(a,b);var d,f;a=this.Id.images;for(d=0;d<r(a);++d){c=a[d];for(f=0;f<r(c);++f)if(c[f]==b)break;if(f<r(c))break}if(d!=r(a)){this.oc(function(g){if(g=g.images[d]&&g.images[d][f]){Qf(g);g.baseTileHasError=e}});
!b.errorTile&&!b.isLowBandwidthTile&&this.yJ(b);this.f.tn()}}};
l.dl=function(a,b,c){a[Sh]&&a[Th]&&this.up(a[Sh],a);if(!ef(b,Rc)){this.fc[b]=1;if(c)this.Ae[b]=1;if(a.isLowBandwidthTile)this.gk[b]=1;a.fetchBegin=ed()}Zh(a,b,a.imageFetcherOpts)};
l.up=function(a,b){if(!(ef(a,Rc)||!this.fc[a])){if(b.fetchBegin){var c=ed()-b.fetchBegin;b.fetchBegin=i;b.isLowBandwidthTile||D.trackTileLoad(b,c);if(ok()){pk.push(c);qk.push("u");this.gf==0&&Eg(this.Ig,"first")}}if(b.bandwidthWaitToShow&&Sf(b)&&b.imageBelow&&b.bandwidthAllowed!=D.DENY)if(!Sf(b.imageBelow)||b.imageBelow.baseTileHasError)for(c=b;c;c=c.imageAbove){Rf(c);c.bandwidthWaitToShow=j}if(!Ee(this.Ae)){++this.Oh;delete this.Ae[a];Ee(this.Ae)&&!this.Jf&&A(this,Na,this.Oh)}++this.gf;delete this.fc[a];
if(!this.kt&&D.isInLowBandwidthMode()){if(b.isLowBandwidthTile){b=He(this.gk);delete this.gk[a];b==1&&He(this.gk)==0&&!this.Jf&&this.UG()}this.Yb&&this.eu()&&this.AC()}else Ee(this.fc)&&!this.Jf&&this.UG()}};
l.UG=function(){A(this,La,this.gf);if(this.Ig){this.Ig.tick("total_"+this.gf);this.Ig.done();this.Ig=i}};
l.eu=function(){return He(this.fc)+this.Ps<Pb};
l.QP=function(a){a?this.aG():this.IO()};
l.AC=function(){setTimeout(n(this.NO,this),0);this.Ps++};
l.NO=function(){this.Ps--;var a,b=Infinity,c;if(!this.eu())return j;this.Po&&this.gU();for(var d=r(this.Ka)-1;d>=0;--d)for(var f=this.Ka[d],g=f.sortedImages,h=0;h<r(g);++h){var k=g[h];if(k.bandwidthAllowed==D.DENY){if(h<b){b=h;a=k;c=f}break}}if(a){a.bandwidthAllowed=D.ALLOW_ONE;a.bandwidthWaitToShow=e;this.If(a,c.tileLayer,new S(a.coordX,a.coordY));this.eu()&&this.AC();return e}return j};
l.JV=function(a,b){this.up(a,b);Zh(b,Rc,b.imageFetcherOpts)};
l.yJ=function(a){var b=this.o.getTileSize();b=J("div",this.Ka[0].pane,Xg,new R(b,b));b.style.left=a.style.left;b.style.top=a.style.top;var c=J("div",b),d=c.style;d.fontFamily="Arial,sans-serif";d.fontSize="x-small";d.textAlign="center";d.padding=Ff(6);gg(c);Vd(c,this.o.getErrorMessage());a.errorTile=b};
l.dz=function(a,b,c){var d=this.ln(a);a=K(this.o.getTileSize()*d);d=a/this.o.getTileSize();d=this.Wz(this.dc.gridTopLeft,b,d);b=K(d.x+c.x);c=K(d.y+c.y);d=this.Id.images;for(var f=r(d),g=r(d[0]),h,k,o,q=Q(a),s=0;s<f;++s){k=d[s];o=Q(b+a*s);for(var u=0;u<g;++u){h=k[u].style;h.left=o;h.top=Q(c+a*u);h.width=h.height=q}}};
l.pn=function(){var a=this.Id;this.oc(function(b){b!=a&&Tf(b.pane)})};
l.QT=function(){for(var a=0,b=r(this.Ka);a<b;++a)Uf(this.Ka[a].pane)};
l.hide=function(){Qf(this.l);this.dt=j};
l.ri=function(a){fg(this.l,a)};
l.ln=function(a){var b=this.ze.width;if(b<1)return 1;b=Kd(Math.log(b)*Math.LOG2E-2);a=se(a-this.tc,-b,b);return Math.pow(2,a)};
l.Sz=function(a,b,c){return new S(1/c*(a.x-b.x)+b.x,1/c*(a.y-b.y)+b.y)};
l.Wz=function(a,b,c){return new S(c*(a.x-b.x)+b.x,c*(a.y-b.y)+b.y)};
l.tG=function(){this.oc(function(a){a=a.images;for(var b=0;b<r(a);++b)for(var c=0;c<r(a[b]);++c){var d=a[b][c];this.fc[d[Sh]]&&this.no++;ci(d)}});
this.fc=[];this.Ae=[];if(this.no){A(this,Na,this.Oh);A(this,La,this.gf)}};
l.loaded=function(){return Ee(this.fc)};
l.uG=function(){return this.no>r(this.Id.sortedImages)*0.66};function rk(){rk.g.apply(this,arguments)}
;rk.g=function(a,b){this.vR=a||j;this.PS=b||j};
l=rk.prototype;l.printable=function(){return this.vR};
l.selectable=function(){return this.PS};
l.initialize=function(){return i};
l.W=function(a,b){this.initialize(a,b)};
l.Jk=N;l.getDefaultPosition=N;l.Jb=N;l.xa=N;l.Xk=function(a){a=a.style;a.color="black";a.fontFamily="Arial,sans-serif";a.fontSize="small"};
l.allowSetVisibility=Oe;l.Jq=Ne;l.clear=function(){Rg(this)};
var tk=function(a,b,c){if(c)sk(b);else{function d(){Of(b,!a.it())}
d();v(a,Ca,d)}};
function uk(a){(a=Nf(a))&&Qf(a)}
;function vk(){this.LR=new RegExp("[^:]+?:([^'\"\\/;]*('{1}(\\\\\\\\|\\\\'|\\\\?[^'\\\\])*'{1}|\"{1}(\\\\\\\\|\\\\\"|\\\\?[^\"\\\\])*\"{1}|\\/{1}(\\\\\\\\|\\\\\\/|\\\\?[^\\/\\\\])*\\/{1})*)+;?","g")}
vk.prototype.match=function(a){return a.match(this.LR)};var wk="$this",xk="$context",yk="$top",zk=/;$/,Ak=/\s*;\s*/;function Bk(a,b){if(!this.ad)this.ad={};b?De(this.ad,b.ad):De(this.ad,Ck);this.ad[wk]=a;this.ad[xk]=this;this.k=Le(a,ca);if(!b)this.ad[yk]=this.k}
var Ck={};Ck.$default=i;var Dk=[],Ek=function(a,b){if(r(Dk)>0){var c=Dk.pop();Bk.call(c,a,b);return c}else return new Bk(a,b)},
Fk=function(a){for(var b in a.ad)delete a.ad[b];a.k=i;Dk.push(a)};
Bk.prototype.jsexec=function(a,b){try{return a.call(b,this.ad,this.k)}catch(c){return Ck.$default}};
Bk.prototype.clone=function(a,b,c){a=Ek(a,this);a.eb("$index",b);a.eb("$count",c);return a};
Bk.prototype.eb=function(a,b){this.ad[a]=b};
var Gk="a_",Hk="b_",Ik="with (a_) with (b_) return ",Jk={},Kk=new vk;function Lk(a){if(!Jk[a])try{Jk[a]=new Function(Gk,Hk,Ik+a)}catch(b){}return Jk[a]}
function Mk(a){return a}
function Nk(a){for(var b=[],c=Kk.match(a),d=-1,f=0,g=i,h=0,k=r(c);h<k;++h){g=c[h];f+=r(g);d=g.indexOf(ea);b.push(df(g.substring(0,d)));var o=g.match(zk)?r(g)-1:r(g);b.push(Lk(g.substring(d+1,o)))}f<r(a)&&0;return b}
function Ok(a){var b=[];a=a.split(Ak);for(var c=0,d=r(a);c<d;++c)if(a[c]){var f=Lk(a[c]);b.push(f)}return b}
;var Pk="jsinstance",Qk="jsts",Rk="div",Sk="id";function Tk(a,b,c,d){c=new Uk(b,c,d);Vk(b);c.JS(uf(c,c.lt,a,b));c.wG()}
function Uk(a,b,c){this.lW=a;this.Ge=b||N;this.lj=Af(a);this.su=1;this.SG=c||i}
Uk.prototype.CU=function(){this.su++};
Uk.prototype.wG=function(){this.su--;this.su==0&&this.Ge()};
var Wk=0,Xk={};Xk[0]={};var Yk={},Zk={},$k=[],Vk=function(a){a.__jstcache||Ig(a,function(b){al(b)})},
bl=[["jsselect",Lk],["jsdisplay",Lk],["jsvalues",Nk],["jsvars",Nk],["jseval",Ok],["transclude",Mk],["jscontent",Lk],["jsskip",Lk]],al=function(a){if(a.__jstcache)return a.__jstcache;var b=a.getAttribute("jstcache");if(b!=i)return a.__jstcache=Xk[b];b=$k.length=0;for(var c=r(bl);b<c;++b){var d=bl[b][0],f=a.getAttribute(d);Zk[d]=f;f!=i&&$k.push(d+"="+f)}if($k.length==0){a.setAttribute("jstcache","0");return a.__jstcache=Xk[0]}var g=$k.join("&");if(b=Yk[g]){a.setAttribute("jstcache",b);return a.__jstcache=
Xk[b]}var h={};b=0;for(c=r(bl);b<c;++b){f=bl[b];d=f[0];var k=f[1];f=Zk[d];if(f!=i)h[d]=k(f)}b=ca+ ++Wk;a.setAttribute("jstcache",b);Xk[b]=h;Yk[g]=b;return a.__jstcache=h},
cl={};l=Uk.prototype;l.JS=function(a){this.Lx=[];this.qE=[];this.hq=[];a();this.oE()};
l.oE=function(){for(var a=this.Lx,b=this.qE,c,d,f,g;a.length;){c=a[a.length-1];d=b[b.length-1];if(d>=c.length){this.JR(a.pop());b.pop()}else{f=c[d++];g=c[d++];c=c[d++];b[b.length-1]=d;f.call(this,g,c)}}};
l.Kk=function(a){this.Lx.push(a);this.qE.push(0)};
l.dj=function(){return this.hq.length?this.hq.pop():[]};
l.JR=function(a){ff(a);this.hq.push(a)};
l.RG=function(a,b,c){if(a){c.parentNode.replaceChild(a,c);c=this.dj();c.push(this.lt,b,a);this.Kk(c)}else Mg(c)};
l.lt=function(a,b){var c=this.oC(b),d=c.transclude;if(d){c=dl(d);!c&&this.SG?this.SG(b,n(function(){d=b.getAttribute("transclude");this.RG(dl(d),a,b);this.oE()},
this)):this.RG(c,a,b)}else(c=c.jsselect)?this.yO(a,b,c):this.Xj(a,b)};
l.Xj=function(a,b){var c=this.oC(b),d=c.jsdisplay;if(d){if(!a.jsexec(d,b)){Qf(b);return}Rf(b)}(d=c.jsvars)&&this.AO(a,b,d);(d=c.jsvalues)&&this.zO(a,b,d);if(d=c.jseval)for(var f=0,g=r(d);f<g;++f)a.jsexec(d[f],b);if(d=c.jsskip)if(a.jsexec(d,b))return;if(c=c.jscontent)this.xO(a,b,c);else{c=this.dj();for(b=b.firstChild;b;b=b.nextSibling)b.nodeType==1&&c.push(this.lt,a,b);c.length&&this.Kk(c)}};
l.yO=function(a,b,c){c=a.jsexec(c,b);var d=b.getAttribute(Pk),f=j;if(d)if(d.charAt(0)==da){d=hf(d.substr(1));f=e}else d=hf(d);var g=nf(c),h=g?r(c):1,k=g&&h==0;if(g)if(k)if(d)Mg(b);else{b.setAttribute(Pk,"*0");Qf(b)}else{Rf(b);if(d===i||d===ca||f&&d<h-1){f=this.dj();for(d=d||0,g=h-1;d<g;++d){var o=b.cloneNode(e);b.parentNode.insertBefore(o,b);el(o,c,d);k=a.clone(c[d],d,h);f.push(this.Xj,k,o,Fk,k,i)}el(b,c,d);k=a.clone(c[d],d,h);f.push(this.Xj,k,b,Fk,k,i);this.Kk(f)}else if(d<h){f=c[d];el(b,c,d);k=
a.clone(f,d,h);f=this.dj();f.push(this.Xj,k,b,Fk,k,i);this.Kk(f)}else Mg(b)}else if(c==i)Qf(b);else{Rf(b);k=a.clone(c,0,1);f=this.dj();f.push(this.Xj,k,b,Fk,k,i);this.Kk(f)}};
l.AO=function(a,b,c){for(var d=0,f=r(c);d<f;d+=2){var g=c[d],h=a.jsexec(c[d+1],b);a.eb(g,h)}};
l.zO=function(a,b,c){for(var d=0,f=r(c);d<f;d+=2){var g=c[d],h=a.jsexec(c[d+1],b),k=cl[b.tagName]&&cl[b.tagName][g];if(k){this.CU();k(b,g,h,n(this.wG,this))}else if(g.charAt(0)=="$")a.eb(g,h);else if(g.charAt(0)==ga)li(b,g,h);else if(g)if(typeof h=="boolean")h?Kg(b,g,g):Lg(b,g);else b.setAttribute(g,ca+h)}b.__jsvalues_parsed=e};
l.xO=function(a,b,c){a=ca+a.jsexec(c,b);if(b.innerHTML!=a){for(;b.firstChild;)Mg(b.firstChild);a=this.lj.createTextNode(a);b.appendChild(a)}};
l.oC=function(a){if(a.__jstcache)return a.__jstcache;var b=a.getAttribute("jstcache");if(b)return a.__jstcache=Xk[b];return al(a)};
function dl(a,b){var c=document;if(a=b?fl(c,a,b):c.getElementById(a)){Vk(a);a=a.cloneNode(e);a.removeAttribute(Sk);return a}else return i}
function fl(a,b,c,d){var f=a.getElementById(b);if(f)return f;c=c();d=d||Qk;if(f=a.getElementById(d))f=f;else{f=a.createElement(Rk);f.id=d;Qf(f);Gf(f);a.body.appendChild(f)}d=a.createElement(Rk);f.appendChild(d);d.innerHTML=c;return f=a.getElementById(b)}
function el(a,b,c){c==r(b)-1?Kg(a,Pk,da+c):Kg(a,Pk,ca+c)}
;function ek(){ek.g.apply(this,arguments)}
function gl(){gl.g.apply(this,arguments)}
;ek.g=function(){this.Wp={};this.SB=[];this.M=[];this.Rf={}};
ek.prototype.DK=function(a){var b=this;return function(c){a:{for(var d=Qg(c);d&&d!=this;d=d.parentNode){var f;f=d;var g=f.__jsaction;if(!g){g=f.__jsaction={};var h=hl(f,"jsaction");if(h){h=h.split(Ak);for(var k=0,o=r(h);k<o;k++){var q=h[k];if(q){var s=q.indexOf(ea);if(s<0)g[m]=il(q,f,this);else{var u=df(q.substr(0,s));g[u]=il(df(q.substr(s+1)),f,this)}}}}}if(f=g[a]){g=d;if(!g.__jsvalues_parsed){if(h=hl(g,"jsvalues")){h=h.split(Ak);k=0;for(o=r(h);k<o;k++){s=h[k];u=s.indexOf(ea);if(!(u<0)){q=df(s.substr(0,
u));if(q.charAt(0)==ga){s=df(s.substr(u+1));li(g,q,pg(s))}}}}g.__jsvalues_parsed=e}c=new jl(f,d,c,undefined);break a}}c=i}if(c)if(b.lB(c))c.done();else b.Gz||c.done()}};
ek.prototype.lB=function(a,b){var c=this.Wp[a.bV];if(c){b&&a.tick("re");c(a);return e}return j};
ek.prototype.KE=function(){this.Gz&&qg(this,function(){this.Gz.iI(n(this.iS,this))},
0)};
ek.prototype.iS=function(a){for(var b=a.node(),c=0;c<r(this.M);c++)if(this.M[c].containsNode(b))return this.lB(a,e);return j};
function hl(a,b){var c=i;if(a.getAttribute)c=a.getAttribute(b);return c}
function il(a,b,c){if(a.indexOf(ga)>=0)return a;for(b=b;b;b=b.parentNode){var d;d=b;var f=d.__jsnamespace;ue(f)||(f=d.__jsnamespace=hl(d,"jsnamespace"));if(d=f)return d+ga+a;if(b==c)break}return a}
function kl(a,b){return function(c){return sh(c,a,b)}}
l=ek.prototype;l.Yg=function(a){if(!Ie(this.Rf,a)){var b=this.DK(a),c=kl(a,b);this.Rf[a]=b;this.SB.push(c);t(this.M,function(d){d.RB(c)})}};
l.Jd=function(a,b,c){tc(c,n(function(d,f){f=b?n(f,b):f;if(a)this.Wp[a+"."+d]=f;else this.Wp[d]=f},
this));this.KE()};
l.Bf=function(a){if(this.qN(a))return i;var b=new gl(a);t(this.SB,function(c){b.RB(c)});
this.M.push(b);this.KE();return b};
l.qN=function(a){for(var b=0;b<this.M.length;b++)if(this.M[b].containsNode(a))return e;return j};
l.Nu=function(a){a.SI();xe(this.M,a)};
gl.g=function(a){this.l=a;this.pB=[]};
gl.prototype.containsNode=function(a){var b=this.l;for(a=a;b!=a&&a.parentNode;)a=a.parentNode;return b==a};
gl.prototype.RB=function(a){this.pB.push(a.call(i,this.l))};
gl.prototype.SI=function(){t(this.pB,w)};function ll(){}
ll.prototype.iI=function(){};var Yc={};function ml(a){Yc[a]||(Yc[a]=[]);for(var b=1,c=arguments.length;b<c;b++)Yc[a].push(arguments[b])}
ml("act_mm","act");ml("act_s","act");ml("act_d","act");ml("qopa","act","qop","act_s");ml("dropapin","act_dap");ml("act_dap","act","sha1");ml("mymaps","act_mm");ml("ms","info");ml("rv","act");ml("mplh","sha1","gdgt");ml("dir","qdt","act_d");ml("trtlr","qdt");ml("mspe","poly");ml("ftr","act");ml("labs","ftr","sdb");ml("act_br","act","browse");ml("re","act","qopa","act_s");ml("ab","ac");ml("sesame","ac");ml("sg","ac");function Xc(a,b){var c=a.replace("/main.js","");return function(d){if(a)return[c+"/mod_"+d+".js"];else if(b)for(var f=0;f<b.length;++f)if(b[f].name==d)return b[f].urls;return i}}
;function nl(){nl.g.apply(this,arguments)}
Kh(nl,"dspmr",1,{rH:e,dS:e,Yp:j,BE:j},{g:e});var sk=function(a){x(nl).rH(a)};function Fj(){this.Ni={};this.UO={};var a={};a.locale=e;this.Kd=new wg(_mHost+"/maps/tldata",document,a);this.Rd={};this.xg={}}
Fj.prototype.Zp=function(a,b){var c=this.Ni,d=this.UO;d[a]||(d[a]={});var f=j;b=b.bounds;for(var g=0;g<r(b);++g){var h=b[g],k=h.ix;if(k==-1||k==-2){this.jV(a,h);f=e}else if(!d[a][k]){d[a][k]=e;c[a]||(c[a]=[]);c[a].push(ol(h,e));f=e}}f&&A(this,"appfeaturesdata",a)};
Fj.prototype.H=function(a){if(this.Ni[a])return this.Ni[a];return i};
Fj.prototype.sN=function(a){return this.Rd[a]||this.xg[a]};
var od=function(a){var b=x(Fj);tc(a,function(c,d){b.Zp(c,d)})},
ol=function(a,b){var c=[a.s*1.0E-6,a.w*1.0E-6,a.n*1.0E-6,a.e*1.0E-6];if(b)c.push(a.minz||1);return c};
Fj.prototype.jV=function(a,b){if(this.Rd[a])this.Rd[a].Tw(ol(b,j),b.ix==-2);else{this.xg[a]||(this.xg[a]=[]);this.xg[a].push(b)}};
Fj.prototype.Lm=function(a,b,c,d,f){if(this.Rd[a])c(this.Rd[a].pE(b));else if(this.xg[a])vd("qdt",1,n(function(k){this.Rd[a]||(this.Rd[a]=a=="ob"?new k(i,i,18):new k);t(this.xg[a],n(function(o){this.Rd[a].Tw(ol(o,j),o.ix==-2)},
this));delete this.xg[a];c(this.Rd[a].pE(b))},
this),d);else if(this.Ni[a]){d=this.Ni[a];for(var g=0;g<r(d);g++)if(r(d[g])==5)if(!(f&&f<d[g][4])){var h=new id(new z(d[g][0],d[g][1]),new z(d[g][2],d[g][3]));if(b.intersects(h)){c(e);return}}c(j)}};Ck.bidiDir=Yi;Ck.bidiAlign=Zi;Ck.bidiAlignEnd=$i;Ck.bidiMark=cj;Ck.bidiSpan=dj;Ck.bidiEmbed=ej;Ck.isRtl=Wi;function pl(a,b,c,d){if(ef(a.src,Rc))a.src="";Zh(a,ca+c,{onLoadCallback:d,onErrorCallback:d})}
cl.IMG||(cl.IMG={});cl.IMG.src=pl;var ql=ga+"src";cl.IMG||(cl.IMG={});cl.IMG[ql]=pl;function rl(a,b,c,d){wd("exdom",Ua)(a,b,c,d)}
;var D={};D.wH="delay";D.xH="forced";D.yH="ip";D.zH="nodelay";D.Rw="tiles";D.uH="lbm";D.vH="lbr";D.ALLOW_ALL=3;D.ALLOW_ONE=2;D.ALLOW_KEEP=1;D.DENY=0;D.Us=j;D.Ty=j;D.xp=[];D.mw=0;D.setupBandwidthHandler=function(a,b,c){if(!rb)return-1;if(Kb)if(Lb){D.setLowBandwidthMode(e,D.yH);return 0}var d=0;if(!c||Kb){c=ed();d=B(0,a-c+sb*1000)}if(d<=0)D.setLowBandwidthMode(e,D.zH);else{var f=setTimeout(function(){D.setLowBandwidthMode(e,D.wH)},
d);fd(b,La,function(){clearTimeout(f)})}return d};
D.YK=function(a){D.Ty=e;D.setLowBandwidthMode(a,D.xH)};
D.setLowBandwidthMode=function(a,b){if(rb)if(D.Us!=a){D.Us=a;A(D,ia,a);var c={};c[D.uH]=a+0;if(b)c[D.vH]=b;sl(i,c)}};
D.isInLowBandwidthMode=function(){return D.Us};
D.initializeLowBandwidthMapLayers=function(){if(rb){D.mapTileLayer=new tl(tb,17);D.satTileLayer=new tl(ub,19);D.hybTileLayer=new tl(vb,17);D.terTileLayer=new tl(wb,15)}};
D.trackTileLoad=function(a,b){if(!(!rb||D.Ty||!bi(a)||a.preCached)){D.xp.unshift(b);D.mw+=b;if(!(D.xp.length<Bb)){a=D.mw/D.xp.length;if(a>zb)D.setLowBandwidthMode(e,D.Rw);else a<Ab&&D.setLowBandwidthMode(j,D.Rw);D.mw-=D.xp.pop()}}};
function tl(a,b){a=a.split(",");Id.call(this,a,i,b,_mSatelliteToken,_mDomain)}
p(tl,Id);function ul(a){var b=[],c=a.split(":",1)[0],d=hf(c);if(d){a=a.substring(c.length+1);for(c=0;c<d;++c)b.push(Ei(a,c))}return b}
function vl(a){if(_mGL=="in")for(var b=0;b<a.length;++b){var c=/[&?]$/.test(a[b])?"":/[?]/.test(a[b])?"&":"?";a[b]=[a[b],c,"gl=",_mGL,"&"].join("")}}
function wl(a,b){md.call(this);this.lm=a||"#000";this.QC=b}
p(wl,md);wl.prototype.vK=function(a,b){var c=new Ki;c.set("ll",a.T().Aa());c.set("spn",a.sb().Aa());c.set("z",b);this.QC&&c.set("t",this.QC);return'<a target="_blank" style="color:'+this.lm+'" href="'+c.Xe(e,"http://google.com/mapmaker")+'">'+F(12915)+"</a>"};
wl.prototype.$r=function(a,b){a=_mMapCopy+" "+F(12916)+" - "+this.vK(a,b);return new tg("",[a])};
function Cd(a,b,c,d){var f=[];if(Ib){f.push(["MAPMAKER_NORMAL_MAP",a]);f.push(["MAPMAKER_HYBRID_MAP",c]);f.push(["MAPMAKER_MAP_TYPES",[a,b,c]]);return f}var g=new wl(a.getLinkColor(),"m"),h=ul(_mCityblockUseSsl?Zb:Fb);vl(h);a={shortName:F(10111),errorMessage:F(10120),alt:F(10511),urlArg:"gm"};g=new Ed(h,g,17);a=new Hd([g],d,F(10049),a);f.push(["MAPMAKER_NORMAL_MAP",a]);h=ul(_mCityblockUseSsl?$b:Gb);vl(h);g=b.getTileLayers()[0];var k=new wl(c.getLinkColor(),"h");c={shortName:F(10117),urlArg:"gh",textColor:"white",
linkColor:"white",errorMessage:F(10121),alt:F(10513)};h=new Ed(h,k,17,e);d=new Hd([g,h],d,F(10116),c);f.push(["MAPMAKER_HYBRID_MAP",d]);f.push(["MAPMAKER_MAP_TYPES",[a,b,d]]);return f}
;function xl(a){De(this,a,e)}
function jl(){jl.g.apply(this,arguments)}
p(jl,cd);jl.g=function(a,b,c,d){cd.call(this,a,d);this.bV=a;this.uD=b;this.Me=new xl(c);c.type==m&&this.action(b)};
jl.prototype.Pr=function(){cd.prototype.Pr.call(this);this.Me=this.uD=i};
jl.prototype.node=function(){return this.uD};
jl.prototype.event=function(){return this.Me};
jl.prototype.value=function(a){var b=this.node();return b?b[a]:undefined};function ok(){return typeof _stats!="undefined"}
function yl(a,b,c){ok()&&vd("stats",$a,function(d){d(a,b,c)});
wj(a,b,c)}
v(cd,"report",yl);function sl(a,b){Cb&&vd("stats",ab,function(c){c(a,b)})}
v(cd,"reportaction",sl);function zl(a,b,c,d){vd("stats",eb,function(f){f(a,b,c,d)})}
v(cd,"dapperreport",zl);function Zc(a){ok()&&vd("stats",cb,function(b){b(a)})}
function $c(a){ok()&&vd("stats",db,function(b){b(a)})}
;var pk=[],qk=[];function hd(a,b){a.Xg("mt",b.o.getUrlArg()+(D.isInLowBandwidthMode()?"l":"h"))}
;function Al(){}
p(Al,oi);function Bl(){}
;function Cl(){Cl.g.apply(this,arguments)}
var Dl,El;p(Cl,Al);var Fl=Ne,Gl=j;l=Cl.prototype;l.Wa=Bl;l.sh=Pe;l.Tj=Ne;l.Zh=Pe;l.redraw=function(){};
l.remove=function(){this.Qa=e};
l.Nz=Pe;l.Qq=N;zj(Cl,"poly",2);
Cl.g=function(a,b,c,d,f){this.color=b||Hl;this.weight=Le(c,Il);this.opacity=Le(d,Jl);this.N=e;this.ea=i;this.mc=j;b=f||{};this.Yn=!!b.mapsdt;this.Pm=!!b.geodesic;this.mD=b.mouseOutTolerance||i;this.jc=e;if(f&&f.clickable!=i)this.jc=f.clickable;this.ia=i;this.hd={};this.Db={};this.Va=j;this.S=i;this.Oa=a&&r(a)||this.Va?4:0;this.ce=i;if(this.Va){this.ah=3;this.Ce=16}else{this.ah=1;this.Ce=32}this.Jw=0;this.j=[];this.jb=[];this.U=[];if(a){f=[];for(b=0;b<r(a);b++)if(c=a[b])c.lat&&c.lng?f.push(c):f.push(new z(c.y,
c.x));this.j=f;this.Qq()}this.f=i;this.Qa=e;this.Vj={}};
l=Cl.prototype;l.Ea=function(){return"Polyline"};
l.initialize=function(a){this.f=a;this.Qa=j};
l.copy=function(){var a=new Cl(i,this.color,this.weight,this.opacity);a.j=Me(this.j);a.Ce=this.Ce;a.S=this.S;a.Oa=this.Oa;a.ce=this.ce;a.ia=this.ia;return a};
l.Vb=function(a){return new z(this.j[a].lat(),this.j[a].lng())};
l.GM=function(){return{color:this.color,weight:this.weight,opacity:this.opacity}};
l.Ud=function(){return r(this.j)};
l.show=function(){this.Wa(e)};
l.hide=function(){this.Wa(j)};
l.I=function(){return!this.N};
l.ya=function(){return!this.Yn};
l.sL=function(){var a=this.Ud();if(a==0)return i;var b=this.Vb(Kd((a-1)/2));a=this.Vb(ke((a-1)/2));b=this.f.J(b);a=this.f.J(a);return this.f.X(new S((b.x+a.x)/2,(b.y+a.y)/2))};
l.aM=function(a){var b=this.j,c=0;a=a||6378137;for(var d=0,f=r(b);d<f-1;++d)c+=b[d].Pb(b[d+1],a);return c};
l.zv=function(a){this.ia=a};
l.hE=function(){x(Vh).Cf(n(function(){this.H();this.Se()},
this))};
l.J=function(a){return this.f.J(a)};
l.X=function(a){return this.f.X(a)};
function Kl(a,b){b=new Cl(i,a.color,a.weight,a.opacity,b);b.LO(a);return b}
l=Cl.prototype;
l.LO=function(a){this.ia=a;Ge(this,a,["name","description","snippet"]);this.Ce=a.zoomFactor;if(this.Ce==16)this.ah=3;var b=r(a.levels||[]);if(b){for(var c=a.points,d=r(c),f=new Array(b),g=0,h=0,k=0,o=0;g<d;++o){var q=1,s=0,u;do{u=c.charCodeAt(g++)-63-1;q+=u<<s;s+=5}while(u>=31);h+=q&1?~(q>>1):q>>1;q=1;s=0;do{u=c.charCodeAt(g++)-63-1;q+=u<<s;s+=5}while(u>=31);k+=q&1?~(q>>1):q>>1;f[o]=new z(h*1.0E-5,k*1.0E-5,e)}this.j=f;c=a.levels;d=new Array(b);for(f=0;f<b;++f)d[f]=c.charCodeAt(f)-63;b=this.S=d;this.Oa=
a.numLevels;this.ce=Ll(b,this.Oa)}else{this.j=[];this.S=[];this.Oa=0;this.ce=[]}this.K=i};
l.H=function(a,b){if(this.K&&!a&&!b)return this.K;var c=r(this.j);if(c==0)return this.K=i;var d=a?a:0;c=b?b:c;var f=new id(this.j[d]);if(this.Pm)for(d=d+1;d<c;++d){var g=Ml([this.j[d-1],this.j[d]]);f.extend(g.nb());f.extend(g.mb())}else for(d=d+1;d<c;d++)f.extend(this.j[d]);if(!a&&!b)this.K=f;return f};
l.cn=function(){return this.Oa};
l.kw=function(){var a=[];t(this.j,function(b){a.push(b.MG())});
return a.join(" ")};
l.getKml=function(a){vd("kmlu",2,n(function(b){a(b(this))},
this))};var Nl=2,Ol="#0055ff";function Pl(){Pl.g.apply(this,arguments)}
p(Pl,Al);l=Pl.prototype;l.Wa=Bl;l.sh=Pe;l.aE=Pe;l.redraw=Bl;l.remove=function(){this.Qa=e;t(this.xj,w);this.xj.length=0};
zj(Pl,"poly",3);Pl.g=function(a,b,c,d,f,g,h){h=h||{};this.D=[];var k=h.mouseOutTolerance;this.mD=k;if(a){this.D=[new Cl(a,b,c,d,{mouseOutTolerance:k})];this.D[0].Wo&&this.D[0].Wo(e);c=this.D[0].weight}this.fill=f||!ue(f);this.color=f||Ol;this.opacity=Le(g,0.25);this.outline=!!(a&&c&&c>0);this.N=e;this.ea=i;this.mc=j;this.Yn=!!h.mapsdt;this.jc=e;if(h.clickable!=i)this.jc=h.clickable;this.ia=i;this.hd={};this.Db={};this.sf=[];this.Qa=e;this.xj=[]};
l=Pl.prototype;l.Ea=function(){return"Polygon"};
l.initialize=function(a){this.f=a;this.Qa=j;for(var b=0;b<r(this.D);++b){this.D[b].initialize(a);this.xj.push(U(this.D[b],"lineupdated",this,this.qV))}};
l.qV=function(){this.hd={};this.Db={};this.K=i;this.sf=[];A(this,"lineupdated")};
l.copy=function(){var a=new Pl(i,i,i,i,i,i);a.ia=this.ia;Ge(a,this,["fill","color","opacity","outline","name","description","snippet"]);for(var b=0;b<r(this.D);++b)a.D.push(this.D[b].copy());return a};
l.H=function(){if(!this.K){for(var a=i,b=0;b<r(this.D);b++){var c=this.D[b].H();if(c)if(a){a.extend(c.gs());a.extend(c.XA())}else a=c}this.K=a}return this.K};
l.Vb=function(a){if(r(this.D)>0)return this.D[0].Vb(a);return i};
l.Ud=function(){if(r(this.D)>0)return this.D[0].Ud()};
l.show=function(){this.Wa(e)};
l.hide=function(){this.Wa(j)};
l.I=function(){return!this.N};
l.ya=function(){return!this.Yn};
l.lL=function(a){for(var b=0,c=this.D[0].j,d=c[0],f=1,g=r(c);f<g-1;++f)b+=qj(d,c[f],c[f+1])*rj(d,c[f],c[f+1]);a=a||6378137;return Math.abs(b)*a*a};
l.zv=function(a){this.ia=a};
l.hE=function(){x(Vh).Cf(n(function(){this.H();this.Se()},
this))};
function Ql(a,b){var c=new Pl(i,i,i,i,a.fill?a.color||Ol:i,a.opacity,b);c.ia=a;Ge(c,a,["name","description","snippet","outline"]);for(var d=Le(a.outline,e),f=0;f<r(a.polylines||[]);++f){a.polylines[f].weight=a.polylines[f].weight||Nl;if(!d)a.polylines[f].weight=0;c.D[f]=Kl(a.polylines[f],b);c.D[f].Wo(e)}return c}
Pl.prototype.cn=function(){for(var a=0,b=0;b<r(this.D);++b)if(this.D[b].cn()>a)a=this.D[b].cn();return a};
Pl.prototype.getKml=function(a){vd("kmlu",3,n(function(b){a(b(this))},
this))};function Ml(a){var b;b=[];var c=[];oj(a[0],b);oj(a[1],c);var d=[];Rl(b,c,d);b=[];Rl(d,[0,0,1],b);c=new Sl;Rl(d,b,c.r3);if(c.r3[0]*c.r3[0]+c.r3[1]*c.r3[1]+c.r3[2]*c.r3[2]>1.0E-12)pj(c.r3,c.latlng);else c.latlng=new z(a[0].lat(),a[0].lng());b=c.latlng;c=new id;c.extend(a[0]);c.extend(a[1]);d=c.Ia;c=c.Ja;var f=Qe(b.lng());b=Qe(b.lat());c.contains(f)&&d.extend(b);if(c.contains(f+ee)||c.contains(f-ee))d.extend(-b);return new nj(new z(Re(d.lo),a[0].lng(),e),new z(Re(d.hi),a[1].lng(),e))}
function Sl(a,b){this.latlng=a?a:new z(0,0);this.r3=b?b:[0,0,0]}
Sl.prototype.toString=function(){var a=this.r3;return this.latlng+", ["+a[0]+", "+a[1]+", "+a[2]+"]"};var Hl="#0000ff",Il=5,Jl=0.45,Ll=function(a,b){for(var c=r(a),d=new Array(c),f=new Array(b),g=0;g<b;++g)f[g]=c;for(g=c-1;g>=0;--g){for(var h=a[g],k=c,o=h+1;o<b;++o)if(k>f[o])k=f[o];d[g]=k;f[h]=g}return d};Fl=function(){return Dl};
Cl.prototype.lb=function(a){for(var b=0,c=1;c<r(this.j);++c)b+=this.j[c].Pb(this.j[c-1]);if(a)b+=a.Pb(this.j[r(this.j)-1]);return b*3.2808399};
Cl.prototype.Xo=function(a,b){this.Qk=!!b;if(this.kb!=a){Gl=this.kb=a;if(this.f){this.f.Fj("Polyline").rv(!this.kb);A(this.f,"capture",this,m,a)}}};
function Tl(a){return function(){var b=arguments;vd("mspe",a,n(function(c){c.apply(this,b)},
this))}}
l=Cl.prototype;l.zm=function(){var a=arguments;vd("mspe",1,n(function(b){b.apply(this,a)},
this))};
l.Ar=Tl(3);l.cq=Tl(4);l.Tj=function(){return this.kb};
l.Br=function(){var a=arguments;vd("mspe",5,n(function(b){b.apply(this,a)},
this))};
l.bf=function(){if(!this.ok)return j;return this.Ud()>=this.ok};
l.Wo=function(a){this.Hb=a};
l.er=Tl(6);l.Lv=Tl(7);l=Pl.prototype;l.Ar=Tl(8);l.Lv=Tl(9);l.$S=Tl(18);l.er=Tl(10);l.Tj=function(){return this.D[0].kb};
l.cq=Tl(11);l.Br=Tl(12);l.zm=Tl(13);Cl.prototype.aq=Tl(20);v(Pc,Ba,function(a){a.AE(["Polyline","Polygon"],new Ul)});
function Ul(){Ul.g.apply(this,arguments)}
p(Ul,qi);Ul.g=Jh(N);Ul.prototype.initialize=Jh(N);Ul.prototype.ba=N;Ul.prototype.ka=N;Ul.prototype.rv=N;Ih(Ul,"poly",4);function ak(){ak.g.apply(this,arguments)}
p(ak,oi);function Vl(){Vl.g.apply(this,arguments)}
;function Wl(){Wl.g.apply(this,arguments)}
;function Yj(){Yj.g.apply(this,arguments)}
;ak.g=function(a,b){this.Cc=a;this.N=e;if(b){if(ve(b.zPriority))this.zPriority=b.zPriority;if(b.statsFlowType)this.kl=b.statsFlowType}};
l=ak.prototype;l.constructor=ak;l.yh=e;l.zPriority=10;l.kl="";l.initialize=function(a){this.La=new Vj(a.Ya(1),a.O(),a,e,this.kl);this.La.pi(this.yh);a=a.o;var b={};b.tileSize=a.getTileSize();this.La.Bb(new Hd([this.Cc],a.getProjection(),"",b));yh(this.La,La,this)};
l.remove=function(){ph(this.La,La);this.La.remove();this.La=i};
l.pi=function(a){this.yh=a;this.La&&this.La.pi(a)};
l.copy=function(){var a=new ak(this.Cc);a.pi(this.yh);return a};
l.redraw=N;l.hide=function(){this.N=j;this.La.hide()};
l.show=function(){this.N=e;this.La.show()};
l.I=function(){return!this.N};
l.ya=Oe;l.KM=function(){return this.Cc};
l.refresh=function(){this.La&&this.La.refresh()};
l.getKml=function(a){var b=this.Cc.DO;b?vd("kmlu",7,function(c){a(c(b))}):a(i)};var Xl=0,Yl=1,Zl=0,$l="iconAnchor",am="iconSize",bm="image",cm="imageMap",dm="infoWindowAnchor",em="transparent",fm,gm,hm,im;function jm(a,b,c,d){De(this,a||{});if(b)this.image=b;if(c)this.label=c;if(d)this.shadow=d}
function km(a){var b=a.infoWindowAnchor;a=a.iconAnchor;return new R(b.x-a.x,b.y-a.y)}
function lm(a,b,c){var d=0;if(b==i)b=Yl;switch(b){case Xl:d=a;break;case Zl:d=c-1-a;break;case Yl:default:d=(c-1)*a}return d}
function mm(a,b){if(a.image){var c=r(a.image);c=a.image.substring(0,c-4);a.printImage=c+"ie.gif";a.mozPrintImage=c+"ff.gif";if(b){a.shadow=b.shadow;a.iconSize=new R(b.width,b.height);a.shadowSize=new R(b.shadow_width,b.shadow_height);var d,f;d=b.hotspot_x;f=b.hotspot_y;var g=b.hotspot_x_units,h=b.hotspot_y_units;d=d!=i?lm(d,g,a.iconSize.width):(a.iconSize.width-1)/2;f=f!=i?lm(f,h,a.iconSize.height):a.iconSize.height;a.iconAnchor=new S(d,f);a.infoWindowAnchor=new S(d,2);if(b.mask)a.transparent=c+"t.png";
a.imageMap=[0,0,0,b.width,b.height,b.width,b.height,0]}}}
fm=new jm;fm[bm]=L("marker");fm.shadow=L("shadow50");fm[am]=new R(20,34);fm.shadowSize=new R(37,34);fm[$l]=new S(9,34);fm.maxHeight=13;fm.dragCrossImage=L("drag_cross_67_16");fm.dragCrossSize=new R(16,16);fm.dragCrossAnchor=new S(7,9);fm[dm]=new S(9,2);fm[em]=L("markerTransparent");fm[cm]=[9,0,6,1,4,2,2,4,0,8,0,12,1,14,2,16,5,19,7,23,8,26,9,30,9,34,11,34,11,30,12,26,13,24,14,21,16,18,18,16,20,12,20,8,18,4,16,2,15,1,13,0];fm.printImage=L("markerie",e);fm.mozPrintImage=L("markerff",e);
fm.printShadow=L("dithshadow",e);var nm=new jm;nm[bm]=L("circle");nm[em]=L("circleTransparent");nm[cm]=[10,10,10];nm.imageMapType="circle";nm.shadow=L("circle-shadow45");nm[am]=new R(20,34);nm.shadowSize=new R(37,34);nm[$l]=new S(9,34);nm.maxHeight=13;nm.dragCrossImage=L("drag_cross_67_16");nm.dragCrossSize=new R(16,16);nm.dragCrossAnchor=new S(7,9);nm[dm]=new S(9,2);nm.printImage=L("circleie",e);nm.mozPrintImage=L("circleff",e);gm=new jm(fm,L("dd-start"));gm.printImage=L("dd-startie",e);
gm.mozPrintImage=L("dd-startff",e);hm=new jm(fm,L("dd-pause"));hm.printImage=L("dd-pauseie",e);hm.mozPrintImage=L("dd-pauseff",e);im=new jm(fm,L("dd-end"));im.printImage=L("dd-endie",e);im.mozPrintImage=L("dd-endff",e);function om(a){a=se(K(a),0,255);return Kd(a/16).toString(16)+(a%16).toString(16)}
;function pm(a){var b=[1518500249,1859775393,2400959708,3395469782];a+=String.fromCharCode(128);var c=r(a),d=ke(c/4)+2;d=ke(d/16);for(var f=new Array(d),g=0;g<d;g++){f[g]=new Array(16);for(var h=0;h<16;h++)f[g][h]=a.charCodeAt(g*64+h*4)<<24|a.charCodeAt(g*64+h*4+1)<<16|a.charCodeAt(g*64+h*4+2)<<8|a.charCodeAt(g*64+h*4+3)}f[d-1][14]=(c-1>>>30)*8;f[d-1][15]=(c-1)*8&4294967295;a=1732584193;c=4023233417;h=2562383102;var k=271733878,o=3285377520,q=new Array(80),s,u,H,G,I;for(g=0;g<d;g++){for(var M=0;M<
16;M++)q[M]=f[g][M];for(M=16;M<80;M++)q[M]=(q[M-3]^q[M-8]^q[M-14]^q[M-16])<<1|(q[M-3]^q[M-8]^q[M-14]^q[M-16])>>>31;s=a;u=c;H=h;G=k;I=o;for(M=0;M<80;M++){var Y=Kd(M/20);Y=(s<<5|s>>>27)+qm(Y,u,H,G)+I+b[Y]+q[M]&4294967295;I=G;G=H;H=u<<30|u>>>2;u=s;s=Y}a=a+s&4294967295;c=c+u&4294967295;h=h+H&4294967295;k=k+G&4294967295;o=o+I&4294967295}return rm(a)+rm(c)+rm(h)+rm(k)+rm(o)}
function qm(a,b,c,d){switch(a){case 0:return b&c^~b&d;case 1:return b^c^d;case 2:return b&c^b&d^c&d;case 3:return b^c^d}}
function rm(a){for(var b="",c=7;c>=0;c--)b+=(a>>>c*4&15).toString(16);return b}
;function sm(a){this.Ha=new wg(_mHost+"/maps/gen_204",window.document);this.Da=a}
sm.prototype.log=function(a){if(Fc!=0){var b;b="";var c,d,f,g,h,k,o=0;do{c=a.charCodeAt(o++);d=a.charCodeAt(o++);f=a.charCodeAt(o++);g=c>>2;c=(c&3)<<4|d>>4;h=(d&15)<<2|f>>6;k=f&63;if(isNaN(d))h=k=64;else if(isNaN(f))k=64;b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-=".charAt(k)}while(o<
a.length);b=b;a=pm(b).substr(0,10);d=[];f=Gc%Fc;for(g=r(b);f<g;){d.push(b[f]);f+=Fc}b=d.join("");this.Ha.send({ev:"frag",src:this.Da,fpr:a,fra:b,see:Gc})}};function ik(){ik.g.apply(this,arguments)}
p(ik,oi);function tm(a,b,c,d,f){this.B=a;this.gb=b;this.jj=i;this.wb=c;this.jc=this.N=this.kd=e;this.ng=1;this.RV=d;this.xe={border:"1px solid "+d,backgroundColor:"white",fontSize:"1%"};f&&De(this.xe,f)}
p(tm,ik);l=tm.prototype;l.initialize=Pe;l.Gg=Pe;l.$k=Pe;l.qv=Pe;l.LF=Pe;l.Jb=Pe;l.remove=Pe;l.Yl=Pe;l.Ic=Pe;l.nc=Pe;l.cc=Pe;l.redraw=Pe;l.cc=Pe;l.hide=Pe;l.show=Pe;Ih(tm,"mspe",17);tm.prototype.Ea=function(){return"ControlPoint"};
tm.prototype.I=function(){return!this.N};
tm.prototype.ya=Oe;tm.prototype.Hj=function(){return this.B};function um(a,b,c,d){this.B=a;this.ue=b;this.Fr=c;this.$=d||{};um.g.apply(this,arguments)}
um.g=N;p(um,oi);um.prototype.copy=function(){return new um(this.B,this.ue,this.Fr,this.$)};
zj(um,"arrow",1);function vm(){if(ue(El))return El;var a;a:{a=j;if(document.namespaces){for(var b=0;b<document.namespaces.length;b++){var c=document.namespaces(b);if(c.name=="v")if(c.urn=="urn:schemas-microsoft-com:vml")a=e;else{a=j;break a}}if(!a){a=e;document.namespaces.add("v","urn:schemas-microsoft-com:vml")}}a=a}if(!a)return El=j;a=J("div",document.body);Vd(a,'<v:shape id="vml_flag1" adj="1" />');b=a.firstChild;b.style.behavior="url(#default#VML)";El=b?typeof b.adj=="object":e;Cg(a);return El}
function wm(){if(E.type==0&&E.version<10)return j;if(document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1"))return e;return j}
function xm(){if(!E.pb())return j;return!!document.createElement("canvas").getContext}
;var Rl=function(a,b,c){c[0]=a[1]*b[2]-a[2]*b[1];c[1]=a[2]*b[0]-a[0]*b[2];c[2]=a[0]*b[1]-a[1]*b[0]};ik.g=function(a,b,c){if(!a.lat&&!a.lon)a=new z(a.y,a.x);this.B=a;this.jj=i;this.va=0;this.N=this.wb=j;this.Ir=[];this.V=[];this.qa=fm;this.zh=this.Rs=i;this.jc=e;this.ii=this.cg=j;this.f=i;if(b instanceof jm||b==i||c!=i){this.qa=b||fm;this.jc=!c;this.$={icon:this.qa,clickable:this.jc}}else{b=this.$=b||{};this.qa=b.icon||fm;this.xy&&this.xy(b);if(b.clickable!=i)this.jc=b.clickable;if(b.isPng)this.cg=e}b&&Ge(this,b,["id","icon_id","name","description","snippet","nodeData"]);this.gz=ym;if(b&&b.getDomId)this.gz=
b.getDomId;A(ik,Ba,this)};
l=ik.prototype;l.oD=i;l.Ea=function(){return"Marker"};
l.NN=function(a,b,c,d){var f=this.qa;a=J("div",a,b.position,i,i,i,this.ii);a.appendChild(c);fg(c,0);c=new Qh;c.alpha=di(f.label.url)||this.cg;c.cache=e;c.onLoadCallback=d;c.onErrorCallback=d;d=Qc(f.label.url,a,f.label.anchor,f.label.size,c);fg(d,1);bg(d);this.V.push(a)};
l.initialize=function(a){this.f=a;this.N=e;this.vJ();this.$.hide&&this.hide()};
l.vJ=function(){var a=this.f,b=this.qa,c=this.V,d=a.Ya(4);if(this.$.ground)d=a.Ya(0);var f=a.Ya(2);a=a.Ya(6);if(this.$.zS)this.ii=e;var g=this.Hf(),h=3,k=sf(this,function(){--h==0&&A(this,"initialized")}),
o=new Qh,q=b.sprite&&b.sprite.image?di(b.sprite.image):di(b.image);o.alpha=q||this.cg;o.scale=e;o.cache=e;o.styleClass=b.styleClass;o.onLoadCallback=k;o.onErrorCallback=k;q=zm(b.image,b.sprite,d,i,b.iconSize,o);if(b.label)this.NN(d,g,q,k);else{Bf(q,g.position,this.ii);d.appendChild(q);c.push(q);k("",i)}this.Rs=q;if(b.shadow&&!this.$.ground){o=new Qh;o.alpha=di(b.shadow)||this.cg;o.scale=e;o.cache=e;o.onLoadCallback=k;o.onErrorCallback=k;k=Qc(b.shadow,f,g.shadowPosition,b.shadowSize,o);bg(k);k.hC=
e;c.push(k)}else k("",i);k=i;if(b.transparent){o=new Qh;o.alpha=di(b.transparent)||this.cg;o.scale=e;o.cache=e;o.styleClass=b.styleClass;k=Qc(b.transparent,a,g.position,b.iconSize,o);bg(k);c.push(k);k.sO=e}this.GJ(d,f,q,g);this.ri();this.sJ(a,q,k)};
l.GJ=function(a,b,c,d){var f=this.qa,g=this.V,h=new Qh;h.scale=e;h.cache=e;h.printOnly=e;var k;if(E.px())k=E.Na()?f.mozPrintImage:f.printImage;if(k){bg(c);a=zm(k,f.sprite,a,d.position,f.iconSize,h);g.push(a)}if(f.printShadow&&!E.Na()){b=Qc(f.printShadow,b,d.position,f.shadowSize,h);b.hC=e;g.push(b)}};
l.sJ=function(a,b,c){var d=this.qa;if(!this.jc&&!this.wb)this.vx(c||b);else{b=c||b;var f=E.Na();if(c&&d.imageMap&&f){b="gmimap"+ji++;a=this.zh=J("map",a);sh(a,ja,Ug);a.setAttribute("name",b);a.setAttribute("id",b);f=J("area",i);f.setAttribute("log","miw");var g=d.imageMap.join(",");f.setAttribute("coords",g);d=Le(d.imageMapType,"poly");f.setAttribute("shape",d);f.setAttribute("alt","");f.setAttribute("href","javascript:void(0)");a.appendChild(f);c.setAttribute("usemap","#"+b);b=f}else $f(b,"pointer");
c=this.gz(this);b.setAttribute("id",c);b.nodeData=this.nodeData;this.oD=b;this.Yl(b)}};
l.Tb=function(){return this.f};
var zm=function(a,b,c,d,f,g){if(b){f=f||new R(b.width,b.height);return hi(b.image||a,c,new S(b.left?b.left:0,b.top),f,d,i,g)}else return Qc(a,c,d,f,g)};
l=ik.prototype;l.Hf=function(){var a=this.qa.iconAnchor,b=this.jj=this.f.J(this.B),c=b.x-a.x;if(this.ii)c=-c;a=this.Ao=new S(c,b.y-a.y-this.va);c=new S(a.x+this.va/2,a.y+this.va/2);return{divPixel:b,position:a,shadowPosition:c}};
l.fT=function(a){Zh(this.Rs,a,{scale:e,size:this.qa.iconSize})};
l.VI=function(){t(this.V,Cg);ff(this.V);this.oD=this.Rs=i;if(this.zh){Cg(this.zh);this.zh=i}};
l.remove=function(){this.VI();t(this.Ir,function(a){if(a[Am]==this)a[Am]=i});
ff(this.Ir);this.da&&this.da();A(this,"remove");this.vd=i};
l.copy=function(){this.$.id=this.id;this.$.icon_id=this.icon_id;return new ik(this.B,this.$)};
l.hide=function(){this.Wa(j)};
l.show=function(){this.Wa(e)};
l.Wa=function(a,b){if(!(!b&&this.N==a)){this.N=a;t(this.V,a?Uf:Tf);this.zh&&Pf(this.zh,a);A(this,Qa,a)}};
l.I=function(){return!this.N};
l.ya=function(){return e};
l.redraw=function(a){if(this.V.length){if(!a)if(this.f.J(this.B).equals(this.jj))return;a=this.V;for(var b=this.Hf(),c=0,d=r(a);c<d;++c)if(a[c].dO)this.oK(b,a[c]);else a[c].hC?Bf(a[c],b.shadowPosition,this.ii):Bf(a[c],b.position,this.ii)}};
l.ri=function(){if(this.V&&this.V.length)for(var a=this.$.zIndexProcess?this.$.zIndexProcess(this):pi(this.B.lat()),b=this.V,c=0;c<r(b);++c)this.QV&&b[c].sO?fg(b[c],1000000000):fg(b[c],a)};
l.xB=function(a){this.ZV=a;this.$.zIndexProcess&&this.ri()};
l.Hj=function(){return this.B};
l.H=function(){return new id(this.B)};
l.cc=function(a){var b=this.B;this.B=a;this.ri();this.redraw(e);A(this,"changed",this,b,a);A(this,"kmlchanged")};
l.pd=function(){return this.qa};
l.bB=function(){return this.$.title};
l.uh=function(){return this.qa.iconSize||new R(0,0)};
l.zb=function(){return this.Ao};
l.kq=function(a){a[Am]=this;this.Ir.push(a)};
l.Yl=function(a){this.wb?this.lq(a):this.kq(a);this.vx(a)};
l.vx=function(a){var b=this.$.title;b&&!this.$.hoverable?Kg(a,"title",b):Lg(a,"title")};
l.zv=function(a){this.ia=a;A(this,Aa,a)};
l.getKml=function(a){vd("kmlu",1,n(function(b){a(b(this))},
this))};
l.$u=function(a){vd("apiiw",7,n(function(b){if(!this.vd){this.vd=new b(this);xh(this,"remove",this,this.$R)}this.bm||a.call(this)},
this))};
l.$R=function(){if(this.vd){this.vd.remove();delete this.vd}};
l.ja=function(a,b){this.bm=j;this.$u(function(){this.vd.ja(a,b)})};
l.Zl=function(a,b){if(this.Ws){w(this.Ws);this.Ws=i}this.da();if(a)this.Ws=v(this,m,uf(this,this.ja,a,b))};
l.AJ=function(a,b){if(a.infoWindow)this.infoWindow=n(this.QQ,this,a,b)};
l.QQ=function(a,b,c,d){this.bm=j;rg(d);this.$u(function(){this.vd.PQ(a,b,c,d)})};
l.da=function(){if(this.vd)this.vd.da();else this.bm=e};
l.Kb=function(a,b){this.bm=j;this.$u(function(){this.vd.Kb(a,b)})};
var Bm=0,ym=function(a){return a.id?"mtgt_"+a.id:"mtgt_unnamed_"+Bm++};var Am="__marker__",Cm=[[m,e,e,j],[ka,e,e,j],["mousedown",e,e,j],["mouseup",j,e,j],["mouseover",j,j,j],["mouseout",j,j,j],[ja,j,j,e]],Dm={};(function(){t(Cm,function(a){Dm[a[0]]={mU:a[1],bL:a[3]}})})();
function Wj(a){t(a,function(b){for(var c=0;c<Cm.length;++c)sh(b,Cm[c][0],Em);Fm(b);v(b,Oa,Gm)})}
function Fm(a){E.Dh()&&vd("touch",Va,function(b){new b(a)})}
function Em(a){var b=Qg(a)[Am],c=a.type;if(b){Dm[c].mU&&Tg(a);Dm[c].bL?A(b,c,a):A(b,c,b.B)}}
function Gm(){Ig(this,function(a){if(a[Am])try{delete a[Am]}catch(b){a[Am]=i}})}
function Hm(a,b){t(Cm,function(c){c[2]&&v(a,c[0],function(){A(b,c[0],b.B)})})}
;function Im(){this.kk=[];this.yt=new sm("mk");this.Ml=Math.random()<Ec;v(ik,Ba,n(this.zD,this))}
Im.prototype.zD=function(a){if(this.Ml){r(this.kk)||setTimeout(n(this.YO,this),1000);this.kk.push(a);v(a,"remove",n(function(){xe(this.kk,a)},
this))}};
Im.prototype.YO=function(){for(var a=[],b=this.kk,c=Math.min(r(b),200),d=0;d<c;++d){var f=b[d];if(!f.I()){var g=f.B;f=encodeURIComponent(f.bB());a.push([g.lat(),g.lng(),f].join(","))}}if(r(a)){a.sort();a.push(b[0].Tb().F());this.yt.log(a.join(","))}this.Ml=j;this.kk=[]};
var Jm=i;fd(ik,Ba,function(a){Jm=new Im;Jm.zD(a)});var Km=Q(12);
function Lm(a,b,c,d,f,g,h,k){if(Ub){this.l=k?k:dl("tb_jstemplate",Mm);a&&a.appendChild(this.l);this.Pj=i;this.wq=e;this.k={};this.k.width=String(d);this.k.right=String(f);this.k.fontSize=Km;this.k.title=c?c:"";this.k.whiteSpace="";this.k.textAlign="center";this.k.label=b;this.k.paddingLeft="";this.k.paddingRight="";this.k.visible=e;this.k.toggled=j;this.k.subtypes=h?h:[];this.k.showChildren=h?r(h):j;this.k.rightAlign=j;this.vg()}else{a=J("div",a);Gf(a);h=a.style;h.backgroundColor="white";h.border=
"1px solid black";h.textAlign="center";h.width=String(d);h.right=String(f);$f(a,"pointer");c&&a.setAttribute("title",c);c=J("div",a);c.style.fontSize=Km;Ef(b,c);this.l=a;this.ub=c}this.kC=j;this.cW=e;this.o=g}
l=Lm.prototype;l.Uw=function(a,b,c,d){if(Ub){var f={};f.label=a;f.mapType=b;f.alt=c;f.checked=d;this.k.subtypes.push(f);if(this.wq)this.k.showChildren=e;this.vg()}};
l.Sv=function(){if(Ub){this.zq();this.wq=e;if(!this.k.showChildren){this.k.showChildren=e;this.vg()}}};
l.qn=function(){if(Ub){this.zq();this.wq=j;if(this.k.showChildren){this.k.showChildren=j;this.vg()}}};
l.qF=function(a){if(Ub){this.zq();this.Pj=qg(this.l,n(this.qn,this),a)}};
l.zq=function(){Ub&&clearTimeout(this.Pj)};
l.vg=function(){if(Ub){var a=Ek(this.k);Tk(a,this.l);this.ub=this.l.firstChild}};
l.yb=function(){return this.o};
l.RS=function(a){if(Ub){if(this.k.title!=a){this.k.title=a;this.vg()}}else this.l.setAttribute("title",a)};
l.Gg=function(a){if(Ub){for(var b in a)this.k[b]=a[b];this.vg()}};
l.se=function(a,b){if(b){if(this.k.toggled!=a){this.k.toggled=a;this.vg()}}else{b=this.ub.style;b.fontWeight=a?"bold":"";b.border=a?"1px solid #6C9DDF":"1px solid white";for(var c=a?["Top","Left"]:["Bottom","Right"],d=a?"1px solid #345684":"1px solid #b0b0b0",f=0;f<r(c);f++)b["border"+c[f]]=d}return this.kC=a};
l.Ln=function(){return this.kC};function Mm(){Yi()=="rtl";return'<div id="tbo_jstemplate" jsskip="$this.skip"><div id="tb_jstemplate" style="background-color: white;text-align: center;border: 1px solid black;position: absolute;cursor: pointer;" jsdisplay="visible" jsvalues=".style.width:$this.width;.style.right:$this.right;.style.whiteSpace:$this.whiteSpace;.style.textAlign:$this.textAlign;.title:$this.title;"><div jscontent="$this.label" jsvalues=".style.fontSize:$this.fontSize;.style.paddingLeft:$this.paddingLeft;.style.paddingRight:$this.paddingRight;.style.fontWeight:$this.toggled ? \'bold\' : \'\';.style.borderTop:$this.toggled ? \'1px solid #345684\' : \'1px solid white\';.style.borderLeft:$this.toggled ? \'1px solid #345684\' : \'1px solid white\';.style.borderBottom:$this.toggled ? \'1px solid #6C9DDF\' : \'1px solid #b0b0b0\';.style.borderRight:$this.toggled ? \'1px solid #6C9DDF\' : \'1px solid #b0b0b0\';"></div><div style="white-space:nowrap;text-align:left;font-size:11px;width:83px;background-color:white;border:1px solid black;padding-left:2px;position:absolute;" jsdisplay="showChildren" jsvalues=".style.left:$this.rightAlign ? \'-21px\' : \'-1px\';"><div jsselect="subtypes" jsvalues=".title:$this.alt"><input type="checkbox" style="vertical-align:middle;" jsvalues=".checked:$this.checked;"></input><span jscontent="$this.label"></span></div></div></div></div><div id="mmtc_jstemplate" jsselect="buttons"><div transclude="tbo_jstemplate"></div></div>'}
;function Nm(a){return function(b){b?a(new z(Number(b.Location.lat),Number(b.Location.lng))):a(i)}}
function Om(a){return function(){a(i)}}
function Pm(a,b){return function(c){if(c){c[vg]=200;c.location=Qm(c.Location);c.copyright=c.Data&&c.Data.copyright;c.links=c.Links;t(c.links,Rm);b(c)}else b({query:a,code:600})}}
function Sm(a,b){return function(){b({query:a,code:500})}}
function Tm(a){this.pm=a||"api";this.Ha=new wg(_mHost+"/cbk",document)}
Tm.prototype.Fq=function(){var a={};a.output="json";a.oe="utf-8";a.cb_client=this.pm;return a};
Tm.prototype.MA=function(a,b){var c=this.Fq();c.ll=a.Aa();this.Ha.send(c,Pm(a.Aa(),b),Sm(a.Aa(),b))};
Tm.prototype.oM=function(a,b){var c=this.Fq();c.ll=a.Aa();this.Ha.send(c,Nm(b),Om(b))};
Tm.prototype.tM=function(a,b){var c=this.Fq();c.panoid=a;this.Ha.send(c,Pm(a,b),Sm(a,b))};function Um(){Cj.call(this,new md(""));this.RI=(_mCityblockUseSsl?Jb:ib)+"/cbk"}
p(Um,Cj);Um.prototype.isPng=function(){return e};
Um.prototype.getTileUrl=function(a,b){if(b>=0){var c=this.f.o.getName();a=this.RI+"?output="+(c==F(10116)||c==F(10050)?"hybrid":"overlay")+"&zoom="+b+"&x="+a.x+"&y="+a.y;a+="&cb_client=api";return a}else return Rc};
Um.prototype.nT=function(a){this.f=a};
Um.prototype.Tb=function(){return this.f};function Vm(){ak.call(this,new Um,{zPriority:4})}
p(Vm,ak);Vm.prototype.initialize=function(a){this.f=a;ak.prototype.initialize.apply(this,[a]);this.Cc.nT(a);this.Tx=i;this.Z=[];this.Z.push(U(a,Ea,this,this.vq));this.Z.push(U(x(Fj),"appfeaturesdata",this,this.vq));this.vq()};
Vm.prototype.vq=function(a){if(!a||a=="cb")x(Fj).Lm("cb",this.f.H(),n(function(b){if(this.Tx!=b){this.Tx=b;A(this,"changed",b)}},
this))};
Vm.prototype.remove=function(){t(this.Z,w);ff(this.Z);ak.prototype.remove.apply(this)};
Vm.prototype.Ea=function(){return"CityblockLayerOverlay"};function Qm(a){a.latlng=new z(Number(a.lat),Number(a.lng));var b=a.pov={};b.yaw=a.yaw&&Number(a.yaw);b.pitch=a.pitch&&Number(a.pitch);b.zoom=a.zoom&&Number(a.zoom);return a}
function Rm(a){a.yaw=a.yawDeg&&Number(a.yawDeg);return a}
;function Wm(){Wm.g.apply(this,arguments)}
Wm.g=function(){this.wa=j};
l=Wm.prototype;l.hide=function(){return this.wa=e};
l.show=function(){this.wa=j};
l.I=function(){return this.wa};
l.en=function(){return{}};
l.gn=function(){return i};
l.retarget=N;l.hF=N;l.$i=N;l.remove=N;l.focus=N;l.blur=N;l.ap=N;l.bl=N;l.al=N;l.YF=N;l.qb=N;l.Mm=N;l.ga=function(){return i};
l.Gj=function(){return""};
Ih(Wm,"cb_api",2);function Xm(){}
p(Xm,rk);function gk(){gk.g.apply(this,arguments)}
p(gk,Xm);function Ym(){Ym.g.apply(this,arguments)}
p(Ym,Xm);function Zm(){Zm.g.apply(this,arguments)}
p(Zm,Xm);Yj.g=function(a,b){this.anchor=a;this.offset=b||Yg};
Yj.prototype.apply=function(a){Gf(a);a.style[this.WM()]=this.offset.getWidthString();a.style[this.RL()]=this.offset.getHeightString()};
Yj.prototype.WM=function(){switch(this.anchor){case 1:case 3:return"right";default:return"left"}};
Yj.prototype.RL=function(){switch(this.anchor){case 2:case 3:return"bottom";default:return"top"}};function $m(a){var b=this.Sb&&this.Sb();b=J("div",a.R(),i,b);this.W(a,b);return b}
function Zj(){Zj.g.apply(this,arguments)}
Zj.g=N;p(Zj,rk);Zj.prototype.hp=N;Zj.prototype.W=N;Ih(Zj,"ctrapi",7);Zj.prototype.allowSetVisibility=Ne;Zj.prototype.initialize=$m;Zj.prototype.getDefaultPosition=function(){return new Yj(2,new R(2,2))};
function Xj(){Xj.g.apply(this,arguments)}
Xj.g=N;p(Xj,rk);l=Xj.prototype;l.allowSetVisibility=Ne;l.printable=Oe;l.wk=N;l.sq=N;l.xa=N;l.W=N;Ih(Xj,"ctrapi",2);Xj.prototype.initialize=$m;Xj.prototype.getDefaultPosition=function(){return new Yj(3,new R(3,2))};
function dk(){}
p(dk,rk);dk.prototype.W=N;Ih(dk,"ctrapi",8);dk.prototype.initialize=$m;dk.prototype.allowSetVisibility=Ne;dk.prototype.getDefaultPosition=Pe;dk.prototype.Sb=function(){return new R(60,40)};
function an(){}
p(an,rk);an.prototype.W=N;Ih(an,"ctrapi",13);an.prototype.initialize=$m;an.prototype.getDefaultPosition=function(){return new Yj(0,new R(7,7))};
an.prototype.Sb=function(){return new R(37,94)};
function bn(){bn.g.apply(this,arguments)}
bn.g=N;p(bn,rk);bn.prototype.W=N;Ih(bn,"ctrapi",12);bn.prototype.initialize=$m;bn.prototype.getDefaultPosition=function(){return xc?new Yj(2,new R(68,5)):new Yj(2,new R(7,4))};
bn.prototype.Sb=function(){return new R(0,26)};
function cn(){cn.g.apply(this,arguments)}
p(cn,rk);cn.prototype.getDefaultPosition=function(){return new Yj(0,new R(7,7))};
cn.prototype.Sb=function(){return new R(59,354)};
cn.prototype.initialize=$m;function dn(){dn.g.apply(this,arguments)}
dn.g=N;p(dn,cn);dn.prototype.W=N;Ih(dn,"ctrapi",5);function en(){en.g.apply(this,arguments)}
en.g=N;p(en,cn);en.prototype.W=N;Ih(en,"ctrapi",6);function fn(){fn.g.apply(this,arguments)}
Kh(fn,"ctrapi",17,{},{g:j});function gn(){gn.g.apply(this,arguments)}
p(gn,rk);gn.prototype.initialize=$m;function fk(){fk.g.apply(this,arguments)}
fk.g=N;p(fk,gn);fk.prototype.W=N;Ih(fk,"ctrapi",14);fk.prototype.getDefaultPosition=function(){return new Yj(0,new R(7,7))};
fk.prototype.Sb=function(){return new R(17,35)};
function hn(){hn.g.apply(this,arguments)}
hn.g=N;p(hn,gn);hn.prototype.W=N;Ih(hn,"ctrapi",15);hn.prototype.getDefaultPosition=function(){return new Yj(0,new R(10,10))};
hn.prototype.Sb=function(){return new R(19,42)};
Xm.prototype.Jb=N;Xm.prototype.W=N;Ih(Xm,"ctrapi",1);Xm.prototype.initialize=$m;Xm.prototype.getDefaultPosition=function(){return new Yj(1,new R(7,7))};
Ym.g=N;Ym.prototype.W=N;Ih(Ym,"ctrapi",9);Zm.g=N;Zm.prototype.W=N;Zm.prototype.Jk=N;Ih(Zm,"ctrapi",10);function jn(){jn.g.apply(this,arguments)}
jn.g=N;p(jn,Xm);jn.prototype.W=N;Ih(jn,"ctrapi",18);gk.g=N;gk.prototype.Sl=N;gk.prototype.FE=N;gk.prototype.$x=N;gk.prototype.W=N;Ih(gk,"ctrapi",4);gk.prototype.Sb=function(){var a=Nf("hmtctl_inline");return a?new R(a.offsetWidth,a.offsetHeight):new R(0,0)};function kn(){this.Ad=new ln(this);kn.g.apply(this,arguments);this.show();this.mq(this.Ad)}
p(kn,rk);kn.g=N;kn.prototype.mq=N;kn.prototype.Bb=N;kn.prototype.W=N;Ih(kn,"ovrmpc",1);l=kn.prototype;l.show=function(a){this.Ad.show(a)};
l.hide=function(a){this.Ad.hide(a)};
l.initialize=$m;l.QA=Pe;l.getDefaultPosition=function(){return new Yj(3,Yg)};
l.O=function(){return Yg};
function mn(){mn.g.apply(this,arguments)}
mn.g=N;mn.prototype=new rk(j,e);mn.prototype.W=N;Ih(mn,"ctrapi",3);mn.prototype.initialize=$m;mn.prototype.getDefaultPosition=function(){return new Yj(2,new R(2,2))};
function nn(){nn.g.apply(this,arguments)}
nn.g=N;nn.prototype=new rk(j,e);nn.prototype.W=N;Ih(nn,"ctrapi",16);nn.prototype.initialize=$m;nn.prototype.getDefaultPosition=function(){return new Yj(2,new R(3,5))};function ln(a){this.wa=e;this.mJ=a;a=Nf("overview-toggle");sk(a)}
var pn=function(a){var b=new ln,c=b.IH(function(d,f){if(!b.I()){on(a,b,f);w(c)}});
return b},
on=function(a,b,c){vd("ovrmpc",1,function(d){d=new d(a,b,c,e);b.SS(d)},
c)};
l=ln.prototype;l.I=function(){return this.wa};
l.TU=function(){this.IT(!this.wa)};
l.IT=function(a){if(a!=this.wa)a?this.hide():this.show()};
l.IH=function(a){return v(this,"changed",a)};
l.SS=function(a){this.mJ=a};
l.show=function(a,b){this.wa=j;A(this,"changed",a,b)};
l.hide=function(a){this.wa=e;A(this,"changed",a)};function qn(){}
p(qn,rk);l=qn.prototype;l.getDefaultPosition=function(){return new Yj(1,new R(7,7))};
l.initialize=function(a){var b=this.Sb&&this.Sb();b=J("div",a.R(),i,b);b.setAttribute("id","nlcc");U(a,Da,this,this.vw);U(a,Ga,this,this.vw);this.W(a,b);return b};
l.vw=function(){this.xl()};
l.W=N;l.GF=N;l.xl=N;Ih(qn,"nl",1);l=ik.prototype;l.ho=function(a){var b={};if(E.pb()&&!a)b={left:0,top:0};else if(E.type==1&&E.version<7)b={draggingCursor:"hand"};a=new Nh(a,b);this.oI(a);return a};
l.oI=function(a){v(a,"dragstart",uf(this,this.lg,a));v(a,"drag",uf(this,this.jf,a));U(a,"dragend",this,this.kg);Hm(a,this)};
l.lq=function(a){this.G=this.ho(a);this.cf=this.ho(i);this.kd?this.vz():this.Uy();this.pI(a);this.XR=U(this,"remove",this,this.VR)};
l.pI=function(a){T(a,"mouseover",this,this.iu);T(a,"mouseout",this,this.gu);sh(a,ja,Ah(ja,this))};
l.Ic=function(){this.kd=e;this.vz()};
l.vz=function(){if(this.G){this.G.enable();this.cf.enable();if(!this.lz&&this.mK){var a=this.qa,b=a.dragCrossImage||L("drag_cross_67_16");a=a.dragCrossSize||rn;var c=new Qh;c.alpha=e;b=this.lz=Qc(b,this.f.Ya(2),Xg,a,c);b.dO=e;this.V.push(b);bg(b);Qf(b)}}};
l.nc=function(){this.kd=j;this.Uy()};
l.Uy=function(){if(this.G){this.G.disable();this.cf.disable()}};
l.dragging=function(){return!!(this.G&&this.G.dragging()||this.cf&&this.cf.dragging())};
l.rA=function(){return this.G};
l.lg=function(a){this.pj=new S(a.left,a.top);this.oj=this.f.J(this.B);A(this,"dragstart",this.B);a=be(this.Vp);this.LN();a=pf(this.gv,a,this.fK);qg(this,a,0)};
l.LN=function(){this.DN()};
l.DN=function(){this.Ci=ke(pe(2*this.Fx*(this.mk-this.va)))};
l.fz=function(){this.Ci-=this.Fx;this.dT(this.va+this.Ci)};
l.fK=function(){this.fz();return this.va!=this.mk};
l.dT=function(a){a=B(0,me(this.mk,a));if(this.mz&&this.dragging()&&this.va!=a){var b=this.f.J(this.B);b.y+=a-this.va;this.cc(this.f.X(b))}this.va=a;this.ri()};
l.gv=function(a,b,c){if(a.sc()){var d=b.call(this);this.redraw(e);if(d){a=pf(this.gv,a,b,c);qg(this,a,this.tI);return}}c&&c.call(this)};
l.jf=function(a,b){if(!this.Ih){var c=new S(a.left-this.pj.x,a.top-this.pj.y),d=new S(this.oj.x+c.x,this.oj.y+c.y);if(this.kI){var f=this.f.Lc(),g=0,h=0,k=me((f.maxX-f.minX)*0.04,20),o=me((f.maxY-f.minY)*0.04,20);if(d.x-f.minX<20)g=k;else if(f.maxX-d.x<20)g=-k;if(d.y-f.minY-this.va-sn.y<20)h=o;else if(f.maxY-d.y+sn.y<20)h=-o;if(g||h){b||A(this.f,"movestart");this.f.G.Vt(g,h);a.left-=g;a.top-=h;d.x-=g;d.y-=h;this.Ih=setTimeout(n(function(){this.Ih=i;this.jf(a,e)},
this),30)}}b&&!this.Ih&&A(this.f,Da);b=2*B(c.x,c.y);this.va=me(B(b,this.va),this.mk);if(this.mz)d.y+=this.va;this.cc(this.f.X(d));A(this,"drag",this.B)}};
l.kg=function(){if(this.Ih){window.clearTimeout(this.Ih);this.Ih=i;A(this.f,Da)}A(this,"dragend",this.B);if(E.pb()&&this.Nn){var a=this.f.oa();a&&a.Ry();this.Ao.y+=this.va;this.Ao.y-=this.va}a=be(this.Vp);this.IN();a=pf(this.gv,a,this.dK,this.TK);qg(this,a,0)};
l.IN=function(){this.Ci=0;this.nq=e;this.Gx=j};
l.TK=function(){this.nq=j};
l.dK=function(){this.fz();if(this.va!=0)return e;if(this.uI&&!this.Gx){this.Gx=e;this.Ci=ke(this.Ci*-0.5)+1;return e}return this.nq=j};
l.qj=function(){return this.wb&&this.kd};
l.draggable=function(){return this.wb};
var sn={x:7,y:9},rn=new R(16,16);l=ik.prototype;l.xy=function(a){this.Vp=ae("marker");if(a)this.kI=(this.wb=!!a.draggable)&&a.autoPan!==j?e:!!a.autoPan;if(this.wb){this.uI=a.bouncy!=i?a.bouncy:e;this.Fx=a.bounceGravity||1;this.Ci=0;this.tI=a.bounceTimeout||30;this.kd=e;this.mK=a.dragCross!=j?e:j;this.mz=!!a.dragCrossMove;this.mk=13;a=this.qa;if(ve(a.maxHeight)&&a.maxHeight>=0)this.mk=a.maxHeight;this.oz=a.dragCrossAnchor||sn}};
l.VR=function(){if(this.G){this.G.gm();Rg(this.G);this.G=i}if(this.cf){this.cf.gm();Rg(this.cf);this.cf=i}this.lz=i;ce(this.Vp);w(this.XR)};
l.oK=function(a,b){if(this.dragging()||this.nq){Bf(b,new S(a.divPixel.x-this.oz.x,a.divPixel.y-this.oz.y));Rf(b)}else Qf(b)};
l.iu=function(){this.dragging()||A(this,"mouseover",this.B)};
l.gu=function(){this.dragging()||A(this,"mouseout",this.B)};Vl.g=function(a,b,c){this.name=a;if(typeof b=="string"){a=J("div",i);Vd(a,b);b=a}else if(b.nodeType==3){a=J("div",i);a.appendChild(b);b=a}this.contentElem=b;this.onclick=c};var tn=new R(690,786);Wl.g=N;l=Wl.prototype;l.OB=function(){};
l.reset=function(a,b,c,d,f){this.B=a;this.Gf=c;if(f)this.Ed=f;this.wa=j};
l.uh=function(){return new R(0,0)};
l.ks=function(){return Yg};
l.I=Oe;l.Ry=N;l.Oo=N;l.hide=N;l.hG=N;l.show=N;l.nr=N;l.Dr=N;l.xq=N;l.Wk=N;l.bg=N;l.gG=N;l.wB=N;l.vs=N;l.Rm=N;l.YA=N;l.av=N;l.Yx=N;l.zb=N;l.fA=N;l.Fp=N;l.Nl=N;l.mv=N;l.Dv=N;l.ps=N;l.EF=N;l.create=N;l.maximize=N;l.Mv=N;l.restore=N;l.CF=N;zj(Wl,"apiiw",1);l=Wl.prototype;l.M={};l.lc=[];l.B=new z(0,0);l.Dd=i;l.Zc=[];l.Ed=0;l.Yv=Yg;l.Gf=tn;l.wa=e;l.tL=function(){return this.lc};
l.re=function(a){this.Dd=a};
l.rd=function(){return this.Dd};
l.Hj=function(){return this.B};
l.ZA=function(){return this.Zc};
l.zM=function(){return this.Ed};
l.initialize=function(a){this.M=this.Hy(a.Ya(7),a.Ya(5));this.OB(a,this.M)};
l.Hy=function(a,b){var c=new S(-10000,0);a=J("div",a,c);b=J("div",b,c);Qf(a);Qf(b);bg(a);bg(b);b={window:a,shadow:b};a=b.contents=J("div",a,Xg);Wf(a);bg(a);fg(a,10);return b};function jk(a,b){this.f=a;this.So=b;this.Rj=e;this.ww=j;this.Cu=[];this.HB=j;this.Z=[];this.jt=this.JB=j;this.Kh=i}
l=jk.prototype;l.XF=function(){this.ww=e};
l.bv=function(){this.ww=j;if(this.Cu.length>0){var a=this.Cu.shift();setTimeout(a,0)}};
l.xa=function(){for(var a=0;a<r(this.Z);++a)w(this.Z[a]);this.Z=[];this.Z.push(U(this.f,m,this,this.kP))};
l.ja=function(a,b,c,d){if(this.Rj){b=nf(b)?b:b?[new Vl(i,b)]:i;this.JD(a,b,c,d)}};
l.ax=function(a){var b=this.oa();if(b){var c=this.Ze||{};if(c.limitSizeToMap&&!this.Xd()){var d={width:c.maxWidth||640,height:c.maxHeight||598},f=this.f.R(),g=f.offsetHeight-200;f=f.offsetWidth-50;if(d.height>g)d.height=B(40,g);if(d.width>f)d.width=B(199,f);b.Wk(!!c.autoScroll&&!this.Xd()&&(a.width>d.width||a.height>d.height));a.height=me(a.height,d.height);a.width=me(a.width,d.width)}else{b.Wk(!!c.autoScroll&&!this.Xd()&&(a.width>(c.maxWidth||640)||a.height>(c.maxHeight||598)));if(c.maxHeight)a.height=
me(a.height,c.maxHeight)}}};
l.Hp=function(a,b,c,d,f){var g=this.oa();if(g){this.JB=e;d=d&&!a?d:rl;var h=this.Ze?this.Ze.maxWidth:i,k=g.Zc,o=Jd(a||k,function(s){return s.contentElem});
if(!a&&d==rl){var q=g.Ed;o[q]=o[q].cloneNode(e)}rg(f);d(o,n(function(s,u){if(g.Zc!=k)sg(f);else{this.ax(u);g.reset(g.B,a,u,g.ks(),g.Ed);a||g.Fp();b&&b();A(this,"infowindowupdate",Le(c,e),f);this.JB=j;sg(f);xj("iw-updated")}},
this),h,f)}};
l.Gp=function(a,b,c){var d=this.oa();if(d)if(this.ww)this.Cu.push(n(this.Gp,this,a,b));else{this.XF();a(d.Zc[d.Ed]);a=c||c==i;this.Hp(undefined,n(function(){b&&b();this.bv()},
this),a)}};
l.JD=function(a,b,c,d){var f=d||new cd("iw");f.tick("iwo0");var g=this.Ze=c||{};c=this.Ej();g.noCloseBeforeOpen||this.da();c.re(g.owner||i);this.XF();g.onPrepareOpenFn&&g.onPrepareOpenFn(b);A(this,Ia,b,a);c=i;if(b)c=Jd(b,function(k){return k.contentElem});
if(b&&!g.contentSize){var h=be(this.IB);f.branch();rl(c,n(function(k,o){h.sc()&&this.Oz(a,b,o,g,f);this.bv();f.done()},
this),g.maxWidth,f)}else{c=g.contentSize?g.contentSize:new R(200,100);this.Oz(a,b,c,g,f);this.bv()}d||f.done()};
l.Oz=function(a,b,c,d,f){var g=this.oa();g.Dv(d.maxMode||0);d.buttons?g.Nl(d.buttons):g.Oo();this.ax(c);g.reset(a,b,c,d.pixelOffset,d.selectedTab);ue(d.maxUrl)||d.maxTitle||d.maxContent?this.Kh.WN(d.maxUrl,d):g.Yx();this.HB?this.gx(d,f):xh(this.oa(),"infowindowcontentset",this,pf(this.gx,d,f))};
l.MN=function(){var a=this.oa();if(E.type==4){this.Z.push(U(this.f,Da,a,function(){this.gG()}));
this.Z.push(U(this.f,"movestart",a,function(){this.wB()}))}};
l.Xd=function(){var a=this.oa();return!!a&&a.bg()};
l.cl=function(a){this.Kh&&this.Kh.cl(a)};
l.kP=function(a){!a&&!(ue(this.Ze)&&this.Ze.noCloseOnClick)&&this.da()};
l.gx=function(a,b){A(this,"infowindowupdate",e,b);this.jt=e;a.onOpenFn&&a.onOpenFn();A(this,Ka,b);this.GB=a.onCloseFn;this.FB=a.onBeforeCloseFn;this.f.mi(this.oa().B);b.tick("iwo1")};
l.da=function(){var a=this.oa();if(a){be(this.IB);if(!a.I()||this.jt){this.jt=j;var b=this.FB;if(b){b();this.FB=i}a.hide();A(this,Ha);(this.Ze||{}).noClearOnClose||a.xq();if(b=this.GB){b();this.GB=i}A(this,Ja)}a.re(i)}};
l.Ej=function(){if(!this.cb){this.cb=new Wl;this.TN(this.cb)}return this.cb};
l.TN=function(a){oi.re(a,this);this.f.ba(a);xh(a,"infowindowcontentset",this,function(){this.HB=e});
U(a,"closeclick",this,this.da);U(a,"animate",this.f,this.f.NF);this.ET();this.DT();T(a.M.contents,m,this,this.eQ);this.IB=ae("infowindowopen");this.MN()};
l.ET=function(){vd("apiiw",3,n(function(a){this.Kh=new a(this.oa(),this.f);yh(this.Kh,"maximizedcontentadjusted",this);yh(this.Kh,"maxtab",this)},
this))};
l.DT=function(){vd("apiiw",6,n(function(a){var b=this.oa();a=new a(b,this.f,this);U(this,"infowindowupdate",a,a.jQ);U(this,Ja,a,a.fQ);U(b,"restoreclick",a,a.sR)},
this))};
l.oa=function(){return this.cb};
l.eQ=function(){var a=this.oa();A(a,m,a.B)};
l.Kb=function(a,b){if(!this.Rj)return i;var c=J("div",this.f.R());c.style.border="1px solid #979797";Tf(c);b=b||{};var d=this.f.DJ(c,a,{ml:e,mapType:b.mapType||this.KC,zoomLevel:b.zoomLevel||this.LC}),f=new Vl(i,c);this.JD(a,[f],b);Uf(c);U(d,Ga,this,function(){this.LC=d.F()});
U(d,Ca,this,function(){this.KC=d.o});
return d};
l.sU=function(){return this.Ze&&this.Ze.suppressMapPan};
var un=new jm;un.infoWindowAnchor=new S(0,0);un.iconAnchor=new S(0,0);jk.prototype.qu=function(a,b,c,d,f){for(var g=a.modules||[],h=[],k=0,o=r(g);k<o;k++)g[k]&&h.push(this.So.AM(g[k]));var q=be("loadMarkerModules");this.So.fM(h,n(function(){q.sc()&&this.SQ(a,b,c,d,f)},
this),f)};
jk.prototype.SQ=function(a,b,c,d,f){if(c)d=c;else{b=b||new z(a.latlng.lat,a.latlng.lng);c={};c.icon=un;c.id=a.id;if(d)c.pixelOffset=d;d=new ik(b,c)}d.zv(a);this.f.da();b={marker:d,features:{}};A(this,"iwopenfrommarkerjsonapphook",b);A(this,"markerload",a,d.UD);d.AJ(a,b.features);d.f=this.f;d.infoWindow(j,f)};function vn(){this.yt=new sm("iw");this.Ml=Math.random()<Ec}
vn.prototype.hQ=function(a,b){if(this.Ml){var c=b.B;b=b.Zc[b.Ed].contentElem.innerHTML;a=a.F();c=[c.lat(),c.lng(),encodeURIComponent(b),a].join(",");c.length<2048*Fc&&this.yt.log(c)}};
v(Pc,Ba,function(a){var b=new vn;v(a,Ka,function(){b.hQ(a,a.Ej())})});jk.prototype.Cr=function(){this.Rj=e};
jk.prototype.lr=function(){this.da();this.Rj=j};
jk.prototype.Vs=function(){return this.Rj};function wn(){this.reset()}
l=wn.prototype;l.reset=function(){this.ca={}};
l.get=function(a){return this.ca[this.toCanonical(a)]};
l.isCachable=function(a){return!!(a&&a.name)};
l.put=function(a,b){if(a&&this.isCachable(b))this.ca[this.toCanonical(a)]=b};
l.toCanonical=function(a){return a.Aa?a.Aa():a.replace(/,/g," ").replace(/\s\s*/g," ").toLowerCase()};
function xn(){this.reset()}
p(xn,wn);xn.prototype.isCachable=function(a){if(!wn.prototype.isCachable.call(this,a))return j;var b=500;if(a[ug]&&a[ug][vg])b=a[ug][vg];return b==200||b>=600&&b!=620};function yn(){yn.g.apply(this,arguments)}
yn.g=function(a){this.ca=a||new xn};
l=yn.prototype;l.ga=N;l.$m=N;l.Wr=N;l.reset=N;l.gA=function(){return this.ca};
l.eF=function(a){this.ca=a};
l.Pv=function(a){this.hc=a};
l.eB=function(){return this.hc};
l.cF=function(a){this.$g=a};
l.eA=function(){return this.$g};
Ih(yn,"api_gc",1);function zn(){zn.g.apply(this,arguments)}
;zn.g=N;zn.prototype.enable=N;zn.prototype.disable=N;Ih(zn,"adsense",1);function An(){An.g.apply(this,arguments)}
p(An,oi);function Bn(){Bn.g.apply(this,arguments)}
p(Bn,oi);An.g=N;l=An.prototype;l.ya=Oe;l.$A=Pe;l.nn=Ne;l.DC=Ne;l.Um=function(){return i};
l.Vm=function(){return i};
l.bs=Pe;l.Ea=function(){return"GeoXml"};
l.ys=N;l.getKml=N;zj(An,"kml_api",2);Bn.g=N;Bn.prototype.getKml=N;zj(Bn,"kml_api",1);function Cn(){Cn.g.apply(this,arguments)}
Cn.g=N;p(Cn,oi);Cn.prototype.getKml=N;zj(Cn,"kml_api",4);var Dn={co:{ck:1,cr:1,hu:1,id:1,il:1,"in":1,je:1,jp:1,ke:1,kr:1,ls:1,nz:1,th:1,ug:1,uk:1,ve:1,vi:1,za:1},com:{ag:1,ar:1,au:1,bo:1,br:1,bz:1,co:1,cu:1,"do":1,ec:1,fj:1,gi:1,gr:1,gt:1,hk:1,jm:1,ly:1,mt:1,mx:1,my:1,na:1,nf:1,ni:1,np:1,pa:1,pe:1,ph:1,pk:1,pr:1,py:1,sa:1,sg:1,sv:1,tr:1,tw:1,ua:1,uy:1,vc:1,vn:1},off:{ai:1}};function En(a){return Fn(window.location,a)}
function Fn(a,b){var c;c=a.host.toLowerCase().split(".");if(r(c)<2)c=j;else{var d=c.pop(),f=c.pop();if((f=="igoogle"||f=="gmodules"||f=="googlepages"||f=="googleusercontent"||f=="orkut"||f=="googlegroups")&&d=="com")c=e;else{if(r(d)==2&&r(c)>0)if(Dn[f]&&Dn[f][d]==1)f=c.pop();c=f=="google"}}if(c)return e;if(a.protocol=="file:")return e;if(a.hostname=="localhost")return e;d=a.protocol;var g=a.host;f=a.pathname;a=[];if(f){if(f.indexOf("/")!=0)f="/"+f}else f="/";if(g.charAt(g.length-1)==".")g=g.substr(0,
g.length-1);c=[d];d=="https:"&&c.unshift("http:");g=g.toLowerCase();d=[g];g=g.split(".");g[0]!="www"&&d.push("www."+g.join("."));g.shift();for(var h=r(g);h>1;){if(h!=2||g[0]!="co"&&g[0]!="off"){d.push(g.join("."));g.shift()}h--}f=f.split("/");for(g=[];r(f)>1;){f.pop();g.push(f.join("/")+"/")}for(f=0;f<r(c);++f)for(h=0;h<r(d);++h)for(var k=0;k<r(g);++k){a.push(c[f]+"//"+d[h]+g[k]);var o=d[h].indexOf(":");o!=-1&&a.push(c[f]+"//"+d[h].substr(0,o)+g[k])}for(c=0;c<r(a);++c){d=pm(a[c]);if(b==d)return e}return j}
window.GValidateKey=En;l=Pc.prototype;l.wz=function(){this.oF(e)};
l.$J=function(){this.oF(j)};
l.$p=function(a){a=this.xs?new nn(a,this.gB):new Zj(a);this.$a(a);this.ek=a};
l.YR=function(){if(this.ek){this.ge(this.ek);this.ek.clear();delete this.ek}};
l.oF=function(a){this.xs=a;this.YR();this.$p(this.ZO)};
l.Cr=function(){this.Ub().Cr()};
l.lr=function(){this.Ub().lr()};
l.Vs=function(){return this.Ub().Vs()};
l.mA=function(){return new Bj(this.O())};
l.XO=function(a){a=a?"maps_api_set_default_ui":"maps_api_set_ui";var b=new Ki;b.set("imp",a);this.Ha.send(b.Gd)};
l.WF=function(){var a=this.VF(this.mA(),e);if(this.cv){w(this.cv);delete this.cv}this.cv=v(this,Ea,n(function(){t(a,n(function(b){this.ge(b)},
this));this.WF()},
this))};
l.VF=function(a,b){this.XO(!!b);t([["NORMAL_MAP","normal"],["SATELLITE_MAP","satellite"],["HYBRID_MAP","hybrid"],["PHYSICAL_MAP","physical"]],n(function(d){var f=zc[d[0]];if(f)a.maptypes[d[1]]?this.Pl(f):this.CE(f)},
this));a.zoom.scrollwheel?this.Bz():this.Wy();a.zoom.doubleclick?this.uz():this.jr();a.keyboard&&new mi(this);b=[];if(a.controls.largemapcontrol3d){var c=new en;b.push(c);this.$a(c)}else if(a.controls.smallzoomcontrol3d){c=new hn;b.push(c);this.$a(c)}if(a.controls.maptypecontrol){c=new Ym;b.push(c);this.$a(c)}else if(a.controls.menumaptypecontrol){c=new Zm;b.push(c);this.$a(c)}else if(a.controls.hierarchicalmaptypecontrol){c=new gk;b.push(c);this.$a(c)}if(a.controls.scalecontrol){c=new bn;b.push(c);
this.gB||this.xs?this.$a(c,new Yj(2,new R(92,5))):this.$a(c)}a.controls.overviewmapcontrol&&pn(this).show();if(a.controls.googlebar){this.wz();b.push(this.ek)}return b};function Gn(){var a=[];a=a.concat(Hn());a=a.concat(In());return a=a.concat(Jn())}
function Hn(){var a=[{symbol:Kn,name:"visible",url:"http://mw1.google.com/mw-planetary/lunar/lunarmaps_v1/clem_bw/",zoom_levels:9},{symbol:Ln,name:"elevation",url:"http://mw1.google.com/mw-planetary/lunar/lunarmaps_v1/terrain/",zoom_levels:7}],b=[],c=new pd(30),d=new md;d.Oi(new Qd("1",new id(new z(-180,-90),new z(180,90)),0,"NASA/USGS"));for(var f=[],g=0;g<a.length;g++){var h=a[g],k=new Mn(h.url,d,h.zoom_levels);k=new Hd([k],c,h.name,{radius:1738000,shortName:h.name,alt:"Show "+h.name+" map"});f.push(k);
b.push([h.symbol,f[g]])}b.push([Nn,f]);return b}
function Mn(a,b,c){Cj.call(this,b,0,c);this.Ui=a}
p(Mn,Cj);Mn.prototype.getTileUrl=function(a,b){var c=Math.pow(2,b);return this.Ui+b+"/"+a.x+"/"+(c-a.y-1)+".jpg"};
function In(){for(var a=[{symbol:On,name:"elevation",url:"http://mw1.google.com/mw-planetary/mars/elevation/",zoom_levels:8,credits:"NASA/JPL/GSFC"},{symbol:Pn,name:"visible",url:"http://mw1.google.com/mw-planetary/mars/visible/",zoom_levels:9,credits:"NASA/JPL/ASU/MSSS"},{symbol:Qn,name:"infrared",url:"http://mw1.google.com/mw-planetary/mars/infrared/",zoom_levels:12,credits:"NASA/JPL/ASU"}],b=[],c=new pd(30),d=[],f=0;f<a.length;f++){var g=a[f],h=new md;h.Oi(new Qd("2",new id(new z(-180,-90),new z(180,
90)),0,g.credits));h=new Rn(g.url,h,g.zoom_levels);h=new Hd([h],c,g.name,{radius:3396200,shortName:g.name,alt:"Show "+g.name+" map"});d.push(h);b.push([g.symbol,d[f]])}b.push([Sn,d]);return b}
function Rn(a,b,c){Cj.call(this,b,0,c);this.Ui=a}
p(Rn,Cj);Rn.prototype.getTileUrl=function(a,b){var c=Math.pow(2,b),d=a.x;a=a.y;for(var f=["t"],g=0;g<b;g++){c/=2;if(a<c)if(d<c)f.push("q");else{f.push("r");d-=c}else{if(d<c)f.push("t");else{f.push("s");d-=c}a-=c}}return this.Ui+f.join("")+".jpg"};
function Jn(){var a=[{symbol:Tn,name:"visible",url:"http://mw1.google.com/mw-planetary/sky/skytiles_v1/",zoom_levels:19}],b=[],c=new pd(30),d=new md;d.Oi(new Qd("1",new id(new z(-180,-90),new z(180,90)),0,"SDSS, DSS Consortium, NASA/ESA/STScI"));for(var f=[],g=0;g<a.length;g++){var h=a[g],k=new Un(h.url,d,h.zoom_levels);k=new Hd([k],c,h.name,{radius:57.2957763671875,shortName:h.name,alt:"Show "+h.name+" map"});f.push(k);b.push([h.symbol,f[g]])}b.push([Vn,f]);return b}
function Un(a,b,c){Cj.call(this,b,0,c);this.Ui=a}
p(Un,Cj);Un.prototype.getTileUrl=function(a,b){return this.Ui+a.x+"_"+a.y+"_"+b+".jpg"};function Wn(){Wn.g.apply(this,arguments)}
Kh(Wn,"log",1,{write:j,oH:j,pH:j,KA:j},{g:e});function Xn(){Xn.g.apply(this,arguments)}
Xn.g=N;Xn.prototype.Ww=N;Xn.prototype.aq=N;Xn.prototype.refresh=N;Xn.prototype.GA=function(){return 0};
Ih(Xn,"mkrmr",1);function Yn(){Yn.g.apply(this,arguments)}
Kh(Yn,"apidir",1,{load:j,zC:j,clear:j,We:j,H:j,qd:j,ab:j,bn:j,Xm:j,Sm:j,hn:j,lb:j,od:j,getPolyline:j,FA:j},{g:j,nA:j});function Zn(){Zn.g.apply(this,arguments)}
Kh(Zn,"apidir",2,{clear:j,HE:j,Mo:j},{g:j});function $n(){$n.g.apply(this,arguments)}
$n.g=N;p($n,oi);$n.prototype.Zd=Ne;zj($n,"tfcapi",1);function hk(){hk.g.apply(this,arguments)}
hk.g=N;hk.addInitializer=function(){};
l=hk.prototype;l.setParameter=function(){};
l.OF=function(){};
l.refresh=function(){};
l.Tb=Pe;l.yv=N;l.Bk=function(){};
l.og=function(){};
l.getKml=N;zj(hk,"lyrs",1);hk.prototype.Ch=Ne;hk.prototype.I=yj.I;hk.prototype.Ea=function(){return"Layer"};function ao(a,b){this.zN=a;this.$=b||i}
ao.prototype.gC=function(a){return!!a.id.match(this.zN)};
ao.prototype.XD=function(a){this.$&&a.ux(this.$);a.yv()};function bo(){bo.g.apply(this,arguments)}
p(bo,qi);bo.g=Jh(N);l=bo.prototype;l.f=i;l.initialize=Jh(function(a){this.f=a;this.fg={}});
l.ba=N;l.ka=N;l.Ym=N;Ih(bo,"lyrs",2);bo.prototype.Td=function(a,b){var c=this.fg[a];c||(c=this.fg[a]=new hk(a,b,this));return c};v(Pc,Ba,function(a){var b=new bo(window._mLayersTileBaseUrls,window._mLayersFeaturesBaseUrl);a.AE(["Layer"],b)});var co;function X(a){return co+=a||1}
co=0;
var eo=X(),fo=X(),go=X(),ho=X(),io=X(),jo=X(),ko=X(),lo=X(),mo=X(),no=X(),oo=X(),po=X(),qo=X(),ro=X(),so=X(),to=X(),uo=X(),vo=X(),wo=X(),xo=X(),yo=X(),zo=X(),Ao=X(),Bo=X(),Co=X(),Do=X(),Eo=X(),Fo=X(),Go=X(),Ho=X(),Io=X(),Jo=X(),Ko=X(),Lo=X(),Mo=X(),No=X(),Oo=X(),Po=X(),Qo=X(),Ro=X(),So=X(),To=X(),Uo=X(),Vo=X(),Wo=X(),Xo=X(),Yo=X(),Zo=X(),$o=X(),ap=X(),bp=X(),cp=X(),dp=X(),ep=X(),fp=X(),gp=X(),hp=X(),ip=X(),jp=X(),kp=X(),lp=X(),mp=X(),np=X(),op=X(),pp=X(),qp=X(),rp=X(),sp=X(),tp=X(),up=X(),vp=X(),
wp=X(),xp=X();co=0;var yp=X(),zp=X(),Ap=X(),Bp=X(),Cp=X(),Dp=X(),Ep=X(),Fp=X(),Gp=X(),Hp=X(),Ip=X(),Jp=X(),Kp=X(),Lp=X(),Mp=X(),Np=X(),Op=X(),Pp=X(),Qp=X(),Rp=X(),Sp=X(),Tp=X(),Up=X(),Vp=X(),Wp=X(),Xp=X(),Yp=X(),Zp=X(),$p=X(),aq=X(),bq=X(),cq=X(),dq=X(),eq=X(),fq=X(),gq=X(),hq=X(),iq=X(),jq=X(),kq=X(),lq=X(),mq=X(),nq=X(),Nn=X(),Kn=X(),Ln=X(),Sn=X(),On=X(),Pn=X(),Qn=X(),Vn=X(),Tn=X(),oq=X(),pq=X(),qq=X(),rq=X(),sq=X();co=0;
var tq=X(),uq=X(),vq=X(),wq=X(),xq=X(),yq=X(),zq=X(),Aq=X(),Bq=X(),Cq=X(),Dq=X(),Eq=X(),Fq=X(),Gq=X(),Hq=X(),Iq=X(),Jq=X(),Kq=X(),Lq=X(),Mq=X(),Nq=X(),Oq=X(),Pq=X(),Qq=X(),Rq=X(),Sq=X(),Tq=X(),Uq=X(),Vq=X(),Wq=X(),Xq=X(),Yq=X(),Zq=X(),$q=X(),ar=X(),br=X(),cr=X(),dr=X(),er=X(),fr=X(),gr=X(),hr=X(),ir=X(),jr=X(),kr=X(),lr=X(),mr=X(),nr=X(),or=X(),pr=X(),qr=X(),rr=X(),sr=X(),tr=X(),ur=X(),vr=X(),wr=X(),xr=X(),yr=X(),zr=X(),Ar=X();co=100;
var Br=X(),Cr=X(),Dr=X(),Er=X(),Fr=X(),Gr=X(),Hr=X(),Ir=X(),Jr=X(),Kr=X(),Lr=X(),Mr=X(),Nr=X(),Or=X(),Pr=X(),Qr=X();co=200;var Rr=X(),Sr=X(),Tr=X(),Ur=X(),Vr=X(),Wr=X(),Xr=X(),Yr=X(),Zr=X(),$r=X(),as=X(),bs=X(),cs=X(),ds=X(),es=X(),fs=X(),gs=X();co=300;var hs=X(),is=X(),js=X(),ks=X(),ls=X(),ms=X(),ns=X(),os=X(),ps=X(),qs=X(),rs=X(),ss=X(),ts=X(),us=X(),vs=X(),ws=X(),xs=X(),ys=X(),zs=X(),As=X(),Bs=X(),Cs=X(),Ds=X(),Es=X(),Fs=X(),Gs=X();co=400;
var Hs=X(),Is=X(),Js=X(),Ks=X(),Ls=X(),Ms=X(),Ns=X(),Os=X(),Ps=X(),Qs=X(),Rs=X(),Ss=X(),Ts=X(),Us=X(),Vs=X(),Ws=X(),Xs=X(),Ys=X(),Zs=X(),$s=X(),at=X(),bt=X(),ct=X(),dt=X(),et=X(),ft=X(),gt=X(),ht=X(),it=X(),jt=X(),kt=X(),lt=X(),mt=X(),nt=X(),ot=X(),pt=X(),qt=X(),rt=X(),st=X(),tt=X(),ut=X(),vt=X(),wt=X(),zt=X(),At=X(),Bt=X(),Ct=X(),Dt=X();co=500;var Et=X(),Ft=X(),Gt=X(),Ht=X(),It=X(),Jt=X(),Kt=X(),Lt=X(),Mt=X(),Nt=X(),Ot=X(),Pt=X(),Qt=X(),Rt=X();co=600;
var St=X(),Tt=X(),Ut=X(),Vt=X(),Wt=X(),Xt=X(),Yt=X(),Zt=X(),$t=X(),au=X(),bu=X(),cu=X(),du=X(),eu=X(),fu=X(),gu=X(),hu=X();co=700;var iu=X(),ju=X(),ku=X(),lu=X(),mu=X(),nu=X(),ou=X(),pu=X(),qu=X(),ru=X(),su=X(),tu=X(),uu=X(),vu=X(),wu=X(),xu=X(),yu=X(),zu=X(),Au=X(),Bu=X(),Cu=X(),Du=X(),Eu=X();co=800;var Fu=X(),Gu=X(),Hu=X(),Iu=X(),Ju=X(),Ku=X(),Lu=X(),Mu=X(),Nu=X(),Ou=X(),Pu=X(),Qu=X(),Ru=X(),Su=X();co=900;
var Tu=X(),Uu=X(),Vu=X(),Wu=X(),Xu=X(),Yu=X(),Zu=X(),$u=X(),av=X(),bv=X(),cv=X(),dv=X(),ev=X(),fv=X(),gv=X(),hv=X(),iv=X(),jv=X(),kv=X(),lv=X(),mv=X(),nv=X(),ov=X(),pv=X(),qv=X(),rv=X();co=1000;var sv=X(),tv=X(),uv=X(),vv=X(),wv=X(),xv=X(),yv=X(),zv=X(),Av=X(),Bv=X(),Cv=X(),Dv=X(),Ev=X(),Fv=X(),Gv=X(),Hv=X(),Iv=X(),Jv=X(),Kv=X(),Lv=X(),Mv=X(),Nv=X(),Ov=X(),Pv=X(),Qv=X(),Rv=X();co=1100;
var Sv=X(),Tv=X(),Uv=X(),Vv=X(),Wv=X(),Xv=X(),Yv=X(),Zv=X(),$v=X(),aw=X(),bw=X(),cw=X(),dw=X(),ew=X(),fw=X(),gw=X(),hw=X(),iw=X(),jw=X(),kw=X(),lw=X(),mw=X();co=1200;var nw=X(),ow=X(),pw=X(),qw=X(),rw=X(),sw=X(),tw=X(),uw=X(),vw=X(),ww=X(),xw=X(),yw=X(),zw=X(),Aw=X(),Bw=X(),Cw=X(),Dw=X(),Ew=X(),Fw=X();X();X();X();X();var Gw=X();co=1300;
var Hw=X(),Iw=X(),Jw=X(),Kw=X(),Lw=X(),Mw=X(),Nw=X(),Ow=X(),Pw=X(),Qw=X(),Rw=X(),Sw=X(),Tw=X(),Uw=X(),Vw=X(),Ww=X(),Xw=X(),Yw=X(),Zw=X(),$w=X(),ax=X(),bx=X(),cx=X(),dx=X(),ex=X(),fx=X(),gx=X(),hx=X(),ix=X(),jx=X(),kx=X(),lx=X(),mx=X(),nx=X(),ox=X(),px=X(),qx=X(),rx=X(),sx=X(),tx=X(),ux=X(),vx=X(),wx=X(),xx=X(),yx=X(),zx=X(),Ax=X(),Bx=X(),Cx=X(),Dx=X(),Ex=X(),Fx=X(),Gx=X(),Hx=X(),Ix=X(),Jx=X(),Kx=X(),Lx=X(),Mx=X(),Nx=X(),Ox=X(),Px=X(),Qx=X(),Rx=X(),Sx=X(),Tx=X(),Ux=X(),Vx=X(),Wx=X(),Xx=X(),Yx=X(),
Zx=X(),$x=X(),ay=X(),by=X(),cy=X(),dy=X(),ey=X(),fy=X(),gy=X(),hy=X(),iy=X(),jy=X(),ky=X(),ly=X();co=1400;var my=X(),ny=X(),oy=X(),py=X();X();var qy=X(),uy=X();X();var vy=X(),wy=X();co=1500;var xy=X(),yy=X(),zy=X(),Ay=X(),By=X(),Cy=X(),Dy=X(),Ey=X(),Fy=X(),Gy=X(),Hy=X(),Iy=X(),Jy=X(),Ky=X(),Ly=X(),My=X(),Ny=X(),Oy=X(),Py=X(),Qy=X(),Ry=X(),Sy=X(),Ty=X(),Uy=X();co=0;X(2);X(2);X(2);X(2);X(2);var Vy=[[Oo,cr,[tq,uq,vq,wq,xq,Br,yq,zq,Aq,Bq,Cr,Cq,Dq,Eq,Fq,Gq,Hq,Iq,Dr,Jq,Kq,Lq,Mq,Nq,Lq,Oq,Pq,Qq,Rq,Sq,Tq,Uq,Vq,Er,Wq,Xq,Yq,Zq,$q,ar,Fr,br,Gr,Hr,Ir,Jr,dr,er,fr,gr,hr,ir,jr,kr,lr,mr,nr,or,pr,qr,rr,sr,tr,Kr,Lr,Mr,ur,vr,Nr,Or,wr,xr,yr,zr,Ar,wy]],[Fo,Pr],[Eo,Qr],[Do,i,[Rr,Sr,Tr,Ur,Vr,Wr,Xr,Yr,Zr,$r,bs,cs,ds,es,as]],[Yo,fs,[],[gs]],[So,xs,[hs,is,js,ks,ls,ms,ns,os,ps,qs,rs,ss,ts,us,vs,ws,ys,zs,As,Bs,Cs,Ds,Es,Fs,Gs]],[bp,Hs,[Is,Js,Ks,Ls,Os,Ps,Ns,Ms,Qs,Rs,Ss,Ts,Us,Vs],[Ws]],[ap,Xs,[Ys,Zs,$s,at,bt,ct,dt,
et,ft,gt,ht,it,jt,kt,lt],[mt]],[zo,nt,[ot,pt,qt,rt,st]],[hp,tt,[ut,vt,wt,zt,At]],[ip,Bt,[]],[jp,Ct,[]],[Co,Dt],[to,i,[],[Ht,Et,Ft,Gt,Kt,It,Jt,Lt,Mt,Nt,Ot,Pt,Qt]],[wp,i,[],[Rt]],[$o,St,[Tt,Ut],[Vt]],[kp,Wt,[Xt,Yt],[Zt]],[go,$t,[au,cu,bu,du,eu,fu,gu,hu]],[Jo,iu,[ju,ku,mu,nu,ou,pu,qu],[lu]],[Ko,ru,[su,tu,uu,vu,wu,xu,yu,zu,Au,Bu,Cu,Du,Eu]],[ko,Fu,[Iu,Gu,Hu,Ju,Ku,Lu,Mu,Nu,Ou,Pu,Qu]],[yo,Ru],[vo,Su],[no,Tu],[oo,Uu,[Vu,Wu,Xu]],[qp,Yu],[rp,Zu,[$u,av,bv,cv,dv,ev]],[xo,fv,[gv,hv,iv,jv,kv,lv,mv,nv,ov,pv,qv,
rv]],[Po,sv,[tv,uv,vv]],[dp,wv,[xv,yv,zv,Av,Bv]],[so,Cv,[Dv,Ev,Jv,Kv],[Fv,Gv,Hv,Iv]],[To,Lv,[Mv,Nv,Ov,Pv]],[mo,Sv],[lo,Tv],[gp,Uv],[Ho,Vv],[Io,Wv],[lp,Xv],[mp,Yv],[np,Zv],[Qo,$v],[Uo,aw],[Ao,bw,[cw,dw,ew]],[Zo,fw,[gw,hw,iw,jw]],[Wo,kw,[lw]],[Ro,mw],[cp,nw],[Vo,ow],[Xo,pw],[Mo,i,[],[qw,rw,sw,tw]],[vp,i,[],[uw,vw]],[xp,ww,[xw],[yw]],[Lo,zw,[Aw,Bw,Cw,Dw,Ew]],[sp,Fw,[]],[fo,i,[],[Gw]],[po,Hw,[Iw,Jw,Kw,Lw,Mw,Nw,Ow,Pw,Qw,Rw,Sw,Tw,Uw,Vw,Ww],[Xw]],[ro,Yw,[Zw,$w,ax]],[eo,jy,[ky,ly]],[uo,qy,[uy]],[wo,i,[vy]],
[Bo,i,[my,ny,oy,py]],[ho,xy,[yy,zy,Ay]],[io,By],[jo,Cy,[Dy,Ey,Fy,Gy,Hy,Iy,Jy,Ky,Ly,My,Ny,Oy,Py,Qy,Ry,Sy,Ty,Uy]],[Go,i,[],[Qv,Rv]]];var Wy=[[eo,"AdsManager"],[go,"Bounds"],[fo,"Bandwidth"],[ho,"StreetviewClient"],[io,"StreetviewOverlay"],[jo,"StreetviewPanorama"],[ko,"ClientGeocoder"],[lo,"Control"],[mo,"ControlPosition"],[no,"Copyright"],[oo,"CopyrightCollection"],[po,"Directions"],[ro,"DirectionsRenderer"],[so,"DraggableObject"],[to,"Event"],[uo,i],[vo,"FactualGeocodeCache"],[xo,"GeoXml"],[yo,"GeocodeCache"],[wo,i],[zo,"GroundOverlay"],[Bo,"_IDC"],[Co,"Icon"],[Do,i],[Do,i],[Eo,"InfoWindowTab"],[Fo,"KeyboardHandler"],[Ho,"LargeMapControl"],
[Io,"LargeMapControl3D"],[Jo,"LatLng"],[Ko,"LatLngBounds"],[Lo,"Layer"],[Mo,"Log"],[No,"Map"],[Oo,"Map2"],[Po,"MapType"],[Qo,"MapTypeControl"],[Ro,"MapUIOptions"],[So,"Marker"],[To,"MarkerManager"],[Uo,"MenuMapTypeControl"],[Ao,"HierarchicalMapTypeControl"],[Vo,"MercatorProjection"],[Xo,"ObliqueMercator"],[Yo,"Overlay"],[Zo,"OverviewMapControl"],[$o,"Point"],[ap,"Polygon"],[bp,"Polyline"],[cp,"Projection"],[dp,"RotatableMapTypeCollection"],[gp,"ScaleControl"],[hp,"ScreenOverlay"],[ip,"ScreenPoint"],
[jp,"ScreenSize"],[kp,"Size"],[lp,"SmallMapControl"],[mp,"SmallZoomControl"],[np,"SmallZoomControl3D"],[qp,"TileLayer"],[rp,"TileLayerOverlay"],[sp,"TrafficOverlay"],[vp,"Xml"],[wp,"XmlHttp"],[xp,"Xslt"],[Wo,"NavLabelControl"],[Go,"Language"]],Xy=[[tq,"addControl"],[uq,"addMapType"],[vq,"addOverlay"],[wq,"checkResize"],[xq,"clearOverlays"],[Br,"closeInfoWindow"],[yq,"continuousZoomEnabled"],[zq,"disableContinuousZoom"],[Aq,"disableDoubleClickZoom"],[Bq,"disableDragging"],[Cr,"disableInfoWindow"],
[Cq,"disablePinchToZoom"],[Dq,"disableScrollWheelZoom"],[Eq,"doubleClickZoomEnabled"],[Fq,"draggingEnabled"],[Gq,"enableContinuousZoom"],[Hq,"enableDoubleClickZoom"],[Iq,"enableDragging"],[Dr,"enableInfoWindow"],[Jq,"enablePinchToZoom"],[Kq,"enableScrollWheelZoom"],[Lq,"fromContainerPixelToLatLng"],[Mq,"fromLatLngToContainerPixel"],[Nq,"fromDivPixelToLatLng"],[Oq,"fromLatLngToDivPixel"],[Pq,"getBounds"],[Qq,"getBoundsZoomLevel"],[Rq,"getCenter"],[Sq,"getContainer"],[Tq,"getCurrentMapType"],[Uq,"getDefaultUI"],
[Vq,"getDragObject"],[Er,"getInfoWindow"],[Wq,"getMapTypes"],[Xq,"getPane"],[Yq,"getSize"],[$q,"getZoom"],[ar,"hideControls"],[Fr,"infoWindowEnabled"],[br,"isLoaded"],[Gr,"openInfoWindow"],[Hr,"openInfoWindowHtml"],[Ir,"openInfoWindowTabs"],[Jr,"openInfoWindowTabsHtml"],[dr,"panBy"],[er,"panDirection"],[fr,"panTo"],[gr,"pinchToZoomEnabled"],[hr,"removeControl"],[ir,"removeMapType"],[jr,"removeOverlay"],[kr,"returnToSavedPosition"],[lr,"savePosition"],[mr,"scrollWheelZoomEnabled"],[nr,"setCenter"],
[or,"setFocus"],[pr,"setMapType"],[qr,"setUI"],[rr,"setUIToDefault"],[sr,"setZoom"],[tr,"showControls"],[Kr,"showMapBlowup"],[Lr,"updateCurrentTab"],[Mr,"updateInfoWindow"],[ur,"zoomIn"],[vr,"zoomOut"],[Nr,"enableGoogleBar"],[Or,"disableGoogleBar"],[wr,"changeHeading"],[xr,"disableRotation"],[yr,"enableRotation"],[zr,"isRotatable"],[Ar,"rotationEnabled"],[Rr,"disableMaximize"],[Sr,"enableMaximize"],[Tr,"getContentContainers"],[Ur,"getPixelOffset"],[Vr,"getPoint"],[Wr,"getSelectedTab"],[Xr,"getTabs"],
[Yr,"hide"],[Zr,"isHidden"],[$r,"maximize"],[bs,"reset"],[cs,"restore"],[ds,"selectTab"],[es,"show"],[as,"supportsHide"],[gs,"getZIndex"],[hs,"bindInfoWindow"],[is,"bindInfoWindowHtml"],[js,"bindInfoWindowTabs"],[ks,"bindInfoWindowTabsHtml"],[ls,"closeInfoWindow"],[ms,"disableDragging"],[ns,"draggable"],[os,"dragging"],[ps,"draggingEnabled"],[qs,"enableDragging"],[rs,"getIcon"],[ss,"getPoint"],[ts,"getLatLng"],[us,"getTitle"],[vs,"hide"],[ws,"isHidden"],[ys,"openInfoWindow"],[zs,"openInfoWindowHtml"],
[As,"openInfoWindowTabs"],[Bs,"openInfoWindowTabsHtml"],[Cs,"setImage"],[Ds,"setPoint"],[Es,"setLatLng"],[Fs,"show"],[Gs,"showMapBlowup"],[Is,"deleteVertex"],[Ks,"enableDrawing"],[Js,"disableEditing"],[Ls,"enableEditing"],[Ms,"getBounds"],[Ns,"getLength"],[Os,"getVertex"],[Ps,"getVertexCount"],[Qs,"hide"],[Rs,"insertVertex"],[Ss,"isHidden"],[Ts,"setStrokeStyle"],[Us,"show"],[Ws,"fromEncoded"],[Vs,"supportsHide"],[Ys,"deleteVertex"],[Zs,"disableEditing"],[$s,"enableDrawing"],[at,"enableEditing"],[bt,
"getArea"],[ct,"getBounds"],[dt,"getVertex"],[et,"getVertexCount"],[ft,"hide"],[gt,"insertVertex"],[ht,"isHidden"],[it,"setFillStyle"],[jt,"setStrokeStyle"],[kt,"show"],[mt,"fromEncoded"],[lt,"supportsHide"],[Aw,"show"],[Bw,"hide"],[Cw,"isHidden"],[Dw,"isEnabled"],[Ew,"setParameter"],[Ht,"cancelEvent"],[Et,"addListener"],[Ft,"addDomListener"],[Gt,"removeListener"],[Kt,"clearAllListeners"],[It,"clearListeners"],[Jt,"clearInstanceListeners"],[Lt,"clearNode"],[Mt,"trigger"],[Nt,"bind"],[Ot,"bindDom"],
[Pt,"callback"],[Qt,"callbackArgs"],[Rt,"create"],[Tt,"equals"],[Ut,"toString"],[Vt,"ORIGIN"],[Xt,"equals"],[Yt,"toString"],[Zt,"ZERO"],[au,"toString"],[cu,"equals"],[bu,"mid"],[du,"min"],[eu,"max"],[fu,"containsBounds"],[gu,"containsPoint"],[hu,"extend"],[ju,"equals"],[ku,"toUrlValue"],[lu,"fromUrlValue"],[mu,"lat"],[nu,"lng"],[ou,"latRadians"],[pu,"lngRadians"],[qu,"distanceFrom"],[su,"equals"],[tu,"contains"],[uu,"containsLatLng"],[vu,"intersects"],[wu,"containsBounds"],[xu,"extend"],[yu,"getSouthWest"],
[zu,"getNorthEast"],[Au,"toSpan"],[Bu,"isFullLat"],[Cu,"isFullLng"],[Du,"isEmpty"],[Eu,"getCenter"],[Gu,"getLocations"],[Hu,"getLatLng"],[Iu,"getAddress"],[Ju,"getCache"],[Ku,"setCache"],[Lu,"reset"],[Mu,"setViewport"],[Nu,"getViewport"],[Ou,"setBaseCountryCode"],[Pu,"getBaseCountryCode"],[Qu,"getAddressInBounds"],[Vu,"addCopyright"],[Wu,"getCopyrights"],[Xu,"getCopyrightNotice"],[$u,"getTileLayer"],[av,"hide"],[bv,"isHidden"],[cv,"refresh"],[dv,"show"],[ev,"supportsHide"],[gv,"getDefaultBounds"],
[hv,"getDefaultCenter"],[iv,"getDefaultSpan"],[jv,"getKml"],[kv,"getTileLayerOverlay"],[lv,"gotoDefaultViewport"],[mv,"hasLoaded"],[nv,"hide"],[ov,"isHidden"],[pv,"loadedCorrectly"],[qv,"show"],[rv,"supportsHide"],[ot,"getKml"],[pt,"hide"],[qt,"isHidden"],[rt,"show"],[st,"supportsHide"],[ut,"getKml"],[vt,"hide"],[wt,"isHidden"],[zt,"show"],[At,"supportsHide"],[tv,"getName"],[uv,"getBoundsZoomLevel"],[vv,"getSpanZoomLevel"],[xv,"getDefault"],[yv,"getMapTypeArray"],[zv,"getRotatedMapType"],[Av,"isImageryVisible"],
[Bv,"setMinZoomLevel"],[Dv,"setDraggableCursor"],[Ev,"setDraggingCursor"],[Fv,"getDraggableCursor"],[Gv,"getDraggingCursor"],[Hv,"setDraggableCursor"],[Iv,"setDraggingCursor"],[Jv,"moveTo"],[Kv,"moveBy"],[cw,"addRelationship"],[dw,"removeRelationship"],[ew,"clearRelationships"],[Mv,"addMarkers"],[Nv,"addMarker"],[Ov,"getMarkerCount"],[Pv,"refresh"],[gw,"getOverviewMap"],[hw,"show"],[iw,"hide"],[jw,"setMapType"],[lw,"setMinAddressLinkLevel"],[qw,"write"],[rw,"writeUrl"],[sw,"writeHtml"],[tw,"getMessages"],
[uw,"parse"],[vw,"value"],[xw,"transformToHtml"],[yw,"create"],[Gw,"forceLowBandwidthMode"],[Iw,"load"],[Jw,"loadFromWaypoints"],[Kw,"clear"],[Lw,"getStatus"],[Mw,"getBounds"],[Nw,"getNumRoutes"],[Ow,"getRoute"],[Pw,"getNumGeocodes"],[Qw,"getGeocode"],[Rw,"getCopyrightsHtml"],[Sw,"getSummaryHtml"],[Tw,"getDistance"],[Uw,"getDuration"],[Vw,"getPolyline"],[Ww,"getMarker"],[Xw,"getDirections"],[Zw,"clear"],[$w,"renderResult"],[ax,"renderTrip"],[ky,"enable"],[ly,"disable"],[uy,"destroy"],[vy,"setMessage"],
[wy,"__internal_testHookRespond"],[my,"call_"],[ny,"registerService_"],[oy,"initialize_"],[py,"clear_"],[yy,"getNearestPanorama"],[zy,"getNearestPanoramaLatLng"],[Ay,"getPanoramaById"],[Dy,"hide"],[Ey,"show"],[Fy,"isHidden"],[Gy,"setContainer"],[Hy,"checkResize"],[Iy,"remove"],[Jy,"focus"],[Ky,"blur"],[Ly,"getPOV"],[My,"setPOV"],[Ny,"panTo"],[Oy,"followLink"],[Py,"setLocationAndPOVFromServerResponse"],[Qy,"setLocationAndPOV"],[Ry,"setUserPhoto"],[Sy,"getScreenPoint"],[Ty,"getLatLng"],[Uy,"getPanoId"],
[Zq,"getEarthInstance"],[Qv,"isRtl"],[Rv,"getLanguageCode"]],Yy=[[aq,"DownloadUrl"],[oq,"Async"],[yp,"API_VERSION"],[zp,"MAP_MAP_PANE"],[Ap,"MAP_OVERLAY_LAYER_PANE"],[Bp,"MAP_MARKER_SHADOW_PANE"],[Cp,"MAP_MARKER_PANE"],[Dp,"MAP_FLOAT_SHADOW_PANE"],[Ep,"MAP_MARKER_MOUSE_TARGET_PANE"],[Fp,"MAP_FLOAT_PANE"],[Pp,"DEFAULT_ICON"],[Qp,"GEO_SUCCESS"],[Rp,"GEO_MISSING_ADDRESS"],[Sp,"GEO_UNKNOWN_ADDRESS"],[Tp,"GEO_UNAVAILABLE_ADDRESS"],[Up,"GEO_BAD_KEY"],[Vp,"GEO_TOO_MANY_QUERIES"],[Wp,"GEO_SERVER_ERROR"],
[Gp,"GOOGLEBAR_TYPE_BLENDED_RESULTS"],[Hp,"GOOGLEBAR_TYPE_KMLONLY_RESULTS"],[Ip,"GOOGLEBAR_TYPE_LOCALONLY_RESULTS"],[Jp,"GOOGLEBAR_RESULT_LIST_SUPPRESS"],[Kp,"GOOGLEBAR_RESULT_LIST_INLINE"],[Lp,"GOOGLEBAR_LINK_TARGET_TOP"],[Mp,"GOOGLEBAR_LINK_TARGET_SELF"],[Np,"GOOGLEBAR_LINK_TARGET_PARENT"],[Op,"GOOGLEBAR_LINK_TARGET_BLANK"],[Xp,"ANCHOR_TOP_RIGHT"],[Yp,"ANCHOR_TOP_LEFT"],[Zp,"ANCHOR_BOTTOM_RIGHT"],[$p,"ANCHOR_BOTTOM_LEFT"],[bq,"START_ICON"],[cq,"PAUSE_ICON"],[dq,"END_ICON"],[eq,"GEO_MISSING_QUERY"],
[fq,"GEO_UNKNOWN_DIRECTIONS"],[gq,"GEO_BAD_REQUEST"],[hq,"TRAVEL_MODE_DRIVING"],[iq,"TRAVEL_MODE_WALKING"],[jq,"TRAVEL_MODE_TRANSIT"],[kq,"MPL_GEOXML"],[lq,"MPL_POLY"],[mq,"MPL_MAPVIEW"],[nq,"MPL_GEOCODING"],[Nn,"MOON_MAP_TYPES"],[Kn,"MOON_VISIBLE_MAP"],[Ln,"MOON_ELEVATION_MAP"],[Sn,"MARS_MAP_TYPES"],[On,"MARS_ELEVATION_MAP"],[Pn,"MARS_VISIBLE_MAP"],[Qn,"MARS_INFRARED_MAP"],[Vn,"SKY_MAP_TYPES"],[Tn,"SKY_VISIBLE_MAP"],[pq,"LAYER_PARAM_COLOR"],[qq,"LAYER_PARAM_DENSITY_MODIFIER"],[rq,"ADSMANAGER_STYLE_ADUNIT"],
[sq,"ADSMANAGER_STYLE_ICON"]];function Zy(a,b){b=b||{};return b.delayDrag?new Nh(a,b):new Mh(a,b)}
Zy.prototype=Mh.prototype;function $y(a,b){b=b||{};var c=new Sj;c.mapTypes=b.mapTypes;c.size=b.size;c.draggingCursor=b.draggingCursor;c.draggableCursor=b.draggableCursor;c.logoPassive=b.logoPassive;c.googleBarOptions=b.googleBarOptions;c.backgroundColor=b.backgroundColor;Pc.call(this,a,c)}
$y.prototype=Pc.prototype;
var az={},bz=[[eo,zn],[go,Zg],[fo,D],[ko,yn],[lo,rk],[mo,Yj],[no,Qd],[oo,md],[so,Mh],[to,{}],[vo,xn],[xo,An],[yo,wn],[zo,Bn],[Ao,gk],[Co,jm],[Do,Wl],[Eo,Vl],[Fo,mi],[Go,{}],[Ho,dn],[Io,en],[Jo,z],[Ko,id],[Mo,{}],[No,Pc],[Oo,$y],[Po,Hd],[Qo,Ym],[Ro,Bj],[So,ik],[To,Xn],[Uo,Zm],[Vo,pd],[Wo,qn],[Yo,oi],[Zo,kn],[$o,S],[ap,Pl],[bp,Cl],[cp,sj],[gp,bn],[hp,Cn],[ip,bh],[jp,ch],[kp,R],[lp,an],[mp,fk],[np,hn],[qp,Cj],[rp,ak],[vp,{}],[wp,{}],[xp,Ud]],cz=[[yp,_mJavascriptVersion],[zp,0],[Ap,1],[Bp,2],[Cp,4],[Dp,
5],[Ep,6],[Fp,7],[Pp,fm],[Gp,"blended"],[Hp,"kmlonly"],[Ip,"localonly"],[Jp,"suppress"],[Kp,"inline"],[Lp,"_top"],[Mp,"_self"],[Np,"_parent"],[Op,"_blank"],[Qp,200],[Rp,601],[Sp,602],[Tp,603],[Up,610],[Vp,620],[Wp,500],[Xp,1],[Yp,0],[Zp,3],[$p,2],[aq,ij],[rq,"adunit"],[sq,"icon"]];lh=e;
var $=Pc.prototype,dz=Wl.prototype,ez=ik.prototype,fz=Cl.prototype,gz=Pl.prototype,hz=S.prototype,iz=R.prototype,jz=Zg.prototype,kz=z.prototype,lz=id.prototype,mz=kn.prototype,nz=qn.prototype,oz=Ud.prototype,pz=yn.prototype,qz=md.prototype,rz=ak.prototype,sz=Mh.prototype,tz=Xn.prototype,uz=An.prototype,vz=Bn.prototype,wz=Cn.prototype,xz=gk.prototype,yz=[[Rq,$.T],[nr,$.Ga],[or,$.mi],[Pq,$.H],[$q,$.F],[sr,$.te],[ur,$.Dc],[vr,$.bd],[Tq,$.AL],[Vq,$.rA],[Wq,$.hM],[pr,$.Bb],[uq,$.Pl],[ir,$.CE],[Yq,$.O],
[dr,$.to],[er,$.db],[fr,$.qb],[vq,$.ba],[jr,$.ka],[xq,$.Zx],[Xq,$.Ya],[tq,$.$a],[hr,$.ge],[tr,$.ti],[ar,$.rn],[wq,$.$i],[Sq,$.R],[Qq,$.getBoundsZoomLevel],[lr,$.UE],[kr,$.QE],[br,$.ha],[Bq,$.nc],[Iq,$.Ic],[Fq,$.qj],[Lq,$.oh],[Mq,$.Tz],[Nq,$.X],[Oq,$.J],[Gq,$.xK],[zq,$.YJ],[yq,$.lJ],[Hq,$.uz],[Aq,$.jr],[Eq,$.jK],[Kq,$.Bz],[Dq,$.Wy],[mr,$.kv],[Jq,$.zz],[Cq,$.aK],[gr,$.uu],[qr,$.VF],[rr,$.WF],[Uq,$.mA],[Gr,$.ja],[Hr,$.ja],[Ir,$.ja],[Jr,$.ja],[Kr,$.Kb],[Er,$.Ej],[Mr,$.Hp],[Lr,$.Gp],[Br,$.da],[Dr,$.Cr],
[Cr,$.lr],[Fr,$.Vs],[Rr,dz.nr],[Sr,dz.Dr],[$r,dz.maximize],[cs,dz.restore],[ds,dz.mv],[Yr,dz.hide],[es,dz.show],[Zr,dz.I],[as,dz.ya],[bs,dz.reset],[Vr,dz.Hj],[Ur,dz.ks],[Wr,dz.zM],[Xr,dz.ZA],[Tr,dz.tL],[gs,pi],[ys,ez.ja],[zs,ez.ja],[As,ez.ja],[Bs,ez.ja],[hs,ez.Zl],[is,ez.Zl],[js,ez.Zl],[ks,ez.Zl],[ls,ez.da],[Gs,ez.Kb],[rs,ez.pd],[ss,ez.Hj],[ts,ez.Hj],[us,ez.bB],[Ds,ez.cc],[Es,ez.cc],[qs,ez.Ic],[ms,ez.nc],[os,ez.dragging],[ns,ez.draggable],[ps,ez.qj],[Cs,ez.fT],[vs,ez.hide],[Fs,ez.show],[ws,ez.I],
[Is,fz.er],[Js,fz.zm],[Ks,fz.Ar],[Ls,fz.Br],[Ms,fz.H],[Ns,fz.aM],[Os,fz.Vb],[Ps,fz.Ud],[Qs,fz.hide],[Rs,fz.cq],[Ss,fz.I],[Ts,fz.Lv],[Us,fz.show],[Vs,fz.ya],[Ws,Kl],[Ys,gz.er],[Zs,gz.zm],[$s,gz.Ar],[at,gz.Br],[dt,gz.Vb],[et,gz.Ud],[bt,gz.lL],[ct,gz.H],[ft,gz.hide],[gt,gz.cq],[ht,gz.I],[it,gz.$S],[jt,gz.Lv],[kt,gz.show],[lt,gz.ya],[mt,Ql],[Et,rf(v,3,az)],[Ft,rf(sh,3,az)],[Gt,w],[It,rf(ph,2,az)],[Jt,rf(Rg,1,az)],[Lt,rf(Pg,1,az)],[Mt,A],[Nt,rf(wh,4,az)],[Ot,rf(uh,4,az)],[Pt,qf],[Qt,uf],[Rt,hj],[Tt,hz.equals],
[Ut,hz.toString],[Vt,Xg],[Xt,iz.equals],[Yt,iz.toString],[Zt,Yg],[au,jz.toString],[cu,jz.equals],[bu,jz.mid],[du,jz.min],[eu,jz.max],[fu,jz.kc],[gu,jz.Kf],[hu,jz.extend],[ju,kz.equals],[ku,kz.Aa],[lu,z.fromUrlValue],[mu,kz.lat],[nu,kz.lng],[ou,kz.$d],[pu,kz.ff],[qu,kz.Pb],[su,lz.equals],[tu,lz.contains],[uu,lz.contains],[vu,lz.intersects],[wu,lz.kc],[xu,lz.extend],[yu,lz.nb],[zu,lz.mb],[Au,lz.sb],[Bu,lz.hO],[Cu,lz.iO],[Du,lz.ma],[Eu,lz.T],[Gu,pz.$m],[Hu,pz.ga],[Iu,pz.getAddress],[Ju,pz.gA],[Ku,pz.eF],
[Lu,pz.reset],[Mu,pz.Pv],[Nu,pz.eB],[Ou,pz.cF],[Pu,pz.eA],[Qu,pz.Wr],[Vu,qz.Oi],[Wu,qz.getCopyrights],[Xu,qz.$r],[av,rz.hide],[bv,rz.I],[cv,rz.refresh],[dv,rz.show],[ev,rz.ya],[$u,rz.KM],[gv,uz.bs],[hv,uz.Um],[iv,uz.Vm],[jv,uz.getKml],[kv,uz.$A],[lv,uz.ys],[mv,uz.nn],[nv,uz.hide],[ov,uz.I],[pv,uz.DC],[qv,uz.show],[rv,uz.ya],[ot,vz.getKml],[pt,vz.hide],[qt,vz.I],[rt,vz.show],[st,vz.ya],[ut,wz.getKml],[vt,wz.hide],[wt,wz.I],[zt,wz.show],[At,wz.ya],[Dv,sz.qe],[Ev,sz.Yk],[Fv,Mh.Xf],[Gv,Mh.Dj],[Hv,Mh.qe],
[Iv,Mh.Yk],[Jv,sz.moveTo],[Kv,sz.moveBy],[Mv,tz.aq],[Nv,tz.Ww],[Ov,tz.GA],[Pv,tz.refresh],[gw,mz.QA],[hw,mz.show],[iw,mz.hide],[jw,mz.Bb],[lw,nz.GF],[cw,xz.Sl],[dw,xz.FE],[ew,xz.$x],[qw,n(Wn.prototype.write,x(Wn))],[rw,n(Wn.prototype.pH,x(Wn))],[sw,n(Wn.prototype.oH,x(Wn))],[tw,n(Wn.prototype.KA,x(Wn))],[uw,Sd],[vw,Rd],[xw,oz.$U],[yw,Td],[Gw,D.YK],[ky,zn.prototype.enable],[ly,zn.prototype.disable],[Qv,Wi],[Rv,Xd]];window._mTrafficEnableApi&&bz.push([sp,$n]);
if(window._mDirectionsEnableApi){bz.push([po,Yn],[ro,Zn]);var zz=Yn.prototype,Az=Zn.prototype;yz.push([Iw,zz.load],[Jw,zz.zC],[Kw,zz.clear],[Lw,zz.We],[Mw,zz.H],[Nw,zz.qd],[Ow,zz.ab],[Pw,zz.bn],[Qw,zz.Xm],[Rw,zz.Sm],[Sw,zz.hn],[Tw,zz.lb],[Uw,zz.od],[Vw,zz.getPolyline],[Ww,zz.FA],[Xw,Yn.nA],[Zw,Az.clear],[$w,Az.HE],[ax,Az.Mo]);cz.push([bq,gm],[cq,hm],[dq,im],[eq,601],[fq,604],[gq,400],[hq,1],[iq,2],[jq,3])}
if(ac){bz.push([Xo,rd],[dp,Ej]);var Bz=Ej.prototype;yz.push([wr,$.em],[xr,$.or],[yr,$.Er],[zr,$.Wj],[Ar,$.Rk],[xv,Bz.Tm],[yv,Bz.gM],[zv,Bz.rs],[Av,Bz.isImageryVisible],[Bv,Bz.qi])}var Cz=Tm.prototype,Dz=Wm.prototype;bz.push([ho,Tm],[io,Vm],[jo,Wm]);yz.push([yy,Cz.MA],[zy,Cz.oM],[Ay,Cz.tM],[Dy,Dz.hide],[Ey,Dz.show],[Fy,Dz.I],[Gy,Dz.hF],[Hy,Dz.$i],[Iy,Dz.remove],[Jy,Dz.focus],[Ky,Dz.blur],[Ly,Dz.en],[My,Dz.ap],[Ny,Dz.qb],[Oy,Dz.Mm],[Py,Dz.bl],[Qy,Dz.al],[Ry,Dz.YF],[Sy,Dz.gn],[Ty,Dz.ga],[Uy,Dz.Gj]);
Tm.ReturnValues={SUCCESS:200,SERVER_ERROR:500,NO_NEARBY_PANO:600};Wm.ErrorValues={NO_NEARBY_PANO:600,NO_PHOTO:601,FLASH_UNAVAILABLE:603};yz.push([Nr,$.wz],[Or,$.$J]);yz.push([Zq,$.PM]);var Ez=hk.prototype;bz.push([Lo,hk]);yz.push([Aw,Ez.show],[Bw,Ez.hide],[Cw,Ez.I],[Dw,Ez.Ch],[Ew,Ez.setParameter]);cz.push([pq,"c"],[qq,"dm"]);Array.prototype.push.apply(cz,Gn());Bc.push(function(a){sc(a,Wy,Xy,Yy,bz,yz,cz,Vy)});function Fz(a,b){var c=new Sj;c.mapTypes=b||i;Pc.call(this,a,c);v(this,Ga,function(d,f){A(this,Fa,this.De(d),this.De(f))})}
p(Fz,Pc);l=Fz.prototype;l.rL=function(){var a=this.T();return new S(a.lng(),a.lat())};
l.nL=function(){var a=this.H();return new Zg([a.nb(),a.mb()])};
l.DM=function(){var a=this.H().sb();return new R(a.lng(),a.lat())};
l.wh=function(){return this.De(this.F())};
l.Bb=function(a){if(this.ha())Pc.prototype.Bb.call(this,a);else this.gJ=a};
l.JI=function(a,b){a=new z(a.y,a.x);if(this.ha()){b=this.De(b);this.Ga(a,b)}else{var c=this.gJ;b=this.De(b);this.Ga(a,b,c)}};
l.KI=function(a){this.Ga(new z(a.y,a.x))};
l.HR=function(a){this.qb(new z(a.y,a.x))};
l.tH=function(a){this.te(this.De(a))};
l.ja=function(a,b,c,d,f){var g={};g.pixelOffset=c;g.onOpenFn=d;g.onCloseFn=f;Pc.prototype.ja.call(this,new z(a.y,a.x),b,g)};
l.TQ=Fz.prototype.ja;l.Kb=function(a,b,c,d,f,g){var h={};h.pixelOffset=d;h.onOpenFn=f;h.onCloseFn=g;h.mapType=c;h.zoomLevel=ue(b)?this.De(b):undefined;Pc.prototype.Kb.call(this,new z(a.y,a.x),h)};
l.De=function(a){return typeof a=="number"?17-a:a};
Bc.push(function(a){var b=Fz.prototype;b=[["Map",Fz,[["getCenterLatLng",b.rL],["getBoundsLatLng",b.nL],["getSpanLatLng",b.DM],["getZoomLevel",b.wh],["setMapType",b.Bb],["centerAtLatLng",b.KI],["recenterOrPanToLatLng",b.HR],["zoomTo",b.tH],["centerAndZoom",b.JI],["openInfoWindow",b.ja],["openInfoWindowHtml",b.TQ],["openInfoWindowXslt",N],["showMapBlowup",b.Kb]]],[i,ik,[["openInfoWindowXslt",N]]]];a=="G"&&mc(a,b)});Gg("api.css","@media print{.gmnoprint{display:none}}@media screen{.gmnoscreen{display:none}}");window.GLoad&&window.GLoad(Oc);})()



/*	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310"}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}();



/*    HTTP Host:  static.ak.connect.facebook.com                               */
/*    Generated:  February 26th 2010 1:51:38 PM PDT                            */
/*      Machine:  10.27.115.117                                                */
/*       Source:  Local/Global Cache                                           */
/*     Location:  JIT Construction: v222481                                    */
/*       Locale:  en_US                                                        */
/*   Components:  js/connect/core/FB/monitorWrapper.js:r221967,js/connect/core/FB/prelude.js:r221967,js/connect/core/FB/log.js:r221967,js/connect/core/FB/class.js:r221967,js/connect/core/FB/Type.js:r221967,js/connect/core/FB/HiddenContainer.js:r221967,js/connect/core/FB/HiddenContainerLoad.js:r221967,js/connect/core/FB/Delegate.js:r221967,js/connect/core/FB/Loader.js:r221967,js/connect/core/FB/Bootstrap.js:r221967,js/api_lib/v0.4/XdCommReceiver.js:r221967 */

if (!window.FB) {FB = {};} if(!FB.dynData) { FB.dynData = {"site_vars":{"canvas_client_compute_content_size_method":1,"use_postMessage":1,"use_xdProxy":0,"use_ui_server":1,"monitor_usage_regex":"somethingtoputhere.com|huffingtonpost.com|lala.com","monitor_usage_rate":0.05,"enable_custom_href":1},"resources":{"base_url_format":"http:\/\/{0}.connect.facebook.com\/","base_cdn_url":"http:\/\/static.ak.fbcdn.net\/","api_channel":210036,"api_server":210036,"www_channel":210036,"xd_proxy":205601,"xd_comm_swf_url":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/z48NA\/hash\/6r2djk2l.swf","share_button":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/z1NNP\/hash\/4273uaqa.png","login_img_dark_small_short":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/zATAA\/hash\/a969rwcd.png","login_img_dark_medium_short":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/zI08N\/hash\/156b4b3s.png","login_img_dark_medium_long":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/zDFXV\/hash\/85b5jlja.png","login_img_dark_large_short":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/zHW0N\/hash\/a22m3ibb.png","login_img_dark_large_long":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/zC8F0\/hash\/8mzymam2.png","login_img_light_small_short":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/z68PZ\/hash\/8t35mjql.png","login_img_light_medium_short":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/zEV10\/hash\/6ad3z8m6.png","login_img_light_medium_long":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/z7T3O\/hash\/4li2k73z.png","login_img_light_large_short":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/zEYEC\/hash\/7e3mp7ee.png","login_img_light_large_long":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/z1RA7\/hash\/8rc0izvz.png","login_img_white_small_short":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/z79GY\/hash\/di0gkqrt.png","login_img_white_medium_short":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/zDTB7\/hash\/cdozw38w.png","login_img_white_medium_long":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/z6AST\/hash\/338d3m67.png","login_img_white_large_short":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/z6FD4\/hash\/8yzn0wu3.png","login_img_white_large_long":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/z5V8V\/hash\/5pwowlag.png","logout_img_small":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/z68NS\/hash\/cxrz4k7j.png","logout_img_medium":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/zATSY\/hash\/4lsqsd7l.png","logout_img_large":"http:\/\/static.ak.fbcdn.net\/rsrc.php\/z8P0T\/hash\/4515xk7j.png"}};} if (!FB.locale) {FB.locale = "en_US";} if (!FB.localeIsRTL) {FB.localeIsRTL = false;}


if(!window.FB)FB={};if(!FB.Monitor)FB.Monitor={wrapObject:function(a,b,f){if(typeof(a)!="object")return a;if(!FB.Monitor.loggingEnabled())return a;if(b=='FB.Debug'||b=='FB.HiddenContainer'||b=='FB.XdComm.Server'||b.indexOf('FBIntern')==0)return a;for(var d in a){var c=a[d];if(!a.hasOwnProperty(d)||typeof(c)!='function'||c.wrapped)continue;var e={containerName:b,functionName:d};a[d]=FB.Monitor._monitorWrapper(c,a,f,e);a[d].wrapped=true;}return a;},disableLogging:function(){FB.Monitor.loggingEnabledCache=false;},loggingEnabled:function(){if(FB.Monitor.loggingEnabledCache===null){var c=FB.dynData&&FB.dynData.site_vars&&FB.dynData.site_vars.monitor_usage_regex;if(!c){FB.Monitor.loggingEnabledCache=false;}else{var a=new RegExp(c);var b=FB.dynData.site_vars.monitor_usage_rate;FB.Monitor.loggingEnabledCache=a.test(document.domain)?(Math.random()/b)<1:false;}}return FB.Monitor.loggingEnabledCache;},externalCallback:function(a){if(typeof(a)!='function')return a;return function(){var d=FB.Monitor.internalCallStackDepth;FB.Monitor.internalCallStackDepth=0;var b=Array.prototype.slice.call(arguments);var c=a.apply(this,b);FB.Monitor.internalCallStackDepth=d;return c;};},_monitorWrapper:function(b,a,d,c){return function(){var e=Array.prototype.slice.call(arguments);context=d?this:(a||window);c=c||{containerName:'unknown',functionName:'unknown'};if(FB.Monitor.internalCallStackDepth==0)if(c.functionName.substr(0,1)!='_')FB.Monitor.logFunction(c,e);++FB.Monitor.internalCallStackDepth;var f=b.apply(context,e);--FB.Monitor.internalCallStackDepth;return f;};},logFunction:function(e,c){var b=[];for(var d=0;d<c.length;d++){var a=c[d];b[d]=a?a.toString():a;}FB.Monitor.log("functions",e.containerName+"."+e.functionName,b);},logXFBML:function(c){var b={};for(var d=0;d<c.attributes.length;++d){var a=c.attributes[d];if(a.specified!==false&&a.nodeName&&a.nodeValue&&a.nodeName!="class")b[a.nodeName]=a.nodeValue.toString();}var e=c.nodeName.toLowerCase();FB.Monitor.log("tags",e,b);},log:function(b,d,a){var c={name:d,args:a};FB.Monitor.loggingQueue[b].push(c);if(!FB.Monitor.pendingTimer){setTimeout(FB.Monitor.send,FB.Monitor.TIMER_INTERVAL);FB.Monitor.pendingTimer=true;}},clearQueues:function(){var a=FB.Monitor.loggingQueue;FB.Monitor.pendingTimer=false;FB.Monitor.loggingQueue={tags:[],functions:[]};return a;},send:function(){if(FB.MonitorSender){FB.bind(FB.MonitorSender.send)();}else{FB.Monitor.TIMER_INTERVAL=FB.Monitor.TIMER_INTERVAL*1.5;setTimeout(FB.Monitor.send,FB.Monitor.TIMER_INTERVAL);}},TIMER_INTERVAL:6*1000,internalCallStackDepth:0,loggingQueue:{tags:[],functions:[]},pendingTimer:false,loggingEnabledCache:null};
if(!window.FB)FB={};FB.forEach=function(c,a,f){if(Object.prototype.toString.apply(c)==='[object Array]'){if(c.forEach){c.forEach(a);}else for(var b=0,e=c.length;b<e;b++)a(c[b],b,c);}else for(var d in c)if(f||c.hasOwnProperty(d))a(c[d],d,c);};FB.copy=function(c,b,a){FB.forEach(b,function(e,d){if(a||typeof c[d]==='undefined')c[d]=e;});};FB.copy(FB,{$:function(a){return document.getElementById(a);},TypeLoader:{NOTIFY:{},LOADED_MODULES:{},LOADED_CLASSES:{},resolve:function(f,e,a){for(var b=0,c=e.length;b<c;b++){var d=e[b];if(d==='')continue;if(typeof f[d]==='undefined')if(a){f[d]={};}else return false;f=f[d];}return f;},provide:function(c,b,a){FB.Monitor.wrapObject(b,c,false);var d=this.resolve(window,c.split('.'),true);if(a||!this.LOADED_MODULES[c]){FB.copy(d,b,true);if(b._onLoad)d._onLoad();}this.LOADED_MODULES[c]=true;},subclass:function(e,a,i){if(this.LOADED_CLASSES[e])return;if(a!=='FB.Class'&&!this.LOADED_CLASSES[a]){FB.Log.debug('"'+e+'" needs to wait for "'+a+'"');var j=FB.redo(arguments,this);this.NOTIFY[a]?this.NOTIFY[a].push(j):this.NOTIFY[a]=[j];return;}var b=this.resolve(window,a.split('.')),f=b.extend(i),g=this.NOTIFY[e],h=e.split('.'),d=this.resolve(window,h,true),c=h.pop();FB.Monitor.wrapObject(f.prototype,e,true);FB.Monitor.wrapObject(f,e,false);FB.copy(f,d);this.resolve(window,h)[c]=f;this.LOADED_CLASSES[e]=true;if(g){FB.forEach(g,function(k){k();});delete this.NOTIFY[e];}}},bind:function(){var a=Array.prototype.slice.call(arguments),c=a.shift(),b=a.shift();var d=function(){++FB.Monitor.internalCallStackDepth;var e=c.apply(b,a.concat(Array.prototype.slice.call(arguments)));--FB.Monitor.internalCallStackDepth;return e;};d._targets=[b,c];return d;},redo:function(a,c){var b=Array.prototype.slice.call(a);b.unshift(c);b.unshift(a.callee);return FB.bind.apply(FB,b);}});FB.provide=FB.bind(FB.TypeLoader.provide,FB.TypeLoader);FB.subclass=FB.bind(FB.TypeLoader.subclass,FB.TypeLoader);
FB.provide('FB.Log',{level:3,Level:{DEBUG:3,INFO:2,WARNING:1,ERROR:0},_helper:function(){var a=Array.prototype.slice.call(arguments),c=a.shift(),b=a.shift();if(this.level>=b&&window.console)(console[c]||console.log).apply(console,a);}});FB.provide('FB.Log',{debug:FB.bind(FB.Log._helper,FB.Log,'debug',FB.Log.Level.DEBUG),info:FB.bind(FB.Log._helper,FB.Log,'info',FB.Log.Level.INFO),warn:FB.bind(FB.Log._helper,FB.Log,'warn',FB.Log.Level.WARNING),error:FB.bind(FB.Log._helper,FB.Log,'error',FB.Log.Level.ERROR)},true);
(function(){var b=false,a=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;FB.Class=function(){};FB.Class.extend=function(e){var d=this.prototype;b=true;var f=new this();b=false;FB.forEach(e,function(h,g){f[g]=typeof h==="function"&&typeof d[g]==="function"&&a.test(h)?(function(j,i){return function(){var l=this._super;this._super=d[j];var k=i.apply(this,arguments);this._super=l;return k;};})(g,h):h;});var c=function(){if(!b){var g;if(this instanceof c){g=this;}else{b=true;g=new c();b=false;}if(g.init)g.init.apply(g,arguments);return g;}};c.prototype=f;c.constructor=c;c.extend=FB.Class.extend;return c;};})();
if(!window.FB)FB={};if(!FB.Type){FB.Type={createNamespace:function(b){var d=window;var c=b.split('.');for(var a=0;a<c.length;a++){var f=c[a];var e=d[f];if(!e)d[f]=e={};d=e;}return d;},createEnum:function(e,c,d){if(this.getObj(e))return;var a=function(){};a.prototype=c;for(var b in c)a[b]=c[b];if(d)a.__flags=true;this.setObj(e,a);},createClass2:function(cls,baseType){if(baseType&&typeof(baseType)=="string")baseType=eval(baseType);cls.prototype.constructor=cls;this.extend(cls,FB.Type.Methods);cls.__baseType=baseType||Object;if(baseType)cls.__basePrototypePending=true;},setObj:function(fullName,value){var i=fullName.lastIndexOf('.');var objName;var scope=window;if(i>0){var ns=fullName.substring(0,i);this.createNamespace(ns);objName=fullName.substring(i+1);scope=eval(ns);}else objName=fullName;scope[objName]=value;},getObj:function(b){var d=window;var c=b.split('.');for(var a=0;a<c.length;a++){var e=c[a];d=d[e];if(!d)break;}return d;},createClass:function(a,b){if(this.getObj(a))return;if(arguments.length==1&&typeof(a)!="string"){return this._createClass(a);}else this.setObj(a,this._createClass(b));},_createClass:function(b){var a=b.ctor||function(){};if(b.static_ctor)this.addStaticInit(b.static_ctor);if(b.instance)a.prototype=b.instance;if(b['static'])this.extend(a,b['static']);this.createClass2(a,b.base);return a;},addStaticInit:function(a){if(!FB.Type._pendingInits)FB.Type._pendingInits=[];FB.Type._pendingInits[FB.Type._pendingInits.length]=a;window.setTimeout(FB.Type.runPendingInits,0);},runPendingInits:function(){if(FB.Type._pendingInits){var b=FB.Type._pendingInits;FB.Type._pendingInits=null;var a=b.length;for(var c=0;c<a;c++)b[c]();}},extend:function(a,c){for(var b in c)a[b]=c[b];return a;},getInstanceType:function(a){return a.constructor;}};FB.Type.Methods={setupBase:function(){if(this.__basePrototypePending){var a=this.__baseType;if(a.__basePrototypePending)a.setupBase();for(var b in a.prototype){var c=a.prototype[b];if(!this.prototype[b])this.prototype[b]=c;}delete this.__basePrototypePending;}},constructBase:function(b,a){if(this.__basePrototypePending)this.setupBase();if(!a){this.__baseType.apply(b);}else this.__baseType.apply(b,a);},callBase:function(c,d,a){var b=this.__baseType.prototype[d];if(!a){return b.apply(c);}else return b.apply(c,a);},get_baseType:function(){return this.__baseType||null;}};}
FB.provide('FB.HiddenContainer',{_onLoad:function(){if(document.getElementById('FB_HiddenContainer')==null){var a;try{var b=window.navigator.userAgent.toLowerCase().indexOf('msie')>=0&&window.attachEvent;if((!b||document.readyState=='completed')&&document.body){a=document.createElement('div');a.id="FB_HiddenContainer";a.style.position="absolute";a.style.top="-10000px";a.style.width="0px";a.style.height="0px";document.body.appendChild(a);}}catch(e){a=null;}if(!a)document.write('<div id="FB_HiddenContainer" '+'style="position:absolute; top:-10000px; left:-10000px; width:0px; height:0px;" >'+'</div>');}},get:function(){return FB.$('FB_HiddenContainer');}});
FB.provide('FB.HiddenContainerLoader',{_onLoad:function(){FB.HiddenContainer.get();}});
FB.subclass('FB.Delegate','FB.Class',{});FB.provide('FB.Delegate',{Null:function(){},_create:function(b){var a=function(){if(b.length==2){return b[1].apply(b[0],arguments);}else{var d=b.slice();for(var c=0;c<d.length;c+=2)d[c+1].apply(d[c],arguments);return null;}};a._targets=b;return a;},create:function(b,a){if(!b)return a;return FB.Delegate._create([b,a]);},combine:function(a,b){if(!a){if(!b._targets)return FB.Delegate.create(null,b);return b;}if(!b){if(!a._targets)return FB.Delegate.create(null,a);return a;}var c=a._targets?a._targets:[null,a];var d=b._targets?b._targets:[null,b];return FB.Delegate._create(c.concat(d));},remove:function(a,b){if(!a||(a===b))return null;if(!b)return a;var f=a._targets;var e=null;var d;if(b._targets){e=b._targets[0];d=b._targets[1];}else d=b;for(var c=0;c<f.length;c+=2)if((f[c]===e)&&(f[c+1]===d)){if(f.length==2)return null;f.splice(c,2);return FB.Delegate._create(f);}return a;}});if(!window.Delegate)window.Delegate=FB.Delegate;
if(!window.FB)FB={};if(!FB.Loader)FB.Loader={loaded:{},loading:{},loadedCss:{},loadedCallback:null,onScriptLoaded:function(b){var a=b.length;for(var c=0;c<a;c++){var d=b[c];FB.Loader.loaded[d]=true;}if(FB.Loader.loadedCallback)window.setTimeout(function(){FB.Loader.loadedCallback(b);},0);},loadCssComps:function(a){var b=FB.Loader.getStaticResourceUrl('connect.php/'+FB.locale+'/css/'+a.join('/'));if(!this.loadedCss[b]){var c=document.createElement('link');c.setAttribute('rel','stylesheet');c.setAttribute('type','text/css');c.setAttribute('href',b);document.getElementsByTagName('head')[0].appendChild(c);this.loadedCss[b]=true;}},getStaticResourceUrl:function(b){var a=FB.dynData.resources.base_url_format;var c=(a.indexOf('https')===0)?'ssl':'static.ak';return a.replace('{0}',c)+b;}};
if(!FB.Bootstrap){FB.Bootstrap={requireFeatures:function(e,c){if(FB.Bootstrap.isXdChannel)return;var i={features:e,callback:FB.Monitor.externalCallback(c),completed:false};if(FB.Bootstrap._checkRequest(i))return;FB.Bootstrap._featureReqQueue.push(i);FB.Loader.loadedCallback=FB.Delegate.combine(FB.Loader.loadedCallback,FB.Bootstrap._onCompLoaded);FB.Bootstrap._transformFeatureList(e);var h={};var a=[];var f;var b=e.length;var g=0;for(f=0;f<b;f++){var d=e[f];if(!(FB.Loader.loaded[d]))if(!(FB.Loader.loaded[d]||FB.Loader.loading[d])){h[d]=true;a[a.length]=d;}}a.sort();var j=FB.Loader.getStaticResourceUrl('connect.php/'+FB.locale+'/js/'+a.join('/'));FB.Bootstrap.addScript(j);},_requireFeatures:function(b,a){this.requireFeatures(b,FB.bind(a));},_checkRequest:function(d){if(!d.completed){var b=0;var e=d.features.length;var c=0;for(b=0;b<e;b++){var a=d.features[b];if(FB.Loader.loaded[a])c++;}if(c==e){d.completed=true;if(d.callback)d.callback(true);}}return d.completed;},_transformFeatureList:function(b){var c={Api:true,CanvasUtil:true,Connect:true,XFBML:true};var a=b.length;var g=false;var f={};for(var d=0;d<a;d++){f[b[d]]=true;if(c[b[d]])g=true;}if(g)for(var e in c)if(!f[e])b[b.length]=e;},ensureInit:function(a){if(!a)throw ("FB.ensureInit called without a valid callback");a=FB.Monitor.externalCallback(a);if(FB.Facebook&&FB.Facebook.get_initialized&&FB.Facebook.get_initialized().get_isReady()&&FB.Facebook.get_initialized().result)return a();FB.Bootstrap._requireFeatures(FB.Bootstrap.features,function(){FB.Facebook.get_initialized().waitForValue(true,a);});},init:function(a,c,b){FB.Bootstrap._requireFeatures(FB.Bootstrap.features,function(){if(FB.Facebook)FB.Facebook.init(a,c,b);});},addScript:function(f){var d;var e=document.getElementsByTagName('script');if(e){var a=e.length;for(var b=0;b<a;b++){d=e[b];if(d.src==f)return;}}d=document.createElement("script");d.type="text/javascript";d.src=f;var c=document.getElementsByTagName('HEAD')[0]||document.body;c.appendChild(d);},setLocale:function(b,a){window.FB.locale=b;window.FB.localeIsRTL=a;},_initializeXdChannel:function(){FB.Bootstrap.isXdChannel=window.location.search.indexOf(FB.Bootstrap.fbc_channel_token)>=0;},_detectDocumentNamespaces:function(){if(document.namespaces&&!document.namespaces.item['fb'])document.namespaces.add('fb');},createDefaultXdChannelUrl:function(){var a=location.protocol+'//'+location.hostname+location.pathname+location.search;if(location.search||location.search.length>0){a+='&';}else a+='?';a+='fbc_channel=1';return a;},_onCompLoaded:function(){var b=0;var a=FB.Bootstrap._featureReqQueue.length;for(b=0;b<a;b++)FB.Bootstrap._checkRequest(FB.Bootstrap._featureReqQueue[b]);},_onLoad:function(){this._initializeXdChannel();this._detectDocumentNamespaces();},features:["XFBML","CanvasUtil"],fbc_channel_token:'fbc_channel=1',_featureReqQueue:[]};FB.Monitor.wrapObject(FB.Bootstrap,'FB.Bootstrap');window.FB_RequireFeatures=FB.Bootstrap.requireFeatures;window.FB.init=FB.Bootstrap.init;window.FB.ensureInit=FB.Bootstrap.ensureInit;FB.Bootstrap._onLoad();}
if(!window.FBIntern)FBIntern={};if(!FBIntern.XdReceiver){FBIntern.XdReceiver={delay:100,timerId:-1,dispatchMessage:function(){var i=document.URL;var e=i.indexOf('#');var d;if(e>0){d=i.substring(e+1);}else{e=i.indexOf('fb_login&');if(e>0){d=i.substring(e+9);}else return;}var a='debug=1&';if(d.indexOf(a)==0)d=d.substring(a.length);var h;var c=null;try{var f=window.parent;if(d.indexOf('fname=')==0){var g=d.indexOf('&');var b=d.substr(6,g-6);if(b=="_opener"){f=f.opener;}else if(b=="_oparen"){f=f.opener.parent;}else if(b!="_parent")f=f.frames[b];h=d.substr(g+1);}else{f=f.parent;h=d;}c=f.FB.XdComm.Server.singleton.onReceiverLoaded;}catch(e){if(e.number==-2146828218)return;}if(c){f.FB.XdComm.Server.singleton.onReceiverLoaded(h);if(FBIntern.XdReceiver.timerId!=-1){window.clearInterval(FBIntern.XdReceiver.timerId);FBIntern.XdReceiver.timerId=-1;}}else if(FBIntern.XdReceiver.timerId==-1)try{FBIntern.XdReceiver.timerId=window.setInterval(FBIntern.XdReceiver.dispatchMessage,FBIntern.XdReceiver.delay);}catch(e){}}};if(!(window.FB&&FB.Bootstrap&&!FB.Bootstrap.isXdChannel))try{FBIntern.XdReceiver.dispatchMessage();}catch(e){}}(function(){var c=document.getElementsByTagName('script');var d=c[c.length-1];if(d!=undefined){var a=d.getAttribute('fb-api-key');var b=d.getAttribute('fb-xd-receiver');if(a!=null)window.setTimeout(function(){FB.init(a,b);},0);}})();

if (FB && FB.Loader) { FB.Loader.onScriptLoaded(["FB.monitor-wrapper","FB.Prelude","FB.Log","FB.Class","FB.Type","FB.HiddenContainer","FB.HiddenContainerLoader","FB.Delegate","FB.Loader","FB.Bootstrap","XdCommReceiver"]); }



var MooTools={"version":"1.2.4","build":"0d9113241a90b9cd5643b926795852a2026710d4"};var Native=function(options){options=options||{};var name=options.name;var legacy=options.legacy;var protect=options.protect;var methods=options.implement;var generics=options.generics;var initialize=options.initialize;var afterImplement=options.afterImplement||function(){};var object=initialize||legacy;generics=generics!==false;object.constructor=Native;object.$family={name:"native"};if(legacy&&initialize){object.prototype=legacy.prototype;}object.prototype.constructor=object;if(name){var family=name.toLowerCase();object.prototype.$family={name:family};Native.typize(object,family);}var add=function(obj,name,method,force){if(!protect||force||!obj.prototype[name]){obj.prototype[name]=method;}if(generics){Native.genericize(obj,name,protect);}afterImplement.call(obj,name,method);return obj;};object.alias=function(a1,a2,a3){if(typeof a1=="string"){var pa1=this.prototype[a1];if((a1=pa1)){return add(this,a2,a1,a3);}}for(var a in a1){this.alias(a,a1[a],a2);}return this;};object.implement=function(a1,a2,a3){if(typeof a1=="string"){return add(this,a1,a2,a3);}for(var p in a1){add(this,p,a1[p],a2);}return this;};if(methods){object.implement(methods);}return object;};Native.genericize=function(object,property,check){if((!check||!object[property])&&typeof object.prototype[property]=="function"){object[property]=function(){var args=Array.prototype.slice.call(arguments);return object.prototype[property].apply(args.shift(),args);};}};Native.implement=function(objects,properties){for(var i=0,l=objects.length;i<l;i++){objects[i].implement(properties);}};Native.typize=function(object,family){if(!object.type){object.type=function(item){return($type(item)===family);};}};(function(){var natives={"Array":Array,"Date":Date,"Function":Function,"Number":Number,"RegExp":RegExp,"String":String};for(var n in natives){new Native({name:n,initialize:natives[n],protect:true});}var types={"boolean":Boolean,"native":Native,"object":Object};for(var t in types){Native.typize(types[t],t);}var generics={"Array":["concat","indexOf","join","lastIndexOf","pop","push","reverse","shift","slice","sort","splice","toString","unshift","valueOf"],"String":["charAt","charCodeAt","concat","indexOf","lastIndexOf","match","replace","search","slice","split","substr","substring","toLowerCase","toUpperCase","valueOf"]};for(var g in generics){for(var i=generics[g].length;i--;){Native.genericize(natives[g],generics[g][i],true);}}})();var Hash=new Native({name:"Hash",initialize:function(object){if($type(object)=="hash"){object=$unlink(object.getClean());}for(var key in object){this[key]=object[key];}return this;}});Hash.implement({forEach:function(fn,bind){for(var key in this){if(this.hasOwnProperty(key)){fn.call(bind,this[key],key,this);}}},getClean:function(){var clean={};for(var key in this){if(this.hasOwnProperty(key)){clean[key]=this[key];}}return clean;},getLength:function(){var length=0;for(var key in this){if(this.hasOwnProperty(key)){length++;}}return length;}});Hash.alias("forEach","each");Array.implement({forEach:function(fn,bind){for(var i=0,l=this.length;i<l;i++){fn.call(bind,this[i],i,this);}}});Array.alias("forEach","each");function $A(iterable){if(iterable.item){var l=iterable.length,array=new Array(l);while(l--){array[l]=iterable[l];}return array;}return Array.prototype.slice.call(iterable);}function $arguments(i){return function(){return arguments[i];};}function $chk(obj){return !!(obj||obj===0);}function $clear(timer){clearTimeout(timer);clearInterval(timer);return null;}function $defined(obj){return(obj!=undefined);}function $each(iterable,fn,bind){var type=$type(iterable);((type=="arguments"||type=="collection"||type=="array")?Array:Hash).each(iterable,fn,bind);}function $empty(){}function $extend(original,extended){for(var key in (extended||{})){original[key]=extended[key];}return original;}function $H(object){return new Hash(object);}function $lambda(value){return($type(value)=="function")?value:function(){return value;};}function $merge(){var args=Array.slice(arguments);args.unshift({});return $mixin.apply(null,args);}function $mixin(mix){for(var i=1,l=arguments.length;i<l;i++){var object=arguments[i];if($type(object)!="object"){continue;}for(var key in object){var op=object[key],mp=mix[key];mix[key]=(mp&&$type(op)=="object"&&$type(mp)=="object")?$mixin(mp,op):$unlink(op);}}return mix;}function $pick(){for(var i=0,l=arguments.length;i<l;i++){if(arguments[i]!=undefined){return arguments[i];}}return null;}function $random(min,max){return Math.floor(Math.random()*(max-min+1)+min);}function $splat(obj){var type=$type(obj);return(type)?((type!="array"&&type!="arguments")?[obj]:obj):[];}var $time=Date.now||function(){return +new Date;};function $try(){for(var i=0,l=arguments.length;i<l;i++){try{return arguments[i]();}catch(e){}}return null;}function $type(obj){if(obj==undefined){return false;}if(obj.$family){return(obj.$family.name=="number"&&!isFinite(obj))?false:obj.$family.name;}if(obj.nodeName){switch(obj.nodeType){case 1:return"element";case 3:return(/\S/).test(obj.nodeValue)?"textnode":"whitespace";}}else{if(typeof obj.length=="number"){if(obj.callee){return"arguments";}else{if(obj.item){return"collection";}}}}return typeof obj;}function $unlink(object){var unlinked;switch($type(object)){case"object":unlinked={};for(var p in object){unlinked[p]=$unlink(object[p]);}break;case"hash":unlinked=new Hash(object);break;case"array":unlinked=[];for(var i=0,l=object.length;i<l;i++){unlinked[i]=$unlink(object[i]);}break;default:return object;}return unlinked;}var Browser=$merge({Engine:{name:"unknown",version:0},Platform:{name:(window.orientation!=undefined)?"ipod":(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase()},Features:{xpath:!!(document.evaluate),air:!!(window.runtime),query:!!(document.querySelector)},Plugins:{},Engines:{presto:function(){return(!window.opera)?false:((arguments.callee.caller)?960:((document.getElementsByClassName)?950:925));},trident:function(){return(!window.ActiveXObject)?false:((window.XMLHttpRequest)?((document.querySelectorAll)?6:5):4);},webkit:function(){return(navigator.taintEnabled)?false:((Browser.Features.xpath)?((Browser.Features.query)?525:420):419);},gecko:function(){return(!document.getBoxObjectFor&&window.mozInnerScreenX==null)?false:((document.getElementsByClassName)?19:18);}}},Browser||{});Browser.Platform[Browser.Platform.name]=true;Browser.detect=function(){for(var engine in this.Engines){var version=this.Engines[engine]();if(version){this.Engine={name:engine,version:version};this.Engine[engine]=this.Engine[engine+version]=true;break;}}return{name:engine,version:version};};Browser.detect();Browser.Request=function(){return $try(function(){return new XMLHttpRequest();},function(){return new ActiveXObject("MSXML2.XMLHTTP");},function(){return new ActiveXObject("Microsoft.XMLHTTP");});};Browser.Features.xhr=!!(Browser.Request());Browser.Plugins.Flash=(function(){var version=($try(function(){return navigator.plugins["Shockwave Flash"].description;},function(){return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version");})||"0 r0").match(/\d+/g);return{version:parseInt(version[0]||0+"."+version[1],10)||0,build:parseInt(version[2],10)||0};})();function $exec(text){if(!text){return text;}if(window.execScript){window.execScript(text);}else{var script=document.createElement("script");script.setAttribute("type","text/javascript");script[(Browser.Engine.webkit&&Browser.Engine.version<420)?"innerText":"text"]=text;document.head.appendChild(script);document.head.removeChild(script);}return text;}Native.UID=1;var $uid=(Browser.Engine.trident)?function(item){return(item.uid||(item.uid=[Native.UID++]))[0];}:function(item){return item.uid||(item.uid=Native.UID++);};var Window=new Native({name:"Window",legacy:(Browser.Engine.trident)?null:window.Window,initialize:function(win){$uid(win);if(!win.Element){win.Element=$empty;if(Browser.Engine.webkit){win.document.createElement("iframe");}win.Element.prototype=(Browser.Engine.webkit)?window["[[DOMElement.prototype]]"]:{};}win.document.window=win;return $extend(win,Window.Prototype);},afterImplement:function(property,value){window[property]=Window.Prototype[property]=value;}});Window.Prototype={$family:{name:"window"}};new Window(window);var Document=new Native({name:"Document",legacy:(Browser.Engine.trident)?null:window.Document,initialize:function(doc){$uid(doc);doc.head=doc.getElementsByTagName("head")[0];doc.html=doc.getElementsByTagName("html")[0];if(Browser.Engine.trident&&Browser.Engine.version<=4){$try(function(){doc.execCommand("BackgroundImageCache",false,true);});}if(Browser.Engine.trident){doc.window.attachEvent("onunload",function(){doc.window.detachEvent("onunload",arguments.callee);doc.head=doc.html=doc.window=null;});}return $extend(doc,Document.Prototype);},afterImplement:function(property,value){document[property]=Document.Prototype[property]=value;}});Document.Prototype={$family:{name:"document"}};new Document(document);Array.implement({every:function(fn,bind){for(var i=0,l=this.length;i<l;i++){if(!fn.call(bind,this[i],i,this)){return false;}}return true;},filter:function(fn,bind){var results=[];for(var i=0,l=this.length;i<l;i++){if(fn.call(bind,this[i],i,this)){results.push(this[i]);}}return results;},clean:function(){return this.filter($defined);},indexOf:function(item,from){var len=this.length;for(var i=(from<0)?Math.max(0,len+from):from||0;i<len;i++){if(this[i]===item){return i;}}return -1;},map:function(fn,bind){var results=[];for(var i=0,l=this.length;i<l;i++){results[i]=fn.call(bind,this[i],i,this);}return results;},some:function(fn,bind){for(var i=0,l=this.length;i<l;i++){if(fn.call(bind,this[i],i,this)){return true;}}return false;},associate:function(keys){var obj={},length=Math.min(this.length,keys.length);for(var i=0;i<length;i++){obj[keys[i]]=this[i];}return obj;},link:function(object){var result={};for(var i=0,l=this.length;i<l;i++){for(var key in object){if(object[key](this[i])){result[key]=this[i];delete object[key];break;}}}return result;},contains:function(item,from){return this.indexOf(item,from)!=-1;},extend:function(array){for(var i=0,j=array.length;i<j;i++){this.push(array[i]);}return this;},getLast:function(){return(this.length)?this[this.length-1]:null;},getRandom:function(){return(this.length)?this[$random(0,this.length-1)]:null;},include:function(item){if(!this.contains(item)){this.push(item);}return this;},combine:function(array){for(var i=0,l=array.length;i<l;i++){this.include(array[i]);}return this;},erase:function(item){for(var i=this.length;i--;i){if(this[i]===item){this.splice(i,1);}}return this;},empty:function(){this.length=0;return this;},flatten:function(){var array=[];for(var i=0,l=this.length;i<l;i++){var type=$type(this[i]);if(!type){continue;}array=array.concat((type=="array"||type=="collection"||type=="arguments")?Array.flatten(this[i]):this[i]);}return array;},hexToRgb:function(array){if(this.length!=3){return null;}var rgb=this.map(function(value){if(value.length==1){value+=value;}return value.toInt(16);});return(array)?rgb:"rgb("+rgb+")";},rgbToHex:function(array){if(this.length<3){return null;}if(this.length==4&&this[3]==0&&!array){return"transparent";}var hex=[];for(var i=0;i<3;i++){var bit=(this[i]-0).toString(16);hex.push((bit.length==1)?"0"+bit:bit);}return(array)?hex:"#"+hex.join("");}});Function.implement({extend:function(properties){for(var property in properties){this[property]=properties[property];}return this;},create:function(options){var self=this;options=options||{};return function(event){var args=options.arguments;args=(args!=undefined)?$splat(args):Array.slice(arguments,(options.event)?1:0);if(options.event){args=[event||window.event].extend(args);}var returns=function(){return self.apply(options.bind||null,args);};if(options.delay){return setTimeout(returns,options.delay);}if(options.periodical){return setInterval(returns,options.periodical);}if(options.attempt){return $try(returns);}return returns();};},run:function(args,bind){return this.apply(bind,$splat(args));},pass:function(args,bind){return this.create({bind:bind,arguments:args});},bind:function(bind,args){return this.create({bind:bind,arguments:args});},bindWithEvent:function(bind,args){return this.create({bind:bind,arguments:args,event:true});},attempt:function(args,bind){return this.create({bind:bind,arguments:args,attempt:true})();},delay:function(delay,bind,args){return this.create({bind:bind,arguments:args,delay:delay})();},periodical:function(periodical,bind,args){return this.create({bind:bind,arguments:args,periodical:periodical})();}});Number.implement({limit:function(min,max){return Math.min(max,Math.max(min,this));},round:function(precision){precision=Math.pow(10,precision||0);return Math.round(this*precision)/precision;},times:function(fn,bind){for(var i=0;i<this;i++){fn.call(bind,i,this);}},toFloat:function(){return parseFloat(this);},toInt:function(base){return parseInt(this,base||10);}});Number.alias("times","each");(function(math){var methods={};math.each(function(name){if(!Number[name]){methods[name]=function(){return Math[name].apply(null,[this].concat($A(arguments)));};}});Number.implement(methods);})(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]);String.implement({test:function(regex,params){return((typeof regex=="string")?new RegExp(regex,params):regex).test(this);},contains:function(string,separator){return(separator)?(separator+this+separator).indexOf(separator+string+separator)>-1:this.indexOf(string)>-1;},trim:function(){return this.replace(/^\s+|\s+$/g,"");},clean:function(){return this.replace(/\s+/g," ").trim();},camelCase:function(){return this.replace(/-\D/g,function(match){return match.charAt(1).toUpperCase();});},hyphenate:function(){return this.replace(/[A-Z]/g,function(match){return("-"+match.charAt(0).toLowerCase());});},capitalize:function(){return this.replace(/\b[a-z]/g,function(match){return match.toUpperCase();});},escapeRegExp:function(){return this.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1");},toInt:function(base){return parseInt(this,base||10);},toFloat:function(){return parseFloat(this);},hexToRgb:function(array){var hex=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return(hex)?hex.slice(1).hexToRgb(array):null;},rgbToHex:function(array){var rgb=this.match(/\d{1,3}/g);return(rgb)?rgb.rgbToHex(array):null;},stripScripts:function(option){var scripts="";var text=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(){scripts+=arguments[1]+"\n";return"";});if(option===true){$exec(scripts);}else{if($type(option)=="function"){option(scripts,text);}}return text;},substitute:function(object,regexp){return this.replace(regexp||(/\\?\{([^{}]+)\}/g),function(match,name){if(match.charAt(0)=="\\"){return match.slice(1);}return(object[name]!=undefined)?object[name]:"";});}});Hash.implement({has:Object.prototype.hasOwnProperty,keyOf:function(value){for(var key in this){if(this.hasOwnProperty(key)&&this[key]===value){return key;}}return null;},hasValue:function(value){return(Hash.keyOf(this,value)!==null);},extend:function(properties){Hash.each(properties||{},function(value,key){Hash.set(this,key,value);},this);return this;},combine:function(properties){Hash.each(properties||{},function(value,key){Hash.include(this,key,value);},this);return this;},erase:function(key){if(this.hasOwnProperty(key)){delete this[key];}return this;},get:function(key){return(this.hasOwnProperty(key))?this[key]:null;},set:function(key,value){if(!this[key]||this.hasOwnProperty(key)){this[key]=value;}return this;},empty:function(){Hash.each(this,function(value,key){delete this[key];},this);return this;},include:function(key,value){if(this[key]==undefined){this[key]=value;}return this;},map:function(fn,bind){var results=new Hash;Hash.each(this,function(value,key){results.set(key,fn.call(bind,value,key,this));},this);return results;},filter:function(fn,bind){var results=new Hash;Hash.each(this,function(value,key){if(fn.call(bind,value,key,this)){results.set(key,value);}},this);return results;},every:function(fn,bind){for(var key in this){if(this.hasOwnProperty(key)&&!fn.call(bind,this[key],key)){return false;}}return true;},some:function(fn,bind){for(var key in this){if(this.hasOwnProperty(key)&&fn.call(bind,this[key],key)){return true;}}return false;},getKeys:function(){var keys=[];Hash.each(this,function(value,key){keys.push(key);});return keys;},getValues:function(){var values=[];Hash.each(this,function(value){values.push(value);});return values;},toQueryString:function(base){var queryString=[];Hash.each(this,function(value,key){if(base){key=base+"["+key+"]";}var result;switch($type(value)){case"object":result=Hash.toQueryString(value,key);break;case"array":var qs={};value.each(function(val,i){qs[i]=val;});result=Hash.toQueryString(qs,key);break;default:result=key+"="+encodeURIComponent(value);}if(value!=undefined){queryString.push(result);}});return queryString.join("&");}});Hash.alias({keyOf:"indexOf",hasValue:"contains"});var Event=new Native({name:"Event",initialize:function(event,win){win=win||window;var doc=win.document;event=event||win.event;if(event.$extended){return event;}this.$extended=true;var type=event.type;var target=event.target||event.srcElement;while(target&&target.nodeType==3){target=target.parentNode;}if(type.test(/key/)){var code=event.which||event.keyCode;var key=Event.Keys.keyOf(code);if(type=="keydown"){var fKey=code-111;if(fKey>0&&fKey<13){key="f"+fKey;}}key=key||String.fromCharCode(code).toLowerCase();}else{if(type.match(/(click|mouse|menu)/i)){doc=(!doc.compatMode||doc.compatMode=="CSS1Compat")?doc.html:doc.body;var page={x:event.pageX||event.clientX+doc.scrollLeft,y:event.pageY||event.clientY+doc.scrollTop};var client={x:(event.pageX)?event.pageX-win.pageXOffset:event.clientX,y:(event.pageY)?event.pageY-win.pageYOffset:event.clientY};if(type.match(/DOMMouseScroll|mousewheel/)){var wheel=(event.wheelDelta)?event.wheelDelta/120:-(event.detail||0)/3;}var rightClick=(event.which==3)||(event.button==2);var related=null;if(type.match(/over|out/)){switch(type){case"mouseover":related=event.relatedTarget||event.fromElement;break;case"mouseout":related=event.relatedTarget||event.toElement;}if(!(function(){while(related&&related.nodeType==3){related=related.parentNode;}return true;}).create({attempt:Browser.Engine.gecko})()){related=false;}}}}return $extend(this,{event:event,type:type,page:page,client:client,rightClick:rightClick,wheel:wheel,relatedTarget:related,target:target,code:code,key:key,shift:event.shiftKey,control:event.ctrlKey,alt:event.altKey,meta:event.metaKey});}});Event.Keys=new Hash({"enter":13,"up":38,"down":40,"left":37,"right":39,"esc":27,"space":32,"backspace":8,"tab":9,"delete":46});Event.implement({stop:function(){return this.stopPropagation().preventDefault();},stopPropagation:function(){if(this.event.stopPropagation){this.event.stopPropagation();}else{this.event.cancelBubble=true;}return this;},preventDefault:function(){if(this.event.preventDefault){this.event.preventDefault();}else{this.event.returnValue=false;}return this;}});function Class(params){if(params instanceof Function){params={initialize:params};}var newClass=function(){Object.reset(this);if(newClass._prototyping){return this;}this._current=$empty;var value=(this.initialize)?this.initialize.apply(this,arguments):this;delete this._current;delete this.caller;return value;}.extend(this);newClass.implement(params);newClass.constructor=Class;newClass.prototype.constructor=newClass;return newClass;}Function.prototype.protect=function(){this._protected=true;return this;};Object.reset=function(object,key){if(key==null){for(var p in object){Object.reset(object,p);}return object;}delete object[key];switch($type(object[key])){case"object":var F=function(){};F.prototype=object[key];var i=new F;object[key]=Object.reset(i);break;case"array":object[key]=$unlink(object[key]);break;}return object;};new Native({name:"Class",initialize:Class}).extend({instantiate:function(F){F._prototyping=true;var proto=new F;delete F._prototyping;return proto;},wrap:function(self,key,method){if(method._origin){method=method._origin;}return function(){if(method._protected&&this._current==null){throw new Error('The method "'+key+'" cannot be called.');}var caller=this.caller,current=this._current;this.caller=current;this._current=arguments.callee;var result=method.apply(this,arguments);this._current=current;this.caller=caller;return result;}.extend({_owner:self,_origin:method,_name:key});}});Class.implement({implement:function(key,value){if($type(key)=="object"){for(var p in key){this.implement(p,key[p]);}return this;}var mutator=Class.Mutators[key];if(mutator){value=mutator.call(this,value);if(value==null){return this;}}var proto=this.prototype;switch($type(value)){case"function":if(value._hidden){return this;}proto[key]=Class.wrap(this,key,value);break;case"object":var previous=proto[key];if($type(previous)=="object"){$mixin(previous,value);}else{proto[key]=$unlink(value);}break;case"array":proto[key]=$unlink(value);break;default:proto[key]=value;}return this;}});Class.Mutators={Extends:function(parent){this.parent=parent;this.prototype=Class.instantiate(parent);this.implement("parent",function(){var name=this.caller._name,previous=this.caller._owner.parent.prototype[name];if(!previous){throw new Error('The method "'+name+'" has no parent.');}return previous.apply(this,arguments);}.protect());},Implements:function(items){$splat(items).each(function(item){if(item instanceof Function){item=Class.instantiate(item);}this.implement(item);},this);}};var Chain=new Class({$chain:[],chain:function(){this.$chain.extend(Array.flatten(arguments));return this;},callChain:function(){return(this.$chain.length)?this.$chain.shift().apply(this,arguments):false;},clearChain:function(){this.$chain.empty();return this;}});var Events=new Class({$events:{},addEvent:function(type,fn,internal){type=Events.removeOn(type);if(fn!=$empty){this.$events[type]=this.$events[type]||[];this.$events[type].include(fn);if(internal){fn.internal=true;}}return this;},addEvents:function(events){for(var type in events){this.addEvent(type,events[type]);}return this;},fireEvent:function(type,args,delay){type=Events.removeOn(type);if(!this.$events||!this.$events[type]){return this;}this.$events[type].each(function(fn){fn.create({"bind":this,"delay":delay,"arguments":args})();},this);return this;},removeEvent:function(type,fn){type=Events.removeOn(type);if(!this.$events[type]){return this;}if(!fn.internal){this.$events[type].erase(fn);}return this;},removeEvents:function(events){var type;if($type(events)=="object"){for(type in events){this.removeEvent(type,events[type]);}return this;}if(events){events=Events.removeOn(events);}for(type in this.$events){if(events&&events!=type){continue;}var fns=this.$events[type];for(var i=fns.length;i--;i){this.removeEvent(type,fns[i]);}}return this;}});Events.removeOn=function(string){return string.replace(/^on([A-Z])/,function(full,first){return first.toLowerCase();});};var Options=new Class({setOptions:function(){this.options=$merge.run([this.options].extend(arguments));if(!this.addEvent){return this;}for(var option in this.options){if($type(this.options[option])!="function"||!(/^on[A-Z]/).test(option)){continue;}this.addEvent(option,this.options[option]);delete this.options[option];}return this;}});var Element=new Native({name:"Element",legacy:window.Element,initialize:function(tag,props){var konstructor=Element.Constructors.get(tag);if(konstructor){return konstructor(props);}if(typeof tag=="string"){return document.newElement(tag,props);}return document.id(tag).set(props);},afterImplement:function(key,value){Element.Prototype[key]=value;if(Array[key]){return;}Elements.implement(key,function(){var items=[],elements=true;for(var i=0,j=this.length;i<j;i++){var returns=this[i][key].apply(this[i],arguments);items.push(returns);if(elements){elements=($type(returns)=="element");}}return(elements)?new Elements(items):items;});}});Element.Prototype={$family:{name:"element"}};Element.Constructors=new Hash;var IFrame=new Native({name:"IFrame",generics:false,initialize:function(){var params=Array.link(arguments,{properties:Object.type,iframe:$defined});var props=params.properties||{};var iframe=document.id(params.iframe);var onload=props.onload||$empty;delete props.onload;props.id=props.name=$pick(props.id,props.name,iframe?(iframe.id||iframe.name):"IFrame_"+$time());iframe=new Element(iframe||"iframe",props);var onFrameLoad=function(){var host=$try(function(){return iframe.contentWindow.location.host;});if(!host||host==window.location.host){var win=new Window(iframe.contentWindow);new Document(iframe.contentWindow.document);$extend(win.Element.prototype,Element.Prototype);}onload.call(iframe.contentWindow,iframe.contentWindow.document);};var contentWindow=$try(function(){return iframe.contentWindow;});((contentWindow&&contentWindow.document.body)||window.frames[props.id])?onFrameLoad():iframe.addListener("load",onFrameLoad);return iframe;}});var Elements=new Native({initialize:function(elements,options){options=$extend({ddup:true,cash:true},options);elements=elements||[];if(options.ddup||options.cash){var uniques={},returned=[];for(var i=0,l=elements.length;i<l;i++){var el=document.id(elements[i],!options.cash);if(options.ddup){if(uniques[el.uid]){continue;}uniques[el.uid]=true;}if(el){returned.push(el);}}elements=returned;}return(options.cash)?$extend(elements,this):elements;}});Elements.implement({filter:function(filter,bind){if(!filter){return this;}return new Elements(Array.filter(this,(typeof filter=="string")?function(item){return item.match(filter);}:filter,bind));}});Document.implement({newElement:function(tag,props){if(Browser.Engine.trident&&props){["name","type","checked"].each(function(attribute){if(!props[attribute]){return;}tag+=" "+attribute+'="'+props[attribute]+'"';if(attribute!="checked"){delete props[attribute];}});tag="<"+tag+">";}return document.id(this.createElement(tag)).set(props);},newTextNode:function(text){return this.createTextNode(text);},getDocument:function(){return this;},getWindow:function(){return this.window;},id:(function(){var types={string:function(id,nocash,doc){id=doc.getElementById(id);return(id)?types.element(id,nocash):null;},element:function(el,nocash){$uid(el);if(!nocash&&!el.$family&&!(/^object|embed$/i).test(el.tagName)){var proto=Element.Prototype;for(var p in proto){el[p]=proto[p];}}return el;},object:function(obj,nocash,doc){if(obj.toElement){return types.element(obj.toElement(doc),nocash);}return null;}};types.textnode=types.whitespace=types.window=types.document=$arguments(0);return function(el,nocash,doc){if(el&&el.$family&&el.uid){return el;}var type=$type(el);return(types[type])?types[type](el,nocash,doc||document):null;};})()});if(window.$==null){Window.implement({$:function(el,nc){return document.id(el,nc,this.document);}});}Window.implement({$$:function(selector){if(arguments.length==1&&typeof selector=="string"){return this.document.getElements(selector);}var elements=[];var args=Array.flatten(arguments);for(var i=0,l=args.length;i<l;i++){var item=args[i];switch($type(item)){case"element":elements.push(item);break;case"string":elements.extend(this.document.getElements(item,true));}}return new Elements(elements);},getDocument:function(){return this.document;},getWindow:function(){return this;}});Native.implement([Element,Document],{getElement:function(selector,nocash){return document.id(this.getElements(selector,true)[0]||null,nocash);},getElements:function(tags,nocash){tags=tags.split(",");var elements=[];var ddup=(tags.length>1);tags.each(function(tag){var partial=this.getElementsByTagName(tag.trim());(ddup)?elements.extend(partial):elements=partial;},this);return new Elements(elements,{ddup:ddup,cash:!nocash});}});(function(){var collected={},storage={};var props={input:"checked",option:"selected",textarea:(Browser.Engine.webkit&&Browser.Engine.version<420)?"innerHTML":"value"};var get=function(uid){return(storage[uid]||(storage[uid]={}));};var clean=function(item,retain){if(!item){return;}var uid=item.uid;if(Browser.Engine.trident){if(item.clearAttributes){var clone=retain&&item.cloneNode(false);item.clearAttributes();if(clone){item.mergeAttributes(clone);}}else{if(item.removeEvents){item.removeEvents();}}if((/object/i).test(item.tagName)){for(var p in item){if(typeof item[p]=="function"){item[p]=$empty;}}Element.dispose(item);}}if(!uid){return;}collected[uid]=storage[uid]=null;};var purge=function(){Hash.each(collected,clean);if(Browser.Engine.trident){$A(document.getElementsByTagName("object")).each(clean);}if(window.CollectGarbage){CollectGarbage();}collected=storage=null;};var walk=function(element,walk,start,match,all,nocash){var el=element[start||walk];var elements=[];while(el){if(el.nodeType==1&&(!match||Element.match(el,match))){if(!all){return document.id(el,nocash);}elements.push(el);}el=el[walk];}return(all)?new Elements(elements,{ddup:false,cash:!nocash}):null;};var attributes={"html":"innerHTML","class":"className","for":"htmlFor","defaultValue":"defaultValue","text":(Browser.Engine.trident||(Browser.Engine.webkit&&Browser.Engine.version<420))?"innerText":"textContent"};var bools=["compact","nowrap","ismap","declare","noshade","checked","disabled","readonly","multiple","selected","noresize","defer"];var camels=["value","type","defaultValue","accessKey","cellPadding","cellSpacing","colSpan","frameBorder","maxLength","readOnly","rowSpan","tabIndex","useMap"];bools=bools.associate(bools);Hash.extend(attributes,bools);Hash.extend(attributes,camels.associate(camels.map(String.toLowerCase)));var inserters={before:function(context,element){if(element.parentNode){element.parentNode.insertBefore(context,element);}},after:function(context,element){if(!element.parentNode){return;}var next=element.nextSibling;(next)?element.parentNode.insertBefore(context,next):element.parentNode.appendChild(context);},bottom:function(context,element){element.appendChild(context);},top:function(context,element){var first=element.firstChild;(first)?element.insertBefore(context,first):element.appendChild(context);}};inserters.inside=inserters.bottom;Hash.each(inserters,function(inserter,where){where=where.capitalize();Element.implement("inject"+where,function(el){inserter(this,document.id(el,true));return this;});Element.implement("grab"+where,function(el){inserter(document.id(el,true),this);return this;});});Element.implement({set:function(prop,value){switch($type(prop)){case"object":for(var p in prop){this.set(p,prop[p]);}break;case"string":var property=Element.Properties.get(prop);(property&&property.set)?property.set.apply(this,Array.slice(arguments,1)):this.setProperty(prop,value);}return this;},get:function(prop){var property=Element.Properties.get(prop);return(property&&property.get)?property.get.apply(this,Array.slice(arguments,1)):this.getProperty(prop);},erase:function(prop){var property=Element.Properties.get(prop);(property&&property.erase)?property.erase.apply(this):this.removeProperty(prop);return this;},setProperty:function(attribute,value){var key=attributes[attribute];if(value==undefined){return this.removeProperty(attribute);}if(key&&bools[attribute]){value=!!value;}(key)?this[key]=value:this.setAttribute(attribute,""+value);return this;},setProperties:function(attributes){for(var attribute in attributes){this.setProperty(attribute,attributes[attribute]);}return this;},getProperty:function(attribute){var key=attributes[attribute];var value=(key)?this[key]:this.getAttribute(attribute,2);return(bools[attribute])?!!value:(key)?value:value||null;},getProperties:function(){var args=$A(arguments);return args.map(this.getProperty,this).associate(args);},removeProperty:function(attribute){var key=attributes[attribute];(key)?this[key]=(key&&bools[attribute])?false:"":this.removeAttribute(attribute);return this;},removeProperties:function(){Array.each(arguments,this.removeProperty,this);return this;},hasClass:function(className){return this.className.contains(className," ");},addClass:function(className){if(!this.hasClass(className)){this.className=(this.className+" "+className).clean();}return this;},removeClass:function(className){this.className=this.className.replace(new RegExp("(^|\\s)"+className+"(?:\\s|$)"),"$1");return this;},toggleClass:function(className){return this.hasClass(className)?this.removeClass(className):this.addClass(className);},adopt:function(){Array.flatten(arguments).each(function(element){element=document.id(element,true);if(element){this.appendChild(element);}},this);return this;},appendText:function(text,where){return this.grab(this.getDocument().newTextNode(text),where);},grab:function(el,where){inserters[where||"bottom"](document.id(el,true),this);return this;},inject:function(el,where){inserters[where||"bottom"](this,document.id(el,true));return this;},replaces:function(el){el=document.id(el,true);el.parentNode.replaceChild(this,el);return this;},wraps:function(el,where){el=document.id(el,true);return this.replaces(el).grab(el,where);},getPrevious:function(match,nocash){return walk(this,"previousSibling",null,match,false,nocash);},getAllPrevious:function(match,nocash){return walk(this,"previousSibling",null,match,true,nocash);},getNext:function(match,nocash){return walk(this,"nextSibling",null,match,false,nocash);},getAllNext:function(match,nocash){return walk(this,"nextSibling",null,match,true,nocash);},getFirst:function(match,nocash){return walk(this,"nextSibling","firstChild",match,false,nocash);},getLast:function(match,nocash){return walk(this,"previousSibling","lastChild",match,false,nocash);},getParent:function(match,nocash){return walk(this,"parentNode",null,match,false,nocash);},getParents:function(match,nocash){return walk(this,"parentNode",null,match,true,nocash);},getSiblings:function(match,nocash){return this.getParent().getChildren(match,nocash).erase(this);},getChildren:function(match,nocash){return walk(this,"nextSibling","firstChild",match,true,nocash);},getWindow:function(){return this.ownerDocument.window;},getDocument:function(){return this.ownerDocument;},getElementById:function(id,nocash){var el=this.ownerDocument.getElementById(id);if(!el){return null;}for(var parent=el.parentNode;parent!=this;parent=parent.parentNode){if(!parent){return null;}}return document.id(el,nocash);},getSelected:function(){return new Elements($A(this.options).filter(function(option){return option.selected;}));},getComputedStyle:function(property){if(this.currentStyle){return this.currentStyle[property.camelCase()];}var computed=this.getDocument().defaultView.getComputedStyle(this,null);return(computed)?computed.getPropertyValue([property.hyphenate()]):null;},toQueryString:function(){var queryString=[];this.getElements("input, select, textarea",true).each(function(el){if(!el.name||el.disabled||el.type=="submit"||el.type=="reset"||el.type=="file"){return;}var value=(el.tagName.toLowerCase()=="select")?Element.getSelected(el).map(function(opt){return opt.value;}):((el.type=="radio"||el.type=="checkbox")&&!el.checked)?null:el.value;$splat(value).each(function(val){if(typeof val!="undefined"){queryString.push(el.name+"="+encodeURIComponent(val));}});});return queryString.join("&");},clone:function(contents,keepid){contents=contents!==false;var clone=this.cloneNode(contents);var clean=function(node,element){if(!keepid){node.removeAttribute("id");}if(Browser.Engine.trident){node.clearAttributes();node.mergeAttributes(element);node.removeAttribute("uid");if(node.options){var no=node.options,eo=element.options;for(var j=no.length;j--;){no[j].selected=eo[j].selected;}}}var prop=props[element.tagName.toLowerCase()];if(prop&&element[prop]){node[prop]=element[prop];}};if(contents){var ce=clone.getElementsByTagName("*"),te=this.getElementsByTagName("*");for(var i=ce.length;i--;){clean(ce[i],te[i]);}}clean(clone,this);return document.id(clone);},destroy:function(){Element.empty(this);Element.dispose(this);clean(this,true);return null;},empty:function(){$A(this.childNodes).each(function(node){Element.destroy(node);});return this;},dispose:function(){return(this.parentNode)?this.parentNode.removeChild(this):this;},hasChild:function(el){el=document.id(el,true);if(!el){return false;}if(Browser.Engine.webkit&&Browser.Engine.version<420){return $A(this.getElementsByTagName(el.tagName)).contains(el);}return(this.contains)?(this!=el&&this.contains(el)):!!(this.compareDocumentPosition(el)&16);},match:function(tag){return(!tag||(tag==this)||(Element.get(this,"tag")==tag));}});Native.implement([Element,Window,Document],{addListener:function(type,fn){if(type=="unload"){var old=fn,self=this;fn=function(){self.removeListener("unload",fn);old();};}else{collected[this.uid]=this;}if(this.addEventListener){this.addEventListener(type,fn,false);}else{this.attachEvent("on"+type,fn);}return this;},removeListener:function(type,fn){if(this.removeEventListener){this.removeEventListener(type,fn,false);}else{this.detachEvent("on"+type,fn);}return this;},retrieve:function(property,dflt){var storage=get(this.uid),prop=storage[property];if(dflt!=undefined&&prop==undefined){prop=storage[property]=dflt;}return $pick(prop);},store:function(property,value){var storage=get(this.uid);storage[property]=value;return this;},eliminate:function(property){var storage=get(this.uid);delete storage[property];return this;}});window.addListener("unload",purge);})();Element.Properties=new Hash;Element.Properties.style={set:function(style){this.style.cssText=style;},get:function(){return this.style.cssText;},erase:function(){this.style.cssText="";}};Element.Properties.tag={get:function(){return this.tagName.toLowerCase();}};Element.Properties.html=(function(){var wrapper=document.createElement("div");var translations={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};translations.thead=translations.tfoot=translations.tbody;var html={set:function(){var html=Array.flatten(arguments).join("");var wrap=Browser.Engine.trident&&translations[this.get("tag")];if(wrap){var first=wrapper;first.innerHTML=wrap[1]+html+wrap[2];for(var i=wrap[0];i--;){first=first.firstChild;}this.empty().adopt(first.childNodes);}else{this.innerHTML=html;}}};html.erase=html.set;return html;})();if(Browser.Engine.webkit&&Browser.Engine.version<420){Element.Properties.text={get:function(){if(this.innerText){return this.innerText;}var temp=this.ownerDocument.newElement("div",{html:this.innerHTML}).inject(this.ownerDocument.body);var text=temp.innerText;temp.destroy();return text;}};}Element.Properties.events={set:function(events){this.addEvents(events);}};Native.implement([Element,Window,Document],{addEvent:function(type,fn){var events=this.retrieve("events",{});events[type]=events[type]||{"keys":[],"values":[]};if(events[type].keys.contains(fn)){return this;}events[type].keys.push(fn);var realType=type,custom=Element.Events.get(type),condition=fn,self=this;if(custom){if(custom.onAdd){custom.onAdd.call(this,fn);}if(custom.condition){condition=function(event){if(custom.condition.call(this,event)){return fn.call(this,event);}return true;};}realType=custom.base||realType;}var defn=function(){return fn.call(self);};var nativeEvent=Element.NativeEvents[realType];if(nativeEvent){if(nativeEvent==2){defn=function(event){event=new Event(event,self.getWindow());if(condition.call(self,event)===false){event.stop();}};}this.addListener(realType,defn);}events[type].values.push(defn);return this;},removeEvent:function(type,fn){var events=this.retrieve("events");if(!events||!events[type]){return this;}var pos=events[type].keys.indexOf(fn);if(pos==-1){return this;}events[type].keys.splice(pos,1);var value=events[type].values.splice(pos,1)[0];var custom=Element.Events.get(type);if(custom){if(custom.onRemove){custom.onRemove.call(this,fn);}type=custom.base||type;}return(Element.NativeEvents[type])?this.removeListener(type,value):this;},addEvents:function(events){for(var event in events){this.addEvent(event,events[event]);}return this;},removeEvents:function(events){var type;if($type(events)=="object"){for(type in events){this.removeEvent(type,events[type]);}return this;}var attached=this.retrieve("events");if(!attached){return this;}if(!events){for(type in attached){this.removeEvents(type);}this.eliminate("events");}else{if(attached[events]){while(attached[events].keys[0]){this.removeEvent(events,attached[events].keys[0]);}attached[events]=null;}}return this;},fireEvent:function(type,args,delay){var events=this.retrieve("events");if(!events||!events[type]){return this;}events[type].keys.each(function(fn){fn.create({"bind":this,"delay":delay,"arguments":args})();},this);return this;},cloneEvents:function(from,type){from=document.id(from);var fevents=from.retrieve("events");if(!fevents){return this;}if(!type){for(var evType in fevents){this.cloneEvents(from,evType);}}else{if(fevents[type]){fevents[type].keys.each(function(fn){this.addEvent(type,fn);},this);}}return this;}});Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,load:1,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1};(function(){var $check=function(event){var related=event.relatedTarget;if(related==undefined){return true;}if(related===false){return false;}return($type(this)!="document"&&related!=this&&related.prefix!="xul"&&!this.hasChild(related));};Element.Events=new Hash({mouseenter:{base:"mouseover",condition:$check},mouseleave:{base:"mouseout",condition:$check},mousewheel:{base:(Browser.Engine.gecko)?"DOMMouseScroll":"mousewheel"}});})();Element.Properties.styles={set:function(styles){this.setStyles(styles);}};Element.Properties.opacity={set:function(opacity,novisibility){if(!novisibility){if(opacity==0){if(this.style.visibility!="hidden"){this.style.visibility="hidden";}}else{if(this.style.visibility!="visible"){this.style.visibility="visible";}}}if(!this.currentStyle||!this.currentStyle.hasLayout){this.style.zoom=1;}if(Browser.Engine.trident){this.style.filter=(opacity==1)?"":"alpha(opacity="+opacity*100+")";}this.style.opacity=opacity;this.store("opacity",opacity);},get:function(){return this.retrieve("opacity",1);}};Element.implement({setOpacity:function(value){return this.set("opacity",value,true);},getOpacity:function(){return this.get("opacity");},setStyle:function(property,value){switch(property){case"opacity":return this.set("opacity",parseFloat(value));case"float":property=(Browser.Engine.trident)?"styleFloat":"cssFloat";}property=property.camelCase();if($type(value)!="string"){var map=(Element.Styles.get(property)||"@").split(" ");value=$splat(value).map(function(val,i){if(!map[i]){return"";}return($type(val)=="number")?map[i].replace("@",Math.round(val)):val;}).join(" ");}else{if(value==String(Number(value))){value=Math.round(value);}}this.style[property]=value;return this;},getStyle:function(property){switch(property){case"opacity":return this.get("opacity");case"float":property=(Browser.Engine.trident)?"styleFloat":"cssFloat";}property=property.camelCase();var result=this.style[property];if(!$chk(result)){result=[];for(var style in Element.ShortStyles){if(property!=style){continue;}for(var s in Element.ShortStyles[style]){result.push(this.getStyle(s));}return result.join(" ");}result=this.getComputedStyle(property);}if(result){result=String(result);var color=result.match(/rgba?\([\d\s,]+\)/);if(color){result=result.replace(color[0],color[0].rgbToHex());}}if(Browser.Engine.presto||(Browser.Engine.trident&&!$chk(parseInt(result,10)))){if(property.test(/^(height|width)$/)){var values=(property=="width")?["left","right"]:["top","bottom"],size=0;values.each(function(value){size+=this.getStyle("border-"+value+"-width").toInt()+this.getStyle("padding-"+value).toInt();},this);return this["offset"+property.capitalize()]-size+"px";}if((Browser.Engine.presto)&&String(result).test("px")){return result;}if(property.test(/(border(.+)Width|margin|padding)/)){return"0px";}}return result;},setStyles:function(styles){for(var style in styles){this.setStyle(style,styles[style]);}return this;},getStyles:function(){var result={};Array.flatten(arguments).each(function(key){result[key]=this.getStyle(key);},this);return result;}});Element.Styles=new Hash({left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",zIndex:"@","zoom":"@",fontWeight:"@",textIndent:"@px",opacity:"@"});Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}};["Top","Right","Bottom","Left"].each(function(direction){var Short=Element.ShortStyles;var All=Element.Styles;["margin","padding"].each(function(style){var sd=style+direction;Short[style][sd]=All[sd]="@px";});var bd="border"+direction;Short.border[bd]=All[bd]="@px @ rgb(@, @, @)";var bdw=bd+"Width",bds=bd+"Style",bdc=bd+"Color";Short[bd]={};Short.borderWidth[bdw]=Short[bd][bdw]=All[bdw]="@px";Short.borderStyle[bds]=Short[bd][bds]=All[bds]="@";Short.borderColor[bdc]=Short[bd][bdc]=All[bdc]="rgb(@, @, @)";});(function(){Element.implement({scrollTo:function(x,y){if(isBody(this)){this.getWindow().scrollTo(x,y);}else{this.scrollLeft=x;this.scrollTop=y;}return this;},getSize:function(){if(isBody(this)){return this.getWindow().getSize();}return{x:this.offsetWidth,y:this.offsetHeight};},getScrollSize:function(){if(isBody(this)){return this.getWindow().getScrollSize();}return{x:this.scrollWidth,y:this.scrollHeight};},getScroll:function(){if(isBody(this)){return this.getWindow().getScroll();}return{x:this.scrollLeft,y:this.scrollTop};},getScrolls:function(){var element=this,position={x:0,y:0};while(element&&!isBody(element)){position.x+=element.scrollLeft;position.y+=element.scrollTop;element=element.parentNode;}return position;},getOffsetParent:function(){var element=this;if(isBody(element)){return null;}if(!Browser.Engine.trident){return element.offsetParent;}while((element=element.parentNode)&&!isBody(element)){if(styleString(element,"position")!="static"){return element;}}return null;},getOffsets:function(){if(this.getBoundingClientRect){var bound=this.getBoundingClientRect(),html=document.id(this.getDocument().documentElement),htmlScroll=html.getScroll(),elemScrolls=this.getScrolls(),elemScroll=this.getScroll(),isFixed=(styleString(this,"position")=="fixed");return{x:bound.left.toInt()+elemScrolls.x-elemScroll.x+((isFixed)?0:htmlScroll.x)-html.clientLeft,y:bound.top.toInt()+elemScrolls.y-elemScroll.y+((isFixed)?0:htmlScroll.y)-html.clientTop};}var element=this,position={x:0,y:0};if(isBody(this)){return position;}while(element&&!isBody(element)){position.x+=element.offsetLeft;position.y+=element.offsetTop;if(Browser.Engine.gecko){if(!borderBox(element)){position.x+=leftBorder(element);position.y+=topBorder(element);}var parent=element.parentNode;if(parent&&styleString(parent,"overflow")!="visible"){position.x+=leftBorder(parent);position.y+=topBorder(parent);}}else{if(element!=this&&Browser.Engine.webkit){position.x+=leftBorder(element);position.y+=topBorder(element);}}element=element.offsetParent;}if(Browser.Engine.gecko&&!borderBox(this)){position.x-=leftBorder(this);position.y-=topBorder(this);}return position;},getPosition:function(relative){if(isBody(this)){return{x:0,y:0};}var offset=this.getOffsets(),scroll=this.getScrolls();var position={x:offset.x-scroll.x,y:offset.y-scroll.y};var relativePosition=(relative&&(relative=document.id(relative)))?relative.getPosition():{x:0,y:0};return{x:position.x-relativePosition.x,y:position.y-relativePosition.y};},getCoordinates:function(element){if(isBody(this)){return this.getWindow().getCoordinates();}var position=this.getPosition(element),size=this.getSize();var obj={left:position.x,top:position.y,width:size.x,height:size.y};obj.right=obj.left+obj.width;obj.bottom=obj.top+obj.height;return obj;},computePosition:function(obj){return{left:obj.x-styleNumber(this,"margin-left"),top:obj.y-styleNumber(this,"margin-top")};},setPosition:function(obj){return this.setStyles(this.computePosition(obj));}});Native.implement([Document,Window],{getSize:function(){if(Browser.Engine.presto||Browser.Engine.webkit){var win=this.getWindow();return{x:win.innerWidth,y:win.innerHeight};}var doc=getCompatElement(this);return{x:doc.clientWidth,y:doc.clientHeight};},getScroll:function(){var win=this.getWindow(),doc=getCompatElement(this);return{x:win.pageXOffset||doc.scrollLeft,y:win.pageYOffset||doc.scrollTop};},getScrollSize:function(){var doc=getCompatElement(this),min=this.getSize();return{x:Math.max(doc.scrollWidth,min.x),y:Math.max(doc.scrollHeight,min.y)};},getPosition:function(){return{x:0,y:0};},getCoordinates:function(){var size=this.getSize();return{top:0,left:0,bottom:size.y,right:size.x,height:size.y,width:size.x};}});var styleString=Element.getComputedStyle;function styleNumber(element,style){return styleString(element,style).toInt()||0;}function borderBox(element){return styleString(element,"-moz-box-sizing")=="border-box";}function topBorder(element){return styleNumber(element,"border-top-width");}function leftBorder(element){return styleNumber(element,"border-left-width");}function isBody(element){return(/^(?:body|html)$/i).test(element.tagName);}function getCompatElement(element){var doc=element.getDocument();return(!doc.compatMode||doc.compatMode=="CSS1Compat")?doc.html:doc.body;}})();Element.alias("setPosition","position");Native.implement([Window,Document,Element],{getHeight:function(){return this.getSize().y;},getWidth:function(){return this.getSize().x;},getScrollTop:function(){return this.getScroll().y;},getScrollLeft:function(){return this.getScroll().x;},getScrollHeight:function(){return this.getScrollSize().y;},getScrollWidth:function(){return this.getScrollSize().x;},getTop:function(){return this.getPosition().y;},getLeft:function(){return this.getPosition().x;}});Native.implement([Document,Element],{getElements:function(expression,nocash){expression=expression.split(",");var items,local={};for(var i=0,l=expression.length;i<l;i++){var selector=expression[i],elements=Selectors.Utils.search(this,selector,local);if(i!=0&&elements.item){elements=$A(elements);}items=(i==0)?elements:(items.item)?$A(items).concat(elements):items.concat(elements);}return new Elements(items,{ddup:(expression.length>1),cash:!nocash});}});Element.implement({match:function(selector){if(!selector||(selector==this)){return true;}var tagid=Selectors.Utils.parseTagAndID(selector);var tag=tagid[0],id=tagid[1];if(!Selectors.Filters.byID(this,id)||!Selectors.Filters.byTag(this,tag)){return false;}var parsed=Selectors.Utils.parseSelector(selector);return(parsed)?Selectors.Utils.filter(this,parsed,{}):true;}});var Selectors={Cache:{nth:{},parsed:{}}};Selectors.RegExps={id:(/#([\w-]+)/),tag:(/^(\w+|\*)/),quick:(/^(\w+|\*)$/),splitter:(/\s*([+>~\s])\s*([a-zA-Z#.*:\[])/g),combined:(/\.([\w-]+)|\[(\w+)(?:([!*^$~|]?=)(["']?)([^\4]*?)\4)?\]|:([\w-]+)(?:\(["']?(.*?)?["']?\)|$)/g)};Selectors.Utils={chk:function(item,uniques){if(!uniques){return true;}var uid=$uid(item);if(!uniques[uid]){return uniques[uid]=true;}return false;},parseNthArgument:function(argument){if(Selectors.Cache.nth[argument]){return Selectors.Cache.nth[argument];}var parsed=argument.match(/^([+-]?\d*)?([a-z]+)?([+-]?\d*)?$/);if(!parsed){return false;}var inta=parseInt(parsed[1],10);var a=(inta||inta===0)?inta:1;var special=parsed[2]||false;var b=parseInt(parsed[3],10)||0;if(a!=0){b--;while(b<1){b+=a;}while(b>=a){b-=a;}}else{a=b;special="index";}switch(special){case"n":parsed={a:a,b:b,special:"n"};break;case"odd":parsed={a:2,b:0,special:"n"};break;case"even":parsed={a:2,b:1,special:"n"};break;case"first":parsed={a:0,special:"index"};break;case"last":parsed={special:"last-child"};break;case"only":parsed={special:"only-child"};break;default:parsed={a:(a-1),special:"index"};}return Selectors.Cache.nth[argument]=parsed;},parseSelector:function(selector){if(Selectors.Cache.parsed[selector]){return Selectors.Cache.parsed[selector];}var m,parsed={classes:[],pseudos:[],attributes:[]};while((m=Selectors.RegExps.combined.exec(selector))){var cn=m[1],an=m[2],ao=m[3],av=m[5],pn=m[6],pa=m[7];if(cn){parsed.classes.push(cn);}else{if(pn){var parser=Selectors.Pseudo.get(pn);if(parser){parsed.pseudos.push({parser:parser,argument:pa});}else{parsed.attributes.push({name:pn,operator:"=",value:pa});}}else{if(an){parsed.attributes.push({name:an,operator:ao,value:av});}}}}if(!parsed.classes.length){delete parsed.classes;}if(!parsed.attributes.length){delete parsed.attributes;}if(!parsed.pseudos.length){delete parsed.pseudos;}if(!parsed.classes&&!parsed.attributes&&!parsed.pseudos){parsed=null;}return Selectors.Cache.parsed[selector]=parsed;},parseTagAndID:function(selector){var tag=selector.match(Selectors.RegExps.tag);var id=selector.match(Selectors.RegExps.id);return[(tag)?tag[1]:"*",(id)?id[1]:false];},filter:function(item,parsed,local){var i;if(parsed.classes){for(i=parsed.classes.length;i--;i){var cn=parsed.classes[i];if(!Selectors.Filters.byClass(item,cn)){return false;}}}if(parsed.attributes){for(i=parsed.attributes.length;i--;i){var att=parsed.attributes[i];if(!Selectors.Filters.byAttribute(item,att.name,att.operator,att.value)){return false;}}}if(parsed.pseudos){for(i=parsed.pseudos.length;i--;i){var psd=parsed.pseudos[i];if(!Selectors.Filters.byPseudo(item,psd.parser,psd.argument,local)){return false;}}}return true;},getByTagAndID:function(ctx,tag,id){if(id){var item=(ctx.getElementById)?ctx.getElementById(id,true):Element.getElementById(ctx,id,true);return(item&&Selectors.Filters.byTag(item,tag))?[item]:[];}else{return ctx.getElementsByTagName(tag);}},search:function(self,expression,local){var splitters=[];var selectors=expression.trim().replace(Selectors.RegExps.splitter,function(m0,m1,m2){splitters.push(m1);return":)"+m2;}).split(":)");var items,filtered,item;for(var i=0,l=selectors.length;i<l;i++){var selector=selectors[i];if(i==0&&Selectors.RegExps.quick.test(selector)){items=self.getElementsByTagName(selector);continue;}var splitter=splitters[i-1];var tagid=Selectors.Utils.parseTagAndID(selector);var tag=tagid[0],id=tagid[1];if(i==0){items=Selectors.Utils.getByTagAndID(self,tag,id);}else{var uniques={},found=[];for(var j=0,k=items.length;j<k;j++){found=Selectors.Getters[splitter](found,items[j],tag,id,uniques);}items=found;}var parsed=Selectors.Utils.parseSelector(selector);if(parsed){filtered=[];for(var m=0,n=items.length;m<n;m++){item=items[m];if(Selectors.Utils.filter(item,parsed,local)){filtered.push(item);}}items=filtered;}}return items;}};Selectors.Getters={" ":function(found,self,tag,id,uniques){var items=Selectors.Utils.getByTagAndID(self,tag,id);for(var i=0,l=items.length;i<l;i++){var item=items[i];if(Selectors.Utils.chk(item,uniques)){found.push(item);}}return found;},">":function(found,self,tag,id,uniques){var children=Selectors.Utils.getByTagAndID(self,tag,id);for(var i=0,l=children.length;i<l;i++){var child=children[i];if(child.parentNode==self&&Selectors.Utils.chk(child,uniques)){found.push(child);}}return found;},"+":function(found,self,tag,id,uniques){while((self=self.nextSibling)){if(self.nodeType==1){if(Selectors.Utils.chk(self,uniques)&&Selectors.Filters.byTag(self,tag)&&Selectors.Filters.byID(self,id)){found.push(self);}break;}}return found;},"~":function(found,self,tag,id,uniques){while((self=self.nextSibling)){if(self.nodeType==1){if(!Selectors.Utils.chk(self,uniques)){break;}if(Selectors.Filters.byTag(self,tag)&&Selectors.Filters.byID(self,id)){found.push(self);}}}return found;}};Selectors.Filters={byTag:function(self,tag){return(tag=="*"||(self.tagName&&self.tagName.toLowerCase()==tag));},byID:function(self,id){return(!id||(self.id&&self.id==id));},byClass:function(self,klass){return(self.className&&self.className.contains&&self.className.contains(klass," "));},byPseudo:function(self,parser,argument,local){return parser.call(self,argument,local);},byAttribute:function(self,name,operator,value){var result=Element.prototype.getProperty.call(self,name);if(!result){return(operator=="!=");}if(!operator||value==undefined){return true;}switch(operator){case"=":return(result==value);case"*=":return(result.contains(value));case"^=":return(result.substr(0,value.length)==value);case"$=":return(result.substr(result.length-value.length)==value);case"!=":return(result!=value);case"~=":return result.contains(value," ");case"|=":return result.contains(value,"-");}return false;}};Selectors.Pseudo=new Hash({checked:function(){return this.checked;},empty:function(){return !(this.innerText||this.textContent||"").length;},not:function(selector){return !Element.match(this,selector);},contains:function(text){return(this.innerText||this.textContent||"").contains(text);},"first-child":function(){return Selectors.Pseudo.index.call(this,0);},"last-child":function(){var element=this;while((element=element.nextSibling)){if(element.nodeType==1){return false;}}return true;},"only-child":function(){var prev=this;while((prev=prev.previousSibling)){if(prev.nodeType==1){return false;}}var next=this;while((next=next.nextSibling)){if(next.nodeType==1){return false;}}return true;},"nth-child":function(argument,local){argument=(argument==undefined)?"n":argument;var parsed=Selectors.Utils.parseNthArgument(argument);if(parsed.special!="n"){return Selectors.Pseudo[parsed.special].call(this,parsed.a,local);}var count=0;local.positions=local.positions||{};var uid=$uid(this);if(!local.positions[uid]){var self=this;while((self=self.previousSibling)){if(self.nodeType!=1){continue;}count++;var position=local.positions[$uid(self)];if(position!=undefined){count=position+count;break;}}local.positions[uid]=count;}return(local.positions[uid]%parsed.a==parsed.b);},index:function(index){var element=this,count=0;while((element=element.previousSibling)){if(element.nodeType==1&&++count>index){return false;}}return(count==index);},even:function(argument,local){return Selectors.Pseudo["nth-child"].call(this,"2n+1",local);},odd:function(argument,local){return Selectors.Pseudo["nth-child"].call(this,"2n",local);},selected:function(){return this.selected;},enabled:function(){return(this.disabled===false);}});Element.Events.domready={onAdd:function(fn){if(Browser.loaded){fn.call(this);}}};(function(){var domready=function(){if(Browser.loaded){return;}Browser.loaded=true;window.fireEvent("domready");document.fireEvent("domready");};window.addEvent("load",domready);if(Browser.Engine.trident){var temp=document.createElement("div");(function(){($try(function(){temp.doScroll();return document.id(temp).inject(document.body).set("html","temp").dispose();}))?domready():arguments.callee.delay(50);})();}else{if(Browser.Engine.webkit&&Browser.Engine.version<525){(function(){(["loaded","complete"].contains(document.readyState))?domready():arguments.callee.delay(50);})();}else{document.addEvent("DOMContentLoaded",domready);}}})();var JSON=new Hash(this.JSON&&{stringify:JSON.stringify,parse:JSON.parse}).extend({$specialChars:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},$replaceChars:function(chr){return JSON.$specialChars[chr]||"\\u00"+Math.floor(chr.charCodeAt()/16).toString(16)+(chr.charCodeAt()%16).toString(16);},encode:function(obj){switch($type(obj)){case"string":return'"'+obj.replace(/[\x00-\x1f\\"]/g,JSON.$replaceChars)+'"';case"array":return"["+String(obj.map(JSON.encode).clean())+"]";case"object":case"hash":var string=[];Hash.each(obj,function(value,key){var json=JSON.encode(value);if(json){string.push(JSON.encode(key)+":"+json);}});return"{"+string+"}";case"number":case"boolean":return String(obj);case false:return"null";}return null;},decode:function(string,secure){if($type(string)!="string"||!string.length){return null;}if(secure&&!(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(string.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""))){return null;}return eval("("+string+")");}});Native.implement([Hash,Array,String,Number],{toJSON:function(){return JSON.encode(this);}});var Cookie=new Class({Implements:Options,options:{path:false,domain:false,duration:false,secure:false,document:document},initialize:function(key,options){this.key=key;this.setOptions(options);},write:function(value){value=encodeURIComponent(value);if(this.options.domain){value+="; domain="+this.options.domain;}if(this.options.path){value+="; path="+this.options.path;}if(this.options.duration){var date=new Date();date.setTime(date.getTime()+this.options.duration*24*60*60*1000);value+="; expires="+date.toGMTString();}if(this.options.secure){value+="; secure";}this.options.document.cookie=this.key+"="+value;return this;},read:function(){var value=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return(value)?decodeURIComponent(value[1]):null;},dispose:function(){new Cookie(this.key,$merge(this.options,{duration:-1})).write("");return this;}});Cookie.write=function(key,value,options){return new Cookie(key,options).write(value);};Cookie.read=function(key){return new Cookie(key).read();};Cookie.dispose=function(key,options){return new Cookie(key,options).dispose();};var Swiff=new Class({Implements:[Options],options:{id:null,height:1,width:1,container:null,properties:{},params:{quality:"high",allowScriptAccess:"always",wMode:"transparent",swLiveConnect:true},callBacks:{},vars:{}},toElement:function(){return this.object;},initialize:function(path,options){this.instance="Swiff_"+$time();this.setOptions(options);options=this.options;var id=this.id=options.id||this.instance;var container=document.id(options.container);Swiff.CallBacks[this.instance]={};var params=options.params,vars=options.vars,callBacks=options.callBacks;var properties=$extend({height:options.height,width:options.width},options.properties);var self=this;for(var callBack in callBacks){Swiff.CallBacks[this.instance][callBack]=(function(option){return function(){return option.apply(self.object,arguments);};})(callBacks[callBack]);vars[callBack]="Swiff.CallBacks."+this.instance+"."+callBack;}params.flashVars=Hash.toQueryString(vars);if(Browser.Engine.trident){properties.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000";params.movie=path;}else{properties.type="application/x-shockwave-flash";properties.data=path;}var build='<object id="'+id+'"';for(var property in properties){build+=" "+property+'="'+properties[property]+'"';}build+=">";for(var param in params){if(params[param]){build+='<param name="'+param+'" value="'+params[param]+'" />';}}build+="</object>";this.object=((container)?container.empty():new Element("div")).set("html",build).firstChild;},replaces:function(element){element=document.id(element,true);element.parentNode.replaceChild(this.toElement(),element);return this;},inject:function(element){document.id(element,true).appendChild(this.toElement());return this;},remote:function(){return Swiff.remote.apply(Swiff,[this.toElement()].extend(arguments));}});Swiff.CallBacks={};Swiff.remote=function(obj,fn){var rs=obj.CallFunction('<invoke name="'+fn+'" returntype="javascript">'+__flash__argumentsToXML(arguments,2)+"</invoke>");return eval(rs);};var Fx=new Class({Implements:[Chain,Events,Options],options:{fps:50,unit:false,duration:500,link:"ignore"},initialize:function(options){this.subject=this.subject||this;this.setOptions(options);this.options.duration=Fx.Durations[this.options.duration]||this.options.duration.toInt();var wait=this.options.wait;if(wait===false){this.options.link="cancel";}},getTransition:function(){return function(p){return -(Math.cos(Math.PI*p)-1)/2;};},step:function(){var time=$time();if(time<this.time+this.options.duration){var delta=this.transition((time-this.time)/this.options.duration);this.set(this.compute(this.from,this.to,delta));}else{this.set(this.compute(this.from,this.to,1));this.complete();}},set:function(now){return now;},compute:function(from,to,delta){return Fx.compute(from,to,delta);},check:function(){if(!this.timer){return true;}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.bind(this,arguments));return false;}return false;},start:function(from,to){if(!this.check(from,to)){return this;}this.from=from;this.to=to;this.time=0;this.transition=this.getTransition();this.startTimer();this.onStart();return this;},complete:function(){if(this.stopTimer()){this.onComplete();}return this;},cancel:function(){if(this.stopTimer()){this.onCancel();}return this;},onStart:function(){this.fireEvent("start",this.subject);},onComplete:function(){this.fireEvent("complete",this.subject);if(!this.callChain()){this.fireEvent("chainComplete",this.subject);}},onCancel:function(){this.fireEvent("cancel",this.subject).clearChain();},pause:function(){this.stopTimer();return this;},resume:function(){this.startTimer();return this;},stopTimer:function(){if(!this.timer){return false;}this.time=$time()-this.time;this.timer=$clear(this.timer);return true;},startTimer:function(){if(this.timer){return false;}this.time=$time()-this.time;this.timer=this.step.periodical(Math.round(1000/this.options.fps),this);return true;}});Fx.compute=function(from,to,delta){return(to-from)*delta+from;};Fx.Durations={"short":250,"normal":500,"long":1000};Fx.CSS=new Class({Extends:Fx,prepare:function(element,property,values){values=$splat(values);var values1=values[1];if(!$chk(values1)){values[1]=values[0];values[0]=element.getStyle(property);}var parsed=values.map(this.parse);return{from:parsed[0],to:parsed[1]};},parse:function(value){value=$lambda(value)();value=(typeof value=="string")?value.split(" "):$splat(value);return value.map(function(val){val=String(val);var found=false;Fx.CSS.Parsers.each(function(parser,key){if(found){return;}var parsed=parser.parse(val);if($chk(parsed)){found={value:parsed,parser:parser};}});found=found||{value:val,parser:Fx.CSS.Parsers.String};return found;});},compute:function(from,to,delta){var computed=[];(Math.min(from.length,to.length)).times(function(i){computed.push({value:from[i].parser.compute(from[i].value,to[i].value,delta),parser:from[i].parser});});computed.$family={name:"fx:css:value"};return computed;},serve:function(value,unit){if($type(value)!="fx:css:value"){value=this.parse(value);}var returned=[];value.each(function(bit){returned=returned.concat(bit.parser.serve(bit.value,unit));});return returned;},render:function(element,property,value,unit){element.setStyle(property,this.serve(value,unit));},search:function(selector){if(Fx.CSS.Cache[selector]){return Fx.CSS.Cache[selector];}var to={};Array.each(document.styleSheets,function(sheet,j){var href=sheet.href;if(href&&href.contains("://")&&!href.contains(document.domain)){return;}var rules=sheet.rules||sheet.cssRules;Array.each(rules,function(rule,i){if(!rule.style){return;}var selectorText=(rule.selectorText)?rule.selectorText.replace(/^\w+/,function(m){return m.toLowerCase();}):null;if(!selectorText||!selectorText.test("^"+selector+"$")){return;}Element.Styles.each(function(value,style){if(!rule.style[style]||Element.ShortStyles[style]){return;}value=String(rule.style[style]);to[style]=(value.test(/^rgb/))?value.rgbToHex():value;});});});return Fx.CSS.Cache[selector]=to;}});Fx.CSS.Cache={};Fx.CSS.Parsers=new Hash({Color:{parse:function(value){if(value.match(/^#[0-9a-f]{3,6}$/i)){return value.hexToRgb(true);}return((value=value.match(/(\d+),\s*(\d+),\s*(\d+)/)))?[value[1],value[2],value[3]]:false;},compute:function(from,to,delta){return from.map(function(value,i){return Math.round(Fx.compute(from[i],to[i],delta));});},serve:function(value){return value.map(Number);}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(value,unit){return(unit)?value+unit:value;}},String:{parse:$lambda(false),compute:$arguments(1),serve:$arguments(0)}});Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(element,options){this.element=this.subject=document.id(element);this.parent(options);},set:function(property,now){if(arguments.length==1){now=property;property=this.property||this.options.property;}this.render(this.element,property,now,this.options.unit);return this;},start:function(property,from,to){if(!this.check(property,from,to)){return this;}var args=Array.flatten(arguments);this.property=this.options.property||args.shift();var parsed=this.prepare(this.element,this.property,args);return this.parent(parsed.from,parsed.to);}});Element.Properties.tween={set:function(options){var tween=this.retrieve("tween");if(tween){tween.cancel();}return this.eliminate("tween").store("tween:options",$extend({link:"cancel"},options));},get:function(options){if(options||!this.retrieve("tween")){if(options||!this.retrieve("tween:options")){this.set("tween",options);}this.store("tween",new Fx.Tween(this,this.retrieve("tween:options")));}return this.retrieve("tween");}};Element.implement({tween:function(property,from,to){this.get("tween").start(arguments);return this;},fade:function(how){var fade=this.get("tween"),o="opacity",toggle;how=$pick(how,"toggle");switch(how){case"in":fade.start(o,1);break;case"out":fade.start(o,0);break;case"show":fade.set(o,1);break;case"hide":fade.set(o,0);break;case"toggle":var flag=this.retrieve("fade:flag",this.get("opacity")==1);fade.start(o,(flag)?0:1);this.store("fade:flag",!flag);toggle=true;break;default:fade.start(o,arguments);}if(!toggle){this.eliminate("fade:flag");}return this;},highlight:function(start,end){if(!end){end=this.retrieve("highlight:original",this.getStyle("background-color"));end=(end=="transparent")?"#fff":end;}var tween=this.get("tween");tween.start("background-color",start||"#ffff88",end).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original"));tween.callChain();}.bind(this));return this;}});Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(element,options){this.element=this.subject=document.id(element);this.parent(options);},set:function(now){if(typeof now=="string"){now=this.search(now);}for(var p in now){this.render(this.element,p,now[p],this.options.unit);}return this;},compute:function(from,to,delta){var now={};for(var p in from){now[p]=this.parent(from[p],to[p],delta);}return now;},start:function(properties){if(!this.check(properties)){return this;}if(typeof properties=="string"){properties=this.search(properties);}var from={},to={};for(var p in properties){var parsed=this.prepare(this.element,p,properties[p]);from[p]=parsed.from;to[p]=parsed.to;}return this.parent(from,to);}});Element.Properties.morph={set:function(options){var morph=this.retrieve("morph");if(morph){morph.cancel();}return this.eliminate("morph").store("morph:options",$extend({link:"cancel"},options));},get:function(options){if(options||!this.retrieve("morph")){if(options||!this.retrieve("morph:options")){this.set("morph",options);}this.store("morph",new Fx.Morph(this,this.retrieve("morph:options")));}return this.retrieve("morph");}};Element.implement({morph:function(props){this.get("morph").start(props);return this;}});Fx.implement({getTransition:function(){var trans=this.options.transition||Fx.Transitions.Sine.easeInOut;if(typeof trans=="string"){var data=trans.split(":");trans=Fx.Transitions;trans=trans[data[0]]||trans[data[0].capitalize()];if(data[1]){trans=trans["ease"+data[1].capitalize()+(data[2]?data[2].capitalize():"")];}}return trans;}});Fx.Transition=function(transition,params){params=$splat(params);return $extend(transition,{easeIn:function(pos){return transition(pos,params);},easeOut:function(pos){return 1-transition(1-pos,params);},easeInOut:function(pos){return(pos<=0.5)?transition(2*pos,params)/2:(2-transition(2*(1-pos),params))/2;}});};Fx.Transitions=new Hash({linear:$arguments(0)});Fx.Transitions.extend=function(transitions){for(var transition in transitions){Fx.Transitions[transition]=new Fx.Transition(transitions[transition]);}};Fx.Transitions.extend({Pow:function(p,x){return Math.pow(p,x[0]||6);},Expo:function(p){return Math.pow(2,8*(p-1));},Circ:function(p){return 1-Math.sin(Math.acos(p));},Sine:function(p){return 1-Math.sin((1-p)*Math.PI/2);},Back:function(p,x){x=x[0]||1.618;return Math.pow(p,2)*((x+1)*p-x);},Bounce:function(p){var value;for(var a=0,b=1;1;a+=b,b/=2){if(p>=(7-4*a)/11){value=b*b-Math.pow((11-6*a-11*p)/4,2);break;}}return value;},Elastic:function(p,x){return Math.pow(2,10*--p)*Math.cos(20*p*Math.PI*(x[0]||1)/3);}});["Quad","Cubic","Quart","Quint"].each(function(transition,i){Fx.Transitions[transition]=new Fx.Transition(function(p){return Math.pow(p,[i+2]);});});var Request=new Class({Implements:[Chain,Events,Options],options:{url:"",data:"",headers:{"X-Requested-With":"XMLHttpRequest","Accept":"text/javascript, text/html, application/xml, text/xml, */*"},async:true,format:false,method:"post",link:"ignore",isSuccess:null,emulation:true,urlEncoded:true,encoding:"utf-8",evalScripts:false,evalResponse:false,noCache:false},initialize:function(options){this.xhr=new Browser.Request();this.setOptions(options);this.options.isSuccess=this.options.isSuccess||this.isSuccess;this.headers=new Hash(this.options.headers);},onStateChange:function(){if(this.xhr.readyState!=4||!this.running){return;}this.running=false;this.status=0;$try(function(){this.status=this.xhr.status;}.bind(this));this.xhr.onreadystatechange=$empty;if(this.options.isSuccess.call(this,this.status)){this.response={text:this.xhr.responseText,xml:this.xhr.responseXML};this.success(this.response.text,this.response.xml);}else{this.response={text:null,xml:null};this.failure();}},isSuccess:function(){return((this.status>=200)&&(this.status<300));},processScripts:function(text){if(this.options.evalResponse||(/(ecma|java)script/).test(this.getHeader("Content-type"))){return $exec(text);}return text.stripScripts(this.options.evalScripts);},success:function(text,xml){this.onSuccess(this.processScripts(text),xml);},onSuccess:function(){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain();},failure:function(){this.onFailure();},onFailure:function(){this.fireEvent("complete").fireEvent("failure",this.xhr);},setHeader:function(name,value){this.headers.set(name,value);return this;},getHeader:function(name){return $try(function(){return this.xhr.getResponseHeader(name);}.bind(this));},check:function(){if(!this.running){return true;}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.bind(this,arguments));return false;}return false;},send:function(options){if(!this.check(options)){return this;}this.running=true;var type=$type(options);if(type=="string"||type=="element"){options={data:options};}var old=this.options;options=$extend({data:old.data,url:old.url,method:old.method},options);var data=options.data,url=String(options.url),method=options.method.toLowerCase();switch($type(data)){case"element":data=document.id(data).toQueryString();break;case"object":case"hash":data=Hash.toQueryString(data);}if(this.options.format){var format="format="+this.options.format;data=(data)?format+"&"+data:format;}if(this.options.emulation&&!["get","post"].contains(method)){var _method="_method="+method;data=(data)?_method+"&"+data:_method;method="post";}if(this.options.urlEncoded&&method=="post"){var encoding=(this.options.encoding)?"; charset="+this.options.encoding:"";this.headers.set("Content-type","application/x-www-form-urlencoded"+encoding);}if(this.options.noCache){var noCache="noCache="+new Date().getTime();data=(data)?noCache+"&"+data:noCache;}var trimPosition=url.lastIndexOf("/");if(trimPosition>-1&&(trimPosition=url.indexOf("#"))>-1){url=url.substr(0,trimPosition);}if(data&&method=="get"){url=url+(url.contains("?")?"&":"?")+data;data=null;}this.xhr.open(method.toUpperCase(),url,this.options.async);this.xhr.onreadystatechange=this.onStateChange.bind(this);this.headers.each(function(value,key){try{this.xhr.setRequestHeader(key,value);}catch(e){this.fireEvent("exception",[key,value]);}},this);this.fireEvent("request");this.xhr.send(data);if(!this.options.async){this.onStateChange();}return this;},cancel:function(){if(!this.running){return this;}this.running=false;this.xhr.abort();this.xhr.onreadystatechange=$empty;this.xhr=new Browser.Request();this.fireEvent("cancel");return this;}});(function(){var methods={};["get","post","put","delete","GET","POST","PUT","DELETE"].each(function(method){methods[method]=function(){var params=Array.link(arguments,{url:String.type,data:$defined});return this.send($extend(params,{method:method}));};});Request.implement(methods);})();Element.Properties.send={set:function(options){var send=this.retrieve("send");if(send){send.cancel();}return this.eliminate("send").store("send:options",$extend({data:this,link:"cancel",method:this.get("method")||"post",url:this.get("action")},options));},get:function(options){if(options||!this.retrieve("send")){if(options||!this.retrieve("send:options")){this.set("send",options);}this.store("send",new Request(this.retrieve("send:options")));}return this.retrieve("send");}};Element.implement({send:function(url){var sender=this.get("send");sender.send({data:this,url:url||sender.options.url});return this;}});Request.HTML=new Class({Extends:Request,options:{update:false,append:false,evalScripts:true,filter:false},processHTML:function(text){var match=text.match(/<body[^>]*>([\s\S]*?)<\/body>/i);text=(match)?match[1]:text;var container=new Element("div");return $try(function(){var root="<root>"+text+"</root>",doc;if(Browser.Engine.trident){doc=new ActiveXObject("Microsoft.XMLDOM");doc.async=false;doc.loadXML(root);}else{doc=new DOMParser().parseFromString(root,"text/xml");}root=doc.getElementsByTagName("root")[0];if(!root){return null;}for(var i=0,k=root.childNodes.length;i<k;i++){var child=Element.clone(root.childNodes[i],true,true);if(child){container.grab(child);}}return container;})||container.set("html",text);},success:function(text){var options=this.options,response=this.response;response.html=text.stripScripts(function(script){response.javascript=script;});var temp=this.processHTML(response.html);response.tree=temp.childNodes;response.elements=temp.getElements("*");if(options.filter){response.tree=response.elements.filter(options.filter);}if(options.update){document.id(options.update).empty().set("html",response.html);}else{if(options.append){document.id(options.append).adopt(temp.getChildren());}}if(options.evalScripts){$exec(response.javascript);}this.onSuccess(response.tree,response.elements,response.html,response.javascript);}});Element.Properties.load={set:function(options){var load=this.retrieve("load");if(load){load.cancel();}return this.eliminate("load").store("load:options",$extend({data:this,link:"cancel",update:this,method:"get"},options));},get:function(options){if(options||!this.retrieve("load")){if(options||!this.retrieve("load:options")){this.set("load",options);}this.store("load",new Request.HTML(this.retrieve("load:options")));}return this.retrieve("load");}};Element.implement({load:function(){this.get("load").send(Array.link(arguments,{data:Object.type,url:String.type}));return this;}});Request.JSON=new Class({Extends:Request,options:{secure:true},initialize:function(options){this.parent(options);this.headers.extend({"Accept":"application/json","X-Request":"JSON"});},success:function(text){this.response.json=JSON.decode(text,this.options.secure);this.onSuccess(this.response.json,text);}});MooTools.More={"version":"1.2.4.2","build":"bd5a93c0913cce25917c48cbdacde568e15e02ef"};(function(){var data={language:"en-US",languages:{"en-US":{}},cascades:["en-US"]};var cascaded;MooTools.lang=new Events();$extend(MooTools.lang,{setLanguage:function(lang){if(!data.languages[lang]){return this;}data.language=lang;this.load();this.fireEvent("langChange",lang);return this;},load:function(){var langs=this.cascade(this.getCurrentLanguage());cascaded={};$each(langs,function(set,setName){cascaded[setName]=this.lambda(set);},this);},getCurrentLanguage:function(){return data.language;},addLanguage:function(lang){data.languages[lang]=data.languages[lang]||{};return this;},cascade:function(lang){var cascades=(data.languages[lang]||{}).cascades||[];cascades.combine(data.cascades);cascades.erase(lang).push(lang);var langs=cascades.map(function(lng){return data.languages[lng];},this);return $merge.apply(this,langs);},lambda:function(set){(set||{}).get=function(key,args){return $lambda(set[key]).apply(this,$splat(args));};return set;},get:function(set,key,args){if(cascaded&&cascaded[set]){return(key?cascaded[set].get(key,args):cascaded[set]);}},set:function(lang,set,members){this.addLanguage(lang);langData=data.languages[lang];if(!langData[set]){langData[set]={};}$extend(langData[set],members);if(lang==this.getCurrentLanguage()){this.load();this.fireEvent("langChange",lang);}return this;},list:function(){return Hash.getKeys(data.languages);}});})();(function(){var global=this;var log=function(){if(global.console&&console.log){try{console.log.apply(console,arguments);}catch(e){console.log(Array.slice(arguments));}}else{Log.logged.push(arguments);}return this;};var disabled=function(){this.logged.push(arguments);return this;};this.Log=new Class({logged:[],log:disabled,resetLog:function(){this.logged.empty();return this;},enableLog:function(){this.log=log;this.logged.each(function(args){this.log.apply(this,args);},this);return this.resetLog();},disableLog:function(){this.log=disabled;return this;}});Log.extend(new Log).enableLog();Log.logger=function(){return this.log.apply(this,arguments);};})();Class.Mutators.Binds=function(binds){return binds;};Class.Mutators.initialize=function(initialize){return function(){$splat(this.Binds).each(function(name){var original=this[name];if(original){this[name]=original.bind(this);}},this);return initialize.apply(this,arguments);};};Class.Occlude=new Class({occlude:function(property,element){element=document.id(element||this.element);var instance=element.retrieve(property||this.property);if(instance&&!$defined(this.occluded)){return this.occluded=instance;}this.occluded=false;element.store(property||this.property,this);return this.occluded;}});(function(){var wait={wait:function(duration){return this.chain(function(){this.callChain.delay($pick(duration,500),this);}.bind(this));}};Chain.implement(wait);if(window.Fx){Fx.implement(wait);["Css","Tween","Elements"].each(function(cls){if(Fx[cls]){Fx[cls].implement(wait);}});}Element.implement({chains:function(effects){$splat($pick(effects,["tween","morph","reveal"])).each(function(effect){effect=this.get(effect);if(!effect){return;}effect.setOptions({link:"chain"});},this);return this;},pauseFx:function(duration,effect){this.chains(effect).get($pick(effect,"tween")).wait(duration);return this;}});})();(function(){var Date=this.Date;if(!Date.now){Date.now=$time;}Date.Methods={ms:"Milliseconds",year:"FullYear",min:"Minutes",mo:"Month",sec:"Seconds",hr:"Hours"};["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds","Time","TimezoneOffset","Week","Timezone","GMTOffset","DayOfYear","LastMonth","LastDayOfMonth","UTCDate","UTCDay","UTCFullYear","AMPM","Ordinal","UTCHours","UTCMilliseconds","UTCMinutes","UTCMonth","UTCSeconds"].each(function(method){Date.Methods[method.toLowerCase()]=method;});var pad=function(what,length){return new Array(length-String(what).length+1).join("0")+what;};Date.implement({set:function(prop,value){switch($type(prop)){case"object":for(var p in prop){this.set(p,prop[p]);}break;case"string":prop=prop.toLowerCase();var m=Date.Methods;if(m[prop]){this["set"+m[prop]](value);}}return this;},get:function(prop){prop=prop.toLowerCase();var m=Date.Methods;if(m[prop]){return this["get"+m[prop]]();}return null;},clone:function(){return new Date(this.get("time"));},increment:function(interval,times){interval=interval||"day";times=$pick(times,1);switch(interval){case"year":return this.increment("month",times*12);case"month":var d=this.get("date");this.set("date",1).set("mo",this.get("mo")+times);return this.set("date",d.min(this.get("lastdayofmonth")));case"week":return this.increment("day",times*7);case"day":return this.set("date",this.get("date")+times);}if(!Date.units[interval]){throw new Error(interval+" is not a supported interval");}return this.set("time",this.get("time")+times*Date.units[interval]());},decrement:function(interval,times){return this.increment(interval,-1*$pick(times,1));},isLeapYear:function(){return Date.isLeapYear(this.get("year"));},clearTime:function(){return this.set({hr:0,min:0,sec:0,ms:0});},diff:function(date,resolution){if($type(date)=="string"){date=Date.parse(date);}return((date-this)/Date.units[resolution||"day"](3,3)).toInt();},getLastDayOfMonth:function(){return Date.daysInMonth(this.get("mo"),this.get("year"));},getDayOfYear:function(){return(Date.UTC(this.get("year"),this.get("mo"),this.get("date")+1)-Date.UTC(this.get("year"),0,1))/Date.units.day();},getWeek:function(){return(this.get("dayofyear")/7).ceil();},getOrdinal:function(day){return Date.getMsg("ordinal",day||this.get("date"));},getTimezone:function(){return this.toString().replace(/^.*? ([A-Z]{3}).[0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3");},getGMTOffset:function(){var off=this.get("timezoneOffset");return((off>0)?"-":"+")+pad((off.abs()/60).floor(),2)+pad(off%60,2);},setAMPM:function(ampm){ampm=ampm.toUpperCase();var hr=this.get("hr");if(hr>11&&ampm=="AM"){return this.decrement("hour",12);}else{if(hr<12&&ampm=="PM"){return this.increment("hour",12);}}return this;},getAMPM:function(){return(this.get("hr")<12)?"AM":"PM";},parse:function(str){this.set("time",Date.parse(str));return this;},isValid:function(date){return !!(date||this).valueOf();},format:function(f){if(!this.isValid()){return"invalid date";}f=f||"%x %X";f=formats[f.toLowerCase()]||f;var d=this;return f.replace(/%([a-z%])/gi,function($0,$1){switch($1){case"a":return Date.getMsg("days")[d.get("day")].substr(0,3);case"A":return Date.getMsg("days")[d.get("day")];case"b":return Date.getMsg("months")[d.get("month")].substr(0,3);case"B":return Date.getMsg("months")[d.get("month")];case"c":return d.toString();case"d":return pad(d.get("date"),2);case"D":return d.get("date");case"H":return pad(d.get("hr"),2);case"I":return((d.get("hr")%12)||12);case"j":return pad(d.get("dayofyear"),3);case"m":return pad((d.get("mo")+1),2);case"M":return pad(d.get("min"),2);case"o":return d.get("ordinal");case"p":return Date.getMsg(d.get("ampm"));case"S":return pad(d.get("seconds"),2);case"U":return pad(d.get("week"),2);case"w":return d.get("day");case"x":return d.format(Date.getMsg("shortDate"));case"X":return d.format(Date.getMsg("shortTime"));case"y":return d.get("year").toString().substr(2);case"Y":return d.get("year");case"T":return d.get("GMTOffset");case"Z":return d.get("Timezone");}return $1;});},toISOString:function(){return this.format("iso8601");}});Date.alias("toISOString","toJSON");Date.alias("diff","compare");Date.alias("format","strftime");var formats={db:"%Y-%m-%d %H:%M:%S",compact:"%Y%m%dT%H%M%S",iso8601:"%Y-%m-%dT%H:%M:%S%T",rfc822:"%a, %d %b %Y %H:%M:%S %Z","short":"%d %b %H:%M","long":"%B %d, %Y %H:%M"};var parsePatterns=[];var nativeParse=Date.parse;var parseWord=function(type,word,num){var ret=-1;var translated=Date.getMsg(type+"s");switch($type(word)){case"object":ret=translated[word.get(type)];break;case"number":ret=translated[month-1];if(!ret){throw new Error("Invalid "+type+" index: "+index);}break;case"string":var match=translated.filter(function(name){return this.test(name);},new RegExp("^"+word,"i"));if(!match.length){throw new Error("Invalid "+type+" string");}if(match.length>1){throw new Error("Ambiguous "+type);}ret=match[0];}return(num)?translated.indexOf(ret):ret;};Date.extend({getMsg:function(key,args){return MooTools.lang.get("Date",key,args);},units:{ms:$lambda(1),second:$lambda(1000),minute:$lambda(60000),hour:$lambda(3600000),day:$lambda(86400000),week:$lambda(608400000),month:function(month,year){var d=new Date;return Date.daysInMonth($pick(month,d.get("mo")),$pick(year,d.get("year")))*86400000;},year:function(year){year=year||new Date().get("year");return Date.isLeapYear(year)?31622400000:31536000000;}},daysInMonth:function(month,year){return[31,Date.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month];},isLeapYear:function(year){return((year%4===0)&&(year%100!==0))||(year%400===0);},parse:function(from){var t=$type(from);if(t=="number"){return new Date(from);}if(t!="string"){return from;}from=from.clean();if(!from.length){return null;}var parsed;parsePatterns.some(function(pattern){var bits=pattern.re.exec(from);return(bits)?(parsed=pattern.handler(bits)):false;});return parsed||new Date(nativeParse(from));},parseDay:function(day,num){return parseWord("day",day,num);},parseMonth:function(month,num){return parseWord("month",month,num);},parseUTC:function(value){var localDate=new Date(value);var utcSeconds=Date.UTC(localDate.get("year"),localDate.get("mo"),localDate.get("date"),localDate.get("hr"),localDate.get("min"),localDate.get("sec"));return new Date(utcSeconds);},orderIndex:function(unit){return Date.getMsg("dateOrder").indexOf(unit)+1;},defineFormat:function(name,format){formats[name]=format;},defineFormats:function(formats){for(var name in formats){Date.defineFormat(name,formats[name]);}},parsePatterns:parsePatterns,defineParser:function(pattern){parsePatterns.push((pattern.re&&pattern.handler)?pattern:build(pattern));},defineParsers:function(){Array.flatten(arguments).each(Date.defineParser);},define2DigitYearStart:function(year){startYear=year%100;startCentury=year-startYear;}});var startCentury=1900;var startYear=70;var regexOf=function(type){return new RegExp("(?:"+Date.getMsg(type).map(function(name){return name.substr(0,3);}).join("|")+")[a-z]*");};var replacers=function(key){switch(key){case"x":return((Date.orderIndex("month")==1)?"%m[.-/]%d":"%d[.-/]%m")+"([.-/]%y)?";case"X":return"%H([.:]%M)?([.:]%S([.:]%s)?)? ?%p? ?%T?";}return null;};var keys={d:/[0-2]?[0-9]|3[01]/,H:/[01]?[0-9]|2[0-3]/,I:/0?[1-9]|1[0-2]/,M:/[0-5]?\d/,s:/\d+/,o:/[a-z]*/,p:/[ap]\.?m\.?/,y:/\d{2}|\d{4}/,Y:/\d{4}/,T:/Z|[+-]\d{2}(?::?\d{2})?/};keys.m=keys.I;keys.S=keys.M;var currentLanguage;var recompile=function(language){currentLanguage=language;keys.a=keys.A=regexOf("days");keys.b=keys.B=regexOf("months");parsePatterns.each(function(pattern,i){if(pattern.format){parsePatterns[i]=build(pattern.format);}});};var build=function(format){if(!currentLanguage){return{format:format};}var parsed=[];var re=(format.source||format).replace(/%([a-z])/gi,function($0,$1){return replacers($1)||$0;}).replace(/\((?!\?)/g,"(?:").replace(/ (?!\?|\*)/g,",? ").replace(/%([a-z%])/gi,function($0,$1){var p=keys[$1];if(!p){return $1;}parsed.push($1);return"("+p.source+")";}).replace(/\[a-z\]/gi,"[a-z\\u00c0-\\uffff]");return{format:format,re:new RegExp("^"+re+"$","i"),handler:function(bits){bits=bits.slice(1).associate(parsed);var date=new Date().clearTime();if("d" in bits){handle.call(date,"d",1);}if("m" in bits){handle.call(date,"m",1);}for(var key in bits){handle.call(date,key,bits[key]);}return date;}};};var handle=function(key,value){if(!value){return this;}switch(key){case"a":case"A":return this.set("day",Date.parseDay(value,true));case"b":case"B":return this.set("mo",Date.parseMonth(value,true));case"d":return this.set("date",value);case"H":case"I":return this.set("hr",value);case"m":return this.set("mo",value-1);case"M":return this.set("min",value);case"p":return this.set("ampm",value.replace(/\./g,""));case"S":return this.set("sec",value);case"s":return this.set("ms",("0."+value)*1000);case"w":return this.set("day",value);case"Y":return this.set("year",value);case"y":value=+value;if(value<100){value+=startCentury+(value<startYear?100:0);}return this.set("year",value);case"T":if(value=="Z"){value="+00";}var offset=value.match(/([+-])(\d{2}):?(\d{2})?/);offset=(offset[1]+"1")*(offset[2]*60+(+offset[3]||0))+this.getTimezoneOffset();return this.set("time",this-offset*60000);}return this;};Date.defineParsers("%Y([-./]%m([-./]%d((T| )%X)?)?)?","%Y%m%d(T%H(%M%S?)?)?","%x( %X)?","%d%o( %b( %Y)?)?( %X)?","%b( %d%o)?( %Y)?( %X)?","%Y %b( %d%o( %X)?)?","%o %b %d %X %T %Y");MooTools.lang.addEvent("langChange",function(language){if(MooTools.lang.get("Date")){recompile(language);}}).fireEvent("langChange",MooTools.lang.getCurrentLanguage());})();Date.implement({timeDiffInWords:function(relative_to){return Date.distanceOfTimeInWords(this,relative_to||new Date);},timeDiff:function(to,joiner){if(to==null){to=new Date;}var delta=((to-this)/1000).toInt();if(!delta){return"0s";}var durations={s:60,m:60,h:24,d:365,y:0};var duration,vals=[];for(var step in durations){if(!delta){break;}if((duration=durations[step])){vals.unshift((delta%duration)+step);delta=(delta/duration).toInt();}else{vals.unshift(delta+step);}}return vals.join(joiner||":");}});Date.alias("timeDiffInWords","timeAgoInWords");Date.extend({distanceOfTimeInWords:function(from,to){return Date.getTimePhrase(((to-from)/1000).toInt());},getTimePhrase:function(delta){var suffix=(delta<0)?"Until":"Ago";if(delta<0){delta*=-1;}var units={minute:60,hour:60,day:24,week:7,month:52/12,year:12,eon:Infinity};var msg="lessThanMinute";for(var unit in units){var interval=units[unit];if(delta<1.5*interval){if(delta>0.75*interval){msg=unit;}break;}delta/=interval;msg=unit+"s";}return Date.getMsg(msg+suffix).substitute({delta:delta.round()});}});Date.defineParsers({re:/^(?:tod|tom|yes)/i,handler:function(bits){var d=new Date().clearTime();switch(bits[0]){case"tom":return d.increment();case"yes":return d.decrement();default:return d;}}},{re:/^(next|last) ([a-z]+)$/i,handler:function(bits){var d=new Date().clearTime();var day=d.getDay();var newDay=Date.parseDay(bits[2],true);var addDays=newDay-day;if(newDay<=day){addDays+=7;}if(bits[1]=="last"){addDays-=7;}return d.set("date",d.getDate()+addDays);}});Hash.implement({getFromPath:function(notation){var source=this.getClean();notation.replace(/\[([^\]]+)\]|\.([^.[]+)|[^[.]+/g,function(match){if(!source){return null;}var prop=arguments[2]||arguments[1]||arguments[0];source=(prop in source)?source[prop]:null;return match;});return source;},cleanValues:function(method){method=method||$defined;this.each(function(v,k){if(!method(v)){this.erase(k);}},this);return this;},run:function(){var args=arguments;this.each(function(v,k){if($type(v)=="function"){v.run(args);}});}});Element.implement({tidy:function(){this.set("value",this.get("value").tidy());},getTextInRange:function(start,end){return this.get("value").substring(start,end);},getSelectedText:function(){if(this.setSelectionRange){return this.getTextInRange(this.getSelectionStart(),this.getSelectionEnd());}return document.selection.createRange().text;},getSelectedRange:function(){if($defined(this.selectionStart)){return{start:this.selectionStart,end:this.selectionEnd};}var pos={start:0,end:0};var range=this.getDocument().selection.createRange();if(!range||range.parentElement()!=this){return pos;}var dup=range.duplicate();if(this.type=="text"){pos.start=0-dup.moveStart("character",-100000);pos.end=pos.start+range.text.length;}else{var value=this.get("value");var offset=value.length;dup.moveToElementText(this);dup.setEndPoint("StartToEnd",range);if(dup.text.length){offset-=value.match(/[\n\r]*$/)[0].length;}pos.end=offset-dup.text.length;dup.setEndPoint("StartToStart",range);pos.start=offset-dup.text.length;}return pos;},getSelectionStart:function(){return this.getSelectedRange().start;},getSelectionEnd:function(){return this.getSelectedRange().end;},setCaretPosition:function(pos){if(pos=="end"){pos=this.get("value").length;}this.selectRange(pos,pos);return this;},getCaretPosition:function(){return this.getSelectedRange().start;},selectRange:function(start,end){if(this.setSelectionRange){this.focus();this.setSelectionRange(start,end);}else{var value=this.get("value");var diff=value.substr(start,end-start).replace(/\r/g,"").length;start=value.substr(0,start).replace(/\r/g,"").length;var range=this.createTextRange();range.collapse(true);range.moveEnd("character",start+diff);range.moveStart("character",start);range.select();}return this;},insertAtCursor:function(value,select){var pos=this.getSelectedRange();var text=this.get("value");this.set("value",text.substring(0,pos.start)+value+text.substring(pos.end,text.length));if($pick(select,true)){this.selectRange(pos.start,pos.start+value.length);}else{this.setCaretPosition(pos.start+value.length);}return this;},insertAroundCursor:function(options,select){options=$extend({before:"",defaultMiddle:"",after:""},options);var value=this.getSelectedText()||options.defaultMiddle;var pos=this.getSelectedRange();var text=this.get("value");if(pos.start==pos.end){this.set("value",text.substring(0,pos.start)+options.before+value+options.after+text.substring(pos.end,text.length));this.selectRange(pos.start+options.before.length,pos.end+options.before.length+value.length);}else{var current=text.substring(pos.start,pos.end);this.set("value",text.substring(0,pos.start)+options.before+current+options.after+text.substring(pos.end,text.length));var selStart=pos.start+options.before.length;if($pick(select,true)){this.selectRange(selStart,selStart+current.length);}else{this.setCaretPosition(selStart+text.length);}}return this;}});(function(){var match=/(.*?):relay\(([^)]+)\)$/,combinators=/[+>~\s]/,splitType=function(type){var bits=type.match(match);return !bits?{event:type}:{event:bits[1],selector:bits[2]};},check=function(e,selector){var t=e.target;if(combinators.test(selector=selector.trim())){var els=this.getElements(selector);for(var i=els.length;i--;){var el=els[i];if(t==el||el.hasChild(t)){return el;}}}else{for(;t&&t!=this;t=t.parentNode){if(Element.match(t,selector)){return document.id(t);}}}return null;};var oldAddEvent=Element.prototype.addEvent,oldRemoveEvent=Element.prototype.removeEvent;Element.implement({addEvent:function(type,fn){var splitted=splitType(type);if(splitted.selector){var monitors=this.retrieve("$moo:delegateMonitors",{});if(!monitors[type]){var monitor=function(e){var el=check.call(this,e,splitted.selector);if(el){this.fireEvent(type,[e,el],0,el);}}.bind(this);monitors[type]=monitor;oldAddEvent.call(this,splitted.event,monitor);}}return oldAddEvent.apply(this,arguments);},removeEvent:function(type,fn){var splitted=splitType(type);if(splitted.selector){var events=this.retrieve("events");if(!events||!events[type]||(fn&&!events[type].keys.contains(fn))){return this;}if(fn){oldRemoveEvent.apply(this,[type,fn]);}else{oldRemoveEvent.apply(this,type);}events=this.retrieve("events");if(events&&events[type]&&events[type].length==0){var monitors=this.retrieve("$moo:delegateMonitors",{});oldRemoveEvent.apply(this,[splitted.event,monitors[type]]);delete monitors[type];}return this;}return oldRemoveEvent.apply(this,arguments);},fireEvent:function(type,args,delay,bind){var events=this.retrieve("events");if(!events||!events[type]){return this;}events[type].keys.each(function(fn){fn.create({bind:bind||this,delay:delay,arguments:args})();},this);return this;}});})();Element.implement({measure:function(fn){var vis=function(el){return !!(!el||el.offsetHeight||el.offsetWidth);};if(vis(this)){return fn.apply(this);}var parent=this.getParent(),restorers=[],toMeasure=[];while(!vis(parent)&&parent!=document.body){toMeasure.push(parent.expose());parent=parent.getParent();}var restore=this.expose();var result=fn.apply(this);restore();toMeasure.each(function(restore){restore();});return result;},expose:function(){if(this.getStyle("display")!="none"){return $empty;}var before=this.style.cssText;this.setStyles({display:"block",position:"absolute",visibility:"hidden"});return function(){this.style.cssText=before;}.bind(this);},getDimensions:function(options){options=$merge({computeSize:false},options);var dim={};var getSize=function(el,options){return(options.computeSize)?el.getComputedSize(options):el.getSize();};var parent=this.getParent("body");if(parent&&this.getStyle("display")=="none"){dim=this.measure(function(){return getSize(this,options);});}else{if(parent){try{dim=getSize(this,options);}catch(e){}}else{dim={x:0,y:0};}}return $chk(dim.x)?$extend(dim,{width:dim.x,height:dim.y}):$extend(dim,{x:dim.width,y:dim.height});},getComputedSize:function(options){options=$merge({styles:["padding","border"],plains:{height:["top","bottom"],width:["left","right"]},mode:"both"},options);var size={width:0,height:0};switch(options.mode){case"vertical":delete size.width;delete options.plains.width;break;case"horizontal":delete size.height;delete options.plains.height;break;}var getStyles=[];$each(options.plains,function(plain,key){plain.each(function(edge){options.styles.each(function(style){getStyles.push((style=="border")?style+"-"+edge+"-"+"width":style+"-"+edge);});});});var styles={};getStyles.each(function(style){styles[style]=this.getComputedStyle(style);},this);var subtracted=[];$each(options.plains,function(plain,key){var capitalized=key.capitalize();size["total"+capitalized]=size["computed"+capitalized]=0;plain.each(function(edge){size["computed"+edge.capitalize()]=0;getStyles.each(function(style,i){if(style.test(edge)){styles[style]=styles[style].toInt()||0;size["total"+capitalized]=size["total"+capitalized]+styles[style];size["computed"+edge.capitalize()]=size["computed"+edge.capitalize()]+styles[style];}if(style.test(edge)&&key!=style&&(style.test("border")||style.test("padding"))&&!subtracted.contains(style)){subtracted.push(style);size["computed"+capitalized]=size["computed"+capitalized]-styles[style];}});});});["Width","Height"].each(function(value){var lower=value.toLowerCase();if(!$chk(size[lower])){return;}size[lower]=size[lower]+this["offset"+value]+size["computed"+value];size["total"+value]=size[lower]+size["total"+value];delete size["computed"+value];},this);return $extend(styles,size);}});(function(){var original=Element.prototype.position;Element.implement({position:function(options){if(options&&($defined(options.x)||$defined(options.y))){return original?original.apply(this,arguments):this;}$each(options||{},function(v,k){if(!$defined(v)){delete options[k];}});options=$merge({relativeTo:document.body,position:{x:"center",y:"center"},edge:false,offset:{x:0,y:0},returnPos:false,relFixedPosition:false,ignoreMargins:false,ignoreScroll:false,allowNegative:false},options);var parentOffset={x:0,y:0},parentPositioned=false;var offsetParent=this.measure(function(){return document.id(this.getOffsetParent());});if(offsetParent&&offsetParent!=this.getDocument().body){parentOffset=offsetParent.measure(function(){return this.getPosition();});parentPositioned=offsetParent!=document.id(options.relativeTo);options.offset.x=options.offset.x-parentOffset.x;options.offset.y=options.offset.y-parentOffset.y;}var fixValue=function(option){if($type(option)!="string"){return option;}option=option.toLowerCase();var val={};if(option.test("left")){val.x="left";}else{if(option.test("right")){val.x="right";}else{val.x="center";}}if(option.test("upper")||option.test("top")){val.y="top";}else{if(option.test("bottom")){val.y="bottom";}else{val.y="center";}}return val;};options.edge=fixValue(options.edge);options.position=fixValue(options.position);if(!options.edge){if(options.position.x=="center"&&options.position.y=="center"){options.edge={x:"center",y:"center"};}else{options.edge={x:"left",y:"top"};}}this.setStyle("position","absolute");var rel=document.id(options.relativeTo)||document.body,calc=rel==document.body?window.getScroll():rel.getPosition(),top=calc.y,left=calc.x;var scrolls=rel.getScrolls();top+=scrolls.y;left+=scrolls.x;var dim=this.getDimensions({computeSize:true,styles:["padding","border","margin"]});var pos={},prefY=options.offset.y,prefX=options.offset.x,winSize=window.getSize();switch(options.position.x){case"left":pos.x=left+prefX;break;case"right":pos.x=left+prefX+rel.offsetWidth;break;default:pos.x=left+((rel==document.body?winSize.x:rel.offsetWidth)/2)+prefX;break;}switch(options.position.y){case"top":pos.y=top+prefY;break;case"bottom":pos.y=top+prefY+rel.offsetHeight;break;default:pos.y=top+((rel==document.body?winSize.y:rel.offsetHeight)/2)+prefY;break;}if(options.edge){var edgeOffset={};switch(options.edge.x){case"left":edgeOffset.x=0;break;case"right":edgeOffset.x=-dim.x-dim.computedRight-dim.computedLeft;break;default:edgeOffset.x=-(dim.totalWidth/2);break;}switch(options.edge.y){case"top":edgeOffset.y=0;break;case"bottom":edgeOffset.y=-dim.y-dim.computedTop-dim.computedBottom;break;default:edgeOffset.y=-(dim.totalHeight/2);break;}pos.x+=edgeOffset.x;pos.y+=edgeOffset.y;}pos={left:((pos.x>=0||parentPositioned||options.allowNegative)?pos.x:0).toInt(),top:((pos.y>=0||parentPositioned||options.allowNegative)?pos.y:0).toInt()};var xy={left:"x",top:"y"};["minimum","maximum"].each(function(minmax){["left","top"].each(function(lr){var val=options[minmax]?options[minmax][xy[lr]]:null;if(val!=null&&pos[lr]<val){pos[lr]=val;}});});if(rel.getStyle("position")=="fixed"||options.relFixedPosition){var winScroll=window.getScroll();pos.top+=winScroll.y;pos.left+=winScroll.x;}if(options.ignoreScroll){var relScroll=rel.getScroll();pos.top-=relScroll.y;pos.left-=relScroll.x;}if(options.ignoreMargins){pos.left+=(options.edge.x=="right"?dim["margin-right"]:options.edge.x=="center"?-dim["margin-left"]+((dim["margin-right"]+dim["margin-left"])/2):-dim["margin-left"]);pos.top+=(options.edge.y=="bottom"?dim["margin-bottom"]:options.edge.y=="center"?-dim["margin-top"]+((dim["margin-bottom"]+dim["margin-top"])/2):-dim["margin-top"]);}pos.left=Math.ceil(pos.left);pos.top=Math.ceil(pos.top);if(options.returnPos){return pos;}else{this.setStyles(pos);}return this;}});})();Element.implement({isDisplayed:function(){return this.getStyle("display")!="none";},isVisible:function(){var w=this.offsetWidth,h=this.offsetHeight;return(w==0&&h==0)?false:(w>0&&h>0)?true:this.isDisplayed();},toggle:function(){return this[this.isDisplayed()?"hide":"show"]();},hide:function(){var d;try{if((d=this.getStyle("display"))=="none"){d=null;}}catch(e){}return this.store("originalDisplay",d||"block").setStyle("display","none");},show:function(display){return this.setStyle("display",display||this.retrieve("originalDisplay")||"block");},swapClass:function(remove,add){return this.removeClass(remove).addClass(add);}});Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(elements,options){this.elements=this.subject=$$(elements);this.parent(options);},compute:function(from,to,delta){var now={};for(var i in from){var iFrom=from[i],iTo=to[i],iNow=now[i]={};for(var p in iFrom){iNow[p]=this.parent(iFrom[p],iTo[p],delta);}}return now;},set:function(now){for(var i in now){var iNow=now[i];for(var p in iNow){this.render(this.elements[i],p,iNow[p],this.options.unit);}}return this;},start:function(obj){if(!this.check(obj)){return this;}var from={},to={};for(var i in obj){var iProps=obj[i],iFrom=from[i]={},iTo=to[i]={};for(var p in iProps){var parsed=this.prepare(this.elements[i],p,iProps[p]);iFrom[p]=parsed.from;iTo[p]=parsed.to;}}return this.parent(from,to);}});Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:true},initialize:function(element,options){this.element=this.subject=document.id(element);this.parent(options);var cancel=this.cancel.bind(this,false);if($type(this.element)!="element"){this.element=document.id(this.element.getDocument().body);}var stopper=this.element;if(this.options.wheelStops){this.addEvent("start",function(){stopper.addEvent("mousewheel",cancel);},true);this.addEvent("complete",function(){stopper.removeEvent("mousewheel",cancel);},true);}},set:function(){var now=Array.flatten(arguments);if(Browser.Engine.gecko){now=[Math.round(now[0]),Math.round(now[1])];}this.element.scrollTo(now[0],now[1]);},compute:function(from,to,delta){return[0,1].map(function(i){return Fx.compute(from[i],to[i],delta);});},start:function(x,y){if(!this.check(x,y)){return this;}var scrollSize=this.element.getScrollSize(),scroll=this.element.getScroll(),values={x:x,y:y};for(var z in values){var max=scrollSize[z];if($chk(values[z])){values[z]=($type(values[z])=="number")?values[z]:max;}else{values[z]=scroll[z];}values[z]+=this.options.offset[z];}return this.parent([scroll.x,scroll.y],[values.x,values.y]);},toTop:function(){return this.start(false,0);},toLeft:function(){return this.start(0,false);},toRight:function(){return this.start("right",false);},toBottom:function(){return this.start(false,"bottom");},toElement:function(el){var position=document.id(el).getPosition(this.element);return this.start(position.x,position.y);},scrollIntoView:function(el,axes,offset){axes=axes?$splat(axes):["x","y"];var to={};el=document.id(el);var pos=el.getPosition(this.element);var size=el.getSize();var scroll=this.element.getScroll();var containerSize=this.element.getSize();var edge={x:pos.x+size.x,y:pos.y+size.y};["x","y"].each(function(axis){if(axes.contains(axis)){if(edge[axis]>scroll[axis]+containerSize[axis]){to[axis]=edge[axis]-containerSize[axis];}if(pos[axis]<scroll[axis]){to[axis]=pos[axis];}}if(to[axis]==null){to[axis]=scroll[axis];}if(offset&&offset[axis]){to[axis]=to[axis]+offset[axis];}},this);if(to.x!=scroll.x||to.y!=scroll.y){this.start(to.x,to.y);}return this;},scrollToCenter:function(el,axes,offset){axes=axes?$splat(axes):["x","y"];el=$(el);var to={},pos=el.getPosition(this.element),size=el.getSize(),scroll=this.element.getScroll(),containerSize=this.element.getSize(),edge={x:pos.x+size.x,y:pos.y+size.y};["x","y"].each(function(axis){if(axes.contains(axis)){to[axis]=pos[axis]-(containerSize[axis]-size[axis])/2;}if(to[axis]==null){to[axis]=scroll[axis];}if(offset&&offset[axis]){to[axis]=to[axis]+offset[axis];}},this);if(to.x!=scroll.x||to.y!=scroll.y){this.start(to.x,to.y);}return this;}});Fx.Slide=new Class({Extends:Fx,options:{mode:"vertical",hideOverflow:true},initialize:function(element,options){this.addEvent("complete",function(){this.open=(this.wrapper["offset"+this.layout.capitalize()]!=0);if(this.open&&Browser.Engine.webkit419){this.element.dispose().inject(this.wrapper);}},true);this.element=this.subject=document.id(element);this.parent(options);var wrapper=this.element.retrieve("wrapper");var styles=this.element.getStyles("margin","position","overflow");if(this.options.hideOverflow){styles=$extend(styles,{overflow:"hidden"});}this.wrapper=wrapper||new Element("div",{styles:styles}).wraps(this.element);this.element.store("wrapper",this.wrapper).setStyle("margin",0);this.now=[];this.open=true;},vertical:function(){this.margin="margin-top";this.layout="height";this.offset=this.element.offsetHeight;},horizontal:function(){this.margin="margin-left";this.layout="width";this.offset=this.element.offsetWidth;},set:function(now){this.element.setStyle(this.margin,now[0]);this.wrapper.setStyle(this.layout,now[1]);return this;},compute:function(from,to,delta){return[0,1].map(function(i){return Fx.compute(from[i],to[i],delta);});},start:function(how,mode){if(!this.check(how,mode)){return this;}this[mode||this.options.mode]();var margin=this.element.getStyle(this.margin).toInt();var layout=this.wrapper.getStyle(this.layout).toInt();var caseIn=[[margin,layout],[0,this.offset]];var caseOut=[[margin,layout],[-this.offset,0]];var start;switch(how){case"in":start=caseIn;break;case"out":start=caseOut;break;case"toggle":start=(layout==0)?caseIn:caseOut;}return this.parent(start[0],start[1]);},slideIn:function(mode){return this.start("in",mode);},slideOut:function(mode){return this.start("out",mode);},hide:function(mode){this[mode||this.options.mode]();this.open=false;return this.set([-this.offset,0]);},show:function(mode){this[mode||this.options.mode]();this.open=true;return this.set([0,this.offset]);},toggle:function(mode){return this.start("toggle",mode);}});Element.Properties.slide={set:function(options){var slide=this.retrieve("slide");if(slide){slide.cancel();}return this.eliminate("slide").store("slide:options",$extend({link:"cancel"},options));},get:function(options){if(options||!this.retrieve("slide")){if(options||!this.retrieve("slide:options")){this.set("slide",options);}this.store("slide",new Fx.Slide(this,this.retrieve("slide:options")));}return this.retrieve("slide");}};Element.implement({slide:function(how,mode){how=how||"toggle";var slide=this.get("slide"),toggle;switch(how){case"hide":slide.hide(mode);break;case"show":slide.show(mode);break;case"toggle":var flag=this.retrieve("slide:flag",slide.open);slide[flag?"slideOut":"slideIn"](mode);this.store("slide:flag",!flag);toggle=true;break;default:slide.start(how,mode);}if(!toggle){this.eliminate("slide:flag");}return this;}});var SmoothScroll=Fx.SmoothScroll=new Class({Extends:Fx.Scroll,initialize:function(options,context){context=context||document;this.doc=context.getDocument();var win=context.getWindow();this.parent(this.doc,options);this.links=$$(this.options.links||this.doc.links);var location=win.location.href.match(/^[^#]*/)[0]+"#";this.links.each(function(link){if(link.href.indexOf(location)!=0){return;}var anchor=link.href.substr(location.length);if(anchor){this.useLink(link,anchor);}},this);if(!Browser.Engine.webkit419){this.addEvent("complete",function(){win.location.hash=this.anchor;},true);}},useLink:function(link,anchor){var el;link.addEvent("click",function(event){if(el!==false&&!el){el=document.id(anchor)||this.doc.getElement("a[name="+anchor+"]");}if(el){event.preventDefault();this.anchor=anchor;this.toElement(el).chain(function(){this.fireEvent("scrolledTo",[link,el]);}.bind(this));link.blur();}}.bind(this));}});Fx.Sort=new Class({Extends:Fx.Elements,options:{mode:"vertical"},initialize:function(elements,options){this.parent(elements,options);this.elements.each(function(el){if(el.getStyle("position")=="static"){el.setStyle("position","relative");}});this.setDefaultOrder();},setDefaultOrder:function(){this.currentOrder=this.elements.map(function(el,index){return index;});},sort:function(newOrder){if($type(newOrder)!="array"){return false;}var top=0,left=0,next={},zero={},vert=this.options.mode=="vertical";var current=this.elements.map(function(el,index){var size=el.getComputedSize({styles:["border","padding","margin"]});var val;if(vert){val={top:top,margin:size["margin-top"],height:size.totalHeight};top+=val.height-size["margin-top"];}else{val={left:left,margin:size["margin-left"],width:size.totalWidth};left+=val.width;}var plain=vert?"top":"left";zero[index]={};var start=el.getStyle(plain).toInt();zero[index][plain]=start||0;return val;},this);this.set(zero);newOrder=newOrder.map(function(i){return i.toInt();});if(newOrder.length!=this.elements.length){this.currentOrder.each(function(index){if(!newOrder.contains(index)){newOrder.push(index);}});if(newOrder.length>this.elements.length){newOrder.splice(this.elements.length-1,newOrder.length-this.elements.length);}}var margin=top=left=0;newOrder.each(function(item,index){var newPos={};if(vert){newPos.top=top-current[item].top-margin;top+=current[item].height;}else{newPos.left=left-current[item].left;left+=current[item].width;}margin=margin+current[item].margin;next[item]=newPos;},this);var mapped={};$A(newOrder).sort().each(function(index){mapped[index]=next[index];});this.start(mapped);this.currentOrder=newOrder;return this;},rearrangeDOM:function(newOrder){newOrder=newOrder||this.currentOrder;var parent=this.elements[0].getParent();var rearranged=[];this.elements.setStyle("opacity",0);newOrder.each(function(index){rearranged.push(this.elements[index].inject(parent).setStyles({top:0,left:0}));},this);this.elements.setStyle("opacity",1);this.elements=$$(rearranged);this.setDefaultOrder();return this;},getDefaultOrder:function(){return this.elements.map(function(el,index){return index;});},forward:function(){return this.sort(this.getDefaultOrder());},backward:function(){return this.sort(this.getDefaultOrder().reverse());},reverse:function(){return this.sort(this.currentOrder.reverse());},sortByElements:function(elements){return this.sort(elements.map(function(el){return this.elements.indexOf(el);},this));},swap:function(one,two){if($type(one)=="element"){one=this.elements.indexOf(one);}if($type(two)=="element"){two=this.elements.indexOf(two);}var newOrder=$A(this.currentOrder);newOrder[this.currentOrder.indexOf(one)]=two;newOrder[this.currentOrder.indexOf(two)]=one;return this.sort(newOrder);}});var Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:false,style:true,limit:false,handle:false,invert:false,preventDefault:false,stopPropagation:false,modifiers:{x:"left",y:"top"}},initialize:function(){var params=Array.link(arguments,{"options":Object.type,"element":$defined});this.element=document.id(params.element);this.document=this.element.getDocument();this.setOptions(params.options||{});var htype=$type(this.options.handle);this.handles=((htype=="array"||htype=="collection")?$$(this.options.handle):document.id(this.options.handle))||this.element;this.mouse={"now":{},"pos":{}};this.value={"start":{},"now":{}};this.selection=(Browser.Engine.trident)?"selectstart":"mousedown";this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:$lambda(false)};this.attach();},attach:function(){this.handles.addEvent("mousedown",this.bound.start);return this;},detach:function(){this.handles.removeEvent("mousedown",this.bound.start);return this;},start:function(event){if(event.rightClick){return;}if(this.options.preventDefault){event.preventDefault();}if(this.options.stopPropagation){event.stopPropagation();}this.mouse.start=event.page;this.fireEvent("beforeStart",this.element);var limit=this.options.limit;this.limit={x:[],y:[]};for(var z in this.options.modifiers){if(!this.options.modifiers[z]){continue;}if(this.options.style){this.value.now[z]=this.element.getStyle(this.options.modifiers[z]).toInt();}else{this.value.now[z]=this.element[this.options.modifiers[z]];}if(this.options.invert){this.value.now[z]*=-1;}this.mouse.pos[z]=event.page[z]-this.value.now[z];if(limit&&limit[z]){for(var i=2;i--;i){if($chk(limit[z][i])){this.limit[z][i]=$lambda(limit[z][i])();}}}}if($type(this.options.grid)=="number"){this.options.grid={x:this.options.grid,y:this.options.grid};}this.document.addEvents({mousemove:this.bound.check,mouseup:this.bound.cancel});this.document.addEvent(this.selection,this.bound.eventStop);},check:function(event){if(this.options.preventDefault){event.preventDefault();}var distance=Math.round(Math.sqrt(Math.pow(event.page.x-this.mouse.start.x,2)+Math.pow(event.page.y-this.mouse.start.y,2)));if(distance>this.options.snap){this.cancel();this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop});this.fireEvent("start",[this.element,event]).fireEvent("snap",this.element);}},drag:function(event){if(this.options.preventDefault){event.preventDefault();}this.mouse.now=event.page;for(var z in this.options.modifiers){if(!this.options.modifiers[z]){continue;}this.value.now[z]=this.mouse.now[z]-this.mouse.pos[z];if(this.options.invert){this.value.now[z]*=-1;}if(this.options.limit&&this.limit[z]){if($chk(this.limit[z][1])&&(this.value.now[z]>this.limit[z][1])){this.value.now[z]=this.limit[z][1];}else{if($chk(this.limit[z][0])&&(this.value.now[z]<this.limit[z][0])){this.value.now[z]=this.limit[z][0];}}}if(this.options.grid[z]){this.value.now[z]-=((this.value.now[z]-(this.limit[z][0]||0))%this.options.grid[z]);}if(this.options.style){this.element.setStyle(this.options.modifiers[z],this.value.now[z]+this.options.unit);}else{this.element[this.options.modifiers[z]]=this.value.now[z];}}this.fireEvent("drag",[this.element,event]);},cancel:function(event){this.document.removeEvent("mousemove",this.bound.check);this.document.removeEvent("mouseup",this.bound.cancel);if(event){this.document.removeEvent(this.selection,this.bound.eventStop);this.fireEvent("cancel",this.element);}},stop:function(event){this.document.removeEvent(this.selection,this.bound.eventStop);this.document.removeEvent("mousemove",this.bound.drag);this.document.removeEvent("mouseup",this.bound.stop);if(event){this.fireEvent("complete",[this.element,event]);}}});Element.implement({makeResizable:function(options){var drag=new Drag(this,$merge({modifiers:{x:"width",y:"height"}},options));this.store("resizer",drag);return drag.addEvent("drag",function(){this.fireEvent("resize",drag);}.bind(this));}});Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:false,precalculate:false,includeMargins:true,checkDroppables:true},initialize:function(element,options){this.parent(element,options);element=this.element;this.droppables=$$(this.options.droppables);this.container=document.id(this.options.container);if(this.container&&$type(this.container)!="element"){this.container=document.id(this.container.getDocument().body);}var styles=element.getStyles("left","right","position");if(styles.left=="auto"||styles.top=="auto"){element.setPosition(element.getPosition(element.getOffsetParent()));}if(styles.position=="static"){element.setStyle("position","absolute");}this.addEvent("start",this.checkDroppables,true);this.overed=null;},start:function(event){if(this.container){this.options.limit=this.calculateLimit();}if(this.options.precalculate){this.positions=this.droppables.map(function(el){return el.getCoordinates();});}this.parent(event);},calculateLimit:function(){var offsetParent=this.element.getOffsetParent(),containerCoordinates=this.container.getCoordinates(offsetParent),containerBorder={},elementMargin={},elementBorder={},containerMargin={},offsetParentPadding={};["top","right","bottom","left"].each(function(pad){containerBorder[pad]=this.container.getStyle("border-"+pad).toInt();elementBorder[pad]=this.element.getStyle("border-"+pad).toInt();elementMargin[pad]=this.element.getStyle("margin-"+pad).toInt();containerMargin[pad]=this.container.getStyle("margin-"+pad).toInt();offsetParentPadding[pad]=offsetParent.getStyle("padding-"+pad).toInt();},this);var width=this.element.offsetWidth+elementMargin.left+elementMargin.right,height=this.element.offsetHeight+elementMargin.top+elementMargin.bottom,left=0,top=0,right=containerCoordinates.right-containerBorder.right-width,bottom=containerCoordinates.bottom-containerBorder.bottom-height;if(this.options.includeMargins){left+=elementMargin.left;top+=elementMargin.top;}else{right+=elementMargin.right;bottom+=elementMargin.bottom;}if(this.element.getStyle("position")=="relative"){var coords=this.element.getCoordinates(offsetParent);coords.left-=this.element.getStyle("left").toInt();coords.top-=this.element.getStyle("top").toInt();left+=containerBorder.left-coords.left;top+=containerBorder.top-coords.top;right+=elementMargin.left-coords.left;bottom+=elementMargin.top-coords.top;if(this.container!=offsetParent){left+=containerMargin.left+offsetParentPadding.left;top+=(Browser.Engine.trident4?0:containerMargin.top)+offsetParentPadding.top;}}else{left-=elementMargin.left;top-=elementMargin.top;if(this.container==offsetParent){right-=containerBorder.left;bottom-=containerBorder.top;}else{left+=containerCoordinates.left+containerBorder.left;top+=containerCoordinates.top+containerBorder.top;}}return{x:[left,right],y:[top,bottom]};},checkAgainst:function(el,i){el=(this.positions)?this.positions[i]:el.getCoordinates();var now=this.mouse.now;return(now.x>el.left&&now.x<el.right&&now.y<el.bottom&&now.y>el.top);},checkDroppables:function(){var overed=this.droppables.filter(this.checkAgainst,this).getLast();if(this.overed!=overed){if(this.overed){this.fireEvent("leave",[this.element,this.overed]);}if(overed){this.fireEvent("enter",[this.element,overed]);}this.overed=overed;}},drag:function(event){this.parent(event);if(this.options.checkDroppables&&this.droppables.length){this.checkDroppables();}},stop:function(event){this.checkDroppables();this.fireEvent("drop",[this.element,this.overed,event]);this.overed=null;return this.parent(event);}});Element.implement({makeDraggable:function(options){var drag=new Drag.Move(this,options);this.store("dragger",drag);return drag;}});var Sortables=new Class({Implements:[Events,Options],options:{snap:4,opacity:1,clone:false,revert:false,handle:false,constrain:false},initialize:function(lists,options){this.setOptions(options);this.elements=[];this.lists=[];this.idle=true;this.addLists($$(document.id(lists)||lists));if(!this.options.clone){this.options.revert=false;}if(this.options.revert){this.effect=new Fx.Morph(null,$merge({duration:250,link:"cancel"},this.options.revert));}},attach:function(){this.addLists(this.lists);return this;},detach:function(){this.lists=this.removeLists(this.lists);return this;},addItems:function(){Array.flatten(arguments).each(function(element){this.elements.push(element);var start=element.retrieve("sortables:start",this.start.bindWithEvent(this,element));(this.options.handle?element.getElement(this.options.handle)||element:element).addEvent("mousedown",start);},this);return this;},addLists:function(){Array.flatten(arguments).each(function(list){this.lists.push(list);this.addItems(list.getChildren());},this);return this;},removeItems:function(){return $$(Array.flatten(arguments).map(function(element){this.elements.erase(element);var start=element.retrieve("sortables:start");(this.options.handle?element.getElement(this.options.handle)||element:element).removeEvent("mousedown",start);return element;},this));},removeLists:function(){return $$(Array.flatten(arguments).map(function(list){this.lists.erase(list);this.removeItems(list.getChildren());return list;},this));},getClone:function(event,element){if(!this.options.clone){return new Element("div").inject(document.body);}if($type(this.options.clone)=="function"){return this.options.clone.call(this,event,element,this.list);}return element.clone(true).setStyles({margin:"0px",position:"absolute",visibility:"hidden","width":element.getStyle("width")}).inject(this.list).setPosition(element.getPosition(element.getOffsetParent()));},getDroppables:function(){var droppables=this.list.getChildren();if(!this.options.constrain){droppables=this.lists.concat(droppables).erase(this.list);}return droppables.erase(this.clone).erase(this.element);},insert:function(dragging,element){var where="inside";if(this.lists.contains(element)){this.list=element;this.drag.droppables=this.getDroppables();}else{where=this.element.getAllPrevious().contains(element)?"before":"after";}this.element.inject(element,where);this.fireEvent("sort",[this.element,this.clone]);},start:function(event,element){if(!this.idle){return;}this.idle=false;this.element=element;this.opacity=element.get("opacity");this.list=element.getParent();this.clone=this.getClone(event,element);this.drag=new Drag.Move(this.clone,{snap:this.options.snap,container:this.options.constrain&&this.element.getParent(),droppables:this.getDroppables(),onSnap:function(){event.stop();this.clone.setStyle("visibility","visible");this.element.set("opacity",this.options.opacity||0);this.fireEvent("start",[this.element,this.clone]);}.bind(this),onEnter:this.insert.bind(this),onCancel:this.reset.bind(this),onComplete:this.end.bind(this)});this.clone.inject(this.element,"before");this.drag.start(event);},end:function(){this.drag.detach();this.element.set("opacity",this.opacity);if(this.effect){var dim=this.element.getStyles("width","height");var pos=this.clone.computePosition(this.element.getPosition(this.clone.offsetParent));this.effect.element=this.clone;this.effect.start({top:pos.top,left:pos.left,width:dim.width,height:dim.height,opacity:0.25}).chain(this.reset.bind(this));}else{this.reset();}},reset:function(){this.idle=true;this.clone.destroy();this.fireEvent("complete",this.element);},serialize:function(){var params=Array.link(arguments,{modifier:Function.type,index:$defined});var serial=this.lists.map(function(list){return list.getChildren().map(params.modifier||function(element){return element.get("id");},this);},this);var index=params.index;if(this.lists.length==1){index=0;}return $chk(index)&&index>=0&&index<this.lists.length?serial[index]:serial;}});var Asset={javascript:function(source,properties){properties=$extend({onload:$empty,document:document,check:$lambda(true)},properties);var script=new Element("script",{src:source,type:"text/javascript"});var load=properties.onload.bind(script),check=properties.check,doc=properties.document;delete properties.onload;delete properties.check;delete properties.document;script.addEvents({load:load,readystatechange:function(){if(["loaded","complete"].contains(this.readyState)){load();}}}).set(properties);if(Browser.Engine.webkit419){var checker=(function(){if(!$try(check)){return;}$clear(checker);load();}).periodical(50);}return script.inject(doc.head);},css:function(source,properties){return new Element("link",$merge({rel:"stylesheet",media:"screen",type:"text/css",href:source},properties)).inject(document.head);},image:function(source,properties){properties=$merge({onload:$empty,onabort:$empty,onerror:$empty},properties);var image=new Image();var element=document.id(image)||new Element("img");["load","abort","error"].each(function(name){var type="on"+name;var event=properties[type];delete properties[type];image[type]=function(){if(!image){return;}if(!element.parentNode){element.width=image.width;element.height=image.height;}image=image.onload=image.onabort=image.onerror=null;event.delay(1,element,element);element.fireEvent(name,element,1);};});image.src=element.src=source;if(image&&image.complete){image.onload.delay(1);}return element.set(properties);},images:function(sources,options){options=$merge({onComplete:$empty,onProgress:$empty,onError:$empty,properties:{}},options);sources=$splat(sources);var images=[];var counter=0;return new Elements(sources.map(function(source){return Asset.image(source,$extend(options.properties,{onload:function(){options.onProgress.call(this,counter,sources.indexOf(source));counter++;if(counter==sources.length){options.onComplete();}},onerror:function(){options.onError.call(this,counter,sources.indexOf(source));counter++;if(counter==sources.length){options.onComplete();}}}));}));}};var IframeShim=new Class({Implements:[Options,Events,Class.Occlude],options:{className:"iframeShim",src:'javascript:false;document.write("");',display:false,zIndex:null,margin:0,offset:{x:0,y:0},browsers:(Browser.Engine.trident4||(Browser.Engine.gecko&&!Browser.Engine.gecko19&&Browser.Platform.mac))},property:"IframeShim",initialize:function(element,options){this.element=document.id(element);if(this.occlude()){return this.occluded;}this.setOptions(options);this.makeShim();return this;},makeShim:function(){if(this.options.browsers){var zIndex=this.element.getStyle("zIndex").toInt();if(!zIndex){zIndex=1;var pos=this.element.getStyle("position");if(pos=="static"||!pos){this.element.setStyle("position","relative");}this.element.setStyle("zIndex",zIndex);}zIndex=($chk(this.options.zIndex)&&zIndex>this.options.zIndex)?this.options.zIndex:zIndex-1;if(zIndex<0){zIndex=1;}this.shim=new Element("iframe",{src:this.options.src,scrolling:"no",frameborder:0,styles:{zIndex:zIndex,position:"absolute",border:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"},"class":this.options.className}).store("IframeShim",this);var inject=(function(){this.shim.inject(this.element,"after");this[this.options.display?"show":"hide"]();this.fireEvent("inject");}).bind(this);if(IframeShim.ready){window.addEvent("load",inject);}else{inject();}}else{this.position=this.hide=this.show=this.dispose=$lambda(this);}},position:function(){if(!IframeShim.ready||!this.shim){return this;}var size=this.element.measure(function(){return this.getSize();});if(this.options.margin!=undefined){size.x=size.x-(this.options.margin*2);size.y=size.y-(this.options.margin*2);this.options.offset.x+=this.options.margin;this.options.offset.y+=this.options.margin;}this.shim.set({width:size.x,height:size.y}).position({relativeTo:this.element,offset:this.options.offset});return this;},hide:function(){if(this.shim){this.shim.setStyle("display","none");}return this;},show:function(){if(this.shim){this.shim.setStyle("display","block");}return this.position();},dispose:function(){if(this.shim){this.shim.dispose();}return this;},destroy:function(){if(this.shim){this.shim.destroy();}return this;}});window.addEvent("load",function(){IframeShim.ready=true;});MooTools.lang.set("en-US","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dateOrder:["month","date","year"],shortDate:"%m/%d/%Y",shortTime:"%I:%M%p",AM:"AM",PM:"PM",ordinal:function(dayOfMonth){return(dayOfMonth>3&&dayOfMonth<21)?"th":["th","st","nd","rd","th"][Math.min(dayOfMonth%10,4)];},lessThanMinuteAgo:"less than a minute ago",minuteAgo:"about a minute ago",minutesAgo:"{delta} minutes ago",hourAgo:"about an hour ago",hoursAgo:"about {delta} hours ago",dayAgo:"1 day ago",daysAgo:"{delta} days ago",weekAgo:"1 week ago",weeksAgo:"{delta} weeks ago",monthAgo:"1 month ago",monthsAgo:"{delta} months ago",yearAgo:"1 year ago",yearsAgo:"{delta} years ago",lessThanMinuteUntil:"less than a minute from now",minuteUntil:"about a minute from now",minutesUntil:"{delta} minutes from now",hourUntil:"about an hour from now",hoursUntil:"about {delta} hours from now",dayUntil:"1 day from now",daysUntil:"{delta} days from now",weekUntil:"1 week from now",weeksUntil:"{delta} weeks from now",monthUntil:"1 month from now",monthsUntil:"{delta} months from now",yearUntil:"1 year from now",yearsUntil:"{delta} years from now"});MooTools.lang.set("en-US","Form.Validator",{required:"This field is required.",minLength:"Please enter at least {minLength} characters (you entered {length} characters).",maxLength:"Please enter no more than {maxLength} characters (you entered {length} characters).",integer:"Please enter an integer in this field. Numbers with decimals (e.g. 1.25) are not permitted.",numeric:'Please enter only numeric values in this field (i.e. "1" or "1.1" or "-1" or "-1.1").',digits:"Please use numbers and punctuation only in this field (for example, a phone number with dashes or dots is permitted).",alpha:"Please use letters only (a-z) with in this field. No spaces or other characters are allowed.",alphanum:"Please use only letters (a-z) or numbers (0-9) only in this field. No spaces or other characters are allowed.",dateSuchAs:"Please enter a valid date such as {date}",dateInFormatMDY:'Please enter a valid date such as MM/DD/YYYY (i.e. "12/31/1999")',email:'Please enter a valid email address. For example "fred@domain.com".',url:"Please enter a valid URL such as http://www.google.com.",currencyDollar:"Please enter a valid $ amount. For example $100.00 .",oneRequired:"Please enter something for at least one of these inputs.",errorPrefix:"Error: ",warningPrefix:"Warning: ",noSpace:"There can be no spaces in this input.",reqChkByNode:"No items are selected.",requiredChk:"This field is required.",reqChkByName:"Please select a {label}.",match:"This field needs to match the {matchName} field",startDate:"the start date",endDate:"the end date",currendDate:"the current date",afterDate:"The date should be the same or after {label}.",beforeDate:"The date should be the same or before {label}.",startMonth:"Please select a start month",sameMonth:"These two dates must be in the same month - you must change one or the other.",creditcard:"The credit card number entered is invalid. Please check the number and try again. {length} digits entered."});var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else{if(isNaN(chr3)){enc4=64;}}output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);}return output;},decode:function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=this._keyStr.indexOf(input.charAt(i++));enc2=this._keyStr.indexOf(input.charAt(i++));enc3=this._keyStr.indexOf(input.charAt(i++));enc4=this._keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2);}if(enc4!=64){output=output+String.fromCharCode(chr3);}}output=Base64._utf8_decode(output);return output;},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}else{if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}}return utftext;},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}else{if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}}return string;}};var CSS=new Class({local:{self:"CSS",limited:["dpi","border-radius"],_rule:""},options:{rules:{}},xhtml:{_style:null},initialize:function(options){this.local=$merge(this.local,this.options,options,this.xhtml);},destroy:function(){if(this.local._style){this.local._style.destroy();}},refresh:function(){var text="";Hash.each(this.local.rules,function(rule,selector){this.local._rule="";Hash.each(rule,this._glue,this);text+=(this.local._rule==""?"":selector+"\n{\n"+this.local._rule+"}\n");},this);this.destroy();this.local._style=new Element("style").set("type","text/css").inject(document.head);switch(Browser.Engine.name){case"trident":this.local._style.styleSheet.cssText=text;break;default:this.local._style.set("text",text);break;}return this;},_glue:function(value,property){if(this[Browser.Engine.name+"_"+property]){var pair;if(pair=this[Browser.Engine.name+"_"+property](value,property)){this.local._rule+="\t"+pair[0]+":"+pair[1]+";\n";}}else{if(!this.local.limited.contains(property)){this.local._rule+="\t"+property+":"+value+";\n";}}},add_prop:function(selector,property,value){var rules={};rules[selector]={};rules[selector][property]=value;return this.add_rules(rules);},add_rule:function(selector,properties){var rules={};rules[selector]=properties;return this.add_rules(rules);},add_rules:function(rules){this.local.rules=$merge(this.local.rules,rules);return this;},remove_prop:function(selector,property){delete this.local.rules[selector][property];return this;},remove_rule:function(selector){delete this.local.rules[selector];return this;},remove_rules:function(selectors){if(selectors){selectors.each(this.remove_rule,this);}else{this.local.rules={};}return this;},check_rule:function(selector){return $defined(this.local.rules[selector]);}});CSS.implement({"trident_opacity":function(value,property){return["filter","alpha(opacity="+(value*100)+")"];},"trident_dpi":function(value,property){if($defined(window.screen.deviceXDPI)){return["font-size",((96/window.screen.deviceXDPI)*value).round()+"%"];}else{return["font-size",value+"%"];}},"gecko_border-radius":function(value,property){return["-moz-"+property,value];},"webkit_border-radius":function(value,property){return["-webkit-"+property,value];}});var GeoHash={BITS:[16,8,4,2,1],BASE32:"0123456789bcdefghjkmnpqrstuvwxyz",NEIGHBORS:{right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}},BORDERS:{right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}},init:function(){GeoHash.NEIGHBORS.bottom.odd=GeoHash.NEIGHBORS.left.even,GeoHash.NEIGHBORS.top.odd=GeoHash.NEIGHBORS.right.even,GeoHash.NEIGHBORS.left.odd=GeoHash.NEIGHBORS.bottom.even,GeoHash.NEIGHBORS.right.odd=GeoHash.NEIGHBORS.top.even,GeoHash.BORDERS.bottom.odd=GeoHash.BORDERS.left.even;GeoHash.BORDERS.top.odd=GeoHash.BORDERS.right.even;GeoHash.BORDERS.left.odd=GeoHash.BORDERS.bottom.even;GeoHash.BORDERS.right.odd=GeoHash.BORDERS.top.even;},refine_interval:function(interval,cd,mask){if(cd&mask){interval[0]=(interval[0]+interval[1])/2;}else{interval[1]=(interval[0]+interval[1])/2;}},calculateAdjacent:function(srcHash,dir){srcHash=srcHash.toLowerCase();var lastChr=srcHash.charAt(srcHash.length-1);var type=(srcHash.length%2)?"odd":"even";var base=srcHash.substring(0,srcHash.length-1);if(GeoHash.BORDERS[dir][type].indexOf(lastChr)!=-1){base=GeoHash.calculateAdjacent(base,dir);}return base+GeoHash.BASE32[GeoHash.NEIGHBORS[dir][type].indexOf(lastChr)];},decodeGeoHash:function(geohash){var is_even=1;var lat=[];var lon=[];lat[0]=-90;lat[1]=90;lon[0]=-180;lon[1]=180;lat_err=90;lon_err=180;for(i=0;i<geohash.length;i++){c=geohash[i];cd=GeoHash.BASE32.indexOf(c);for(j=0;j<5;j++){mask=GeoHash.BITS[j];if(is_even){lon_err/=2;GeoHash.refine_interval(lon,cd,mask);}else{lat_err/=2;GeoHash.refine_interval(lat,cd,mask);}is_even=!is_even;}}lat[2]=(lat[0]+lat[1])/2;lon[2]=(lon[0]+lon[1])/2;return{lat:lat,lng:lon};},encodeGeoHash:function(latitude,longitude){var is_even=1;var i=0;var lat=[];var lon=[];var bit=0;var ch=0;var precision=12;geohash="";lat[0]=-90;lat[1]=90;lon[0]=-180;lon[1]=180;while(geohash.length<precision){if(is_even){mid=(lon[0]+lon[1])/2;if(longitude>mid){ch|=GeoHash.BITS[bit];lon[0]=mid;}else{lon[1]=mid;}}else{mid=(lat[0]+lat[1])/2;if(latitude>mid){ch|=GeoHash.BITS[bit];lat[0]=mid;}else{lat[1]=mid;}}is_even=!is_even;if(bit<4){bit++;}else{geohash+=GeoHash.BASE32[ch];bit=0;ch=0;}}return geohash;}};GeoHash.init();var HistoryManager=(function(){var HistoryManagerSingleton=new Class({initialize:function(){this._currentLocation=this._getHash();var historyManager=this;if(window.ie){this.addState=this._addStateIE;this._iframe=new Element("iframe",{src:"javascript:'<html></html>'",styles:{"position":"absolute","top":"-1000px"}}).inject(document.body).contentWindow;$justForIE=function(hash){historyManager._getHash=function(){return hash;};historyManager._monitorDefault.call(historyManager);location.hash=hash;};function waitForIframeLoad(){if(historyManager._iframe&&historyManager._iframe.document&&historyManager._iframe.document.body){if(!historyManager._iframe.document.body.innerHTML){historyManager.addState(historyManager._currentLocation,true);}}else{setTimeout(waitForIframeLoad,50);}}waitForIframeLoad();}else{if(window.webkit419){this._form=new Element("form",{method:"get"}).inject(document.body);this._historyCounter=history.length;this._stateHistory=[];this._stateHistory[history.length]=this._getHash();this.addState=this._addStateSafari;this._monitorSafari.periodical(250,this);}else{if(window.opera){this.addState=this._addStateDefault;$justForOpera=function(){historyManager._monitorDefault.call(historyManager);};new Element("img",{src:"javascript:location.href='javascript:$justForOpera();';",style:"position: absolute; top: -1000px;"}).inject(document.body);}else{this.addState=this._addStateDefault;this._monitorDefault.periodical(250,this);}}}},getCurrentLocation:function(){return this._currentLocation;},_getHash:function(){return location.href.split("#")[1]||"";},_addStateIE:function(hash,override){if(this._currentLocation==hash&&!override){return;}this._currentLocation=hash;this._iframe.document.write("<html><body onload=\"top.$justForIE('",hash,"');\">Loaded</body></html>");this._iframe.document.close();},_addStateSafari:function(hash){if(this._currentLocation==hash){return;}this._form.setProperty("action","#"+hash).submit();this._currentLocation=hash;this._stateHistory[history.length]=this._getHash();this._historyCounter=history.length;},_monitorSafari:function(){if(history.length!=this._historyCounter){this._historyCounter=history.length;this._currentLocation=this._stateHistory[history.length];this.fireEvent("onHistoryChange",[this._stateHistory[history.length]]);}},_addStateDefault:function(hash){if(this._currentLocation==hash){return;}location.hash="#"+hash;this._currentLocation=hash;},_monitorDefault:function(){var hash=this._getHash();if(hash!=this._currentLocation){this._currentLocation=hash;this.fireEvent("onHistoryChange",[hash]);}}});HistoryManagerSingleton.implement(new Events);var singleton;return function(){return singleton?singleton:singleton=new HistoryManagerSingleton();};})();var JSJAC_HAVEKEYS=true;var JSJAC_NKEYS=16;var JSJAC_INACTIVITY=300;var JSJAC_ERR_COUNT=10;var JSJAC_ALLOW_PLAIN=true;var JSJAC_CHECKQUEUEINTERVAL=500;var JSJAC_CHECKINQUEUEINTERVAL=500;var JSJACHBC_BOSH_VERSION="1.6";var JSJACHBC_USE_BOSH_VER=true;var JSJACHBC_MAX_HOLD=1;var JSJACHBC_MAX_WAIT=300;var JSJACHBC_MAXPAUSE=120;String.prototype.htmlEnc=function(){var str=this.replace(/&/g,"&amp;");str=str.replace(/</g,"&lt;");str=str.replace(/>/g,"&gt;");str=str.replace(/\"/g,"&quot;");str=str.replace(/\n/g,"<br />");return str;};Date.jab2date=function(ts){var date=new Date(Date.UTC(ts.substr(0,4),ts.substr(5,2)-1,ts.substr(8,2),ts.substr(11,2),ts.substr(14,2),ts.substr(17,2)));if(ts.substr(ts.length-6,1)!="Z"){var offset=new Date();offset.setTime(0);offset.setUTCHours(ts.substr(ts.length-5,2));offset.setUTCMinutes(ts.substr(ts.length-2,2));if(ts.substr(ts.length-6,1)=="+"){date.setTime(date.getTime()-offset.getTime());}else{if(ts.substr(ts.length-6,1)=="-"){date.setTime(date.getTime()+offset.getTime());}}}return date;};Date.hrTime=function(ts){return Date.jab2date(ts).toLocaleString();};Date.prototype.jabberDate=function(){var padZero=function(i){if(i<10){return"0"+i;}return i;};var jDate=this.getUTCFullYear()+"-";jDate+=padZero(this.getUTCMonth()+1)+"-";jDate+=padZero(this.getUTCDate())+"T";jDate+=padZero(this.getUTCHours())+":";jDate+=padZero(this.getUTCMinutes())+":";jDate+=padZero(this.getUTCSeconds())+"Z";return jDate;};Number.max=function(A,B){return(A>B)?A:B;};var hexcase=0;var b64pad="=";var chrsz=8;function hex_sha1(s){return binb2hex(core_sha1(str2binb(s),s.length*chrsz));}function b64_sha1(s){return binb2b64(core_sha1(str2binb(s),s.length*chrsz));}function str_sha1(s){return binb2str(core_sha1(str2binb(s),s.length*chrsz));}function hex_hmac_sha1(key,data){return binb2hex(core_hmac_sha1(key,data));}function b64_hmac_sha1(key,data){return binb2b64(core_hmac_sha1(key,data));}function str_hmac_sha1(key,data){return binb2str(core_hmac_sha1(key,data));}function sha1_vm_test(){return hex_sha1("abc")=="a9993e364706816aba3e25717850c26c9cd0d89d";}function core_sha1(x,len){x[len>>5]|=128<<(24-len%32);x[((len+64>>9)<<4)+15]=len;var w=Array(80);var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;var e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;var olde=e;for(var j=0;j<80;j++){if(j<16){w[j]=x[i+j];}else{w[j]=rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);}var t=safe_add(safe_add(rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w[j]),sha1_kt(j)));e=d;d=c;c=rol(b,30);b=a;a=t;}a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);e=safe_add(e,olde);}return Array(a,b,c,d,e);}function sha1_ft(t,b,c,d){if(t<20){return(b&c)|((~b)&d);}if(t<40){return b^c^d;}if(t<60){return(b&c)|(b&d)|(c&d);}return b^c^d;}function sha1_kt(t){return(t<20)?1518500249:(t<40)?1859775393:(t<60)?-1894007588:-899497514;}function core_hmac_sha1(key,data){var bkey=str2binb(key);if(bkey.length>16){bkey=core_sha1(bkey,key.length*chrsz);}var ipad=Array(16),opad=Array(16);for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828;}var hash=core_sha1(ipad.concat(str2binb(data)),512+data.length*chrsz);return core_sha1(opad.concat(hash),512+160);}function rol(num,cnt){return(num<<cnt)|(num>>>(32-cnt));}function str2binb(str){var bin=Array();var mask=(1<<chrsz)-1;for(var i=0;i<str.length*chrsz;i+=chrsz){bin[i>>5]|=(str.charCodeAt(i/chrsz)&mask)<<(32-chrsz-i%32);}return bin;}function binb2str(bin){var str="";var mask=(1<<chrsz)-1;for(var i=0;i<bin.length*32;i+=chrsz){str+=String.fromCharCode((bin[i>>5]>>>(32-chrsz-i%32))&mask);}return str;}function binb2hex(binarray){var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef";var str="";for(var i=0;i<binarray.length*4;i++){str+=hex_tab.charAt((binarray[i>>2]>>((3-i%4)*8+4))&15)+hex_tab.charAt((binarray[i>>2]>>((3-i%4)*8))&15);}return str;}function binb2b64(binarray){var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var str="";for(var i=0;i<binarray.length*4;i+=3){var triplet=(((binarray[i>>2]>>8*(3-i%4))&255)<<16)|(((binarray[i+1>>2]>>8*(3-(i+1)%4))&255)<<8)|((binarray[i+2>>2]>>8*(3-(i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>binarray.length*32){str+=b64pad;}else{str+=tab.charAt((triplet>>6*(3-j))&63);}}}return str;}function hex_md5(s){return binl2hex(core_md5(str2binl(s),s.length*chrsz));}function b64_md5(s){return binl2b64(core_md5(str2binl(s),s.length*chrsz));}function str_md5(s){return binl2str(core_md5(str2binl(s),s.length*chrsz));}function hex_hmac_md5(key,data){return binl2hex(core_hmac_md5(key,data));}function b64_hmac_md5(key,data){return binl2b64(core_hmac_md5(key,data));}function str_hmac_md5(key,data){return binl2str(core_hmac_md5(key,data));}function md5_vm_test(){return hex_md5("abc")=="900150983cd24fb0d6963f7d28e17f72";}function core_md5(x,len){x[len>>5]|=128<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);}return Array(a,b,c,d);}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b);}function md5_ff(a,b,c,d,x,s,t){return md5_cmn((b&c)|((~b)&d),a,b,x,s,t);}function md5_gg(a,b,c,d,x,s,t){return md5_cmn((b&d)|(c&(~d)),a,b,x,s,t);}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t);}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|(~d)),a,b,x,s,t);}function core_hmac_md5(key,data){var bkey=str2binl(key);if(bkey.length>16){bkey=core_md5(bkey,key.length*chrsz);}var ipad=Array(16),opad=Array(16);for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828;}var hash=core_md5(ipad.concat(str2binl(data)),512+data.length*chrsz);return core_md5(opad.concat(hash),512+128);}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&65535);}function bit_rol(num,cnt){return(num<<cnt)|(num>>>(32-cnt));}function str2binl(str){var bin=Array();var mask=(1<<chrsz)-1;for(var i=0;i<str.length*chrsz;i+=chrsz){bin[i>>5]|=(str.charCodeAt(i/chrsz)&mask)<<(i%32);}return bin;}function binl2str(bin){var str="";var mask=(1<<chrsz)-1;for(var i=0;i<bin.length*32;i+=chrsz){str+=String.fromCharCode((bin[i>>5]>>>(i%32))&mask);}return str;}function binl2hex(binarray){var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef";var str="";for(var i=0;i<binarray.length*4;i++){str+=hex_tab.charAt((binarray[i>>2]>>((i%4)*8+4))&15)+hex_tab.charAt((binarray[i>>2]>>((i%4)*8))&15);}return str;}function binl2b64(binarray){var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var str="";for(var i=0;i<binarray.length*4;i+=3){var triplet=(((binarray[i>>2]>>8*(i%4))&255)<<16)|(((binarray[i+1>>2]>>8*((i+1)%4))&255)<<8)|((binarray[i+2>>2]>>8*((i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>binarray.length*32){str+=b64pad;}else{str+=tab.charAt((triplet>>6*(3-j))&63);}}}return str;}function utf8t2d(t){t=t.replace(/\r\n/g,"\n");var d=new Array;var test=String.fromCharCode(237);if(test.charCodeAt(0)<0){for(var n=0;n<t.length;n++){var c=t.charCodeAt(n);if(c>0){d[d.length]=c;}else{d[d.length]=(((256+c)>>6)|192);d[d.length]=(((256+c)&63)|128);}}}else{for(var n=0;n<t.length;n++){var c=t.charCodeAt(n);if(c<128){d[d.length]=c;}else{if((c>127)&&(c<2048)){d[d.length]=((c>>6)|192);d[d.length]=((c&63)|128);}else{d[d.length]=((c>>12)|224);d[d.length]=(((c>>6)&63)|128);d[d.length]=((c&63)|128);}}}}return d;}function utf8d2t(d){var r=new Array;var i=0;while(i<d.length){if(d[i]<128){r[r.length]=String.fromCharCode(d[i]);i++;}else{if((d[i]>191)&&(d[i]<224)){r[r.length]=String.fromCharCode(((d[i]&31)<<6)|(d[i+1]&63));i+=2;}else{r[r.length]=String.fromCharCode(((d[i]&15)<<12)|((d[i+1]&63)<<6)|(d[i+2]&63));i+=3;}}}return r.join("");}function b64arrays(){var b64s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b64=new Array();f64=new Array();for(var i=0;i<b64s.length;i++){b64[i]=b64s.charAt(i);f64[b64s.charAt(i)]=i;}}function b64d2t(d){var r=new Array;var i=0;var dl=d.length;if((dl%3)==1){d[d.length]=0;d[d.length]=0;}if((dl%3)==2){d[d.length]=0;}while(i<d.length){r[r.length]=b64[d[i]>>2];r[r.length]=b64[((d[i]&3)<<4)|(d[i+1]>>4)];r[r.length]=b64[((d[i+1]&15)<<2)|(d[i+2]>>6)];r[r.length]=b64[d[i+2]&63];i+=3;}if((dl%3)==1){r[r.length-1]=r[r.length-2]="=";}if((dl%3)==2){r[r.length-1]="=";}var t=r.join("");return t;}function b64t2d(t){var d=new Array;var i=0;t=t.replace(/\n|\r/g,"");t=t.replace(/=/g,"");while(i<t.length){d[d.length]=(f64[t.charAt(i)]<<2)|(f64[t.charAt(i+1)]>>4);d[d.length]=(((f64[t.charAt(i+1)]&15)<<4)|(f64[t.charAt(i+2)]>>2));d[d.length]=(((f64[t.charAt(i+2)]&3)<<6)|(f64[t.charAt(i+3)]));i+=4;}if(t.length%4==2){d=d.slice(0,d.length-2);}if(t.length%4==3){d=d.slice(0,d.length-1);}return d;}if(typeof(atob)=="undefined"||typeof(btoa)=="undefined"){b64arrays();}if(typeof(atob)=="undefined"){atob=function(s){return utf8d2t(b64t2d(s));};}if(typeof(btoa)=="undefined"){btoa=function(s){return b64d2t(utf8t2d(s));};}function cnonce(size){var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";var cnonce="";for(var i=0;i<size;i++){cnonce+=tab.charAt(Math.round(Math.random(new Date().getTime())*(tab.length-1)));}return cnonce;}function JSJaCJSON(){}JSJaCJSON.toString=function(obj){var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},s={array:function(x){var a=["["],b,f,i,l=x.length,v;for(i=0;i<l;i+=1){v=x[i];f=s[typeof v];if(f){v=f(v);if(typeof v=="string"){if(b){a[a.length]=",";}a[a.length]=v;b=true;}}}a[a.length]="]";return a.join("");},"boolean":function(x){return String(x);},"null":function(x){return"null";},number:function(x){return isFinite(x)?String(x):"null";},object:function(x){if(x){if(x instanceof Array){return s.array(x);}var a=["{"],b,f,i,v;for(i in x){if(x.hasOwnProperty(i)){v=x[i];f=s[typeof v];if(f){v=f(v);if(typeof v=="string"){if(b){a[a.length]=",";}a.push(s.string(i),":",v);b=true;}}}}a[a.length]="}";return a.join("");}return"null";},string:function(x){if(/["\\\x00-\x1f]/.test(x)){x=x.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c){return c;}c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16);});}return'"'+x+'"';}};switch(typeof(obj)){case"object":return s.object(obj);case"array":return s.array(obj);}};JSJaCJSON.parse=function(str){try{return !(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(str.replace(/"(\\.|[^"\\])*"/g,"")))&&eval("("+str+")");}catch(e){return false;}};function XmlHttp(){}XmlHttp.create=function(){try{if(window.XMLHttpRequest){var req=new XMLHttpRequest();if(req.readyState==null){req.readyState=1;req.addEventListener("load",function(){req.readyState=4;if(typeof req.onreadystatechange=="function"){req.onreadystatechange();}},false);}return req;}if(window.ActiveXObject){return new ActiveXObject(XmlHttp.getPrefix()+".XmlHttp");}}catch(ex){}throw new Error("Your browser does not support XmlHttp objects");};XmlHttp.getPrefix=function(){if(XmlHttp.prefix){return XmlHttp.prefix;}var prefixes=["MSXML2","Microsoft","MSXML","MSXML3"];var o;for(var i=0;i<prefixes.length;i++){try{o=new ActiveXObject(prefixes[i]+".XmlHttp");return XmlHttp.prefix=prefixes[i];}catch(ex){}}throw new Error("Could not find an installed XML parser");};function XmlDocument(){}XmlDocument.create=function(name,ns){name=name||"foo";ns=ns||"";try{var doc;if(document.implementation&&document.implementation.createDocument){doc=document.implementation.createDocument(ns,name,null);if(doc.readyState==null){doc.readyState=1;doc.addEventListener("load",function(){doc.readyState=4;if(typeof doc.onreadystatechange=="function"){doc.onreadystatechange();}},false);}}else{if(window.ActiveXObject){doc=new ActiveXObject(XmlDocument.getPrefix()+".DomDocument");}}if(!doc.documentElement||doc.documentElement.tagName!=name||(doc.documentElement.namespaceURI&&doc.documentElement.namespaceURI!=ns)){try{if(ns!=""){doc.appendChild(doc.createElement(name)).setAttribute("xmlns",ns);}else{doc.appendChild(doc.createElement(name));}}catch(dex){doc=document.implementation.createDocument(ns,name,null);if(doc.documentElement==null){doc.appendChild(doc.createElement(name));}if(ns!=""&&doc.documentElement.getAttribute("xmlns")!=ns){doc.documentElement.setAttribute("xmlns",ns);}}}return doc;}catch(ex){alert(ex.name+": "+ex.message);}throw new Error("Your browser does not support XmlDocument objects");};XmlDocument.getPrefix=function(){if(XmlDocument.prefix){return XmlDocument.prefix;}var prefixes=["MSXML2","Microsoft","MSXML","MSXML3"];var o;for(var i=0;i<prefixes.length;i++){try{o=new ActiveXObject(prefixes[i]+".DomDocument");return XmlDocument.prefix=prefixes[i];}catch(ex){}}throw new Error("Could not find an installed XML parser");};if(typeof(Document)!="undefined"&&window.DOMParser){Document.prototype.loadXML=function(s){var doc2=(new DOMParser()).parseFromString(s,"text/xml");while(this.hasChildNodes()){this.removeChild(this.lastChild);}for(var i=0;i<doc2.childNodes.length;i++){this.appendChild(this.importNode(doc2.childNodes[i],true));}};}if(window.XMLSerializer&&window.Node&&Node.prototype&&Node.prototype.__defineGetter__){XMLDocument.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);});Document.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);});Node.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);});}var JSJaCBuilder={buildNode:function(doc,elementName){var element;if(arguments[2]){if(JSJaCBuilder._isStringOrNumber(arguments[2])||(arguments[2] instanceof Array)){element=doc.createElement(elementName);JSJaCBuilder._children(doc,element,arguments[2]);}else{if(arguments[2]["xmlns"]){try{element=doc.createElementNS(arguments[2]["xmlns"],elementName);}catch(e){element=doc.createElement(elementName);}}else{element=doc.createElement(elementName);}for(attr in arguments[2]){if(arguments[2].hasOwnProperty(attr)){if(attr=="xmlns"&&element.namespaceURI==attr){continue;}element.setAttribute(attr,arguments[2][attr]);}}}}else{element=doc.createElement(elementName);}if(arguments[3]){JSJaCBuilder._children(doc,element,arguments[3]);}return element;},_text:function(doc,text){return doc.createTextNode(text);},_children:function(doc,element,children){if(typeof children=="object"){for(var i in children){if(children.hasOwnProperty(i)){var e=children[i];if(typeof e=="object"){if(e instanceof Array){var node=JSJaCBuilder.buildNode(doc,e[0],e[1],e[2]);element.appendChild(node);}else{element.appendChild(e);}}else{if(JSJaCBuilder._isStringOrNumber(e)){element.appendChild(JSJaCBuilder._text(doc,e));}}}}}else{if(JSJaCBuilder._isStringOrNumber(children)){element.appendChild(JSJaCBuilder._text(doc,children));}}},_attributes:function(attributes){var attrs=[];for(attribute in attributes){if(attributes.hasOwnProperty(attribute)){attrs.push(attribute+'="'+attributes[attribute].toString().htmlEnc()+'"');}}return attrs.join(" ");},_isStringOrNumber:function(param){return(typeof param=="string"||typeof param=="number");}};var NS_DISCO_ITEMS="http://jabber.org/protocol/disco#items";var NS_DISCO_INFO="http://jabber.org/protocol/disco#info";var NS_VCARD="vcard-temp";var NS_AUTH="jabber:iq:auth";var NS_AUTH_ERROR="jabber:iq:auth:error";var NS_REGISTER="jabber:iq:register";var NS_SEARCH="jabber:iq:search";var NS_ROSTER="jabber:iq:roster";var NS_PRIVACY="jabber:iq:privacy";var NS_PRIVATE="jabber:iq:private";var NS_VERSION="jabber:iq:version";var NS_TIME="jabber:iq:time";var NS_LAST="jabber:iq:last";var NS_XDATA="jabber:x:data";var NS_IQDATA="jabber:iq:data";var NS_DELAY="jabber:x:delay";var NS_EXPIRE="jabber:x:expire";var NS_EVENT="jabber:x:event";var NS_XCONFERENCE="jabber:x:conference";var NS_STATS="http://jabber.org/protocol/stats";var NS_MUC="http://jabber.org/protocol/muc";var NS_MUC_USER="http://jabber.org/protocol/muc#user";var NS_MUC_ADMIN="http://jabber.org/protocol/muc#admin";var NS_MUC_OWNER="http://jabber.org/protocol/muc#owner";var NS_PUBSUB="http://jabber.org/protocol/pubsub";var NS_PUBSUB_EVENT="http://jabber.org/protocol/pubsub#event";var NS_PUBSUB_OWNER="http://jabber.org/protocol/pubsub#owner";var NS_PUBSUB_NMI="http://jabber.org/protocol/pubsub#node-meta-info";var NS_COMMANDS="http://jabber.org/protocol/commands";var NS_STREAM="http://etherx.jabber.org/streams";var NS_STANZAS="urn:ietf:params:xml:ns:xmpp-stanzas";var NS_STREAMS="urn:ietf:params:xml:ns:xmpp-streams";var NS_TLS="urn:ietf:params:xml:ns:xmpp-tls";var NS_SASL="urn:ietf:params:xml:ns:xmpp-sasl";var NS_SESSION="urn:ietf:params:xml:ns:xmpp-session";var NS_BIND="urn:ietf:params:xml:ns:xmpp-bind";var NS_FEATURE_IQAUTH="http://jabber.org/features/iq-auth";var NS_FEATURE_IQREGISTER="http://jabber.org/features/iq-register";var NS_FEATURE_COMPRESS="http://jabber.org/features/compress";var NS_COMPRESS="http://jabber.org/protocol/compress";function STANZA_ERROR(code,type,cond){if(window==this){return new STANZA_ERROR(code,type,cond);}this.code=code;this.type=type;this.cond=cond;}var ERR_BAD_REQUEST=STANZA_ERROR("400","modify","bad-request");var ERR_CONFLICT=STANZA_ERROR("409","cancel","conflict");var ERR_FEATURE_NOT_IMPLEMENTED=STANZA_ERROR("501","cancel","feature-not-implemented");var ERR_FORBIDDEN=STANZA_ERROR("403","auth","forbidden");var ERR_GONE=STANZA_ERROR("302","modify","gone");var ERR_INTERNAL_SERVER_ERROR=STANZA_ERROR("500","wait","internal-server-error");var ERR_ITEM_NOT_FOUND=STANZA_ERROR("404","cancel","item-not-found");var ERR_JID_MALFORMED=STANZA_ERROR("400","modify","jid-malformed");var ERR_NOT_ACCEPTABLE=STANZA_ERROR("406","modify","not-acceptable");var ERR_NOT_ALLOWED=STANZA_ERROR("405","cancel","not-allowed");var ERR_NOT_AUTHORIZED=STANZA_ERROR("401","auth","not-authorized");var ERR_PAYMENT_REQUIRED=STANZA_ERROR("402","auth","payment-required");var ERR_RECIPIENT_UNAVAILABLE=STANZA_ERROR("404","wait","recipient-unavailable");var ERR_REDIRECT=STANZA_ERROR("302","modify","redirect");var ERR_REGISTRATION_REQUIRED=STANZA_ERROR("407","auth","registration-required");var ERR_REMOTE_SERVER_NOT_FOUND=STANZA_ERROR("404","cancel","remote-server-not-found");var ERR_REMOTE_SERVER_TIMEOUT=STANZA_ERROR("504","wait","remote-server-timeout");var ERR_RESOURCE_CONSTRAINT=STANZA_ERROR("500","wait","resource-constraint");var ERR_SERVICE_UNAVAILABLE=STANZA_ERROR("503","cancel","service-unavailable");var ERR_SUBSCRIPTION_REQUIRED=STANZA_ERROR("407","auth","subscription-required");var ERR_UNEXPECTED_REQUEST=STANZA_ERROR("400","wait","unexpected-request");function JSJaCConnection(oArg){if(oArg&&oArg.oDbg&&oArg.oDbg.log){this.oDbg=oArg.oDbg;}else{this.oDbg=new Object();this.oDbg.log=function(){};}if(oArg&&oArg.httpbase){this._httpbase=oArg.httpbase;}if(oArg&&oArg.allow_plain){this.allow_plain=oArg.allow_plain;}else{this.allow_plain=JSJAC_ALLOW_PLAIN;}this._connected=false;this._events=new Array();this._keys=null;this._ID=0;this._inQ=new Array();this._pQueue=new Array();this._regIDs=new Array();this._req=new Array();this._status="intialized";this._errcnt=0;this._inactivity=JSJAC_INACTIVITY;this._sendRawCallbacks=new Array();if(oArg&&oArg.timerval){this.setPollInterval(oArg.timerval);}}JSJaCConnection.prototype.connect=function(oArg){this._setStatus("connecting");this.domain=oArg.domain||"localhost";this.username=oArg.username;this.resource=oArg.resource;this.pass=oArg.pass;this.register=oArg.register;this.authhost=oArg.authhost||this.domain;this.authtype=oArg.authtype||"sasl";if(oArg.xmllang&&oArg.xmllang!=""){this._xmllang=oArg.xmllang;}this.host=oArg.host||this.domain;this.port=oArg.port||5222;if(oArg.secure){this.secure="true";}else{this.secure="false";}if(oArg.wait){this._wait=oArg.wait;}this.jid=this.username+"@"+this.domain;this.fulljid=this.jid+"/"+this.resource;this._rid=Math.round(100000.5+(((900000.49999)-(100000.5))*Math.random()));var slot=this._getFreeSlot();this._req[slot]=this._setupRequest(true);var reqstr=this._getInitialRequestString();this.oDbg.log(reqstr,4);this._req[slot].r.onreadystatechange=JSJaC.bind(function(){if(this._req[slot].r.readyState==4){this.oDbg.log("async recv: "+this._req[slot].r.responseText,4);this._handleInitialResponse(slot);}},this);if(typeof(this._req[slot].r.onerror)!="undefined"){this._req[slot].r.onerror=JSJaC.bind(function(e){this.oDbg.log("XmlHttpRequest error",1);return false;},this);}this._req[slot].r.send(reqstr);};JSJaCConnection.prototype.connected=function(){return this._connected;};JSJaCConnection.prototype.disconnect=function(){this._setStatus("disconnecting");if(!this.connected()){return;}this._connected=false;clearInterval(this._interval);clearInterval(this._inQto);if(this._timeout){clearTimeout(this._timeout);}var slot=this._getFreeSlot();this._req[slot]=this._setupRequest(false);request=this._getRequestString(false,true);this.oDbg.log("Disconnecting: "+request,4);this._req[slot].r.send(request);try{JSJaCCookie.read("JSJaC_State").erase();}catch(e){}this.oDbg.log("Disconnected: "+this._req[slot].r.responseText,2);this._handleEvent("ondisconnect");};JSJaCConnection.prototype.getPollInterval=function(){return this._timerval;};JSJaCConnection.prototype.registerHandler=function(event){event=event.toLowerCase();var eArg={handler:arguments[arguments.length-1],childName:"*",childNS:"*",type:"*"};if(arguments.length>2){eArg.childName=arguments[1];}if(arguments.length>3){eArg.childNS=arguments[2];}if(arguments.length>4){eArg.type=arguments[3];}if(!this._events[event]){this._events[event]=new Array(eArg);}else{this._events[event]=this._events[event].concat(eArg);}this._events[event]=this._events[event].sort(function(a,b){var aRank=0;var bRank=0;with(a){if(type=="*"){aRank++;}if(childNS=="*"){aRank++;}if(childName=="*"){aRank++;}}with(b){if(type=="*"){bRank++;}if(childNS=="*"){bRank++;}if(childName=="*"){bRank++;}}if(aRank>bRank){return 1;}if(aRank<bRank){return -1;}return 0;});this.oDbg.log("registered handler for event '"+event+"'",2);};JSJaCConnection.prototype.unregisterHandler=function(event,handler){event=event.toLowerCase();if(!this._events[event]){return;}var arr=this._events[event],res=new Array();for(var i=0;i<arr.length;i++){if(arr[i].handler!=handler){res.push(arr[i]);}}if(arr.length!=res.length){this._events[event]=res;this.oDbg.log("unregistered handler for event '"+event+"'",2);}};JSJaCConnection.prototype.registerIQGet=function(childName,childNS,handler){this.registerHandler("iq",childName,childNS,"get",handler);};JSJaCConnection.prototype.registerIQSet=function(childName,childNS,handler){this.registerHandler("iq",childName,childNS,"set",handler);};JSJaCConnection.prototype.resume=function(){try{this._setStatus("resuming");var s=unescape(JSJaCCookie.read("JSJaC_State").getValue());this.oDbg.log("read cookie: "+s,2);var o=JSJaCJSON.parse(s);for(var i in o){if(o.hasOwnProperty(i)){this[i]=o[i];}}if(this._keys){this._keys2=new JSJaCKeys();var u=this._keys2._getSuspendVars();for(var i=0;i<u.length;i++){this._keys2[u[i]]=this._keys[u[i]];}this._keys=this._keys2;}try{JSJaCCookie.read("JSJaC_State").erase();}catch(e){}if(this._connected){this._handleEvent("onresume");setTimeout(JSJaC.bind(this._resume,this),this.getPollInterval());this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL);this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL);}return(this._connected===true);}catch(e){if(e.message){this.oDbg.log("Resume failed: "+e.message,1);}else{this.oDbg.log("Resume failed: "+e,1);}return false;}};JSJaCConnection.prototype.send=function(packet,cb,arg){if(!packet||!packet.pType){this.oDbg.log("no packet: "+packet,1);return false;}if(!this.connected()){return false;}if(cb){if(!packet.getID()){packet.setID("JSJaCID_"+this._ID++);}this._registerPID(packet.getID(),cb,arg);}try{this._handleEvent(packet.pType()+"_out",packet);this._handleEvent("packet_out",packet);this._pQueue=this._pQueue.concat(packet.xml());}catch(e){this.oDbg.log(e.toString(),1);return false;}return true;};JSJaCConnection.prototype.sendIQ=function(iq,handlers,arg){if(!iq||iq.pType()!="iq"){return false;}handlers=handlers||{};var error_handler=handlers.error_handler||function(aIq){this.oDbg.log(iq.xml(),1);};var result_handler=handlers.result_handler||function(aIq){this.oDbg.log(aIq.xml(),2);};var default_handler=handlers.default_handler||function(aIq){this.oDbg.log(aIq.xml(),2);};var iqHandler=function(aIq,arg){switch(aIq.getType()){case"error":error_handler(aIq);break;case"result":result_handler(aIq,arg);break;default:default_handler(aIq,arg);}};return this.send(iq,iqHandler,arg);};JSJaCConnection.prototype.setPollInterval=function(timerval){if(timerval&&!isNaN(timerval)){this._timerval=timerval;}return this._timerval;};JSJaCConnection.prototype.status=function(){return this._status;};JSJaCConnection.prototype.suspend=function(){clearTimeout(this._timeout);clearInterval(this._interval);clearInterval(this._inQto);this._suspend();var u=("_connected,_keys,_ID,_inQ,_pQueue,_regIDs,_errcnt,_inactivity,domain,username,resource,jid,fulljid,_sid,_httpbase,_timerval,_is_polling").split(",");u=u.concat(this._getSuspendVars());var s=new Object();for(var i=0;i<u.length;i++){if(!this[u[i]]){continue;}if(this[u[i]]._getSuspendVars){var uo=this[u[i]]._getSuspendVars();var o=new Object();for(var j=0;j<uo.length;j++){o[uo[j]]=this[u[i]][uo[j]];}}else{var o=this[u[i]];}s[u[i]]=o;}var c=new JSJaCCookie("JSJaC_State",escape(JSJaCJSON.toString(s)),this._inactivity);this.oDbg.log("writing cookie: "+unescape(c.value)+"\n(length:"+unescape(c.value).length+")",2);c.write();try{var c2=JSJaCCookie.read("JSJaC_State");if(c.value!=c2.value){this.oDbg.log("Suspend failed writing cookie.\nRead: "+unescape(JSJaCCookie.read("JSJaC_State")),1);c.erase();}this._connected=false;this._setStatus("suspending");}catch(e){this.oDbg.log("Failed reading cookie 'JSJaC_State': "+e.message);}};JSJaCConnection.prototype._abort=function(){clearTimeout(this._timeout);clearInterval(this._inQto);clearInterval(this._interval);this._connected=false;this._setStatus("aborted");this.oDbg.log("Disconnected.",1);this._handleEvent("ondisconnect");this._handleEvent("onerror",JSJaCError("500","cancel","service-unavailable"));};JSJaCConnection.prototype._checkInQ=function(){for(var i=0;i<this._inQ.length&&i<10;i++){var item=this._inQ[0];this._inQ=this._inQ.slice(1,this._inQ.length);var packet=JSJaCPacket.wrapNode(item);if(!packet){return;}this._handleEvent("packet_in",packet);if(packet.pType&&!this._handlePID(packet)){this._handleEvent(packet.pType()+"_in",packet);this._handleEvent(packet.pType(),packet);}}};JSJaCConnection.prototype._checkQueue=function(){if(this._pQueue.length!=0){this._process();}return true;};JSJaCConnection.prototype._doAuth=function(){if(this.has_sasl&&this.authtype=="nonsasl"){this.oDbg.log("Warning: SASL present but not used",1);}if(!this._doSASLAuth()&&!this._doLegacyAuth()){this.oDbg.log("Auth failed for authtype "+this.authtype,1);this.disconnect();return false;}return true;};JSJaCConnection.prototype._doInBandReg=function(){if(this.authtype=="saslanon"||this.authtype=="anonymous"){return;}var iq=new JSJaCIQ();iq.setType("set");iq.setID("reg1");iq.appendNode("query",{xmlns:"jabber:iq:register"},[["username",this.username],["password",this.pass]]);this.send(iq,this._doInBandRegDone);};JSJaCConnection.prototype._doInBandRegDone=function(iq){if(iq&&iq.getType()=="error"){this.oDbg.log("registration failed for "+this.username,0);this._handleEvent("onerror",iq.getChild("error"));return;}this.oDbg.log(this.username+" registered succesfully",0);this._doAuth();};JSJaCConnection.prototype._doLegacyAuth=function(){if(this.authtype!="nonsasl"&&this.authtype!="anonymous"){return false;}var iq=new JSJaCIQ();iq.setIQ(this.server,"get","auth1");iq.appendNode("query",{xmlns:"jabber:iq:auth"},[["username",this.username]]);this.send(iq,this._doLegacyAuth2);return true;};JSJaCConnection.prototype._doLegacyAuth2=function(iq){if(!iq||iq.getType()!="result"){if(iq&&iq.getType()=="error"){this._handleEvent("onerror",iq.getChild("error"));}this.disconnect();return;}var use_digest=(iq.getChild("digest")!=null);var iq=new JSJaCIQ();iq.setIQ(this.server,"set","auth2");query=iq.appendNode("query",{xmlns:"jabber:iq:auth"},[["username",this.username],["resource",this.resource]]);if(use_digest){query.appendChild(iq.buildNode("digest",hex_sha1(this.streamid+this.pass)));}else{if(this.allow_plain){query.appendChild(iq.buildNode("password",this.pass));}else{this.oDbg.log("no valid login mechanism found",1);this.disconnect();return false;}}this.send(iq,this._doLegacyAuthDone);};JSJaCConnection.prototype._doLegacyAuthDone=function(iq){if(iq.getType()!="result"){if(iq.getType()=="error"){this._handleEvent("onerror",iq.getChild("error"));}this.disconnect();}else{this._handleEvent("onconnect");}};JSJaCConnection.prototype._doSASLAuth=function(){if(this.authtype=="nonsasl"||this.authtype=="anonymous"){return false;}if(this.authtype=="saslanon"){if(this.mechs["ANONYMOUS"]){this.oDbg.log("SASL using mechanism 'ANONYMOUS'",2);return this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='ANONYMOUS'/>",this._doSASLAuthDone);}this.oDbg.log("SASL ANONYMOUS requested but not supported",1);}else{if(this.mechs["DIGEST-MD5"]){this.oDbg.log("SASL using mechanism 'DIGEST-MD5'",2);return this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='DIGEST-MD5'/>",this._doSASLAuthDigestMd5S1);}else{if(this.allow_plain&&this.mechs["PLAIN"]){this.oDbg.log("SASL using mechanism 'PLAIN'",2);var authStr=this.username+"@"+this.domain+String.fromCharCode(0)+this.username+String.fromCharCode(0)+this.pass;this.oDbg.log("authenticating with '"+authStr+"'",2);authStr=btoa(authStr);return this._sendRaw("<auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='PLAIN'>"+authStr+"</auth>",this._doSASLAuthDone);}}this.oDbg.log("No SASL mechanism applied",1);this.authtype="nonsasl";}return false;};JSJaCConnection.prototype._doSASLAuthDigestMd5S1=function(el){if(el.nodeName!="challenge"){this.oDbg.log("challenge missing",1);this._handleEvent("onerror",JSJaCError("401","auth","not-authorized"));this.disconnect();}else{var challenge=atob(el.firstChild.nodeValue);this.oDbg.log("got challenge: "+challenge,2);this._nonce=challenge.substring(challenge.indexOf("nonce=")+7);this._nonce=this._nonce.substring(0,this._nonce.indexOf('"'));this.oDbg.log("nonce: "+this._nonce,2);if(this._nonce==""||this._nonce.indexOf('"')!=-1){this.oDbg.log("nonce not valid, aborting",1);this.disconnect();return;}this._digest_uri="xmpp/";this._digest_uri+=this.domain;this._cnonce=cnonce(14);this._nc="00000001";var A1=str_md5(this.username+":"+this.domain+":"+this.pass)+":"+this._nonce+":"+this._cnonce;var A2="AUTHENTICATE:"+this._digest_uri;var response=hex_md5(hex_md5(A1)+":"+this._nonce+":"+this._nc+":"+this._cnonce+":auth:"+hex_md5(A2));var rPlain='username="'+this.username+'",realm="'+this.domain+'",nonce="'+this._nonce+'",cnonce="'+this._cnonce+'",nc="'+this._nc+'",qop=auth,digest-uri="'+this._digest_uri+'",response="'+response+'",charset=utf-8';this.oDbg.log("response: "+rPlain,2);this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>"+binb2b64(str2binb(rPlain))+"</response>",this._doSASLAuthDigestMd5S2);}};JSJaCConnection.prototype._doSASLAuthDigestMd5S2=function(el){if(el.nodeName=="failure"){if(el.xml){this.oDbg.log("auth error: "+el.xml,1);}else{this.oDbg.log("auth error",1);}this._handleEvent("onerror",JSJaCError("401","auth","not-authorized"));this.disconnect();return;}var response=atob(el.firstChild.nodeValue);this.oDbg.log("response: "+response,2);var rspauth=response.substring(response.indexOf("rspauth=")+8);this.oDbg.log("rspauth: "+rspauth,2);var A1=str_md5(this.username+":"+this.domain+":"+this.pass)+":"+this._nonce+":"+this._cnonce;var A2=":"+this._digest_uri;var rsptest=hex_md5(hex_md5(A1)+":"+this._nonce+":"+this._nc+":"+this._cnonce+":auth:"+hex_md5(A2));this.oDbg.log("rsptest: "+rsptest,2);if(rsptest!=rspauth){this.oDbg.log("SASL Digest-MD5: server repsonse with wrong rspauth",1);this.disconnect();return;}if(el.nodeName=="success"){this._reInitStream(this.domain,this._doStreamBind);}else{this._sendRaw("<response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/>",this._doSASLAuthDone);}};JSJaCConnection.prototype._doSASLAuthDone=function(el){if(el.nodeName!="success"){this.oDbg.log("auth failed",1);this._handleEvent("onerror",JSJaCError("401","auth","not-authorized"));this.disconnect();}else{this._reInitStream(this.domain,this._doStreamBind);}};JSJaCConnection.prototype._doStreamBind=function(){var iq=new JSJaCIQ();iq.setIQ(this.domain,"set","bind_1");iq.appendNode("bind",{xmlns:"urn:ietf:params:xml:ns:xmpp-bind"},[["resource",this.resource]]);this.oDbg.log(iq.xml());this.send(iq,this._doXMPPSess);};JSJaCConnection.prototype._doXMPPSess=function(iq){if(iq.getType()!="result"||iq.getType()=="error"){this.disconnect();if(iq.getType()=="error"){this._handleEvent("onerror",iq.getChild("error"));}return;}this.fulljid=iq.getChildVal("jid");this.jid=this.fulljid.substring(0,this.fulljid.lastIndexOf("/"));iq=new JSJaCIQ();iq.setIQ(this.domain,"set","sess_1");iq.appendNode("session",{xmlns:"urn:ietf:params:xml:ns:xmpp-session"},[]);this.oDbg.log(iq.xml());this.send(iq,this._doXMPPSessDone);};JSJaCConnection.prototype._doXMPPSessDone=function(iq){if(iq.getType()!="result"||iq.getType()=="error"){this.disconnect();if(iq.getType()=="error"){this._handleEvent("onerror",iq.getChild("error"));}return;}else{this._handleEvent("onconnect");}};JSJaCConnection.prototype._handleEvent=function(event,arg){event=event.toLowerCase();this.oDbg.log("incoming event '"+event+"'",3);if(!this._events[event]){return;}this.oDbg.log("handling event '"+event+"'",2);for(var i=0;i<this._events[event].length;i++){var aEvent=this._events[event][i];if(aEvent.handler){try{if(arg){if(arg.pType){if((!arg.getNode().hasChildNodes()&&aEvent.childName!="*")||(arg.getNode().hasChildNodes()&&!arg.getChild(aEvent.childName,aEvent.childNS))){continue;}if(aEvent.type!="*"&&arg.getType()!=aEvent.type){continue;}this.oDbg.log(aEvent.childName+"/"+aEvent.childNS+"/"+aEvent.type+" => match for handler "+aEvent.handler,3);}if(aEvent.handler.call(this,arg)){break;}}else{if(aEvent.handler.call(this)){break;}}}catch(e){this.oDbg.log(aEvent.handler+"\n>>>"+e.name+": "+e.message,1);}}}};JSJaCConnection.prototype._handlePID=function(aJSJaCPacket){if(!aJSJaCPacket.getID()){return false;}for(var i in this._regIDs){if(this._regIDs.hasOwnProperty(i)&&this._regIDs[i]&&i==aJSJaCPacket.getID()){var pID=aJSJaCPacket.getID();this.oDbg.log("handling "+pID,3);try{if(this._regIDs[i].cb.call(this,aJSJaCPacket,this._regIDs[i].arg)===false){return false;}else{this._unregisterPID(pID);return true;}}catch(e){this.oDbg.log(e.name+": "+e.message);this._unregisterPID(pID);return true;}}}return false;};JSJaCConnection.prototype._handleResponse=function(req){var rootEl=this._parseResponse(req);if(!rootEl){return;}for(var i=0;i<rootEl.childNodes.length;i++){if(this._sendRawCallbacks.length){var cb=this._sendRawCallbacks[0];this._sendRawCallbacks=this._sendRawCallbacks.slice(1,this._sendRawCallbacks.length);cb.fn.call(this,rootEl.childNodes.item(i),cb.arg);continue;}this._inQ=this._inQ.concat(rootEl.childNodes.item(i));}};JSJaCConnection.prototype._parseStreamFeatures=function(doc){if(!doc){this.oDbg.log("nothing to parse ... aborting",1);return false;}var errorTag;if(doc.getElementsByTagNameNS){errorTag=doc.getElementsByTagNameNS("http://etherx.jabber.org/streams","error").item(0);}else{var errors=doc.getElementsByTagName("error");for(var i=0;i<errors.length;i++){if(errors.item(i).namespaceURI=="http://etherx.jabber.org/streams"){errorTag=errors.item(i);break;}}}if(errorTag){this._setStatus("internal_server_error");clearTimeout(this._timeout);clearInterval(this._interval);clearInterval(this._inQto);this._handleEvent("onerror",JSJaCError("503","cancel","session-terminate"));this._connected=false;this.oDbg.log("Disconnected.",1);this._handleEvent("ondisconnect");return false;}this.mechs=new Object();var lMec1=doc.getElementsByTagName("mechanisms");this.has_sasl=false;for(var i=0;i<lMec1.length;i++){if(lMec1.item(i).getAttribute("xmlns")=="urn:ietf:params:xml:ns:xmpp-sasl"){this.has_sasl=true;var lMec2=lMec1.item(i).getElementsByTagName("mechanism");for(var j=0;j<lMec2.length;j++){this.mechs[lMec2.item(j).firstChild.nodeValue]=true;}break;}}if(this.has_sasl){this.oDbg.log("SASL detected",2);}else{this.authtype="nonsasl";this.oDbg.log("No support for SASL detected",2);}return true;};JSJaCConnection.prototype._process=function(timerval){if(!this.connected()){this.oDbg.log("Connection lost ...",1);if(this._interval){clearInterval(this._interval);}return;}this.setPollInterval(timerval);if(this._timeout){clearTimeout(this._timeout);}var slot=this._getFreeSlot();if(slot<0){return;}if(typeof(this._req[slot])!="undefined"&&typeof(this._req[slot].r)!="undefined"&&this._req[slot].r.readyState!=4){this.oDbg.log("Slot "+slot+" is not ready");return;}if(!this.isPolling()&&this._pQueue.length==0&&this._req[(slot+1)%2]&&this._req[(slot+1)%2].r.readyState!=4){this.oDbg.log("all slots busy, standby ...",2);return;}if(!this.isPolling()){this.oDbg.log("Found working slot at "+slot,2);}this._req[slot]=this._setupRequest(true);this._req[slot].r.onreadystatechange=JSJaC.bind(function(){if(!this.connected()){return;}if(this._req[slot].r.readyState==4){this._setStatus("processing");this.oDbg.log("async recv: "+this._req[slot].r.responseText,4);this._handleResponse(this._req[slot]);if(this._pQueue.length){this._timeout=setTimeout(JSJaC.bind(this._process,this),100);}else{this.oDbg.log("scheduling next poll in "+this.getPollInterval()+" msec",4);this._timeout=setTimeout(JSJaC.bind(this._process,this),this.getPollInterval());}}},this);try{this._req[slot].r.onerror=JSJaC.bind(function(){if(!this.connected()){return;}this._errcnt++;this.oDbg.log("XmlHttpRequest error ("+this._errcnt+")",1);if(this._errcnt>JSJAC_ERR_COUNT){this._abort();return false;}this._setStatus("onerror_fallback");setTimeout(JSJaC.bind(this._resume,this),this.getPollInterval());return false;},this);}catch(e){}var reqstr=this._getRequestString();if(typeof(this._rid)!="undefined"){this._req[slot].rid=this._rid;}this.oDbg.log("sending: "+reqstr,4);this._req[slot].r.send(reqstr);};JSJaCConnection.prototype._registerPID=function(pID,cb,arg){if(!pID||!cb){return false;}this._regIDs[pID]=new Object();this._regIDs[pID].cb=cb;if(arg){this._regIDs[pID].arg=arg;}this.oDbg.log("registered "+pID,3);return true;};JSJaCConnection.prototype._sendEmpty=function JSJaCSendEmpty(){var slot=this._getFreeSlot();this._req[slot]=this._setupRequest(true);this._req[slot].r.onreadystatechange=JSJaC.bind(function(){if(this._req[slot].r.readyState==4){this.oDbg.log("async recv: "+this._req[slot].r.responseText,4);this._getStreamID(slot);}},this);if(typeof(this._req[slot].r.onerror)!="undefined"){this._req[slot].r.onerror=JSJaC.bind(function(e){this.oDbg.log("XmlHttpRequest error",1);return false;},this);}var reqstr=this._getRequestString();this.oDbg.log("sending: "+reqstr,4);this._req[slot].r.send(reqstr);};JSJaCConnection.prototype._sendRaw=function(xml,cb,arg){if(cb){this._sendRawCallbacks.push({fn:cb,arg:arg});}this._pQueue.push(xml);this._process();return true;};JSJaCConnection.prototype._setStatus=function(status){if(!status||status==""){return;}if(status!=this._status){this._status=status;this._handleEvent("onstatuschanged",status);this._handleEvent("status_changed",status);}};JSJaCConnection.prototype._unregisterPID=function(pID){if(!this._regIDs[pID]){return false;}this._regIDs[pID]=null;this.oDbg.log("unregistered "+pID,3);return true;};function JSJaCConsoleLogger(level){this.level=level||4;this.start=function(){};this.log=function(msg,level){level=level||0;if(level>this.level){return;}if(typeof(console)=="undefined"){return;}try{switch(level){case 0:console.warn(msg);break;case 1:console.error(msg);break;case 2:console.info(msg);break;case 4:console.debug(msg);break;default:console.log(msg);break;}}catch(e){try{console.log(msg);}catch(e){}}};this.setLevel=function(level){this.level=level;return this;};this.getLevel=function(){return this.level;};}function JSJaCCookie(name,value,secs){if(window==this){return new JSJaCCookie(name,value,secs);}this.name=name;this.value=value;this.expires=secs;this.write=function(){if(this.secs){var date=new Date();date.setTime(date.getTime()+(this.secs*1000));var expires="; expires="+date.toGMTString();}else{var expires="";}document.cookie=this.getName()+"="+this.getValue()+expires+"; path=/";};this.erase=function(){var c=new JSJaCCookie(this.getName(),"",-1);c.write();};this.getName=function(){return this.name;};this.setName=function(name){this.name=name;return this;};this.getValue=function(){return this.value;};this.setValue=function(value){this.value=value;return this;};}JSJaCCookie.read=function(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length);}if(c.indexOf(nameEQ)==0){return new JSJaCCookie(name,c.substring(nameEQ.length,c.length));}}throw new JSJaCCookieException("Cookie not found");};JSJaCCookie.get=function(name){return JSJaCCookie.read(name).getValue();};JSJaCCookie.remove=function(name){JSJaCCookie.read(name).erase();};function JSJaCCookieException(msg){this.message=msg;this.name="CookieException";}function JSJaCError(code,type,condition){var xmldoc=XmlDocument.create("error","jsjac");xmldoc.documentElement.setAttribute("code",code);xmldoc.documentElement.setAttribute("type",type);xmldoc.documentElement.appendChild(xmldoc.createElement(condition)).setAttribute("xmlns","urn:ietf:params:xml:ns:xmpp-stanzas");return xmldoc.documentElement;}var JSJACJID_FORBIDDEN=['"'," ","&","'","/",":","<",">","@"];function JSJaCJID(jid){this._node="";this._domain="";this._resource="";if(typeof(jid)=="string"){if(jid.indexOf("@")!=-1){this.setNode(jid.substring(0,jid.indexOf("@")));jid=jid.substring(jid.indexOf("@")+1);}if(jid.indexOf("/")!=-1){this.setResource(jid.substring(jid.indexOf("/")+1));jid=jid.substring(0,jid.indexOf("/"));}this.setDomain(jid);}else{this.setNode(jid.node);this.setDomain(jid.domain);this.setResource(jid.resource);}}JSJaCJID.prototype.getNode=function(){return this._node;};JSJaCJID.prototype.getDomain=function(){return this._domain;};JSJaCJID.prototype.getResource=function(){return this._resource;};JSJaCJID.prototype.setNode=function(node){JSJaCJID._checkNodeName(node);this._node=node||"";return this;};JSJaCJID.prototype.setDomain=function(domain){if(!domain||domain==""){throw new JSJaCJIDInvalidException("domain name missing");}JSJaCJID._checkNodeName(domain);this._domain=domain;return this;};JSJaCJID.prototype.setResource=function(resource){this._resource=resource||"";return this;};JSJaCJID.prototype.toString=function(){var jid="";if(this.getNode()&&this.getNode()!=""){jid=this.getNode()+"@";}jid+=this.getDomain();if(this.getResource()&&this.getResource()!=""){jid+="/"+this.getResource();}return jid;};JSJaCJID.prototype.removeResource=function(){return this.setResource();};JSJaCJID.prototype.clone=function(){return new JSJaCJID(this.toString());};JSJaCJID.prototype.isEntity=function(jid){if(typeof jid=="string"){jid=(new JSJaCJID(jid));}jid.removeResource();return(this.clone().removeResource().toString()===jid.toString());};JSJaCJID._checkNodeName=function(nodeprep){if(!nodeprep||nodeprep==""){return;}for(var i=0;i<JSJACJID_FORBIDDEN.length;i++){if(nodeprep.indexOf(JSJACJID_FORBIDDEN[i])!=-1){throw new JSJaCJIDInvalidException("forbidden char in nodename: "+JSJACJID_FORBIDDEN[i]);}}};function JSJaCJIDInvalidException(message){this.message=message;this.name="JSJaCJIDInvalidException";}function JSJaCKeys(func,oDbg){var seed=Math.random();this._k=new Array();this._k[0]=seed.toString();if(oDbg){this.oDbg=oDbg;}else{this.oDbg={};this.oDbg.log=function(){};}if(func){for(var i=1;i<JSJAC_NKEYS;i++){this._k[i]=func(this._k[i-1]);oDbg.log(i+": "+this._k[i],4);}}this._indexAt=JSJAC_NKEYS-1;this.getKey=function(){return this._k[this._indexAt--];};this.lastKey=function(){return(this._indexAt==0);};this.size=function(){return this._k.length;};this._getSuspendVars=function(){return("_k,_indexAt").split(",");};}var JSJACPACKET_USE_XMLNS=true;function JSJaCPacket(name){this.name=name;if(typeof(JSJACPACKET_USE_XMLNS)!="undefined"&&JSJACPACKET_USE_XMLNS){this.doc=XmlDocument.create(name,"jabber:client");}else{this.doc=XmlDocument.create(name,"");}}JSJaCPacket.prototype.pType=function(){return this.name;};JSJaCPacket.prototype.getDoc=function(){return this.doc;};JSJaCPacket.prototype.getNode=function(){if(this.getDoc()&&this.getDoc().documentElement){return this.getDoc().documentElement;}else{return null;}};JSJaCPacket.prototype.setTo=function(to){if(!to||to==""){this.getNode().removeAttribute("to");}else{if(typeof(to)=="string"){this.getNode().setAttribute("to",to);}else{this.getNode().setAttribute("to",to.toString());}}return this;};JSJaCPacket.prototype.setFrom=function(from){if(!from||from==""){this.getNode().removeAttribute("from");}else{if(typeof(from)=="string"){this.getNode().setAttribute("from",from);}else{this.getNode().setAttribute("from",from.toString());}}return this;};JSJaCPacket.prototype.setID=function(id){if(!id||id==""){this.getNode().removeAttribute("id");}else{this.getNode().setAttribute("id",id);}return this;};JSJaCPacket.prototype.setType=function(type){if(!type||type==""){this.getNode().removeAttribute("type");}else{this.getNode().setAttribute("type",type);}return this;};JSJaCPacket.prototype.setXMLLang=function(xmllang){if(!xmllang||xmllang==""){this.getNode().removeAttribute("xml:lang");}else{this.getNode().setAttribute("xml:lang",xmllang);}return this;};JSJaCPacket.prototype.getTo=function(){return this.getNode().getAttribute("to");};JSJaCPacket.prototype.getFrom=function(){return this.getNode().getAttribute("from");};JSJaCPacket.prototype.getToJID=function(){return new JSJaCJID(this.getTo());};JSJaCPacket.prototype.getFromJID=function(){return new JSJaCJID(this.getFrom());};JSJaCPacket.prototype.getID=function(){return this.getNode().getAttribute("id");};JSJaCPacket.prototype.getType=function(){return this.getNode().getAttribute("type");};JSJaCPacket.prototype.getXMLLang=function(){return this.getNode().getAttribute("xml:lang");};JSJaCPacket.prototype.getXMLNS=function(){return this.getNode().namespaceURI;};JSJaCPacket.prototype.getChild=function(name,ns){if(!this.getNode()){return null;}name=name||"*";ns=ns||"*";if(this.getNode().getElementsByTagNameNS){return this.getNode().getElementsByTagNameNS(ns,name).item(0);}var nodes=this.getNode().getElementsByTagName(name);if(ns!="*"){for(var i=0;i<nodes.length;i++){if(nodes.item(i).namespaceURI==ns){return nodes.item(i);}}}else{return nodes.item(0);}return null;};JSJaCPacket.prototype.getChildVal=function(name,ns){var node=this.getChild(name,ns);if(node&&node.firstChild){return node.firstChild.nodeValue;}else{return"";}};JSJaCPacket.prototype.clone=function(){return JSJaCPacket.wrapNode(this.getNode());};JSJaCPacket.prototype.isError=function(){return(this.getType()=="error");};JSJaCPacket.prototype.errorReply=function(stanza_error){var rPacket=this.clone();rPacket.setTo(this.getFrom());rPacket.setFrom();rPacket.setType("error");rPacket.appendNode("error",{code:stanza_error.code,type:stanza_error.type},[[stanza_error.cond]]);return rPacket;};JSJaCPacket.prototype.xml=function(){if(this.getDoc().xml){return this.getDoc().xml;}var xml=(new XMLSerializer()).serializeToString(this.getNode());if(typeof(xml)!="undefined"){return xml;}return(new XMLSerializer()).serializeToString(this.doc);};JSJaCPacket.prototype._getAttribute=function(attr){return this.getNode().getAttribute(attr);};JSJaCPacket.prototype._replaceNode=function(aNode){for(var i=0;i<aNode.attributes.length;i++){if(aNode.attributes.item(i).nodeName!="xmlns"){this.getNode().setAttribute(aNode.attributes.item(i).nodeName,aNode.attributes.item(i).nodeValue);}}for(var i=0;i<aNode.childNodes.length;i++){if(this.getDoc().importNode){this.getNode().appendChild(this.getDoc().importNode(aNode.childNodes.item(i),true));}else{this.getNode().appendChild(aNode.childNodes.item(i).cloneNode(true));}}};JSJaCPacket.prototype._setChildNode=function(nodeName,nodeValue){var aNode=this.getChild(nodeName);var tNode=this.getDoc().createTextNode(nodeValue);if(aNode){try{aNode.replaceChild(tNode,aNode.firstChild);}catch(e){}}else{aNode=this.getNode().appendChild(this.getDoc().createElement(nodeName));aNode.appendChild(tNode);}return aNode;};JSJaCPacket.prototype.buildNode=function(elementName){return JSJaCBuilder.buildNode(this.getDoc(),elementName,arguments[1],arguments[2]);};JSJaCPacket.prototype.appendNode=function(element){if(typeof element=="object"){return this.getNode().appendChild(element);}else{return this.getNode().appendChild(this.buildNode(element,arguments[1],arguments[2]));}};function JSJaCPresence(){this.base=JSJaCPacket;this.base("presence");}JSJaCPresence.prototype=new JSJaCPacket;JSJaCPresence.prototype.setStatus=function(status){this._setChildNode("status",status);return this;};JSJaCPresence.prototype.setShow=function(show){if(show=="chat"||show=="away"||show=="xa"||show=="dnd"){this._setChildNode("show",show);}return this;};JSJaCPresence.prototype.setPriority=function(prio){this._setChildNode("priority",prio);return this;};JSJaCPresence.prototype.setPresence=function(show,status,prio){if(show){this.setShow(show);}if(status){this.setStatus(status);}if(prio){this.setPriority(prio);}return this;};JSJaCPresence.prototype.getStatus=function(){return this.getChildVal("status");};JSJaCPresence.prototype.getShow=function(){return this.getChildVal("show");};JSJaCPresence.prototype.getPriority=function(){return this.getChildVal("priority");};function JSJaCIQ(){this.base=JSJaCPacket;this.base("iq");}JSJaCIQ.prototype=new JSJaCPacket;JSJaCIQ.prototype.setIQ=function(to,type,id){if(to){this.setTo(to);}if(type){this.setType(type);}if(id){this.setID(id);}return this;};JSJaCIQ.prototype.setQuery=function(xmlns){var query;try{query=this.getDoc().createElementNS(xmlns,"query");}catch(e){query=this.getDoc().createElement("query");}if(query&&query.getAttribute("xmlns")!=xmlns){query.setAttribute("xmlns",xmlns);}this.getNode().appendChild(query);return query;};JSJaCIQ.prototype.getQuery=function(){return this.getNode().getElementsByTagName("query").item(0);};JSJaCIQ.prototype.getQueryXMLNS=function(){if(this.getQuery()){return this.getQuery().namespaceURI;}else{return null;}};JSJaCIQ.prototype.reply=function(payload){var rIQ=this.clone();rIQ.setTo(this.getFrom());rIQ.setType("result");if(payload){if(typeof payload=="string"){rIQ.getChild().appendChild(rIQ.getDoc().loadXML(payload));}else{if(payload.constructor==Array){var node=rIQ.getChild();for(var i=0;i<payload.length;i++){if(typeof payload[i]=="string"){node.appendChild(rIQ.getDoc().loadXML(payload[i]));}else{if(typeof payload[i]=="object"){node.appendChild(payload[i]);}}}}else{if(typeof payload=="object"){rIQ.getChild().appendChild(payload);}}}}return rIQ;};function JSJaCMessage(){this.base=JSJaCPacket;this.base("message");}JSJaCMessage.prototype=new JSJaCPacket;JSJaCMessage.prototype.setBody=function(body){this._setChildNode("body",body);return this;};JSJaCMessage.prototype.setSubject=function(subject){this._setChildNode("subject",subject);return this;};JSJaCMessage.prototype.setThread=function(thread){this._setChildNode("thread",thread);return this;};JSJaCMessage.prototype.getThread=function(){return this.getChildVal("thread");};JSJaCMessage.prototype.getBody=function(){return this.getChildVal("body");};JSJaCMessage.prototype.getSubject=function(){return this.getChildVal("subject");};JSJaCPacket.wrapNode=function(node){var aNode;switch(node.nodeName.toLowerCase()){case"presence":aNode=new JSJaCPresence();break;case"message":aNode=new JSJaCMessage();break;case"iq":aNode=new JSJaCIQ();break;default:return null;}aNode._replaceNode(node);return aNode;};function JSJaCHttpBindingConnection(oArg){this.base=JSJaCConnection;this.base(oArg);this._hold=JSJACHBC_MAX_HOLD;this._inactivity=0;this._last_requests=new Object();this._last_rid=0;this._min_polling=0;this._pause=0;this._wait=JSJACHBC_MAX_WAIT;}JSJaCHttpBindingConnection.prototype=new JSJaCConnection();JSJaCHttpBindingConnection.prototype.inherit=function(oArg){this.domain=oArg.domain||"localhost";this.username=oArg.username;this.resource=oArg.resource;this._sid=oArg.sid;this._rid=oArg.rid;this._min_polling=oArg.polling;this._inactivity=oArg.inactivity;this._setHold(oArg.requests-1);this.setPollInterval(this._timerval);if(oArg.wait){this._wait=oArg.wait;}this._connected=true;this._handleEvent("onconnect");this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL);this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL);this._timeout=setTimeout(JSJaC.bind(this._process,this),this.getPollInterval());};JSJaCHttpBindingConnection.prototype.setPollInterval=function(timerval){if(timerval&&!isNaN(timerval)){if(!this.isPolling()){this._timerval=100;}else{if(this._min_polling&&timerval<this._min_polling*1000){this._timerval=this._min_polling*1000;}else{if(this._inactivity&&timerval>this._inactivity*1000){this._timerval=this._inactivity*1000;}else{this._timerval=timerval;}}}}return this._timerval;};JSJaCHttpBindingConnection.prototype.isPolling=function(){return(this._hold==0);};JSJaCHttpBindingConnection.prototype._getFreeSlot=function(){for(var i=0;i<this._hold+1;i++){if(typeof(this._req[i])=="undefined"||typeof(this._req[i].r)=="undefined"||this._req[i].r.readyState==4){return i;}}return -1;};JSJaCHttpBindingConnection.prototype._getHold=function(){return this._hold;};JSJaCHttpBindingConnection.prototype._getRequestString=function(raw,last){raw=raw||"";var reqstr="";if(this._rid<=this._last_rid&&typeof(this._last_requests[this._rid])!="undefined"){reqstr=this._last_requests[this._rid].xml;}else{var xml="";while(this._pQueue.length){var curNode=this._pQueue[0];xml+=curNode;this._pQueue=this._pQueue.slice(1,this._pQueue.length);}reqstr="<body rid='"+this._rid+"' sid='"+this._sid+"' xmlns='http://jabber.org/protocol/httpbind' ";if(JSJAC_HAVEKEYS){reqstr+="key='"+this._keys.getKey()+"' ";if(this._keys.lastKey()){this._keys=new JSJaCKeys(hex_sha1,this.oDbg);reqstr+="newkey='"+this._keys.getKey()+"' ";}}if(last){reqstr+="type='terminate' ";}else{if(this._reinit){if(JSJACHBC_USE_BOSH_VER){reqstr+="xmpp:restart='true' ";}this._reinit=false;}}if(xml!=""||raw!=""){reqstr+=">"+raw+xml+"</body>";}else{reqstr+="/>";}this._last_requests[this._rid]=new Object();this._last_requests[this._rid].xml=reqstr;this._last_rid=this._rid;for(var i in this._last_requests){if(this._last_requests.hasOwnProperty(i)&&i<this._rid-this._hold){delete (this._last_requests[i]);}}}return reqstr;};JSJaCHttpBindingConnection.prototype._getInitialRequestString=function(){var reqstr="<body hold='"+this._hold+"' xmlns='http://jabber.org/protocol/httpbind' to='"+this.authhost+"' wait='"+this._wait+"' rid='"+this._rid+"'";if(this.host||this.port){reqstr+=" route='xmpp:"+this.host+":"+this.port+"'";}if(this.secure){reqstr+=" secure='"+this.secure+"'";}if(JSJAC_HAVEKEYS){this._keys=new JSJaCKeys(hex_sha1,this.oDbg);key=this._keys.getKey();reqstr+=" newkey='"+key+"'";}if(this._xmllang){reqstr+=" xml:lang='"+this._xmllang+"'";}if(JSJACHBC_USE_BOSH_VER){reqstr+=" ver='"+JSJACHBC_BOSH_VERSION+"'";reqstr+=" xmpp:xmlns='urn:xmpp:xbosh'";if(this.authtype=="sasl"||this.authtype=="saslanon"){reqstr+=" xmpp:version='1.0'";}}reqstr+="/>";return reqstr;};JSJaCHttpBindingConnection.prototype._getStreamID=function(slot){this.oDbg.log(this._req[slot].r.responseText,4);if(!this._req[slot].r.responseXML||!this._req[slot].r.responseXML.documentElement){this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));return;}var body=this._req[slot].r.responseXML.documentElement;if(body.getAttribute("authid")){this.streamid=body.getAttribute("authid");this.oDbg.log("got streamid: "+this.streamid,2);}else{this._timeout=setTimeout(JSJaC.bind(this._sendEmpty,this),this.getPollInterval());return;}this._timeout=setTimeout(JSJaC.bind(this._process,this),this.getPollInterval());if(!this._parseStreamFeatures(body)){return;}if(this.register){this._doInBandReg();}else{this._doAuth();}};JSJaCHttpBindingConnection.prototype._getSuspendVars=function(){return("host,port,secure,_rid,_last_rid,_wait,_min_polling,_inactivity,_hold,_last_requests,_pause").split(",");};JSJaCHttpBindingConnection.prototype._handleInitialResponse=function(slot){try{this.oDbg.log(this._req[slot].r.getAllResponseHeaders(),4);this.oDbg.log(this._req[slot].r.responseText,4);}catch(ex){this.oDbg.log("No response",4);}if(this._req[slot].r.status!=200||!this._req[slot].r.responseXML){this.oDbg.log("initial response broken (status: "+this._req[slot].r.status+")",1);this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));return;}var body=this._req[slot].r.responseXML.documentElement;if(!body||body.tagName!="body"||body.namespaceURI!="http://jabber.org/protocol/httpbind"){this.oDbg.log("no body element or incorrect body in initial response",1);this._handleEvent("onerror",JSJaCError("500","wait","internal-service-error"));return;}if(body.getAttribute("type")=="terminate"){this.oDbg.log("invalid response:\n"+this._req[slot].r.responseText,1);clearTimeout(this._timeout);this._connected=false;this.oDbg.log("Disconnected.",1);this._handleEvent("ondisconnect");this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));return;}this._sid=body.getAttribute("sid");this.oDbg.log("got sid: "+this._sid,2);if(body.getAttribute("polling")){this._min_polling=body.getAttribute("polling");}if(body.getAttribute("inactivity")){this._inactivity=body.getAttribute("inactivity");}if(body.getAttribute("requests")){this._setHold(body.getAttribute("requests")-1);}this.oDbg.log("set hold to "+this._getHold(),2);if(body.getAttribute("ver")){this._bosh_version=body.getAttribute("ver");}if(body.getAttribute("maxpause")){this._pause=Number.max(body.getAttribute("maxpause"),JSJACHBC_MAXPAUSE);}this.setPollInterval(this._timerval);this._connected=true;this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL);this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL);this._getStreamID(slot);};JSJaCHttpBindingConnection.prototype._parseResponse=function(req){if(!this.connected()||!req){return null;}var r=req.r;try{if(r.status==404||r.status==403){this._abort();return null;}if(r.status!=200||!r.responseXML){this._errcnt++;var errmsg="invalid response ("+r.status+"):\n"+r.getAllResponseHeaders()+"\n"+r.responseText;if(!r.responseXML){errmsg+="\nResponse failed to parse!";}this.oDbg.log(errmsg,1);if(this._errcnt>JSJAC_ERR_COUNT){this._abort();return null;}this.oDbg.log("repeating ("+this._errcnt+")",1);this._setStatus("proto_error_fallback");setTimeout(JSJaC.bind(this._resume,this),this.getPollInterval());return null;}}catch(e){this.oDbg.log("XMLHttpRequest error: status not available",1);this._errcnt++;if(this._errcnt>JSJAC_ERR_COUNT){this._abort();}else{this.oDbg.log("repeating ("+this._errcnt+")",1);this._setStatus("proto_error_fallback");setTimeout(JSJaC.bind(this._resume,this),this.getPollInterval());}return null;}var body=r.responseXML.documentElement;if(!body||body.tagName!="body"||body.namespaceURI!="http://jabber.org/protocol/httpbind"){this.oDbg.log("invalid response:\n"+r.responseText,1);clearTimeout(this._timeout);clearInterval(this._interval);clearInterval(this._inQto);this._connected=false;this.oDbg.log("Disconnected.",1);this._handleEvent("ondisconnect");this._setStatus("internal_server_error");this._handleEvent("onerror",JSJaCError("500","wait","internal-server-error"));return null;}if(typeof(req.rid)!="undefined"&&this._last_requests[req.rid]){if(this._last_requests[req.rid].handled){this.oDbg.log("already handled "+req.rid,2);return null;}else{this._last_requests[req.rid].handled=true;}}if(body.getAttribute("type")=="terminate"){this.oDbg.log("session terminated:\n"+r.responseText,1);clearTimeout(this._timeout);clearInterval(this._interval);clearInterval(this._inQto);if(body.getAttribute("condition")=="remote-stream-error"){if(body.getElementsByTagName("conflict").length>0){this._setStatus("session-terminate-conflict");}}this._handleEvent("onerror",JSJaCError("503","cancel",body.getAttribute("condition")));this._connected=false;this.oDbg.log("Disconnected.",1);this._handleEvent("ondisconnect");return null;}this._errcnt=0;return r.responseXML.documentElement;};JSJaCHttpBindingConnection.prototype._reInitStream=function(to,cb,arg){this._reinit=true;cb.call(this,arg);};JSJaCHttpBindingConnection.prototype._resume=function(){if(this._pause==0&&this._rid>=this._last_rid){this._rid=this._last_rid-1;}this._process();};JSJaCHttpBindingConnection.prototype._setHold=function(hold){if(!hold||isNaN(hold)||hold<0){hold=0;}else{if(hold>JSJACHBC_MAX_HOLD){hold=JSJACHBC_MAX_HOLD;}}this._hold=hold;return this._hold;};JSJaCHttpBindingConnection.prototype._setupRequest=function(async){var req=new Object();var r=XmlHttp.create();try{r.open("POST",this._httpbase,async);r.setRequestHeader("Content-Type","text/xml; charset=utf-8");}catch(e){this.oDbg.log(e,1);}req.r=r;this._rid++;req.rid=this._rid;return req;};JSJaCHttpBindingConnection.prototype._suspend=function(){if(this._pause==0){return;}var slot=this._getFreeSlot();this._req[slot]=this._setupRequest(false);var reqstr="<body pause='"+this._pause+"' xmlns='http://jabber.org/protocol/httpbind' sid='"+this._sid+"' rid='"+this._rid+"'";if(JSJAC_HAVEKEYS){reqstr+=" key='"+this._keys.getKey()+"'";if(this._keys.lastKey()){this._keys=new JSJaCKeys(hex_sha1,this.oDbg);reqstr+=" newkey='"+this._keys.getKey()+"'";}}reqstr+=">";while(this._pQueue.length){var curNode=this._pQueue[0];reqstr+=curNode;this._pQueue=this._pQueue.slice(1,this._pQueue.length);}reqstr+="</body>";this.oDbg.log("Disconnecting: "+reqstr,4);this._req[slot].r.send(reqstr);};function JSJaCHttpPollingConnection(oArg){this.base=JSJaCConnection;this.base(oArg);JSJACPACKET_USE_XMLNS=false;}JSJaCHttpPollingConnection.prototype=new JSJaCConnection();JSJaCHttpPollingConnection.prototype.isPolling=function(){return true;};JSJaCHttpPollingConnection.prototype._getFreeSlot=function(){if(typeof(this._req[0])=="undefined"||typeof(this._req[0].r)=="undefined"||this._req[0].r.readyState==4){return 0;}else{return -1;}};JSJaCHttpPollingConnection.prototype._getInitialRequestString=function(){var reqstr="0";if(JSJAC_HAVEKEYS){this._keys=new JSJaCKeys(b64_sha1,this.oDbg);key=this._keys.getKey();reqstr+=";"+key;}var streamto=this.domain;if(this.authhost){streamto=this.authhost;}reqstr+=",<stream:stream to='"+streamto+"' xmlns='jabber:client' xmlns:stream='http://etherx.jabber.org/streams'";if(this.authtype=="sasl"||this.authtype=="saslanon"){reqstr+=" version='1.0'";}reqstr+=">";return reqstr;};JSJaCHttpPollingConnection.prototype._getRequestString=function(raw,last){var reqstr=this._sid;if(JSJAC_HAVEKEYS){reqstr+=";"+this._keys.getKey();if(this._keys.lastKey()){this._keys=new JSJaCKeys(b64_sha1,this.oDbg);reqstr+=";"+this._keys.getKey();}}reqstr+=",";if(raw){reqstr+=raw;}while(this._pQueue.length){reqstr+=this._pQueue[0];this._pQueue=this._pQueue.slice(1,this._pQueue.length);}if(last){reqstr+="</stream:stream>";}return reqstr;};JSJaCHttpPollingConnection.prototype._getStreamID=function(){if(this._req[0].r.responseText==""){this.oDbg.log("waiting for stream id",2);this._timeout=setTimeout(JSJaC.bind(this._sendEmpty,this),1000);return;}this.oDbg.log(this._req[0].r.responseText,4);if(this._req[0].r.responseText.match(/id=[\'\"]([^\'\"]+)[\'\"]/)){this.streamid=RegExp.$1;}this.oDbg.log("got streamid: "+this.streamid,2);var doc;try{var response=this._req[0].r.responseText;if(!response.match(/<\/stream:stream>\s*$/)){response+="</stream:stream>";}doc=XmlDocument.create("doc");doc.loadXML(response);if(!this._parseStreamFeatures(doc)){return;}}catch(e){this.oDbg.log("loadXML: "+e.toString(),1);}this._connected=true;if(this.register){this._doInBandReg();}else{this._doAuth();}this._process(this._timerval);};JSJaCHttpPollingConnection.prototype._getSuspendVars=function(){return new Array();};JSJaCHttpPollingConnection.prototype._handleInitialResponse=function(){this.oDbg.log(this._req[0].r.getAllResponseHeaders(),4);var aPList=this._req[0].r.getResponseHeader("Set-Cookie");aPList=aPList.split(";");for(var i=0;i<aPList.length;i++){aArg=aPList[i].split("=");if(aArg[0]=="ID"){this._sid=aArg[1];}}this.oDbg.log("got sid: "+this._sid,2);this._connected=true;this._interval=setInterval(JSJaC.bind(this._checkQueue,this),JSJAC_CHECKQUEUEINTERVAL);this._inQto=setInterval(JSJaC.bind(this._checkInQ,this),JSJAC_CHECKINQUEUEINTERVAL);this._getStreamID();};JSJaCHttpPollingConnection.prototype._parseResponse=function(r){var req=r.r;if(!this.connected()){return null;}if(req.status!=200){this.oDbg.log("invalid response ("+req.status+"):"+req.responseText+"\n"+req.getAllResponseHeaders(),1);this._setStatus("internal_server_error");clearTimeout(this._timeout);clearInterval(this._interval);clearInterval(this._inQto);this._connected=false;this.oDbg.log("Disconnected.",1);this._handleEvent("ondisconnect");this._handleEvent("onerror",JSJaCError("503","cancel","service-unavailable"));return null;}this.oDbg.log(req.getAllResponseHeaders(),4);var sid,aPList=req.getResponseHeader("Set-Cookie");if(aPList==null){sid="-1:0";}else{aPList=aPList.split(";");var sid;for(var i=0;i<aPList.length;i++){var aArg=aPList[i].split("=");if(aArg[0]=="ID"){sid=aArg[1];}}}if(typeof(sid)!="undefined"&&sid.indexOf(":0")!=-1){switch(sid.substring(0,sid.indexOf(":0"))){case"0":this.oDbg.log("invalid response:"+req.responseText,1);break;case"-1":this.oDbg.log("Internal Server Error",1);break;case"-2":this.oDbg.log("Bad Request",1);break;case"-3":this.oDbg.log("Key Sequence Error",1);break;}this._setStatus("internal_server_error");clearTimeout(this._timeout);clearInterval(this._interval);clearInterval(this._inQto);this._handleEvent("onerror",JSJaCError("500","wait","internal-server-error"));this._connected=false;this.oDbg.log("Disconnected.",1);this._handleEvent("ondisconnect");return null;}if(!req.responseText||req.responseText==""){return null;}try{var response=req.responseText.replace(/\<\?xml.+\?\>/,"");if(response.match(/<stream:stream/)){response+="</stream:stream>";}var doc=JSJaCHttpPollingConnection._parseTree("<body>"+response+"</body>");if(!doc||doc.tagName=="parsererror"){this.oDbg.log("parsererror",1);doc=JSJaCHttpPollingConnection._parseTree("<stream:stream xmlns:stream='http://etherx.jabber.org/streams'>"+req.responseText);if(doc&&doc.tagName!="parsererror"){this.oDbg.log("stream closed",1);if(doc.getElementsByTagName("conflict").length>0){this._setStatus("session-terminate-conflict");}clearTimeout(this._timeout);clearInterval(this._interval);clearInterval(this._inQto);this._handleEvent("onerror",JSJaCError("503","cancel","session-terminate"));this._connected=false;this.oDbg.log("Disconnected.",1);this._handleEvent("ondisconnect");}else{this.oDbg.log("parsererror:"+doc,1);}return doc;}return doc;}catch(e){this.oDbg.log("parse error:"+e.message,1);}return null;};JSJaCHttpPollingConnection.prototype._reInitStream=function(to,cb,arg){this._sendRaw("<stream:stream xmlns:stream='http://etherx.jabber.org/streams' xmlns='jabber:client' to='"+to+"' version='1.0'>",cb,arg);};JSJaCHttpPollingConnection.prototype._resume=function(){this._process(this._timerval);};JSJaCHttpPollingConnection.prototype._setupRequest=function(async){var r=XmlHttp.create();try{r.open("POST",this._httpbase,async);if(r.overrideMimeType){r.overrideMimeType("text/plain; charset=utf-8");}r.setRequestHeader("Content-Type","application/x-www-form-urlencoded");}catch(e){this.oDbg.log(e,1);}var req=new Object();req.r=r;return req;};JSJaCHttpPollingConnection.prototype._suspend=function(){};JSJaCHttpPollingConnection._parseTree=function(s){try{var r=XmlDocument.create("body","foo");if(typeof(r.loadXML)!="undefined"){r.loadXML(s);return r.documentElement;}else{if(window.DOMParser){return(new DOMParser()).parseFromString(s,"text/xml").documentElement;}}}catch(e){}return null;};var JSJaC={Version:"1.3.1",require:function(libraryName){document.write('<script type="text/javascript" src="'+libraryName+'"><\/script>');},load:function(){var includes=["xmlextras","jsextras","crypt","JSJaCConfig","JSJaCConstants","JSJaCCookie","JSJaCJSON","JSJaCJID","JSJaCBuilder","JSJaCPacket","JSJaCError","JSJaCKeys","JSJaCConnection","JSJaCHttpPollingConnection","JSJaCHttpBindingConnection","JSJaCConsoleLogger"];var scripts=document.getElementsByTagName("script");var path="./";for(var i=0;i<scripts.length;i++){if(scripts.item(i).src&&scripts.item(i).src.match(/JSJaC\.js$/)){path=scripts.item(i).src.replace(/JSJaC.js$/,"");break;}}for(var i=0;i<includes.length;i++){this.require(path+includes[i]+".js");}},bind:function(fn,obj,arg){return function(){if(arg){fn.apply(obj,arg);}else{fn.apply(obj);}};}};if(typeof JSJaCConnection=="undefined"){JSJaC.load();}MooTools.More={"version":"1.2.4.3","build":"6c664838ffa145382c063893d35455a624c13a50"};(function(){var data={language:"en-US",languages:{"en-US":{}},cascades:["en-US"]};var cascaded;MooTools.lang=new Events();$extend(MooTools.lang,{setLanguage:function(lang){if(!data.languages[lang]){return this;}data.language=lang;this.load();this.fireEvent("langChange",lang);return this;},load:function(){var langs=this.cascade(this.getCurrentLanguage());cascaded={};$each(langs,function(set,setName){cascaded[setName]=this.lambda(set);},this);},getCurrentLanguage:function(){return data.language;},addLanguage:function(lang){data.languages[lang]=data.languages[lang]||{};return this;},cascade:function(lang){var cascades=(data.languages[lang]||{}).cascades||[];cascades.combine(data.cascades);cascades.erase(lang).push(lang);var langs=cascades.map(function(lng){return data.languages[lng];},this);return $merge.apply(this,langs);},lambda:function(set){(set||{}).get=function(key,args){return $lambda(set[key]).apply(this,$splat(args));};return set;},get:function(set,key,args){if(cascaded&&cascaded[set]){return(key?cascaded[set].get(key,args):cascaded[set]);}},set:function(lang,set,members){this.addLanguage(lang);langData=data.languages[lang];if(!langData[set]){langData[set]={};}$extend(langData[set],members);if(lang==this.getCurrentLanguage()){this.load();this.fireEvent("langChange",lang);}return this;},list:function(){return Hash.getKeys(data.languages);}});})();(function(){var global=this;var log=function(){if(global.console&&console.log){try{console.log.apply(console,arguments);}catch(e){console.log(Array.slice(arguments));}}else{Log.logged.push(arguments);}return this;};var disabled=function(){this.logged.push(arguments);return this;};this.Log=new Class({logged:[],log:disabled,resetLog:function(){this.logged.empty();return this;},enableLog:function(){this.log=log;this.logged.each(function(args){this.log.apply(this,args);},this);return this.resetLog();},disableLog:function(){this.log=disabled;return this;}});Log.extend(new Log).enableLog();Log.logger=function(){return this.log.apply(this,arguments);};})();Array.implement({min:function(){return Math.min.apply(null,this);},max:function(){return Math.max.apply(null,this);},average:function(){return this.length?this.sum()/this.length:0;},sum:function(){var result=0,l=this.length;if(l){do{result+=this[--l];}while(l);}return result;},unique:function(){return[].combine(this);},shuffle:function(){for(var i=this.length;i&&--i;){var temp=this[i],r=Math.floor(Math.random()*(i+1));this[i]=this[r];this[r]=temp;}return this;}});(function(){var Date=this.Date;if(!Date.now){Date.now=$time;}Date.Methods={ms:"Milliseconds",year:"FullYear",min:"Minutes",mo:"Month",sec:"Seconds",hr:"Hours"};["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds","Time","TimezoneOffset","Week","Timezone","GMTOffset","DayOfYear","LastMonth","LastDayOfMonth","UTCDate","UTCDay","UTCFullYear","AMPM","Ordinal","UTCHours","UTCMilliseconds","UTCMinutes","UTCMonth","UTCSeconds"].each(function(method){Date.Methods[method.toLowerCase()]=method;});var pad=function(what,length){return new Array(length-String(what).length+1).join("0")+what;};Date.implement({set:function(prop,value){switch($type(prop)){case"object":for(var p in prop){this.set(p,prop[p]);}break;case"string":prop=prop.toLowerCase();var m=Date.Methods;if(m[prop]){this["set"+m[prop]](value);}}return this;},get:function(prop){prop=prop.toLowerCase();var m=Date.Methods;if(m[prop]){return this["get"+m[prop]]();}return null;},clone:function(){return new Date(this.get("time"));},increment:function(interval,times){interval=interval||"day";times=$pick(times,1);switch(interval){case"year":return this.increment("month",times*12);case"month":var d=this.get("date");this.set("date",1).set("mo",this.get("mo")+times);return this.set("date",d.min(this.get("lastdayofmonth")));case"week":return this.increment("day",times*7);case"day":return this.set("date",this.get("date")+times);}if(!Date.units[interval]){throw new Error(interval+" is not a supported interval");}return this.set("time",this.get("time")+times*Date.units[interval]());},decrement:function(interval,times){return this.increment(interval,-1*$pick(times,1));},isLeapYear:function(){return Date.isLeapYear(this.get("year"));},clearTime:function(){return this.set({hr:0,min:0,sec:0,ms:0});},diff:function(date,resolution){if($type(date)=="string"){date=Date.parse(date);}return((date-this)/Date.units[resolution||"day"](3,3)).toInt();},getLastDayOfMonth:function(){return Date.daysInMonth(this.get("mo"),this.get("year"));},getDayOfYear:function(){return(Date.UTC(this.get("year"),this.get("mo"),this.get("date")+1)-Date.UTC(this.get("year"),0,1))/Date.units.day();},getWeek:function(){return(this.get("dayofyear")/7).ceil();},getOrdinal:function(day){return Date.getMsg("ordinal",day||this.get("date"));},getTimezone:function(){return this.toString().replace(/^.*? ([A-Z]{3}).[0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3");},getGMTOffset:function(){var off=this.get("timezoneOffset");return((off>0)?"-":"+")+pad((off.abs()/60).floor(),2)+pad(off%60,2);},setAMPM:function(ampm){ampm=ampm.toUpperCase();var hr=this.get("hr");if(hr>11&&ampm=="AM"){return this.decrement("hour",12);}else{if(hr<12&&ampm=="PM"){return this.increment("hour",12);}}return this;},getAMPM:function(){return(this.get("hr")<12)?"AM":"PM";},parse:function(str){this.set("time",Date.parse(str));return this;},isValid:function(date){return !!(date||this).valueOf();},format:function(f){if(!this.isValid()){return"invalid date";}f=f||"%x %X";f=formats[f.toLowerCase()]||f;var d=this;return f.replace(/%([a-z%])/gi,function($0,$1){switch($1){case"a":return Date.getMsg("days")[d.get("day")].substr(0,3);case"A":return Date.getMsg("days")[d.get("day")];case"b":return Date.getMsg("months")[d.get("month")].substr(0,3);case"B":return Date.getMsg("months")[d.get("month")];case"c":return d.toString();case"d":return pad(d.get("date"),2);case"D":return d.get("date");case"H":return pad(d.get("hr"),2);case"I":return((d.get("hr")%12)||12);case"j":return pad(d.get("dayofyear"),3);case"m":return pad((d.get("mo")+1),2);case"M":return pad(d.get("min"),2);case"o":return d.get("ordinal");case"p":return Date.getMsg(d.get("ampm"));case"S":return pad(d.get("seconds"),2);case"U":return pad(d.get("week"),2);case"w":return d.get("day");case"x":return d.format(Date.getMsg("shortDate"));case"X":return d.format(Date.getMsg("shortTime"));case"y":return d.get("year").toString().substr(2);case"Y":return d.get("year");case"T":return d.get("GMTOffset");case"Z":return d.get("Timezone");}return $1;});},toISOString:function(){return this.format("iso8601");}});Date.alias("toISOString","toJSON");Date.alias("diff","compare");Date.alias("format","strftime");var formats={db:"%Y-%m-%d %H:%M:%S",compact:"%Y%m%dT%H%M%S",iso8601:"%Y-%m-%dT%H:%M:%S%T",rfc822:"%a, %d %b %Y %H:%M:%S %Z","short":"%d %b %H:%M","long":"%B %d, %Y %H:%M"};var parsePatterns=[];var nativeParse=Date.parse;var parseWord=function(type,word,num){var ret=-1;var translated=Date.getMsg(type+"s");switch($type(word)){case"object":ret=translated[word.get(type)];break;case"number":ret=translated[month-1];if(!ret){throw new Error("Invalid "+type+" index: "+index);}break;case"string":var match=translated.filter(function(name){return this.test(name);},new RegExp("^"+word,"i"));if(!match.length){throw new Error("Invalid "+type+" string");}if(match.length>1){throw new Error("Ambiguous "+type);}ret=match[0];}return(num)?translated.indexOf(ret):ret;};Date.extend({getMsg:function(key,args){return MooTools.lang.get("Date",key,args);},units:{ms:$lambda(1),second:$lambda(1000),minute:$lambda(60000),hour:$lambda(3600000),day:$lambda(86400000),week:$lambda(608400000),month:function(month,year){var d=new Date;return Date.daysInMonth($pick(month,d.get("mo")),$pick(year,d.get("year")))*86400000;},year:function(year){year=year||new Date().get("year");return Date.isLeapYear(year)?31622400000:31536000000;}},daysInMonth:function(month,year){return[31,Date.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month];},isLeapYear:function(year){return((year%4===0)&&(year%100!==0))||(year%400===0);},parse:function(from){var t=$type(from);if(t=="number"){return new Date(from);}if(t!="string"){return from;}from=from.clean();if(!from.length){return null;}var parsed;parsePatterns.some(function(pattern){var bits=pattern.re.exec(from);return(bits)?(parsed=pattern.handler(bits)):false;});return parsed||new Date(nativeParse(from));},parseDay:function(day,num){return parseWord("day",day,num);},parseMonth:function(month,num){return parseWord("month",month,num);},parseUTC:function(value){var localDate=new Date(value);var utcSeconds=Date.UTC(localDate.get("year"),localDate.get("mo"),localDate.get("date"),localDate.get("hr"),localDate.get("min"),localDate.get("sec"));return new Date(utcSeconds);},orderIndex:function(unit){return Date.getMsg("dateOrder").indexOf(unit)+1;},defineFormat:function(name,format){formats[name]=format;},defineFormats:function(formats){for(var name in formats){Date.defineFormat(name,formats[name]);}},parsePatterns:parsePatterns,defineParser:function(pattern){parsePatterns.push((pattern.re&&pattern.handler)?pattern:build(pattern));},defineParsers:function(){Array.flatten(arguments).each(Date.defineParser);},define2DigitYearStart:function(year){startYear=year%100;startCentury=year-startYear;}});var startCentury=1900;var startYear=70;var regexOf=function(type){return new RegExp("(?:"+Date.getMsg(type).map(function(name){return name.substr(0,3);}).join("|")+")[a-z]*");};var replacers=function(key){switch(key){case"x":return((Date.orderIndex("month")==1)?"%m[.-/]%d":"%d[.-/]%m")+"([.-/]%y)?";case"X":return"%H([.:]%M)?([.:]%S([.:]%s)?)? ?%p? ?%T?";}return null;};var keys={d:/[0-2]?[0-9]|3[01]/,H:/[01]?[0-9]|2[0-3]/,I:/0?[1-9]|1[0-2]/,M:/[0-5]?\d/,s:/\d+/,o:/[a-z]*/,p:/[ap]\.?m\.?/,y:/\d{2}|\d{4}/,Y:/\d{4}/,T:/Z|[+-]\d{2}(?::?\d{2})?/};keys.m=keys.I;keys.S=keys.M;var currentLanguage;var recompile=function(language){currentLanguage=language;keys.a=keys.A=regexOf("days");keys.b=keys.B=regexOf("months");parsePatterns.each(function(pattern,i){if(pattern.format){parsePatterns[i]=build(pattern.format);}});};var build=function(format){if(!currentLanguage){return{format:format};}var parsed=[];var re=(format.source||format).replace(/%([a-z])/gi,function($0,$1){return replacers($1)||$0;}).replace(/\((?!\?)/g,"(?:").replace(/ (?!\?|\*)/g,",? ").replace(/%([a-z%])/gi,function($0,$1){var p=keys[$1];if(!p){return $1;}parsed.push($1);return"("+p.source+")";}).replace(/\[a-z\]/gi,"[a-z\\u00c0-\\uffff]");return{format:format,re:new RegExp("^"+re+"$","i"),handler:function(bits){bits=bits.slice(1).associate(parsed);var date=new Date().clearTime();if("d" in bits){handle.call(date,"d",1);}if("m" in bits||"b" in bits||"B" in bits){handle.call(date,"m",1);}for(var key in bits){handle.call(date,key,bits[key]);}return date;}};};var handle=function(key,value){if(!value){return this;}switch(key){case"a":case"A":return this.set("day",Date.parseDay(value,true));case"b":case"B":return this.set("mo",Date.parseMonth(value,true));case"d":return this.set("date",value);case"H":case"I":return this.set("hr",value);case"m":return this.set("mo",value-1);case"M":return this.set("min",value);case"p":return this.set("ampm",value.replace(/\./g,""));case"S":return this.set("sec",value);case"s":return this.set("ms",("0."+value)*1000);case"w":return this.set("day",value);case"Y":return this.set("year",value);case"y":value=+value;if(value<100){value+=startCentury+(value<startYear?100:0);}return this.set("year",value);case"T":if(value=="Z"){value="+00";}var offset=value.match(/([+-])(\d{2}):?(\d{2})?/);offset=(offset[1]+"1")*(offset[2]*60+(+offset[3]||0))+this.getTimezoneOffset();return this.set("time",this-offset*60000);}return this;};Date.defineParsers("%Y([-./]%m([-./]%d((T| )%X)?)?)?","%Y%m%d(T%H(%M%S?)?)?","%x( %X)?","%d%o( %b( %Y)?)?( %X)?","%b( %d%o)?( %Y)?( %X)?","%Y %b( %d%o( %X)?)?","%o %b %d %X %T %Y");MooTools.lang.addEvent("langChange",function(language){if(MooTools.lang.get("Date")){recompile(language);}}).fireEvent("langChange",MooTools.lang.getCurrentLanguage());})();Date.implement({timeDiffInWords:function(relative_to){return Date.distanceOfTimeInWords(this,relative_to||new Date);},timeDiff:function(to,joiner){if(to==null){to=new Date;}var delta=((to-this)/1000).toInt();if(!delta){return"0s";}var durations={s:60,m:60,h:24,d:365,y:0};var duration,vals=[];for(var step in durations){if(!delta){break;}if((duration=durations[step])){vals.unshift((delta%duration)+step);delta=(delta/duration).toInt();}else{vals.unshift(delta+step);}}return vals.join(joiner||":");}});Date.alias("timeDiffInWords","timeAgoInWords");Date.extend({distanceOfTimeInWords:function(from,to){return Date.getTimePhrase(((to-from)/1000).toInt());},getTimePhrase:function(delta){var suffix=(delta<0)?"Until":"Ago";if(delta<0){delta*=-1;}var units={minute:60,hour:60,day:24,week:7,month:52/12,year:12,eon:Infinity};var msg="lessThanMinute";for(var unit in units){var interval=units[unit];if(delta<1.5*interval){if(delta>0.75*interval){msg=unit;}break;}delta/=interval;msg=unit+"s";}return Date.getMsg(msg+suffix).substitute({delta:delta.round()});}});Date.defineParsers({re:/^(?:tod|tom|yes)/i,handler:function(bits){var d=new Date().clearTime();switch(bits[0]){case"tom":return d.increment();case"yes":return d.decrement();default:return d;}}},{re:/^(next|last) ([a-z]+)$/i,handler:function(bits){var d=new Date().clearTime();var day=d.getDay();var newDay=Date.parseDay(bits[2],true);var addDays=newDay-day;if(newDay<=day){addDays+=7;}if(bits[1]=="last"){addDays-=7;}return d.set("date",d.getDate()+addDays);}});Hash.implement({getFromPath:function(notation){var source=this.getClean();notation.replace(/\[([^\]]+)\]|\.([^.[]+)|[^[.]+/g,function(match){if(!source){return null;}var prop=arguments[2]||arguments[1]||arguments[0];source=(prop in source)?source[prop]:null;return match;});return source;},cleanValues:function(method){method=method||$defined;this.each(function(v,k){if(!method(v)){this.erase(k);}},this);return this;},run:function(){var args=arguments;this.each(function(v,k){if($type(v)=="function"){v.run(args);}});}});(function(){var special=["??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??","??"];var standard=["A","a","A","a","A","a","A","a","Ae","ae","A","a","A","a","A","a","C","c","C","c","C","c","D","d","D","d","E","e","E","e","E","e","E","e","E","e","E","e","G","g","I","i","I","i","I","i","I","i","L","l","L","l","L","l","N","n","N","n","N","n","O","o","O","o","O","o","O","o","Oe","oe","O","o","o","R","r","R","r","S","s","S","s","S","s","T","t","T","t","T","t","U","u","U","u","U","u","Ue","ue","U","u","Y","y","Y","y","Z","z","Z","z","Z","z","TH","th","DH","dh","ss","OE","oe","AE","ae","u"];var tidymap={"[\xa0\u2002\u2003\u2009]":" ","\xb7":"*","[\u2018\u2019]":"'","[\u201c\u201d]":'"',"\u2026":"...","\u2013":"-","\u2014":"--","\uFFFD":"&raquo;"};var getRegForTag=function(tag,contents){tag=tag||"";var regstr=contents?"<"+tag+"[^>]*>([\\s\\S]*?)</"+tag+">":"</?"+tag+"([^>]+)?>";reg=new RegExp(regstr,"gi");return reg;};String.implement({standardize:function(){var text=this;special.each(function(ch,i){text=text.replace(new RegExp(ch,"g"),standard[i]);});return text;},repeat:function(times){return new Array(times+1).join(this);},pad:function(length,str,dir){if(this.length>=length){return this;}var pad=(str==null?" ":""+str).repeat(length-this.length).substr(0,length-this.length);if(!dir||dir=="right"){return this+pad;}if(dir=="left"){return pad+this;}return pad.substr(0,(pad.length/2).floor())+this+pad.substr(0,(pad.length/2).ceil());},getTags:function(tag,contents){return this.match(getRegForTag(tag,contents))||[];},stripTags:function(tag,contents){return this.replace(getRegForTag(tag,contents),"");},tidy:function(){var txt=this.toString();$each(tidymap,function(value,key){txt=txt.replace(new RegExp(key,"g"),value);});return txt;}});})();(function(addEvent,removeEvent){var match=/(.*?):relay\(([^)]+)\)$/,combinators=/[+>~\s]/,splitType=function(type){var bits=type.match(match);return !bits?{event:type}:{event:bits[1],selector:bits[2]};},check=function(e,selector){var t=e.target;if(combinators.test(selector=selector.trim())){var els=this.getElements(selector);for(var i=els.length;i--;){var el=els[i];if(t==el||el.hasChild(t)){return el;}}}else{for(;t&&t!=this;t=t.parentNode){if(Element.match(t,selector)){return document.id(t);}}}return null;};Element.implement({addEvent:function(type,fn){var splitted=splitType(type);if(splitted.selector){var monitors=this.retrieve("$moo:delegateMonitors",{});if(!monitors[type]){var monitor=function(e){var el=check.call(this,e,splitted.selector);if(el){this.fireEvent(type,[e,el],0,el);}}.bind(this);monitors[type]=monitor;addEvent.call(this,splitted.event,monitor);}}return addEvent.apply(this,arguments);},removeEvent:function(type,fn){var splitted=splitType(type);if(splitted.selector){var events=this.retrieve("events");if(!events||!events[type]||(fn&&!events[type].keys.contains(fn))){return this;}if(fn){removeEvent.apply(this,[type,fn]);}else{removeEvent.apply(this,type);}events=this.retrieve("events");if(events&&events[type]&&events[type].keys.length==0){var monitors=this.retrieve("$moo:delegateMonitors",{});removeEvent.apply(this,[splitted.event,monitors[type]]);delete monitors[type];}return this;}return removeEvent.apply(this,arguments);},fireEvent:function(type,args,delay,bind){var events=this.retrieve("events");if(!events||!events[type]){return this;}events[type].keys.each(function(fn){fn.create({bind:bind||this,delay:delay,arguments:args})();},this);return this;}});})(Element.prototype.addEvent,Element.prototype.removeEvent);Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(elements,options){this.elements=this.subject=$$(elements);this.parent(options);},compute:function(from,to,delta){var now={};for(var i in from){var iFrom=from[i],iTo=to[i],iNow=now[i]={};for(var p in iFrom){iNow[p]=this.parent(iFrom[p],iTo[p],delta);}}return now;},set:function(now){for(var i in now){var iNow=now[i];for(var p in iNow){this.render(this.elements[i],p,iNow[p],this.options.unit);}}return this;},start:function(obj){if(!this.check(obj)){return this;}var from={},to={};for(var i in obj){var iProps=obj[i],iFrom=from[i]={},iTo=to[i]={};for(var p in iProps){var parsed=this.prepare(this.elements[i],p,iProps[p]);iFrom[p]=parsed.from;iTo[p]=parsed.to;}}return this.parent(from,to);}});Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:true},initialize:function(element,options){this.element=this.subject=document.id(element);this.parent(options);var cancel=this.cancel.bind(this,false);if($type(this.element)!="element"){this.element=document.id(this.element.getDocument().body);}var stopper=this.element;if(this.options.wheelStops){this.addEvent("start",function(){stopper.addEvent("mousewheel",cancel);},true);this.addEvent("complete",function(){stopper.removeEvent("mousewheel",cancel);},true);}},set:function(){var now=Array.flatten(arguments);if(Browser.Engine.gecko){now=[Math.round(now[0]),Math.round(now[1])];}this.element.scrollTo(now[0],now[1]);},compute:function(from,to,delta){return[0,1].map(function(i){return Fx.compute(from[i],to[i],delta);});},start:function(x,y){if(!this.check(x,y)){return this;}var scrollSize=this.element.getScrollSize(),scroll=this.element.getScroll(),values={x:x,y:y};for(var z in values){var max=scrollSize[z];if($chk(values[z])){values[z]=($type(values[z])=="number")?values[z]:max;}else{values[z]=scroll[z];}values[z]+=this.options.offset[z];}return this.parent([scroll.x,scroll.y],[values.x,values.y]);},toTop:function(){return this.start(false,0);},toLeft:function(){return this.start(0,false);},toRight:function(){return this.start("right",false);},toBottom:function(){return this.start(false,"bottom");},toElement:function(el){var position=document.id(el).getPosition(this.element);return this.start(position.x,position.y);},scrollIntoView:function(el,axes,offset){axes=axes?$splat(axes):["x","y"];var to={};el=document.id(el);var pos=el.getPosition(this.element);var size=el.getSize();var scroll=this.element.getScroll();var containerSize=this.element.getSize();var edge={x:pos.x+size.x,y:pos.y+size.y};["x","y"].each(function(axis){if(axes.contains(axis)){if(edge[axis]>scroll[axis]+containerSize[axis]){to[axis]=edge[axis]-containerSize[axis];}if(pos[axis]<scroll[axis]){to[axis]=pos[axis];}}if(to[axis]==null){to[axis]=scroll[axis];}if(offset&&offset[axis]){to[axis]=to[axis]+offset[axis];}},this);if(to.x!=scroll.x||to.y!=scroll.y){this.start(to.x,to.y);}return this;},scrollToCenter:function(el,axes,offset){axes=axes?$splat(axes):["x","y"];el=$(el);var to={},pos=el.getPosition(this.element),size=el.getSize(),scroll=this.element.getScroll(),containerSize=this.element.getSize(),edge={x:pos.x+size.x,y:pos.y+size.y};["x","y"].each(function(axis){if(axes.contains(axis)){to[axis]=pos[axis]-(containerSize[axis]-size[axis])/2;}if(to[axis]==null){to[axis]=scroll[axis];}if(offset&&offset[axis]){to[axis]=to[axis]+offset[axis];}},this);if(to.x!=scroll.x||to.y!=scroll.y){this.start(to.x,to.y);}return this;}});var Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:false,style:true,limit:false,handle:false,invert:false,preventDefault:false,stopPropagation:false,modifiers:{x:"left",y:"top"}},initialize:function(){var params=Array.link(arguments,{"options":Object.type,"element":$defined});this.element=document.id(params.element);this.document=this.element.getDocument();this.setOptions(params.options||{});var htype=$type(this.options.handle);this.handles=((htype=="array"||htype=="collection")?$$(this.options.handle):document.id(this.options.handle))||this.element;this.mouse={"now":{},"pos":{}};this.value={"start":{},"now":{}};this.selection=(Browser.Engine.trident)?"selectstart":"mousedown";this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:$lambda(false)};this.attach();},attach:function(){this.handles.addEvent("mousedown",this.bound.start);return this;},detach:function(){this.handles.removeEvent("mousedown",this.bound.start);return this;},start:function(event){if(event.rightClick){return;}if(this.options.preventDefault){event.preventDefault();}if(this.options.stopPropagation){event.stopPropagation();}this.mouse.start=event.page;this.fireEvent("beforeStart",this.element);var limit=this.options.limit;this.limit={x:[],y:[]};for(var z in this.options.modifiers){if(!this.options.modifiers[z]){continue;}if(this.options.style){this.value.now[z]=this.element.getStyle(this.options.modifiers[z]).toInt();}else{this.value.now[z]=this.element[this.options.modifiers[z]];}if(this.options.invert){this.value.now[z]*=-1;}this.mouse.pos[z]=event.page[z]-this.value.now[z];if(limit&&limit[z]){for(var i=2;i--;i){if($chk(limit[z][i])){this.limit[z][i]=$lambda(limit[z][i])();}}}}if($type(this.options.grid)=="number"){this.options.grid={x:this.options.grid,y:this.options.grid};}this.document.addEvents({mousemove:this.bound.check,mouseup:this.bound.cancel});this.document.addEvent(this.selection,this.bound.eventStop);},check:function(event){if(this.options.preventDefault){event.preventDefault();}var distance=Math.round(Math.sqrt(Math.pow(event.page.x-this.mouse.start.x,2)+Math.pow(event.page.y-this.mouse.start.y,2)));if(distance>this.options.snap){this.cancel();this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop});this.fireEvent("start",[this.element,event]).fireEvent("snap",this.element);}},drag:function(event){if(this.options.preventDefault){event.preventDefault();}this.mouse.now=event.page;for(var z in this.options.modifiers){if(!this.options.modifiers[z]){continue;}this.value.now[z]=this.mouse.now[z]-this.mouse.pos[z];if(this.options.invert){this.value.now[z]*=-1;}if(this.options.limit&&this.limit[z]){if($chk(this.limit[z][1])&&(this.value.now[z]>this.limit[z][1])){this.value.now[z]=this.limit[z][1];}else{if($chk(this.limit[z][0])&&(this.value.now[z]<this.limit[z][0])){this.value.now[z]=this.limit[z][0];}}}if(this.options.grid[z]){this.value.now[z]-=((this.value.now[z]-(this.limit[z][0]||0))%this.options.grid[z]);}if(this.options.style){this.element.setStyle(this.options.modifiers[z],this.value.now[z]+this.options.unit);}else{this.element[this.options.modifiers[z]]=this.value.now[z];}}this.fireEvent("drag",[this.element,event]);},cancel:function(event){this.document.removeEvent("mousemove",this.bound.check);this.document.removeEvent("mouseup",this.bound.cancel);if(event){this.document.removeEvent(this.selection,this.bound.eventStop);this.fireEvent("cancel",this.element);}},stop:function(event){this.document.removeEvent(this.selection,this.bound.eventStop);this.document.removeEvent("mousemove",this.bound.drag);this.document.removeEvent("mouseup",this.bound.stop);if(event){this.fireEvent("complete",[this.element,event]);}}});Element.implement({makeResizable:function(options){var drag=new Drag(this,$merge({modifiers:{x:"width",y:"height"}},options));this.store("resizer",drag);return drag.addEvent("drag",function(){this.fireEvent("resize",drag);}.bind(this));}});Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:false,precalculate:false,includeMargins:true,checkDroppables:true},initialize:function(element,options){this.parent(element,options);element=this.element;this.droppables=$$(this.options.droppables);this.container=document.id(this.options.container);if(this.container&&$type(this.container)!="element"){this.container=document.id(this.container.getDocument().body);}var styles=element.getStyles("left","top","position");if(styles.left=="auto"||styles.top=="auto"){element.setPosition(element.getPosition(element.getOffsetParent()));}if(styles.position=="static"){element.setStyle("position","absolute");}this.addEvent("start",this.checkDroppables,true);this.overed=null;},start:function(event){if(this.container){this.options.limit=this.calculateLimit();}if(this.options.precalculate){this.positions=this.droppables.map(function(el){return el.getCoordinates();});}this.parent(event);},calculateLimit:function(){var offsetParent=this.element.getOffsetParent(),containerCoordinates=this.container.getCoordinates(offsetParent),containerBorder={},elementMargin={},elementBorder={},containerMargin={},offsetParentPadding={};["top","right","bottom","left"].each(function(pad){containerBorder[pad]=this.container.getStyle("border-"+pad).toInt();elementBorder[pad]=this.element.getStyle("border-"+pad).toInt();elementMargin[pad]=this.element.getStyle("margin-"+pad).toInt();containerMargin[pad]=this.container.getStyle("margin-"+pad).toInt();offsetParentPadding[pad]=offsetParent.getStyle("padding-"+pad).toInt();},this);var width=this.element.offsetWidth+elementMargin.left+elementMargin.right,height=this.element.offsetHeight+elementMargin.top+elementMargin.bottom,left=0,top=0,right=containerCoordinates.right-containerBorder.right-width,bottom=containerCoordinates.bottom-containerBorder.bottom-height;if(this.options.includeMargins){left+=elementMargin.left;top+=elementMargin.top;}else{right+=elementMargin.right;bottom+=elementMargin.bottom;}if(this.element.getStyle("position")=="relative"){var coords=this.element.getCoordinates(offsetParent);coords.left-=this.element.getStyle("left").toInt();coords.top-=this.element.getStyle("top").toInt();left+=containerBorder.left-coords.left;top+=containerBorder.top-coords.top;right+=elementMargin.left-coords.left;bottom+=elementMargin.top-coords.top;if(this.container!=offsetParent){left+=containerMargin.left+offsetParentPadding.left;top+=(Browser.Engine.trident4?0:containerMargin.top)+offsetParentPadding.top;}}else{left-=elementMargin.left;top-=elementMargin.top;if(this.container==offsetParent){right-=containerBorder.left;bottom-=containerBorder.top;}else{left+=containerCoordinates.left+containerBorder.left;top+=containerCoordinates.top+containerBorder.top;}}return{x:[left,right],y:[top,bottom]};},checkAgainst:function(el,i){el=(this.positions)?this.positions[i]:el.getCoordinates();var now=this.mouse.now;return(now.x>el.left&&now.x<el.right&&now.y<el.bottom&&now.y>el.top);},checkDroppables:function(){var overed=this.droppables.filter(this.checkAgainst,this).getLast();if(this.overed!=overed){if(this.overed){this.fireEvent("leave",[this.element,this.overed]);}if(overed){this.fireEvent("enter",[this.element,overed]);}this.overed=overed;}},drag:function(event){this.parent(event);if(this.options.checkDroppables&&this.droppables.length){this.checkDroppables();}},stop:function(event){this.checkDroppables();this.fireEvent("drop",[this.element,this.overed,event]);this.overed=null;return this.parent(event);}});Element.implement({makeDraggable:function(options){var drag=new Drag.Move(this,options);this.store("dragger",drag);return drag;}});Request.JSONP=new Class({Implements:[Chain,Events,Options,Log],options:{url:"",data:{},retries:0,timeout:0,link:"ignore",callbackKey:"callback",injectScript:document.head},initialize:function(options){this.setOptions(options);if(this.options.log){this.enableLog();}this.running=false;this.requests=0;this.triesRemaining=[];},check:function(){if(!this.running){return true;}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.bind(this,arguments));return false;}return false;},send:function(options){if(!$chk(arguments[1])&&!this.check(options)){return this;}var type=$type(options),old=this.options,index=$chk(arguments[1])?arguments[1]:this.requests++;if(type=="string"||type=="element"){options={data:options};}options=$extend({data:old.data,url:old.url},options);if(!$chk(this.triesRemaining[index])){this.triesRemaining[index]=this.options.retries;}var remaining=this.triesRemaining[index];(function(){var script=this.getScript(options);this.log("JSONP retrieving script with url: "+script.get("src"));this.fireEvent("request",script);this.running=true;(function(){if(remaining){this.triesRemaining[index]=remaining-1;if(script){script.destroy();this.send(options,index).fireEvent("retry",this.triesRemaining[index]);}}else{if(script&&this.options.timeout){script.destroy();this.cancel().fireEvent("failure");}}}).delay(this.options.timeout,this);}).delay(Browser.Engine.trident?50:0,this);return this;},cancel:function(){if(!this.running){return this;}this.running=false;this.fireEvent("cancel");return this;},getScript:function(options){var index=Request.JSONP.counter,data;Request.JSONP.counter++;switch($type(options.data)){case"element":data=document.id(options.data).toQueryString();break;case"object":case"hash":data=Hash.toQueryString(options.data);}var src=options.url+(options.url.test("\\?")?"&":"?")+(options.callbackKey||this.options.callbackKey)+"=Request.JSONP.request_map.request_"+index+(data?"&"+data:"");if(src.length>2083){this.log("JSONP "+src+" will fail in Internet Explorer, which enforces a 2083 bytes length limit on URIs");}var script=new Element("script",{type:"text/javascript",src:src});Request.JSONP.request_map["request_"+index]=function(){this.success(arguments,script);}.bind(this);return script.inject(this.options.injectScript);},success:function(args,script){if(script){script.destroy();}this.running=false;this.log("JSONP successfully retrieved: ",args);this.fireEvent("complete",args).fireEvent("success",args).callChain();}});Request.JSONP.counter=0;Request.JSONP.request_map={};var Asset={javascript:function(source,properties){properties=$extend({onload:$empty,document:document,check:$lambda(true)},properties);if(properties.onLoad){properties.onload=properties.onLoad;}var script=new Element("script",{src:source,type:"text/javascript"});var load=properties.onload.bind(script),check=properties.check,doc=properties.document;delete properties.onload;delete properties.check;delete properties.document;script.addEvents({load:load,readystatechange:function(){if(["loaded","complete"].contains(this.readyState)){load();}}}).set(properties);if(Browser.Engine.webkit419){var checker=(function(){if(!$try(check)){return;}$clear(checker);load();}).periodical(50);}return script.inject(doc.head);},css:function(source,properties){return new Element("link",$merge({rel:"stylesheet",media:"screen",type:"text/css",href:source},properties)).inject(document.head);},image:function(source,properties){properties=$merge({onload:$empty,onabort:$empty,onerror:$empty},properties);var image=new Image();var element=document.id(image)||new Element("img");["load","abort","error"].each(function(name){var type="on"+name;var cap=name.capitalize();if(properties["on"+cap]){properties[type]=properties["on"+cap];}var event=properties[type];delete properties[type];image[type]=function(){if(!image){return;}if(!element.parentNode){element.width=image.width;element.height=image.height;}image=image.onload=image.onabort=image.onerror=null;event.delay(1,element,element);element.fireEvent(name,element,1);};});image.src=element.src=source;if(image&&image.complete){image.onload.delay(1);}return element.set(properties);},images:function(sources,options){options=$merge({onComplete:$empty,onProgress:$empty,onError:$empty,properties:{}},options);sources=$splat(sources);var images=[];var counter=0;return new Elements(sources.map(function(source){return Asset.image(source,$extend(options.properties,{onload:function(){options.onProgress.call(this,counter,sources.indexOf(source));counter++;if(counter==sources.length){options.onComplete();}},onerror:function(){options.onError.call(this,counter,sources.indexOf(source));counter++;if(counter==sources.length){options.onComplete();}}}));}));}};(function(){var Keyboard=this.Keyboard=new Class({Extends:Events,Implements:[Options,Log],options:{defaultEventType:"keydown",active:false,events:{},nonParsedEvents:["activate","deactivate","onactivate","ondeactivate","changed","onchanged"]},initialize:function(options){this.setOptions(options);this.setup();},setup:function(){this.addEvents(this.options.events);if(Keyboard.manager&&!this.manager){Keyboard.manager.manage(this);}if(this.options.active){this.activate();}},handle:function(event,type){if(event.preventKeyboardPropagation){return;}var bubbles=!!this.manager;if(bubbles&&this.activeKB){this.activeKB.handle(event,type);if(event.preventKeyboardPropagation){return;}}this.fireEvent(type,event);if(!bubbles&&this.activeKB){this.activeKB.handle(event,type);}},addEvent:function(type,fn,internal){return this.parent(Keyboard.parse(type,this.options.defaultEventType,this.options.nonParsedEvents),fn,internal);},removeEvent:function(type,fn){return this.parent(Keyboard.parse(type,this.options.defaultEventType,this.options.nonParsedEvents),fn);},toggleActive:function(){return this[this.active?"deactivate":"activate"]();},activate:function(instance){if(instance){if(instance!=this.activeKB){this.previous=this.activeKB;}this.activeKB=instance.fireEvent("activate");Keyboard.manager.fireEvent("changed");}else{if(this.manager){this.manager.activate(this);}}return this;},deactivate:function(instance){if(instance){if(instance===this.activeKB){this.activeKB=null;instance.fireEvent("deactivate");Keyboard.manager.fireEvent("changed");}}else{if(this.manager){this.manager.deactivate(this);}}return this;},relenquish:function(){if(this.previous){this.activate(this.previous);}},manage:function(instance){if(instance.manager){instance.manager.drop(instance);}this.instances.push(instance);instance.manager=this;if(!this.activeKB){this.activate(instance);}else{this._disable(instance);}},_disable:function(instance){if(this.activeKB==instance){this.activeKB=null;}},drop:function(instance){this._disable(instance);this.instances.erase(instance);},instances:[],trace:function(){Keyboard.trace(this);},each:function(fn){Keyboard.each(this,fn);}});var parsed={};var modifiers=["shift","control","alt","meta"];var regex=/^(?:shift|control|ctrl|alt|meta)$/;Keyboard.parse=function(type,eventType,ignore){if(ignore&&ignore.contains(type.toLowerCase())){return type;}type=type.toLowerCase().replace(/^(keyup|keydown):/,function($0,$1){eventType=$1;return"";});if(!parsed[type]){var key,mods={};type.split("+").each(function(part){if(regex.test(part)){mods[part]=true;}else{key=part;}});mods.control=mods.control||mods.ctrl;var keys=[];modifiers.each(function(mod){if(mods[mod]){keys.push(mod);}});if(key){keys.push(key);}parsed[type]=keys.join("+");}return eventType+":"+parsed[type];};Keyboard.each=function(keyboard,fn){var current=keyboard||Keyboard.manager;while(current){fn.run(current);current=current.activeKB;}};Keyboard.stop=function(event){event.preventKeyboardPropagation=true;};Keyboard.manager=new Keyboard({active:true});Keyboard.trace=function(keyboard){keyboard=keyboard||Keyboard.manager;keyboard.enableLog();keyboard.log("the following items have focus: ");Keyboard.each(keyboard,function(current){keyboard.log(document.id(current.widget)||current.wiget||current);});};var handler=function(event){var keys=[];modifiers.each(function(mod){if(event[mod]){keys.push(mod);}});if(!regex.test(event.key)){keys.push(event.key);}Keyboard.manager.handle(event,event.type+":"+keys.join("+"));};document.addEvents({"keyup":handler,"keydown":handler});Event.Keys.extend({"shift":16,"control":17,"alt":18,"capslock":20,"pageup":33,"pagedown":34,"end":35,"home":36,"numlock":144,"scrolllock":145,";":186,"=":187,",":188,"-":Browser.Engine.Gecko?109:189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222});})();(function(){var read=function(option,element){return(option)?($type(option)=="function"?option(element):element.get(option)):"";};this.Tips=new Class({Implements:[Events,Options],options:{onShow:function(){this.tip.setStyle("display","block");},onHide:function(){this.tip.setStyle("display","none");},title:"title",text:function(element){return element.get("rel")||element.get("href");},showDelay:100,hideDelay:100,className:"tip-wrap",offset:{x:16,y:16},windowPadding:{x:0,y:0},fixed:false},initialize:function(){var params=Array.link(arguments,{options:Object.type,elements:$defined});this.setOptions(params.options);if(params.elements){this.attach(params.elements);}},toElement:function(){if(this.tip){return this.tip;}this.container=new Element("div",{"class":"tip"});return this.tip=new Element("div",{"class":this.options.className,styles:{position:"absolute",top:0,left:0}}).adopt(new Element("div",{"class":"tip-top"}),this.container,new Element("div",{"class":"tip-bottom"})).inject(document.body);},attach:function(elements){$$(elements).each(function(element){var title=read(this.options.title,element),text=read(this.options.text,element);element.erase("title").store("tip:native",title).retrieve("tip:title",title);element.retrieve("tip:text",text);this.fireEvent("attach",[element]);var events=["enter","leave"];if(!this.options.fixed){events.push("move");}events.each(function(value){var event=element.retrieve("tip:"+value);if(!event){event=this["element"+value.capitalize()].bindWithEvent(this,element);}element.store("tip:"+value,event).addEvent("mouse"+value,event);},this);},this);return this;},detach:function(elements){$$(elements).each(function(element){["enter","leave","move"].each(function(value){element.removeEvent("mouse"+value,element.retrieve("tip:"+value)).eliminate("tip:"+value);});this.fireEvent("detach",[element]);if(this.options.title=="title"){var original=element.retrieve("tip:native");if(original){element.set("title",original);}}},this);return this;},elementEnter:function(event,element){this.container.empty();["title","text"].each(function(value){var content=element.retrieve("tip:"+value);if(content){this.fill(new Element("div",{"class":"tip-"+value}).inject(this.container),content);}},this);$clear(this.timer);this.timer=(function(){this.show(this,element);this.position((this.options.fixed)?{page:element.getPosition()}:event);}).delay(this.options.showDelay,this);},elementLeave:function(event,element){$clear(this.timer);this.timer=this.hide.delay(this.options.hideDelay,this,element);this.fireForParent(event,element);},fireForParent:function(event,element){element=element.getParent();if(!element||element==document.body){return;}if(element.retrieve("tip:enter")){element.fireEvent("mouseenter",event);}else{this.fireForParent(event,element);}},elementMove:function(event,element){this.position(event);},position:function(event){if(!this.tip){document.id(this);}var size=window.getSize(),scroll=window.getScroll(),tip={x:this.tip.offsetWidth,y:this.tip.offsetHeight},props={x:"left",y:"top"},obj={};for(var z in props){obj[props[z]]=event.page[z]+this.options.offset[z];if((obj[props[z]]+tip[z]-scroll[z])>size[z]-this.options.windowPadding[z]){obj[props[z]]=event.page[z]-this.options.offset[z]-tip[z];}}this.tip.setStyles(obj);},fill:function(element,contents){if(typeof contents=="string"){element.set("html",contents);}else{element.adopt(contents);}},show:function(element){if(!this.tip){document.id(this);}this.fireEvent("show",[this.tip,element]);},hide:function(element){if(!this.tip){document.id(this);}this.fireEvent("hide",[this.tip,element]);}});})();MooTools.lang.set("en-US","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dateOrder:["month","date","year"],shortDate:"%m/%d/%Y",shortTime:"%I:%M%p",AM:"AM",PM:"PM",ordinal:function(dayOfMonth){return(dayOfMonth>3&&dayOfMonth<21)?"th":["th","st","nd","rd","th"][Math.min(dayOfMonth%10,4)];},lessThanMinuteAgo:"less than a minute ago",minuteAgo:"about a minute ago",minutesAgo:"{delta} minutes ago",hourAgo:"about an hour ago",hoursAgo:"about {delta} hours ago",dayAgo:"1 day ago",daysAgo:"{delta} days ago",weekAgo:"1 week ago",weeksAgo:"{delta} weeks ago",monthAgo:"1 month ago",monthsAgo:"{delta} months ago",yearAgo:"1 year ago",yearsAgo:"{delta} years ago",lessThanMinuteUntil:"less than a minute from now",minuteUntil:"about a minute from now",minutesUntil:"{delta} minutes from now",hourUntil:"about an hour from now",hoursUntil:"about {delta} hours from now",dayUntil:"1 day from now",daysUntil:"{delta} days from now",weekUntil:"1 week from now",weeksUntil:"{delta} weeks from now",monthUntil:"1 month from now",monthsUntil:"{delta} months from now",yearUntil:"1 year from now",yearsUntil:"{delta} years from now"});



var Base=new Class({initialize:function(){this.p=pipio;this.registerHandlers();if($defined(this.init)){var args=[];for(var i=0;i<arguments.length;i++){args.push(arguments[i]);}this.init.run(args,this);}},registerHandlers:function(){if($defined(this.EventHandlers)){for(var i=0;i<this.EventHandlers.length;i++){var event=this.EventHandlers[i];try{this.registerHandler(event,this[event].bind(this));}catch(e){Logger().log(event);}}}},registerHandler:function(eventName,func){this.p.registerHandler(eventName,func);},fireEvent:function(){var args=[];for(var i=0;i<arguments.length;i++){args.push(arguments[i]);}this.p.dispatchEvent.run(args,this.p);},call:function(app,name,params,callbackSuccess,callbackFail,form){this.p.call(app,name,params,callbackSuccess,callbackFail,form);},getPrivateUser:function(){return this.p.currentUser;},getCurrentLocation:function(){return this.p.currentLocation;},getLocation:function(username){return this.p.getLocation(username);},getLocations:function(){return this.p.locationsByUsername;},getProfile:function(username){return this.p.getProfile(username);},getSession:function(){return this.p.xmpp.clientName;},getGroups:function(){return this.p.groups;},getContacts:function(){return this.p.connsByUsername;},getContactRequests:function(){return this.p.requestsByUsername;},getContactsByGroup:function(group_id){return this.p.getContactsByGroup(group_id);},getContact:function(username){return this.p.getContact(username);},hasContact:function(username){return this.p.connsByUsername.has(username);},getRoom:function(username){return this.p.getRoom(username);},getRooms:function(){return this.p.roomsByUsername;},getGroup:function(group_id){return this.p.connections.getGroup(group_id);},getUser:function(username){if(username==this.p.currentUser.username){return this.p.currentUser;}else{return this.p.getUser(username);}},videoEnabled:function(){if(this.p.videoInUse){return false;}else{return this.p.videoEnabled;}},checkTimestamp:function(time){return this.p.checkTimestamp(time);},getAppById:function(appId){return this.p.getAppById(appId);},isLoggedIn:function(){return this.p.isLoggedIn();},getPageTitle:function(){return this.p.pageTitle;},getConnectionState:function(username){var state=0;if(this.p.connsByUsername.has(username)){state=1;}else{if(this.p.requestsByUsername.has(username)){state=2;}else{if(this.p.requestsOutByUsername.has(username)){state=3;}}}return state;}});var App=new Class({Extends:Base,initialize:function(app){this.parent();this.name=app.name;this.iconOptions=app.iconOptions;this.registerApis();this.displayName=app.displayName;this.appId=app.id;this.autoDock=app.autoDock||false;this.isStarted=false;this.isDocked=false;this.isExpanded=true;this.defaultMenu=undefined;this.defaultContent=undefined;this.menus=$H();this.contents=$H();this.navs=$H();},registerApis:function(){if($defined(this.requests)){this.requests.each(function(request){this.p.registerCall(this.name,request);},this);}},start:function(options){if(!this.isStarted){if($defined(this.parseOptions)&&$defined(options)){this.parseOptions(options);}this.createApp();this.onStart();this.isStarted=true;if(this.autoDock){this.dock();}}else{if(this.isStarted&&this.isDocked){this.switchDefault();}}if(!this.isLoggedIn()){this.dock();}this.switchDefault();},stop:function(){Logger().log("stopping app"+this.appId);if(this.isStarted){this.destroyApp();this.onStop();this.isStarted=false;this.isDocked=false;this.isExpanded=true;}},getDockIcon:function(){var icon=new Icon20(this.iconOptions);var el=new Element("div",{"class":"app_button has_submenu"}).adopt($(icon),$(this.alert));el.addEvent("click",this.switchDefault.bind(this));return el;},dock:function(){DomUtility.hide(this.navSection);this.undockSep=new Element("div",{"class":"nav_seperator"});this.undockNav=new Nav({displayName:"Undock",onClick:this.undock.bind(this),name:"undock"});this.undockSep.inject(this.navWrapper);$(this.undockNav).inject(this.navWrapper);this.dockButton=new Element("div",{"class":"app_button_wrapper"}).adopt(this.getDockIcon(),this.navWrapper);this.dockButton.inject("dock");this.isDocked=true;},undock:function(){if(!this.isLoggedIn()){this.switchDefault();return;}this.undockSep.destroy();$(this.undockNav).destroy();this.undockNav=null;this.navWrapper.inject(this.navSection);this.dockButton.destroy();DomUtility.show(this.navSection);this.isDocked=false;this.switchDefault();},switchDefault:function(){if($defined(this.defaultContent)){this.fireEvent("viewSwitch",this.appId,this.defaultContent,this.defaultMenu);}},menuAdd:function(menuName,menu){this.fireEvent("menuAdd",this.appId,menuName,menu);if(menu.isDefault){this.defaultMenu=menuName;}this.menus.set(menuName,menu);},menuClose:function(menuName){this.fireEvent("menuClose",this.appId,menuName);this.menus.erase(menuName);},contentAdd:function(contentName,content){this.fireEvent("contentAdd",this.appId,contentName,content);if(content.isDefault){this.defaultContent=contentName;}this.contents.set(contentName,content);},contentClose:function(contentName){this.fireEvent("contentClose",this.appId,contentName);this.contents.erase(contentName);},navAdd:function(nav){var navId=this.appId+"_"+nav.name;nav.navId=navId;if($defined(nav.parentName)){nav.parentId=this.appId+"_"+nav.parentName;}if(this.navs.has(navId)){Logger().log(navId+" nav exist, did not add");return;}if($defined(nav.parentId)){if(!this.navs.has(nav.parentId)){Logger().log(nav.parentId+" parent does not exist");return;}var parent=this.navs.get(nav.parentId);if(!parent.hasSubnavs){Logger().log(nav.parentId+" parent does not allow subnavs");return;}else{parent.addSubnav(nav);}}else{nav.parentId=this.appId;if(nav.bottom){$(nav).inject(this.bottomNav);}else{$(nav).inject(this.nav);}}this.navs.set(navId,nav);},navDelete:function(navName){var navId=this.appId+"_"+navName;if(!this.navs.has(navId)){return;}this.navs.get(navId).destroy();this.navs.erase(navId);},createAppAlert:function(){this.alert=new Alert();this.registerHandler("alertAdd",this.alertAdd.bind(this));this.registerHandler("alertClear",this.alertClear.bind(this));},alertAdd:function(navId){if(navId!=this.appId){return;}this.alert.increment();},alertClear:function(navId,count){if(navId!=this.appId){return;}if(!$defined(count)){var alerts=this.alert.clear();}else{this.alert.decrement(count);}},createApp:function(){this.navSection=new Element("div",{"class":"nav_section"});this.navHeader=new Element("div",{"class":"nav_header clip2"}).inject(this.navSection);this.navWrapper=new Element("div",{"class":"app_sub_menu sub_elements"}).inject(this.navSection);this.nav=new Element("div").inject(this.navWrapper);this.bottomNav=new Element("div").inject(this.navWrapper);this.navSection.inject("nav");this.icon=new Icon20(this.iconOptions);$(this.icon).inject(this.navHeader);this.headerName=new Element("div",{"class":"header_name text12 light","text":TextUtility.unescapeQuotes(this.displayName)}).inject(this.navHeader);this.closeButton=new Element("div",{"class":"button_nav right"}).adopt(new Element("div",{"class":"action close"})).inject(this.navHeader);this.closeButton.addEvent("click",this.stop.bind(this));this.dockButton=new Element("div",{"class":"button_nav right"}).adopt(new Element("div",{"class":"action dock"})).inject(this.navHeader);this.dockButton.addEvent("click",this.dock.bind(this));this.createAppAlert();if($defined(this.onCreate)){this.onCreate();}},destroyApp:function(){this.contents.each(function(content,contentName){this.contentClose(contentName);},this);this.contents.empty();this.menus.each(function(menu,menuName){this.menuClose(menuName);},this);this.menus.empty();this.navs.each(function(nav){nav.destroy();});this.navs.empty();this.navHeader.destroy();this.nav.destroy();this.navSection.destroy();if($defined(this.dockButton)){this.dockButton.destroy();}this.fireEvent("appClose",this.appId);if($defined(this.onDestroy)){this.onDestroy();}}});var AppInstance=new Class({Extends:Base,Implements:App,initialize:function(app,options){this.parent();this.appId=options.appId;this.parseOptions(options);this.name=app.name;this.registerApis();this.isStarted=false;this.isDocked=false;this.isExpanded=true;this.autoDock=app.autoDock||false;this.defaultMenu=undefined;this.defaultContent=undefined;this.menus=$H();this.contents=$H();this.navs=$H();},start:function(appId){this.appId=appId;if(!this.isStarted){this.appId=appId;this.createApp();this.onStart();this.isStarted=true;if(this.autoDock){this.dock();}}else{if(this.isStarted&&this.isDocked){this.switchDefault();}}if(!this.isLoggedIn()){this.dock();}this.switchDefault();}});var Content=new Class({Extends:Base,init:function(options){if(!$defined(options)){options={};}if($defined(this.onBeforeInit)){this.onBeforeInit(options);}this.className=$defined(options.className)?options.className:"";this.isDefault=options.isDefault||false;this.isOn=true;this.firstShow=true;this.bottomFuncCalled=false;this.atBottom=false;this.createContent();if($defined(this.onInit)){this.onInit();}},checkScroll:function(){var maxY=this.contentWrapper.getScrollSize().y;var bottomY=this.contentWrapper.getScroll().y+this.contentWrapper.getSize().y+300;Logger().log("checking scroll "+bottomY+"-"+maxY);if(bottomY>maxY&&!this.bottomFuncCalled&&!this.atBottom){this.bottomFuncCalled=true;this.bottomFunc();}},destroy:function(){if($defined(this.onDestroy)){this.onDestroy();}this.contentWrapper.destroy();},on:function(){this.isOn=true;DomUtility.show(this.contentWrapper);if($defined(this.scrollY)){this.scroll.set(0,this.scrollY);}if($defined(this.onShow)){if(this.firstShow){this.onShow(true);this.firstShow=false;}else{this.onShow(false);}}},off:function(){this.isOn=false;if($defined(this.onHide)){this.onHide();}if($defined(this.contentWrapper)){this.scrollY=this.contentWrapper.getScroll().y;}DomUtility.hide(this.contentWrapper);},createContent:function(){this.contentWrapper=new Element("div",{"class":"content_wrapper"});this.content=new Element("div",{"class":"content "+this.className}).inject(this.contentWrapper);if($defined(this.bottomFunc)){this.contentWrapper.addEvent("mousewheel",this.checkScroll.bind(this));}this.scroll=new Fx.Scroll(this.contentWrapper);},toElement:function(){return this.contentWrapper;}});var Album=new Class({initialize:function(options){this.className=options.className||"";this.id=options.id||"";this.displayName=options.displayName||"Album";this.albumPhotos=new $H();},addPhoto:function(id,thumb,src,caption){var photo=new Object();photo.id=id;photo.caption=caption;photo.thumb=thumb;photo.src=src;this.albumPhotos.set(id,photo);},getPhoto:function(id){return this.albumPhotos.get(id);},getAllPhotos:function(){return this.albumPhotos.getValues();},getSize:function(){return this.albumPhotos.getLength();},getNextPrevPhoto:function(id){var allIds=this.albumPhotos.getKeys();var index=allIds.indexOf(id);var photos=this.albumPhotos.getValues();var i=index;if(allIds.length<=index+1){i=-1;}var next=photos[i+1];i=index;if(index==0){i=allIds.length;}var prev=photos[i-1];return{prev:prev,next:next};},getIndex:function(id){var allIds=this.albumPhotos.getKeys();return allIds.indexOf(id);},nextPhoto:function(id){var allIds=this.albumPhotos.getKeys();var index=allIds.indexOf(id);var photos=this.albumPhotos.getValues();if(allIds.length<=index+1){index=-1;}return photos[index+1];},prevPhoto:function(id){var allIds=this.albumPhotos.getKeys();var index=allIds.indexOf(id);var photos=this.albumPhotos.getValues();if(index==0){index=allIds.length;}return photos[index-1];}});var Alert=new Class({initialize:function(){this.alerts=0;this.createAlert();},createAlert:function(){this.alert=new Element("div",{"class":"alert","text":"0","style":"display: none !important"});},hasAlerts:function(){return this.alerts>0;},update:function(){if(this.alerts<0){this.alerts=0;}this.alert.set("text",this.alerts);if(this.alerts==0){this.alert.setStyle("display","none !important");}else{this.alert.setStyle("display","");}},increment:function(x){if(!$defined(x)){this.alerts++;}else{this.alerts+=x;}this.update();},decrement:function(x){if(!$defined(x)){this.alerts--;}else{this.alerts-=x;}this.update();},clear:function(){var alerts=this.alerts;this.alerts=0;this.update();return alerts;},toElement:function(){return this.alert;},destroy:function(){this.alert.destroy();}});var ButtonMedium=new Class({initialize:function(options){this.displayName=options.displayName;this.className=options.className||"";this.action=options.action||undefined;this.disabled=options.disabled||false;this.createButton();},createButton:function(){this.button=new Element("div",{"class":"button_medium"});this.button.addClass(this.className);if($defined(this.action)){this.button.addClass("has_action");new Element("div",{"class":"action "+this.action}).inject(this.button);}this.button.appendText(TextUtility.unescapeQuotes(this.displayName));},showProgress:function(){this.button.addClass("progress");},hideProgress:function(){this.button.removeClass("progress");},toElement:function(){return this.button;}});var ButtonSmall=new Class({initialize:function(options){this.displayName=options.displayName;this.className=options.className||"";this.action=options.action||undefined;this.disabled=options.disabled||false;this.createButton();},createButton:function(){this.button=new Element("div",{"class":"button_small"});this.button.addClass(this.className);if($defined(this.action)){this.button.addClass("has_action");new Element("div",{"class":"action "+this.action}).inject(this.button);}this.button.appendText(TextUtility.unescapeQuotes(this.displayName));},showProgress:function(){this.button.addClass("progress");},hideProgress:function(){this.button.removeClass("progress");},toElement:function(){return this.button;}});var Icon=new Class({initialize:function(options){this.iconAction=options.iconAction||null;this.isUser=$defined(options.user);if(this.isUser){this.user=options.user;}else{this.iconName=options.iconName;if(this.iconName.contains("http://")){this.isClass=false;}else{this.isClass=true;}}this.createIcon();},createIcon:function(){this.icon=new Element("div",{"class":"icon_wrapper"});if(!this.isUser){if(this.isClass){this.icon.addClass("hasicon on "+this.iconName);this.icon.adopt(new Element("div",{"class":"icon"}));}else{this.icon.adopt(new Element("img",{"src":this.iconName,"style":"height: 16px; width: 16px;"}));}}else{this.icon.addClass("profile_pic_wrapper_16");this.icon.adopt(new Element("img",{"class":"profile_pic profile_pic_16_"+this.user.username,"src":this.user["profile_pic_16"]}),new Element("div",{"class":"online_status online_status_"+this.user.username}));}if($defined(this.iconAction)){this.addAction(this.iconAction);}},toElement:function(){return this.icon;},addAction:function(action){this.iconAction=action;if($defined(this.action)){this.action.destroy();}this.action=new Element("div",{"class":"icon_action "+this.iconAction}).inject(this.icon);}});var Icon20=new Class({initialize:function(options){this.iconAction=options.iconAction||null;this.isUser=$defined(options.user);if(this.isUser){this.user=options.user;}else{this.iconName=options.iconName;if(this.iconName.contains("http://")){this.isClass=false;}else{this.isClass=true;}}this.createIcon();},createIcon:function(){this.icon=new Element("div",{"class":"icon_wrapper"});if(!this.isUser){if(this.isClass){this.icon.addClass("hasicon on "+this.iconName);this.icon.adopt(new Element("div",{"class":"icon20"}));}else{this.icon.adopt(new Element("img",{"src":this.iconName,"style":"height: 20px; width: 20px;"}));}}else{this.icon.addClass("profile_pic_wrapper_16a");this.icon.adopt(new Element("img",{"class":"profile_pic profile_pic_16_"+this.user.username,"src":this.user["profile_pic_16"]}),new Element("div",{"class":"online_status online_status_"+this.user.username}));}if($defined(this.iconAction)){this.addAction(this.iconAction);}},toElement:function(){return this.icon;},addAction:function(action){this.iconAction=action;if($defined(this.action)){this.action.destroy();}this.action=new Element("div",{"class":"icon_action "+this.iconAction}).inject(this.icon);}});var InlineImage=new Class({initialize:function(attachment){this.attachment=attachment;this.imageWrapper=new Element("div",{"class":"thumbnail"});this.progress=new Element("div",{"class":"progress"}).inject(this.imageWrapper);this.image=new Asset.image(this.attachment.url,{title:this.attachment.filename,onload:this.photoLoaded.bind(this)});},photoLoaded:function(){this.progress.destroy();var imageW=this.image.width;var imageH=this.image.height;if(imageH>100){imageW=(100/imageH)*imageW;imageH=100;}this.image.setStyles({height:imageH+"px",width:imageW+"px"});this.imageWrapper.setStyle("width",imageW+"px");this.image.inject(this.imageWrapper);this.image.addEvent("click",pipio.dispatchEvent.bind(pipio,["showPhotoPopup",this.attachment]));},toElement:function(){return this.imageWrapper;}});var ItemLoader=new Class({initialize:function(options){this.items=$H();this.sortValues=$H();this.empty=true;this.highestId=0;this.lowestId=0;this.highestSortValue=0;this.lowestSortValue=0;this.idField=options.idField;this.sortField=options.sortField;this.sortAlpha=options.sortAlpha||false;this.sortAscending=$defined(options.sortAscending)?options.sortAscending:true;this.createElementFunc=options.createElementFunc;this.emptyEl=options.emptyEl||null;this.errorEl=options.errorEl||null;this.loadingEl=options.loadingEl||null;this.createLoader();},remove:function(id){if(!this.items.has(id)){return;}DomUtility.fadeOutDestroy(this.items.get(id));var sortKey=this.sortValues.keyOf(id);this.sortValues.erase(sortKey);this.items.erase(id);if(this.items.getLength()==0){this.empty=true;this.highestId=0;this.lowestId=0;this.highestSortValue=0;this.lowestSortValue=0;this.showEmpty();}},showEmpty:function(){if(!$defined(this.emptyEl)){return;}if(this.empty){DomUtility.show(this.emptyEl);}else{DomUtility.hide(this.emptyEl);}},showError:function(){if(!$defined(this.errorEl)){return;}if($defined(this.emptyEl)){DomUtility.hide(this.emptyEl);}if($defined(this.loadingEl)){DomUtility.hide(this.loadingEl);}DomUtility.show(this.errorEl);},hideError:function(){if($defined(this.errorEl)){DomUtility.hide(this.errorEl);}if(this.empty){this.showEmpty();}},showLoading:function(){if(!$defined(this.loadingEl)||!this.empty){return;}if($defined(this.emptyEl)){DomUtility.hide(this.emptyEl);}if($defined(this.errorEl)){DomUtility.hide(this.errorEl);}DomUtility.show(this.loadingEl);},hideLoading:function(){if($defined(this.loadingEl)){DomUtility.hide(this.loadingEl);}if(this.empty){this.showEmpty();}},process:function(data){var id=data[this.idField];var sortValue=data[this.sortField];if(this.items.has(id)){Logger().log("item "+id+" exists, do not insert");return;}var position=this.checkBoundary(sortValue,id);if(!position){position=this.findPosition(data);}if(typeof position=="object"){this.insertItem(data,"before",position);}else{this.insertItem(data,position);}},findPosition:function(data){var id=data[this.idField];var sortValue=data[this.sortField];if(this.empty){this.highestId=id;this.lowestId=id;this.highestSortValue=sortValue;this.lowestSortValue=sortValue;this.empty=false;return"top";}else{var sortValues=this.getSortValues();for(var i=0;i<sortValues.length;i++){if(this.sortAlpha){if(this.sortAscending){if(sortValue.toString()<sortValues[i].toString()){return this.items[this.sortValues[sortValues[i]]];}}else{if(sortValue.toString()>sortValues[i].toString()){return this.items[this.sortValues[sortValues[i]]];}}}else{if(this.sortAscending){if(parseInt(sortValue)<parseInt(sortValues[i])){return this.items[this.sortValues[sortValues[i]]];}}else{if(parseInt(sortValue)>parseInt(sortValues[i])){return this.items[this.sortValues[sortValues[i]]];}}}}}},getSortValues:function(){if(this.sortAlpha){if(this.sortAscending){return this.sortValues.getKeys().sort();}else{return this.sortValues.getKeys().sort().reverse();}}else{if(this.sortAscending){return this.sortValues.getKeys().sort(this.sortIntAsc);}else{return this.sortValues.getKeys().sort(this.sortIntDesc);}}},sortIntAsc:function(a,b){return a-b;},sortIntDesc:function(a,b){return b-a;},checkBoundary:function(sortValue,id){if(this.sortAlpha){if(this.empty){this.highestId=id;this.lowestId=id;this.highestSortValue=sortValue.toString();this.lowestSortValue=sortValue.toString();this.empty=false;return"top";}if(sortValue.toString()>this.highestSortValue.toString()){this.highestSortValue=sortValue.toString();this.highestId=id;return(this.sortAscending)?"bottom":"top";}else{if(sortValue.toString()<this.lowestSortValue.toString()){this.lowestSortValue=sortValue.toString();this.lowestId=id;return(this.sortAscending)?"top":"bottom";}else{return false;}}}else{if(this.empty){this.highestId=id;this.lowestId=id;this.highestSortValue=sortValue.toString();this.lowestSortValue=sortValue.toString();this.empty=false;return"top";}if(parseInt(sortValue)>parseInt(this.highestSortValue)){this.highestSortValue=parseInt(sortValue);this.highestId=id;return(this.sortAscending)?"bottom":"top";}else{if(parseInt(sortValue)<parseInt(this.lowestSortValue)){this.lowestSortValue=parseInt(sortValue);this.lowestId=id;return(this.sortAscending)?"top":"bottom";}else{return false;}}}},insertItem:function(data,position,beforeEl){var el=this.createElementFunc(data);var sortValue=data[this.sortField];var id=data[this.idField];this.items.set(id,el);this.sortValues.set(sortValue,id);if(position=="top"){el.inject(this.loader,"top");}else{if(position=="before"){el.inject(beforeEl,"before");}else{el.inject(this.loader,"bottom");}}this.empty=false;this.showEmpty();this.hideLoading();this.hideError();},createLoader:function(){this.loader=new Element("div",{});if($defined(this.emptyEl)){this.emptyEl.inject(this.loader);}if($defined(this.errorEl)){this.errorEl.inject(this.loader);DomUtility.hide(this.errorEl);}if($defined(this.loadingEl)){this.loadingEl.inject(this.loader);DomUtility.hide(this.loadingEl);}},count:function(){return this.items.getLength();},toElement:function(){return this.loader;}});function MarkerLight(latlng,opts){this.latlng=latlng;var size=26;var smallSize=20;if(!opts){opts={};}this.user_=opts.user;this.size_=opts.size||size;this.height_=opts.size||size;this.width_=opts.size||size;this.image_=UserUtility.getProfilePic(this.user_.user_hash,this.user_.user_id,this.size_);this.imageOver_=opts.imageOver;this.clicked_=0;this.divClass_="profile_pic_wrapper_"+this.size_;this.imgClass_="profile_pic profile_pic_"+this.size_+"_"+opts.user.username;this.divStyleClass_="online_status online_status_"+opts.user.username;}MarkerLight.prototype=new GOverlay();MarkerLight.prototype.initialize=function(map){var me=this;var div=document.createElement("div");div.className=me.divClass_;div.style.position="absolute";div.style.paddingLeft="0px";div.style.cursor="pointer";div.style.zIndex=1;var tip=new Element("div",{"class":"tooltip above_right","text":TextUtility.unescape(me.user_.fullname)}).adopt(new Element("div",{"class":"tip_corner"}));tip.inject(div);var img=document.createElement("img");img.src=me.image_;img.className=me.imgClass_;img.style.width=me.width_+"px";img.style.height=me.height_+"px";div.appendChild(img);var styleDiv=document.createElement("div");styleDiv.className=me.divStyleClass_;div.appendChild(styleDiv);GEvent.addDomListener(div,"click",function(event){me.clicked_=1;GEvent.trigger(me,"click");pipio.dispatchEvent("showUser",me.user_);});map.getPane(G_MAP_MARKER_PANE).appendChild(div);this.map_=map;this.div_=div;};MarkerLight.prototype.remove=function(){if($defined(this.div_.parentNode)){this.div_.parentNode.removeChild(this.div_);}};MarkerLight.prototype.copy=function(){var opts={};opts.color=this.color_;opts.height=this.height_;opts.width=this.width_;opts.image=this.image_;opts.imageOver=this.image_;return new MarkerLight(this.latlng,opts);};MarkerLight.prototype.redraw=function(force){if(!force){return;}var divPixel=this.map_.fromLatLngToDivPixel(this.latlng);this.div_.style.width=this.width_+"px";this.div_.style.left=(divPixel.x-Math.round(this.width_/2))+"px";this.div_.style.width=this.height_+"px";this.div_.style.top=(divPixel.y)-this.height_+"px";};MarkerLight.prototype.getZIndex=function(m){return GOverlay.getZIndex(marker.getPoint().lat())-m.clicked*10000;};MarkerLight.prototype.getPoint=function(){return this.latlng;};MarkerLight.prototype.setStyle=function(style){for(s in style){this.div_.style[s]=style[s];}};MarkerLight.prototype.setImage=function(image){this.div_.style.background='url("'+image+'")';};var Menu=new Class({Extends:Base,init:function(options){if($defined(this.onBeforeInit)){options=this.onBeforeInit(options);}this.displayName=options.displayName;this.className=$defined(options.className)?options.className:"";this.isDefault=options.isDefault||false;this.closeFunc=$defined(options.closeFunc)?options.closeFunc:null;this.firstShow=true;this.isOn=true;this.createMenu();if($defined(this.onInit)){this.onInit();}},on:function(){DomUtility.show(this.menu);if($defined(this.onShow)){if(this.firstShow){this.onShow(true);this.firstShow=false;}else{this.onShow(false);}}this.isOn=true;},off:function(){if($defined(this.onHide)){this.onHide();}DomUtility.hide(this.menu);this.isOn=false;},destroy:function(){if($defined(this.onDestroy)){this.onDestroy();}this.menu.destroy();},addSection:function(section){section.inject(this.menu);},createMenu:function(){this.title=new Element("div",{"class":"menu_text","text":TextUtility.unescapeQuotes(this.displayName)});this.menu=new Element("div",{"class":"menu "+this.className}).adopt(new Element("div",{"class":"menu_title text12 light"}).adopt(this.title));if($defined(this.closeFunc)){this.menu.addClass("closable");this.closeButton=new Element("div",{"class":"button_nav right"}).adopt(new Element("div",{"class":"action close"})).inject(this.title,"after");$(this.closeButton).addEvent("click",this.closeFunc);}},toElement:function(){return this.menu;}});var Nav=new Class({Extends:Base,EventHandlers:["contentSwitched","alertAdd","alertClear"],init:function(options){if($defined(this.onBeforeInit)){options=this.onBeforeInit(options);}this.name=options.name;this.iconOptions=$defined(options.iconOptions)?options.iconOptions:null;this.displayName=options.displayName;this.className=$defined(options.className)?options.className:"";this.parentName=options.parentName||undefined;if($defined(this.parentName)){this.className+=" sub1";}this.bottom=$defined(options.bottom)?options.bottom:false;this.hasSubnavs=$defined(options.hasSubnavs)?options.hasSubnavs:false;this.closable=$defined(options.closable)?options.closable:false;this.onClose=$defined(options.onClose)?options.onClose:undefined;this.defaultClosed=$defined(options.defaultClosed)?options.defaultClosed:false;this.onClick=$defined(options.onClick)?options.onClick:undefined;this.isExpanded=true;this.isOn=false;this.subnavEls=$H();this.createNav();if($defined(this.onInit)){this.onInit();}},alertAdd:function(navId){if(!$defined(this.navId)||!$defined(this.alert)){return;}if(navId!=this.navId){return;}if(this.isOn){return;}this.alert.increment();if($defined(this.parentId)){this.fireEvent("alertAdd",this.parentId);}},alertClear:function(navId,count){if(!$defined(this.navId)||!$defined(this.alert)){return;}if(navId!=this.navId){return;}if(!$defined(count)){var alerts=this.alert.clear();if($defined(this.parentId)){this.fireEvent("alertClear",this.parentId,alerts);}}else{this.alert.decrement(count);if($defined(this.parentId)){this.fireEvent("alertClear",this.parentId,count);}}},contentSwitched:function(navId){if(!$defined(this.navId)){return;}if(navId==this.navId){this.on();this.alertClear(this.navId);}else{if(navId!=this.navId&&this.isOn){this.off();}}},on:function(){this.nav.addClass("on");this.isOn=true;},off:function(){this.nav.removeClass("on");this.isOn=false;},click:function(){if($defined(this.onClick)){this.onClick();}},close:function(e){e.stopPropagation();if($defined(this.onClose)){this.onClose();}this.destroy();},toggleSubnav:function(e){e.stopPropagation();if(!this.isExpanded){this.expand();}else{this.collapse();}},expand:function(){if(!this.isExpanded&&this.hasSubnavs){DomUtility.expand(this.subnavs);this.pivot.removeClass("pivot_right");this.pivot.addClass("pivot_down");this.nav.removeClass("collapsed");this.isExpanded=true;if($defined(this.onExpand)){this.onExpand();}}},collapse:function(){if(this.isExpanded&&this.hasSubnavs){DomUtility.collapse(this.subnavs);this.pivot.removeClass("pivot_down");this.pivot.addClass("pivot_right");this.nav.addClass("collapsed");this.isExpanded=false;if($defined(this.onCollapse)){this.onCollapse();}}},toElement:function(){return this.navWrapper;},addSubnav:function(nav){if(nav.bottom){$(nav).inject(this.subnavBottomItems);}else{$(nav).inject(this.subnavItems);}this.subnavEls.set(nav.name,nav);},deleteSubnav:function(name){if(!this.subnavEls.has(name)){return;}this.subnavEls.get(name).destroy();this.subnavEls.erase(name);},hasSubnav:function(name){return this.subnavEls.has(name);},createNav:function(){this.navWrapper=new Element("div");this.nav=new Element("div",{"class":"nav"}).inject(this.navWrapper);this.nav.addEvent("click",this.click.bind(this));if(this.hasSubnavs){this.subnavItems=new Element("div");this.subnavBottomItems=new Element("div");this.subnavs=new Element("div",{"class":"sub_elements"}).adopt(this.subnavItems,this.subnavBottomItems).inject(this.navWrapper);this.nav.addClass("has_submenu");}this.nav.addClass(this.className);this.pivot=new Element("div",{"class":"action pivot_down"}).inject(this.nav);this.pivot.addEvent("click",this.toggleSubnav.bindWithEvent(this));if($defined(this.iconOptions)){this.icon=new Icon(this.iconOptions);$(this.icon).inject(this.nav);}else{this.nav.addClass("noicon");}this.alert=new Alert();$(this.alert).inject(this.nav);this.navName=new Element("div",{"class":"nav_name text12 light","text":TextUtility.unescapeQuotes(this.displayName)}).inject(this.nav);if(this.closable){this.closeButton=new Element("div",{"class":"action close"}).inject(this.nav);this.closeButton.addEvent("click",this.close.bindWithEvent(this));}if(this.defaultClosed){this.collapse();}},destroy:function(){if($defined(this.navWrapper)){this.navWrapper.destroy();}if($defined(this.alert)){this.alert.destroy();this.alert=null;}}});var ScrollBar=new Class({initialize:function(content,wrapper){this.content=$(content);this.wrapper=$(wrapper);this.disabled=false;this.createScrollbar();this.setupHandlers();},disable:function(){this.disabled=true;},enable:function(){this.disabled=false;},createScrollbar:function(){this.scrollbar=new Element("div",{"class":"scrollbar"});this.scrollbar.inject(this.wrapper);},dragOn:function(){this.wrapper.addClass("on");},dragOff:function(){this.wrapper.removeClass("on");},setupHandlers:function(){this.scrollHandleDrag=new Drag(this.scrollbar,{snap:0,limit:{"x":[0,0],"y":[0,this.getHandleYMax.bind(this)]},onStart:this.dragOn.bind(this),onDrag:this.handleDragHandler.bind(this),onComplete:this.dragOff.bind(this),onCancel:this.dragOff.bind(this)});this.contentScroller=new Fx.Scroll(this.content,{wheelStops:false});this.content.addEvent("mousewheel",this.scrollHandler.bindWithEvent(this));this.update.periodical(500,this,true);},update:function(){if(this.disabled){return;}var scrollH=this.content.getScrollSize().y;var h=this.content.getSize().y;if(scrollH>h){this.wrapper.addClass("scrolling");var contentScrollRatio=this.content.getScroll().y/this.getContentYMax();if(contentScrollRatio>1){contentScrollRatio=1;this.content.scrollTo(0,this.getContentYMax());}var handleY=this.getHandleYMax()*contentScrollRatio;this.scrollbar.setStyle("top",handleY);}else{this.wrapper.removeClass("scrolling");}},scrollHandler:function(e){if(this.disabled){return;}e=new Event(e);e.stopPropagation();if(e.wheel>0){this.scrollUp(name);}else{if(e.wheel<0){this.scrollDown(name);}}},scrollUp:function(){var scrollY=this.content.getScroll().y;if(scrollY==0){return;}scrollY-=30;if(scrollY<0){scrollY=0;}this.contentScroller.cancel();this.contentScroller.set(0,scrollY);this.update();},scrollDown:function(){var maxY=this.getContentYMax();if(maxY<0){maxY=0;}var scrollY=this.content.getScroll().y;if(scrollY>=maxY){return;}scrollY+=30;if(scrollY>maxY){scrollY=maxY;}this.contentScroller.cancel();this.contentScroller.set(0,scrollY);this.update();},handleDragHandler:function(){var handleY=this.scrollbar.getPosition(this.wrapper).y;var handleYMax=this.getHandleYMax();var contentY=this.getContentYMax()*(handleY/handleYMax);this.content.scrollTo(0,contentY);},getHandleYMax:function(){return this.wrapper.getSize().y-102;},getContentYMax:function(){return this.content.getScrollSize().y-this.content.getSize().y;}});var StreamLoader=new Class({initialize:function(options){this.items=$H();this.timestamps=$H();this.newestTimestamp=0;this.oldestTimestamp=0;this.newestId=0;this.oldestId=0;this.newestTimestampEl=null;this.empty=true;this.createElementFunc=options.createElementFunc;this.alertFunc=options.alertFunc;this.emptyEl=options.emptyEl||null;this.errorEl=options.errorEl||null;this.loadingEl=options.loadingEl||null;this.idField=options.idField||"item_id";this.dateField=options.dateField||"date_created";this.createLoader();},remove:function(id){if(!this.items.has(id)){return;}var el=this.items.get(id);var prev=el.getPrevious();var next=el.getNext();if(prev.hasClass("seperator")&&next.hasClass("seperator")){prev.destroy();}DomUtility.fadeOutDestroy(el);this.items.erase(id);if(this.items.getLength()==0){this.empty=true;this.showEmpty();}},process:function(data){var position=this.findPosition(data);if(!position){return;}this.insertItem(data,position);},showEmpty:function(){if(!$defined(this.emptyEl)){return;}if(this.empty){DomUtility.show(this.emptyEl);}else{DomUtility.hide(this.emptyEl);}},showError:function(){if(!$defined(this.errorEl)){return;}if($defined(this.emptyEl)){DomUtility.hide(this.emptyEl);}if($defined(this.loadingEl)){DomUtility.hide(this.loadingEl);}DomUtility.show(this.errorEl);},hideError:function(){if($defined(this.errorEl)){DomUtility.hide(this.errorEl);}if(this.empty){this.showEmpty();}},showLoading:function(){if(!$defined(this.loadingEl)||!this.empty){return;}if($defined(this.emptyEl)){DomUtility.hide(this.emptyEl);}if($defined(this.errorEl)){DomUtility.hide(this.errorEl);}DomUtility.show(this.loadingEl);},hideLoading:function(){if($defined(this.loadingEl)){DomUtility.hide(this.loadingEl);}if(this.empty){this.showEmpty();}},insertTimestamp:function(timestamp,position){var el=StreamItemUtility.createDateSeperatorItem(timestamp);el.inject(this.loader,position);if(position=="top"){this.newestTimestampEl=el;}},findPosition:function(data){var id=data[this.idField];var timestamp=this.getTimestamp(data[this.dateField]);if(this.empty){this.insertTimestamp(timestamp,"top");this.oldestTimestamp=timestamp;this.newestTimestamp=timestamp;this.newestId=id;this.oldestId=id;this.empty=false;return"top";}else{if(timestamp>=this.newestTimestamp&&id>this.newestId){if(!this.checkTimestampSameDay(this.newestTimestamp,timestamp)){this.insertTimestamp(timestamp,"top");}this.newestTimestamp=timestamp;this.newestId=id;return"top";}else{if(timestamp<=this.oldestTimestamp&&id<this.oldestId){if(!this.checkTimestampSameDay(this.oldestTimestamp,timestamp)){this.insertTimestamp(timestamp,"bottom");}this.oldestTimestamp=timestamp;this.oldestId=id;return"bottom";}else{return false;}}}},checkTimestampSameDay:function(ts1,ts2){var d1=DateUtility.convertFromTimestamp(ts1);var d2=DateUtility.convertFromTimestamp(ts2);return(d1.getDate()==d2.getDate()&&d1.getMonth()==d2.getMonth());},getTimestamp:function(dateValue){if(parseInt(dateValue)==dateValue){return dateValue;}return Date.parse(dateValue)/1000;},insertItem:function(data,position){var el=this.createElementFunc(data);var id=data[this.idField];var date=this.getTimestamp(data[this.dateField]);this.items.set(id,el);this.timestamps.set(id,date);if(position=="top"){el.inject(this.newestTimestampEl,"after");DomUtility.fadeIn(el,1000);}else{el.inject(this.loader,"bottom");}this.empty=false;this.showEmpty();this.hideLoading();this.hideError();if($defined(this.alertFunc)&&pipio.checkTimestamp(date)){this.alertFunc(data);}},createLoader:function(){this.loader=new Element("div",{});if($defined(this.emptyEl)){this.emptyEl.inject(this.loader);}if($defined(this.errorEl)){this.errorEl.inject(this.loader);DomUtility.hide(this.errorEl);}if($defined(this.loadingEl)){this.loadingEl.inject(this.loader);DomUtility.hide(this.loadingEl);}},toElement:function(){return this.loader;}});var Toggle=new Class({initialize:function(on){this.isOn=$defined(on)?on:false;this.toggle=new Element("div",{"class":"toggle"}).adopt(new Element("div",{"class":"handle"}),new Element("div",{"class":"toggle_text on","text":"on"}),new Element("div",{"class":"toggle_text off","text":"off"}));this.toggle.addEvent("click",this.switchToggle.bind(this));this.setOn();},switchToggle:function(){this.isOn=!this.isOn;this.setOn();},on:function(){this.isOn=true;this.setOn();},off:function(){this.isOn=false;this.setOn();},set:function(on){if(on){this.on();}else{this.off();}},setOn:function(){if(this.isOn){this.toggle.addClass("on");this.toggle.removeClass("off");}else{this.toggle.removeClass("on");this.toggle.addClass("off");}},toInt:function(){return(this.isOn)?1:0;},toElement:function(){return this.toggle;}});var Popup=new Class({Extends:Base,initialize:function(options){this.parent();var options=$defined(options)?options:{};this.navs=$H();this.contents=$H();this.contentSize=$defined(options.size)?options.size:{x:400,y:300};this.resizable=$defined(options.resizable)?options.resizable:true;this.dockable=$defined(options.dockable)?options.dockable:true;this.closable=$defined(options.closable)?options.closable:true;this.className=$defined(options.className)?options.className:undefined;this.noHide=$defined(options.noHide)?options.noHide:false;this.onClose=$defined(options.onClose)?options.onClose:undefined;this.hasTabs=false;this.isDocked=false;this.createPopup();},toElement:function(){return this.popup;},addContent:function(contentName,nav,content){if(this.contents.has(contentName)){return;}$(nav).inject(this.nav);$(content).inject(this.content);this.navs.set(contentName,nav);this.contents.set(contentName,content);nav.onClick=this.switchContent.bind(this,[contentName]);content.resizePopup=this.resizePopup.bind(this);if(nav.closable){nav.onClose=this.closeContent.bind(this,[contentName]);content.onClose=this.closeContent.bind(this,[contentName]);}this.checkTabs();this.switchContent(contentName);},closeContent:function(contentName){if(!this.contents.has(contentName)){return;}this.navs.get(contentName).destroy();this.contents.get(contentName).off();this.contents.get(contentName).close();this.navs.erase(contentName);this.contents.erase(contentName);if(this.contents.getLength()==0){this.close();return;}if(contentName==this.currentContent){this.currentContent=null;var last=this.contents.getKeys().pop();this.switchContent(last);}this.checkTabs();this.setTitle();},switchContent:function(contentName){if(!this.contents.has(contentName)){return;}if(this.isDocked){this.undock();}if(contentName==this.currentContent){return;}if($defined(this.currentContent)){this.navs.get(this.currentContent).off();this.contents.get(this.currentContent).off();}this.navs.get(contentName).on();this.contents.get(contentName).on();this.currentContent=contentName;this.setTitle();},setTitle:function(){var nav=this.navs.get(this.currentContent);var icon=new Icon20(nav.iconOptions);var titleText=new Element("div",{"class":"title_text","text":TextUtility.unescapeQuotes(nav.displayName)});this.titleIcon=$(icon).replaces(this.titleIcon);this.titleText=titleText.replaces(this.titleText);},getDockIcon:function(){var nav=this.navs.get(this.currentContent);var icon=new Icon20(nav.iconOptions);var el=new Element("div",{"class":"app_button has_submenu"}).adopt($(icon));el.addEvent("click",this.undock.bind(this));return el;},checkTabs:function(){if(this.contents.getLength()>1){this.popup.addClass("tabbed");this._checkBounds();this.hasTabs=true;}else{this.popup.removeClass("tabbed");this.hasTabs=false;}},resizePopup:function(x,y){var size={x:x,y:y+24};this.popup.setStyle("height",size.y+"px");this.popup.setStyle("width",size.x+"px");this._checkBounds();},reCenter:function(){var size={x:this.popup.getSize().x,y:this.popup.getSize().y};var pos={x:window.getSize().x/2-(size.x/2),y:window.getSize().y/2-(size.y/2)};if(pos.y<0){pos.y=0;}this.popup.setStyles({"top":pos.y+"px","left":pos.x+"px"});},createPopup:function(){this.size={x:this.contentSize.x,y:this.contentSize.y+24};var pos={x:window.getSize().x/2-(this.size.x/2),y:window.getSize().y/2-(this.size.y/2)};if(pos.y<0){pos.y=0;}this.popup=new Element("div",{"class":"popup","styles":{"height":this.size.y+"px","width":this.size.x+"px","top":pos.y+"px","left":pos.x+"px"}});if($defined(this.className)){this.popup.addClass(this.className);}this.title=new Element("div",{"class":"popup_title text12 light"}).inject(this.popup);this.nav=new Element("div",{"class":"app_sub_menu popup_tabs"}).inject(this.popup);this.content=new Element("div",{"class":"popup_content"}).inject(this.popup);this.dragBorder=new Element("div",{"class":"popup_drag","text":"Drag this window to move it"}).inject(this.popup);this.popup.inject("popups");DomUtility.fadeIn(this.popup);this.titleIcon=new Element("div").inject(this.title);this.titleText=new Element("div").inject(this.title);if(this.closable){this.closeButton=new Element("div",{"class":"button_nav right"}).adopt(new Element("div",{"class":"action close"})).inject(this.title);this.closeButton.addEvent("click",this.close.bind(this));}if(this.dockable){this.dockButton=new Element("div",{"class":"button_nav right"}).adopt(new Element("div",{"class":"action dock"})).inject(this.title);this.dockButton.addEvent("click",this.dock.bind(this));}this.drag=this.popup.makeDraggable({handle:this.title,onStart:this._startDrag.bind(this),onComplete:this._stopDrag.bind(this),onCancel:this._stopDrag.bind(this)});if(this.resizable){this.resizeHandle=new Element("div",{"class":"resize"}).inject(this.popup);this.popup.makeResizable({handle:this.resizeHandle,limit:{x:[400,800],y:[300,800]}});}this.popup.addEvent("mousedown",this._select.bind(this));this._select();this._checkBounds();if($defined(this.onCreate)){this.onCreate();}},close:function(){this.contents.each(function(content){content.close();});this.popup.destroy();if($defined(this.onClose)){this.onClose();}delete (this);},dock:function(){this.navs.get(this.currentContent).off();this.contents.get(this.currentContent).off();this.dockButton=new Element("div",{"class":"app_button_wrapper"}).adopt(this.getDockIcon(),this.nav);this.dockButton.inject("dock");DomUtility.fadeOut(this.popup);this.isDocked=true;},undock:function(){this.nav.inject(this.popup);this.dockButton.destroy();DomUtility.fadeIn(this.popup);this.navs.get(this.currentContent).on();this.contents.get(this.currentContent).on();this.isDocked=false;},_select:function(){this.popup.setStyle("z-index",DomUtility.getZ("popup"));},_startDrag:function(){if(this.noHide){return;}DomUtility.hide(this.nav);DomUtility.show(this.dragBorder);this.contents.get(this.currentContent).off();},_stopDrag:function(){if(!this.noHide){DomUtility.hide(this.dragBorder);DomUtility.show(this.nav);this.nav.set("style","");this.contents.get(this.currentContent).on();}this._checkBounds();},_checkBounds:function(){var pos=this.popup.getPosition();if(pos.x+this.popup.getSize().x>window.getSize().x){this.popup.setStyle("left",window.getSize().x-this.popup.getSize().x);}if(pos.y+this.popup.getSize().y>window.getSize().y){this.popup.setStyle("top",window.getSize().y-this.popup.getSize().y);}pos=this.popup.getPosition();if(pos.x<0){this.popup.setStyle("left",0);}if(pos.y<0){this.popup.setStyle("top",0);}}});var PopupContent=new Class({Extends:Base,init:function(options){if(!$defined(options)){options={};}if($defined(this.onBeforeInit)){options=this.onBeforeInit(options);}this.isOn=false;this.destroy=$defined(options.destroy)?options.destroy:true;this.createContent();if($defined(this.onInit)){this.onInit();}},on:function(){Logger().log("turning on content");DomUtility.show(this.content);if($defined(this.onShow)){this.onShow();}this.isOn=true;},off:function(){if($defined(this.onHide)){this.onHide();}DomUtility.hide(this.content);this.isOn=false;},close:function(destroy){if(this.destroy||destroy){this.content.destroy();}else{this.content.dispose();}},closeContent:function(){if($defined(this.onClose)){this.onClose();}},createContent:function(){this.content=new Element("div",{"class":this.className});this.off();},toElement:function(){return this.content;}});var AlertPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.alertMessage=options.alertMessage;return options;},onInit:function(){new Element("div",{"class":"text_section centered light","text":TextUtility.unescape(this.alertMessage)}).inject(this.content);this.actionButton=new ButtonMedium({displayName:"Close",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.closeContent.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton)).inject(this.content);}});var ConfirmPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.confirmMessage=options.confirmMessage;this.confirmFunc=options.confirmFunc;return options;},onInit:function(){new Element("div",{"class":"text_section centered light","text":TextUtility.unescape(this.confirmMessage)}).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Confirm",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.confirmFunc);$(this.actionButton).addEvent("click",this.progressClose.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},progressClose:function(){this.actionButton.showProgress();this.closeContent.delay(1500,this);}});var RoomStatusBox=new Class({Extends:Base,EventHandlers:["roomMembershipUpdated","roomStatusUpdated","roomStatusCleared"],init:function(room){this.room=room;this.defaultStatus="has no current status";this.canPost=(this.room.status==1);this.createStatusBox();},createStatusBox:function(){this.box=ItemUtility.createPostBubble("post status_message haspic");ItemUtility.createProfilePic(this.room,32).inject(this.box);var buttonText="Write in "+this.room.room_name;this.writeButton=new Element("div",{"class":"button","text":TextUtility.unescape(buttonText)}).inject(this.box);this.writeButton.addEvent("click",this.fireEvent.bind(this,["roomShareBoxShow",this.room]));this.setPostButton();this.content=new Element("div",{"class":"post_content"}).inject(this.box);var header=new Element("div",{"class":"header"}).inject(this.content);StreamItemUtility.createStreamUserAction("status dark").inject(header);var creator=new Element("span",{"class":"user_name clickable","text":TextUtility.unescapeQuotes(this.room.room_name)}).inject(header);creator.addEvent("click",this.fireEvent.bind(this,["showRoom",this.room]));this.statusText=new Element("span",{"class":"status"}).inject(header);this.editButton=new Element("span",{"class":"edit_link","text":"update"});this.editButton.addEvent("click",this.fireEvent.bind(this,["showRoomStatusUpdatePopup",this.room]));this.clearButton=new Element("span",{"class":"edit_link","text":"clear"});this.clearButton.addEvent("click",this.clearStatus.bind(this));this.editSection=new Element("span").adopt($(this.editButton),$(this.clearButton)).inject(header);this.setEditButton();this.footer=StreamItemUtility.createStatusBoxFooter(this.room.status_message).inject(this.content);this.updateStatus();},roomMembershipUpdated:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.room.status=data.status;this.canPost=(this.room.status==1);this.setPostButton();},setEditButton:function(){if(this.canPost){DomUtility.show(this.editSection,"inline");}else{DomUtility.hide(this.editSection);}},setPostButton:function(){if(this.canPost){DomUtility.show(this.writeButton);}else{DomUtility.hide(this.writeButton);}},updateStatus:function(){this.isEmpty=(!$defined(this.room.status_message)||this.room.status_message.status.trim()=="");if(this.isEmpty){this.statusText.addClass("empty");this.statusText.set("text"," "+TextUtility.unescape(this.defaultStatus));DomUtility.hide(this.clearButton);}else{this.statusText.removeClass("empty");this.statusText.set("text"," "+TextUtility.unescape(this.room.status_message.status.trim()));DomUtility.show(this.clearButton,"inline");}this.footer.destroy();this.footer=StreamItemUtility.createStatusBoxFooter(this.room.status_message).inject(this.content);},clearStatus:function(){var params={username:this.room.username,body:"",res:this.getSession()};this.call("pipio","publish_roomstatus",params);this.roomStatusCleared({username:this.room.username});},roomStatusUpdated:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.room=this.getRoom(data.username);this.updateStatus();},roomStatusCleared:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.room.status_message.status="";this.room.status_message.creator=undefined;this.room.status_message.date_created=undefined;this.room.status_message.location=undefined;this.updateStatus();},toElement:function(){return this.box;}});var StatusBox=new Class({Extends:Base,EventHandlers:["userStatusUpdated","userStatusCleared","contactAdded","contactDeleted"],init:function(user){this.user=user;this.isSelf=this.user.user_id==this.getPrivateUser().user_id;this.defaultStatus="has no current status";this.canPost=$defined(this.getContact(this.user.username))||this.isSelf;this.createStatusBox();},createStatusBox:function(){this.box=ItemUtility.createPostBubble("post status_message haspic");ItemUtility.createProfilePic(this.user,32).inject(this.box);var buttonText=this.isSelf?"Write in Your Stream":"Write in "+this.user.first_name+"'s Stream";this.writeButton=new Element("div",{"class":"button","text":TextUtility.unescape(buttonText)}).inject(this.box);this.writeButton.addEvent("click",this.fireEvent.bind(this,["shareBoxShow",this.user]));this.setPostButton();this.content=new Element("div",{"class":"post_content"}).inject(this.box);var header=new Element("div",{"class":"header"}).inject(this.content);StreamItemUtility.createStreamUserAction("status dark").inject(header);var creator=new Element("span",{"class":"user_name clickable","text":TextUtility.unescapeQuotes(this.user.fullname)}).inject(header);creator.addEvent("click",this.fireEvent.bind(this,["showUser",this.user]));this.status=new Element("span",{"class":"status"}).inject(header);if(this.isSelf){this.editButton=new Element("span",{"class":"edit_link","text":"update"}).inject(header);this.editButton.addEvent("click",this.fireEvent.bind(this,["showStatusUpdatePopup"]));this.clearButton=new Element("span",{"class":"edit_link","text":"clear"}).inject(header);this.clearButton.addEvent("click",this.clearStatus.bind(this));}this.footer=StreamItemUtility.createStatusBoxFooter(this.user.status_message).inject(this.content);this.updateStatus();},contactAdded:function(user){if(this.user.username!=user.username){return;}this.canPost=true;this.setPostButton();},contactDeleted:function(username){if(this.user.username!=username){return;}this.canPost=false;this.setPostButton();},setPostButton:function(){if(this.canPost){DomUtility.show(this.writeButton);}else{DomUtility.hide(this.writeButton);}},updateStatus:function(){this.isEmpty=this.user.status_message.status.trim()=="";if(this.isEmpty){this.status.addClass("empty");this.status.set("text"," "+TextUtility.unescape(this.defaultStatus));if(this.isSelf){DomUtility.hide(this.clearButton);}}else{this.status.removeClass("empty");this.status.set("text"," "+TextUtility.unescape(this.user.status_message.status.trim()));if(this.isSelf){DomUtility.show(this.clearButton,"inline");}}this.footer.destroy();this.footer=StreamItemUtility.createStatusBoxFooter(this.user.status_message).inject(this.content);},clearStatus:function(){var params={body:"",res:this.getSession()};this.call("pipio","publish_status",params);this.userStatusCleared({username:this.user.username});},userStatusUpdated:function(data){if(!$defined(data.username)||data.username!=this.user.username){return;}this.user.status_message=data.status_message;this.updateStatus();},userStatusCleared:function(data){if(!$defined(data.username)||data.username!=this.user.username){return;}this.user.status_message.status="";this.user.status_message.date_created=undefined;this.user.status_message.location=undefined;this.updateStatus();},toElement:function(){return this.box;}});var AttachmentUtility={parseLinkAttachment:function(attachment){if($defined(attachment.processed)){return attachment;}attachment.processed=true;attachment.is_video=false;attachment.is_photo=false;if(attachment.url.contains("youtube.com")){var youtubeId=attachment.url.replace(/^[^v]+v.(.{11}).*/,"$1");if(youtubeId!=""){attachment.is_video=true;attachment.video_type="youtube";attachment.youtubeId=youtubeId;return attachment;}}else{if(attachment.url.contains("collegehumor.com/video:")){var vimeoId=attachment.url.split("collegehumor.com/video:")[1];if(vimeoId!=""){attachment.is_video=true;attachment.video_type="ch";attachment.vimeoId=vimeoId;return attachment;}}else{if(attachment.url.contains("vimeo.com/")){var vimeoId=attachment.url.split("vimeo.com/")[1];if(vimeoId!=""){attachment.is_video=true;attachment.video_type="vimeo";attachment.vimeoId=vimeoId;return attachment;}}else{if(attachment.url.contains("hulu.com")){attachment.is_video=true;attachment.video_type="hulu";return attachment;}else{if(attachment.url.contains("break.com")){attachment.is_video=true;attachment.video_type="break";return attachment;}else{if(DataUtility.validatePhotoFile(attachment.url)){attachment.is_photo=true;return attachment;}}}}}}return attachment;},parsePhotoAttachment:function(attachment){if($defined(attachment.processed)){return attachment;}attachment.processed=true;attachment.is_photo=true;return attachment;}};var DataUtility={photoExtensions:[".jpeg",".jpg",".gif",".png",".bmp"],validateUrl:function(url){var v=new RegExp();v.compile("^([A-Za-z]+://[A-Za-z0-9-_]+.[A-Za-z0-9-_%&?/.=,+~!:@()]+(#[A-Za-z0-9-_%&?/.=,+~!:@()]+)?)$");return v.test(url);},validatePhotoFile:function(filename){if(filename.substring(filename.length-5).toLowerCase()==".jpeg"){return true;}var ext=filename.substring(filename.length-4).toLowerCase();return DataUtility.photoExtensions.contains(ext);},getGeoString:function(location){if(!$defined(location)){return false;}var locationString=false;var locality=DataUtility.getGeoLocality(location);if(locality){locationString=locality;}var label=DataUtility.getGeoLabel(location);if(label){locationString=label+", "+locality;}return locationString;},getGeoLabel:function(location){if($defined(location.label)&&location.label!=""){return location.label;}else{return false;}},getGeoLocality:function(location){var local="";if(location.country_code=="US"){if($defined(location.region)&&$defined(location.city)&&location.region!=""&&location.city!=""){local=location.city+", "+location.region;}else{return false;}}else{if($defined(location.city)&&location.city!=""){local=location.city+", "+location.country;}else{if(location.city==""&&$defined(location.region)&&location.region!=""){local=location.region+", "+location.country;}else{if(!$defined(location.city)&&$defined(location.country)){local=location.country;}else{return false;}}}}return local;},getPipioUrl:function(url,hash){if($defined(hash)){return"/"+hash;}else{return url;}},getFacebookPhotoUrl:function(url){return url.replace("_s.jpg","_n.jpg");},sortUsers:function(a,b){return a.last_name.toLowerCase()<b.last_name.toLowerCase();},getCookie:function(c_name){if(document.cookie.length>0){c_start=document.cookie.indexOf(c_name+"=");if(c_start!=-1){c_start=c_start+c_name.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length;}return unescape(document.cookie.substring(c_start,c_end));}}return undefined;},getFileUrl:function(hash,file_id,filename){var serverId=file_id%16;return"http://files"+serverId.toString(16)+".pip.io/"+hash.substring(0,2)+"/"+hash.substring(2,3)+"/"+hash.substring(3,5)+"/"+hash.substring(5,8)+"/"+file_id+"/"+filename;}};var DateUtility={convertFromGMT:function(date){var offsetMils=date.getTimezoneOffset()*60*1000;date.setTime(date.getTime()-offsetMils);return date;},getTimestamp:function(ts,format){if(!$defined(format)){format="%B %D, %I:%M%p";}if(new Date().getTime()-ts.getTime()>86400000){return ts.format(format);}else{return ts.timeAgoInWords();}},convertFromTimestamp:function(ts){var date=new Date();date.setTime(ts*1000);return date;}};var DomUtility={toggle:function(id){if($(id).getStyle("display")=="none"){DomUtility.show(id);}else{DomUtility.hide(id);}},hide:function(id){if($(id)!=null){$(id).setStyle("display","none");}},show:function(id,display){if(!$defined(display)){display="block";}if($(id)!=null){$(id).setStyle("display",display);}},expand:function(id){var el=$(id);el.get("tween",{duration:150}).start("height",el.getScrollSize().y).chain(function(){el.setStyle("height","auto");});},collapse:function(id){var el=$(id);el.setStyle("height",el.getSize().y);el.get("tween",{duration:150}).start("height",0);},setHeight:function(id,h){var el=$(id);el.get("tween",{duration:150}).start("height",h);},expandFade:function(id,h){var el=$(id);el.setStyle("opacity",0);el.get("tween",{duration:150}).start("height",h).chain(function(){el.get("tween",{duration:800}).start("opacity",1);});},collapseFade:function(id){var el=$(id);el.get("tween",{duration:800}).start("opacity",0).chain(function(){el.get("tween",{duration:150}).start("height",0);});},fadeOut:function(id,destroy){var el=$(id);el.setStyle("opacity",1);el.get("tween",{duration:500}).start("opacity",0).chain(function(){if(destroy){el.destroy();}});},fadeOutDestroy:function(id){DomUtility.fadeOut(id,true);},fadeIn:function(id,duration){var el=$(id);duration=duration||500;el.setStyle("opacity",0);el.get("tween",{duration:duration}).start("opacity",1);},getZ:function(name){var zName=name+"Z";if(!$defined(window[zName])){window[zName]=200;}window[zName]++;return window[zName];},textareaAutoSize:function(el,min){min=$defined(min)?min:16;el=$(el);if(el.value.trim().length<30&&el.getSize().y>min){el.setStyle("height",min);return true;}if(el.getScrollSize().y>min&&el.getScrollSize().y>el.getSize().y){el.setStyle("height",el.getScrollSize().y);return true;}return false;}};var ItemUtility={createProfilePic:function(user,size){var picSize=(size=="16a")?16:size;if($defined(user.fullname)){var el=new Element("div",{"class":"shadowed profile_pic_wrapper_"+size}).adopt(new Element("img",{"class":"profile_pic profile_pic_"+picSize+"_"+user.username,"src":user["profile_pic_"+picSize],"title":TextUtility.unescape(user.fullname)}),new Element("div",{"class":"online_status online_status_"+user.username,"title":TextUtility.unescape(user.fullname)}));return el;}else{if($defined(user.room_name)){var el=new Element("div",{"class":"shadowed profile_pic_wrapper_"+size}).adopt(new Element("img",{"class":"profile_pic profile_pic_"+picSize+"_"+user.username,"src":user["profile_pic_"+picSize],"title":TextUtility.unescape(user.room_name)}),new Element("div",{"class":"online_status online_status_"+user.username,"title":TextUtility.unescape(user.room_name)}));return el;}}},createItemPic:function(url,size){var picSize=$defined(size)?size:32;var el=new Element("div",{"class":"shadowed profile_pic_wrapper_"+picSize}).adopt(new Element("img",{"class":"profile_pic profile_pic_"+picSize,"src":url}),new Element("div",{"class":"online_status"}));return el;},createChatPostItem:function(msg,user){var el=ItemUtility.createPostBubble("post chat haspic");if(!msg.outbound){user=msg.target;}ItemUtility.createProfilePic(user,20).inject(el);new Element("div",{"class":"post_content"}).adopt(new Element("div",{"class":"header","html":TextUtility.replaceUrls(TextUtility.cleanText(msg.msg))})).inject(el);return el;},createChatPostHeading:function(user,date){var el=new Element("div",{"class":"post chat heading"});var ts=$defined(date)?new Element("span",{"class":"timestamp","text":DateUtility.getTimestamp(date,"%B %D, %I:%M%p"),"ts":date,"ts_format":"%B %D, %I:%M%p"}):new Element("span");new Element("div",{"class":"post_content"}).adopt(new Element("div",{"class":"header"}).adopt(new Element("span",{"class":"user_name","text":TextUtility.unescapeQuotes(user.fullname)}),ts)).inject(el);return el;},createChatTypingHeading:function(user){var el=new Element("div",{"class":"post chat heading"});new Element("div",{"class":"post_content"}).adopt(new Element("div",{"class":"header"}).adopt(new Element("span",{"class":"user_name","text":TextUtility.unescapeQuotes(user.fullname)}),new Element("span",{"class":"status_text","text":"is typing"}))).inject(el);return el;},createPostBubble:function(className,nocorner){if(nocorner){var el=new Element("div",{"class":className}).adopt(new Element("div",{"class":"bubble"}).adopt(new Element("div",{"class":"bubble_inner"})));}else{var el=new Element("div",{"class":className}).adopt(new Element("div",{"class":"bubble"}).adopt(new Element("div",{"class":"bubble_inner"}),new Element("div",{"class":"corner"})));}return el;}};var Logger=(function(){var LoggerSingleton=new Class({initialize:function(){this._log=new Log();this._log.enableLog();},log:function(val){this._log.log(val);}});var singleton;return function(){return singleton?singleton:singleton=new LoggerSingleton();};})();var TextUtility={unescapeQuotes:function(val){if(!$defined(val)){return"";}val=val.toString();val=val.split("\\\\").join("\\");val=val.split("\\'").join("'");val=val.split('\\"').join('"');return val;},unescapeHtml:function(val){if(!$defined(val)){return"";}val=val.toString();val=val.split("&lt;").join("<");val=val.split("&gt;").join(">");val=val.split("&amp;").join("&");return val;},unescape:function(val){return TextUtility.unescapeQuotes(TextUtility.unescapeHtml(val));},escapeHtml:function(val){if(!$defined(val)){return"";}val=val.toString();val=val.split("<").join("&lt;");val=val.split(">").join("&gt;");return val;},stripHtml:function(val){if(!$defined(val)){return"";}val=val.toString();var re=/<\S[^><]*>/g;val.replace(re,"");return val;},cleanText:function(val){if(!$defined(val)){return"";}val=val.toString();val=TextUtility.unescapeQuotes(val);val=TextUtility.escapeHtml(val);return val;},pluralText:function(count,singular,plural){if(count==1){return count+" "+singular;}else{return count+" "+plural;}},replaceUrls:function(val){if(!$defined(val)){return"";}return val.replace(/([A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_%&\?\/.=,+~!:@()]+(#[A-Za-z0-9-_%&\?\/.=,+~!:@()]+)?)/g,'<a href="$1" target="_blank">$1</a>');},convertNewLine:function(val){if(!$defined(val)){return"";}val=val.toString();val=val.split("\n").join("<br/>");return val;}};String.format=function(text){if(arguments.length<=1){return text;}var tokenCount=arguments.length-2;for(var token=0;token<=tokenCount;token++){text=text.replace(new RegExp("\\{"+token+"\\}","gi"),arguments[token+1]);}return text;};var UserUtility={profilePicVersionSet:function(user_id,ver){if(!$defined(window.profilePicVer)){window.profilePicVer=new Hash();}window.profilePicVer.set(user_id,ver);},profilePicVersionGet:function(user_id){if(!$defined(window.profilePicVer)){return 0;}if(!window.profilePicVer.has(user_id)){return 0;}return window.profilePicVer.get(user_id);},getProfilePic:function(hash,user_id,size){if(!$defined(size)){size=26;}var serverId=user_id%16;var version=UserUtility.profilePicVersionGet(user_id);return"http://profilepics"+serverId.toString(16)+".pip.io/"+hash.substring(0,2)+"/"+hash.substring(2,3)+"/"+hash.substring(3,5)+"/"+user_id+"/"+size+".jpg?"+version;},processSource:function(source){if($defined(source.user_id)){return UserUtility.processUser(source);}else{if($defined(source.room_id)){return UserUtility.processRoom(source);}}},processRoom:function(room){var proom={};proom.username=room.username.toLowerCase();if($defined(room.about)){pipio.profileUpdated({username:room.username,about:room.about});}if($defined(pipio.getRoom(proom.username))){var existing=pipio.getRoom(proom.username);if($defined(room.about)){pipio.profileUpdated({username:proom.username,about:room.about});}if($defined(room.status_message)&&$defined(room.status_message.status)){if($defined(room.status_message.status)&&existing.status_message.status!=room.status_message.status){pipio.dispatchEvent("roomStatusUpdated",{username:room.username,status_message:room.status_message});existing.status_message=room.status_message;}}if($defined(room.is_public)){existing.is_public=parseInt(room.is_public);}if($defined(room.status)){existing.status=parseInt(room.status);}if($defined(room.subscribed)){existing.status=parseInt(room.subscribed);}return existing;}proom.status_message=$defined(room.status_message)?room.status_message:{status:""};proom.room_id=room.room_id;proom.room_name=room.room_name;proom.room_hash=room.room_hash;proom.date_created=room.date_created;proom.creator_id=$defined(room.creator_id)?room.creator_id:0;proom.creator=$defined(room.creator)?UserUtility.processUser(room.creator):null;proom.is_public=parseInt(room.is_public);proom.status=$defined(room.status)?parseInt(room.status):0;proom.subscribed=$defined(room.subscribed)?parseInt(room.subscribed):0;proom.about=$defined(room.about)?room.about:null;proom.profile_pic_16=UserUtility.getProfilePic(room.room_hash,room.room_id,16);proom.profile_pic_20=UserUtility.getProfilePic(room.room_hash,room.room_id,20);proom.profile_pic_26=UserUtility.getProfilePic(room.room_hash,room.room_id,26);proom.profile_pic_32=UserUtility.getProfilePic(room.room_hash,room.room_id,32);proom.profile_pic_42=UserUtility.getProfilePic(room.room_hash,room.room_id,42);proom.profile_pic_60=UserUtility.getProfilePic(room.room_hash,room.room_id,60);proom.profile_pic_100=UserUtility.getProfilePic(room.room_hash,room.room_id,100);proom.profile_pic_200=UserUtility.getProfilePic(room.room_hash,room.room_id,200);pipio.cacheRoom(proom);return proom;},processUser:function(user){var puser={};if(!$defined(user)||!$defined(user.username)){return;}puser.username=user.username.toLowerCase();if($defined(user.current_location)&&user.current_location!=""){pipio.locationUpdated({username:puser.username,location_enabled:$defined(user.location_enabled)?user.location_enabled:0,location:user.current_location});}if($defined(user.about)){pipio.profileUpdated({username:puser.username,about:user.about});}if($defined(pipio.getUser(puser.username))){var existing=pipio.getUser(puser.username);if($defined(user.status_message)&&$defined(user.status_message.status)){if($defined(user.status_message.status)&&existing.status_message.status!=user.status_message.status){pipio.dispatchEvent("userStatusUpdated",{username:user.username,status_message:user.status_message});existing.status_message=user.status_message;}}if($defined(user.location_enabled)){existing.location_enabled=user.location_enabled;}if($defined(user.is_public)){existing.is_public=user.is_public;}return existing;}puser.status_message=$defined(user.status_message)?user.status_message:{status:""};puser.first_name=user.first_name;puser.last_name=user.last_name;puser.fullname=user.first_name+" "+user.last_name;puser.user_hash=user.user_hash;puser.user_id=user.user_id;puser.group_id=$defined(user.group_id)?user.group_id:0;puser.about=$defined(user.about)?user.about:null;puser.is_public=user.is_public;puser.location_enabled=$defined(user.location_enabled)?user.location_enabled:0;puser.online=false;puser.show="";puser.video=false;puser.profile_pic_16=UserUtility.getProfilePic(user.user_hash,user.user_id,16);puser.profile_pic_20=UserUtility.getProfilePic(user.user_hash,user.user_id,20);puser.profile_pic_26=UserUtility.getProfilePic(user.user_hash,user.user_id,26);puser.profile_pic_32=UserUtility.getProfilePic(user.user_hash,user.user_id,32);puser.profile_pic_42=UserUtility.getProfilePic(user.user_hash,user.user_id,42);puser.profile_pic_60=UserUtility.getProfilePic(user.user_hash,user.user_id,60);puser.profile_pic_100=UserUtility.getProfilePic(user.user_hash,user.user_id,100);puser.profile_pic_200=UserUtility.getProfilePic(user.user_hash,user.user_id,200);pipio.cacheUser(puser);return puser;},updateStatusMessage:function(user,status_msg){var msgClass=".status_msg_"+user.username;$$(msgClass).each(function(el){el.set("text",TextUtility.unescapeQuotes(status_msg));});},getInstalledApps:function(){var apps=new Array();if($defined(user_data)){user_data.apps.each(function(app){apps[app.app_id]=app.external_user_id;},this);}return apps;}};var AlbumViewer=new Class({Extends:Base,EventHandlers:["userSwitched","viewAlbum"],init:function(){this.photos=$H();},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){},userLoggedOut:function(){},viewAlbum:function(album,photo,aid){var thumbSize=75;var w=600;var h=450;w+=2;h+=thumbSize+34;var albumPopup=new Popup({size:{x:w,y:h},resizable:false,dockable:true,closable:true,className:"albumViewer"});var nav=new Nav({iconOptions:{iconName:"photo"},displayName:album.displayName,closable:true});var content=new AlbumPopupContent({album:album,photo:photo,aid:aid,width:w,height:h,thumbSize:thumbSize});albumPopup.addContent("album",nav,content);}});var AlbumPopupContent=new Class({Extends:PopupContent,EventHandlers:["albumPicView"],onBeforeInit:function(options){this.album=options.album;this.curPhoto=options.photo;this.aid=options.aid;this.width=options.width;this.height=options.height;this.thumbSize=options.thumbSize;this.imageEls=$H();return options;},onInit:function(){var img=new Asset.image(this.curPhoto.src,{title:this.curPhoto.caption,onload:(function(image){this.picLoaded(image,this.curPhoto);}).bind(this)});this.nextImage;this.nextId;},picLoaded:function(image,photo){this.curImage=this.photoResize(image);var imgArea=new Element("div",{"class":"albumImage"}).adopt(this.curImage);imgArea.inject(this.content);this.nextLayer=new Element("div",{"class":"nav_image next nextLayer"});this.prevLayer=new Element("div",{"class":"nav_image previous prevLayer"});this.nextLayer.inject(imgArea);this.prevLayer.inject(imgArea);var nextL=this.nextLayer;var prevL=this.prevLayer;imgArea.addEvent("mouseover",function(){DomUtility.show(nextL);},this);imgArea.addEvent("mouseover",function(){DomUtility.show(prevL);},this);imgArea.addEvent("mouseout",function(){DomUtility.hide(nextL);},this);imgArea.addEvent("mouseout",function(){DomUtility.hide(prevL);},this);this.addNextPrevEvents(photo.id,this.aid);this.captionBox=new Element("div",{"class":"photoCaption","text":photo.caption}).inject(this.content);if($defined(photo.caption)&&photo.caption!=""){DomUtility.show(this.captionBox);}else{DomUtility.hide(this.captionBox);}var imgBarWidth=(this.thumbSize+10)*this.album.getSize();this.imageBarOuter=new Element("div",{"class":"imageBarOuter","styles":{"width":this.w-2}});this.imageBarOuter.inject(this.content);var imageBar=new Element("div",{"class":"imageBar","styles":{"width":imgBarWidth}});imageBar.inject(this.imageBarOuter);var curIndex;var photos=this.album.getAllPhotos();var pic,img,imgContainer;for(var i=0;i<this.album.getSize();i++){pic=photos[i];img=new Element("img",{"src":pic.thumb,"alt":pic.caption,"title":pic.caption});imgContainer=new Element("div",{"class":"imageInBar"}).adopt(img);imgContainer.inject(imageBar);this.imageEls.set(pic.id,imgContainer);if(pic.id==photo.id){imgContainer.addClass("photoHightlight");this.oldPic=pic;}imgContainer.addEvent("click",pipio.dispatchEvent.bind(this,["albumPicView",pic.id,this.aid]));}this.scrollToPic(photo.id);this.loadNextPic(photo.pid);},photoResize:function(image){var w=parseInt(image.get("width"));var h=parseInt(image.get("height"));var ratio=1;if(h>w){if(h>450){ratio=450/h;h=450;w=ratio*w;}}else{if(w>600){ratio=600/w;w=600;h=ratio*h;}}image.setStyle("height",h);image.setStyle("width",w);return image;},addNextPrevEvents:function(id,aid){var photos=this.album.getNextPrevPhoto(id);$(this.nextLayer).addEvent("click",pipio.dispatchEvent.bind(this,["albumPicView",photos.next.id,aid]));$(this.prevLayer).addEvent("click",pipio.dispatchEvent.bind(this,["albumPicView",photos.prev.id,aid]));},scrollToPic:function(id){var width=600;var index=this.album.getIndex(id);var x=index*(this.thumbSize+10);x=x-(600/2)+(this.thumbSize/2)+4;if(x<0){x=0;}var meh=this.imageEls.get(id).scrollLeft;$(this.imageBarOuter).scrollTo(x,0);},loadNextPic:function(pid){var nextPhoto=this.album.nextPhoto(pid);this.nextId=nextPhoto.id;var img=new Asset.image(nextPhoto.src,{onload:(function(image){this.nextImage=image;}).bind(this)});},albumPicView:function(pid){if($defined(pid[1])&&pid[1]==this.aid){pid=pid[0];if(pid==this.nextId){this.albumPicViewLoaded(this.nextImage,pid,this.aid);}else{var photo=this.album.getPhoto(pid);var img=new Asset.image(photo.src,{onload:(function(image){this.albumPicViewLoaded(image,pid,this.aid);}).bind(this)});}}},albumPicViewLoaded:function(image,pid,aid){var photo=this.album.getPhoto(pid);image=this.photoResize(image);var im=image.replaces($(this.curImage));this.curImage=im;this.captionBox.set("text",photo.caption);if($defined(photo.caption)&&photo.caption!=""){DomUtility.show(this.captionBox);}else{DomUtility.hide(this.captionBox);}this.nextLayer.removeEvents("click");this.prevLayer.removeEvents("click");this.addNextPrevEvents(pid,aid);this.imageEls.get(this.oldPic.id).removeClass("photoHighlight");this.imageEls.get(pid).addClass("photoHighlight");this.scrollToPic(pid);this.loadNextPic(pid);}});var Background=new Class({Extends:Base,EventHandlers:["userLoggedIn","userLoggedOut"],init:function(){this.clouds=new Array();this.stars=new Array();this.container=$("background");this.getBounds();this.setupSky();this.sunrise=6;this.sunset=19;this.moonrise=21;this.moonset=4;this.maxStars=30;this.starsStart=19;this.starsEnd=4;for(var i=0;i<6;i++){var cloud=this.createCloud().inject(this.container);this.clouds.push(cloud);}this.run();},setupSky:function(){this.sky=new Element("div",{"class":"sky"}).inject(this.container);this.sun=new Element("div",{"class":"celestial sun"}).inject(this.container);this.dusk=new Element("div",{"class":"sky_dusk"}).inject(this.container);this.moon=new Element("div",{"class":"celestial moon"}).inject(this.container);this.moveSky();},run:function(){this.step();this.anim=this.step.periodical(20000,this);},stop:function(){$clear(this.anim);},step:function(){this.moveClouds();this.moveSky();},getBounds:function(){this.xMin=-100;this.xMax=this.container.getSize().x;this.yMin=0;this.yMax=this.container.getSize().y-100;},userLoggedIn:function(){},userLoggedOut:function(){},setStars:function(){var time=this.getTime();if((time>this.starsStart||time<this.starsEnd)&&this.stars.length<this.maxStars){var star=this.createStar();star.inject(this.container);star.setStyles({"top":$random(1,this.yMax),"left":$random(1,this.xMax)});this.stars.push(star);}else{if(((time>this.starsEnd&&time<this.starsStart)&&this.stars.length>0)||this.stars.length==this.maxStars){this.removeStar();}}},removeStar:function(){if(this.stars.length==0){return;}var i=$random(0,this.stars.length-1);this.stars[i].destroy();this.stars.splice(i,1);},moveClouds:function(){var containerSize=this.container.getSize();this.clouds.each(function(item){var pos=item.getPosition();var speed=$random(2,6);if(pos.x+speed>this.xMax){item.setStyle("left",this.xMin);}else{item.get("tween",{duration:1000}).start("left",pos.x+speed);}},this);},createStar:function(){var star=new Element("div",{"class":"celestial stars star"+$random(1,4)});return star;},createCloud:function(){var cloud=new Element("div",{"class":"cloud cloud"+$random(1,6)});cloud.setStyle("left",$random(this.xMin,this.xMax));cloud.setStyle("top",$random(this.yMin,this.yMax));return cloud;},moveSky:function(){this.sky.setStyle("top",this.getSkyPosition());this.dusk.setStyle("bottom",this.getDuskPosition());this.moveSun();this.moveMoon();this.setStars();},moveSun:function(){var pos=this.getSunPosition();this.sun.setStyles({"top":pos.y+"%","left":pos.x+"%"});},moveMoon:function(){var pos=this.getMoonPosition();this.moon.setStyles({"top":pos.y+"%","left":pos.x+"%"});},getSkyPosition:function(){var skyMax=3000-this.container.getSize().y;var time=this.getTime();if(time>=1){time+=23;}else{time-=1;}return -Math.sin(((time)/24)*Math.PI)*Math.sin(((time)/24)*Math.PI)*skyMax;},getGroundOpacity:function(){var opacityMax=80;var time=this.getTime();if(time>=1){time+=23;}else{time-=1;}var dark=(1-Math.sin(((time)/24)*Math.PI))*opacityMax;return dark;},getDuskPosition:function(){var time=this.getTime();if(time>this.sunset-1&&time<this.sunset+1){time=(time-(this.sunset-1))/2;return -183+Math.sin((time)*Math.PI)*183;}else{return -183;}},getSunPosition:function(){var pos={x:90,y:100};var time=this.getTime();if(time>this.sunrise&&time<this.sunset){time=(time-this.sunrise)/(this.sunset-this.sunrise);pos.y=100-Math.sin(time*Math.PI)*100;pos.x=90-time*100;}return pos;},getMoonPosition:function(){var pos={x:90,y:100};var time=this.getTime();if(time<this.moonset){time+=24;}if(time>this.moonrise&&time<this.moonset+24){time=Math.abs((time-this.moonrise)/((this.moonset+24)-this.moonrise));pos.y=100-Math.sin(time*Math.PI)*100;pos.x=90-time*100;}return pos;},getTime:function(){var date=new Date();return date.getHours()+date.getMinutes()/60;}});var Chat=new Class({Extends:Base,EventHandlers:["userSwitched","chatStart","chatMsgReceived","chatTypingReceived"],init:function(){this.contents=$H();this.lastMsg=$H();},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){},userLoggedOut:function(){this.resetChatPopup();this.init();},chatStart:function(username,noSwitch){if(!$defined(this.popup)){this.createChatPopup();}var user=this.getContact(username);var content=this.addChatConvo(user);if(!$defined(noSwitch)){this.popup.switchContent(username);}return content;},chatTypingReceived:function(username){if(!this.contents.has(username)){return;}this.contents.get(username).showTyping();},chatMsgReceived:function(msg){var user=msg.target;var content=this.chatStart(user.username,true);if(!this.lastMsg.has(user.username)||this.lastMsg.get(user.username).outbound!=msg.outbound||new Date().getTime()-this.lastMsg.get(user.username).timestamp.getTime()>300000){var ts=msg.timestamp;if(this.lastMsg.has(user.username)&&msg.timestamp.getTime()-this.lastMsg.get(user.username).timestamp.getTime()<300000){ts=null;}var heading=(msg.outbound)?ItemUtility.createChatPostHeading(this.getPrivateUser(),ts):ItemUtility.createChatPostHeading(user,ts);content.insertChatItem(heading);}this.lastMsg.set(user.username,msg);var item=ItemUtility.createChatPostItem(msg,this.getPrivateUser());content.insertChatItem(item);},resetChatPopup:function(){if($defined(this.popup)){this.popup.close();}this.contents.each(function(content,key){content.close(true);this.contents.erase(key);},this);},createChatPopup:function(){this.popup=new ChatPopup({size:{x:400,y:350},resizable:false,className:"pipioChat",onClose:this.destroyChatPopup.bind(this)});},destroyChatPopup:function(){this.popup=null;this.isActive=false;},addChatConvo:function(user){if(this.contents.has(user.username)){var nav=new Nav({iconOptions:{user:user},displayName:user.fullname,closable:true});var content=this.contents.get(user.username);this.popup.addContent(user.username,nav,content);content.jumpToBottom();return content;}else{var nav=new Nav({iconOptions:{user:user},displayName:user.fullname,closable:true});var content=new ChatPopupContent({user:user});this.contents.set(user.username,content);this.popup.addContent(user.username,nav,content);return content;}}});Chat.implement({createChatPostItem:function(msg){var item=new Element("div",{"class":"post chat haspic"});}});var ChatPopup=new Class({Extends:Popup,setTitle:function(){if(this.hasTabs){var icon=new Icon20({iconName:"rooms"});var titleText=new Element("div",{"class":"title_text","text":this.contents.getLength()+" Chats"});}else{var nav=this.navs.get(this.currentContent);var icon=new Icon20(nav.iconOptions);var titleText=new Element("div",{"class":"title_text","text":"Chat with "+TextUtility.unescapeQuotes(nav.displayName)});}this.titleIcon=$(icon).replaces(this.titleIcon);this.titleText=titleText.replaces(this.titleText);}});var ChatPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){options.destroy=false;this.user=options.user;return options;},onInit:function(){this.lastOutbound=null;this.typingSent=false;this.chatContent=new Element("div",{"class":"chatContent"}).inject(this.content);this.chatInput=new Element("textarea",{"maxlength":2000});this.chatInput.addEvent("keyup",this.chatInputKeyUp.bindWithEvent(this));new Element("div",{"class":"chatInput"}).adopt(new Element("div",{"class":"textarea_wrapper"}).adopt(this.chatInput)).inject(this.content);this.scroll=new Fx.Scroll(this.chatContent);},jumpToBottom:function(){this.scroll.set(0,this.chatContent.getScrollSize().y);},onShow:function(){if($defined(this.scrollY)){this.scroll.set(0,this.scrollY);}this.focus();var msg=this.user.first_name+" says...";this.fireEvent("titleMessageDelete",msg);},onHide:function(){if($defined(this.chatContent)){this.scrollY=this.chatContent.getScroll().y;}},focus:function(){this.chatInput.focus.delay(500,this.chatInput);},clearInput:function(){this.chatInput.value="";},chatInputKeyUp:function(e){if(e.key=="enter"){var msg=e.target.value.trim();if(msg==""){return;}this.fireEvent("sendIM",this.user,msg);this.resetTypingSent();this.clearInput();this.focus();}else{this.sendTyping();}DomUtility.textareaAutoSize(e.target,16);},insertChatItem:function(el){this.hideTyping();el.inject(this.chatContent);this.scroll.toBottom();if(!this.isOn){var msg=this.user.first_name+" says...";this.fireEvent("titleMessageAdd",msg);}},showTyping:function(){if($defined(this.typingHeading)){return;}this.typingHeading=ItemUtility.createChatTypingHeading(this.user);this.typingHeading.inject(this.chatContent);this.scroll.toBottom();this.hideTyping.delay(9000,this);},hideTyping:function(){if($defined(this.typingHeading)){this.typingHeading.destroy();this.typingHeading=null;}},sendTyping:function(){if(this.typingSent||!this.user.online){return;}this.typingSent=true;this.fireEvent("sendTyping",this.user);this.resetTypingSent.delay(6000,this);},resetTypingSent:function(){this.typingSent=false;}});var Invite=new Class({Extends:Base,EventHandlers:["userSwitched","searchUserShow","searchEmailShow","inviteUserShow"],userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){},userLoggedOut:function(){},searchUserShow:function(){if($defined(this.searchUserPopup)){this.searchUserPopup._select();return;}this.createSearchUserPopup();},closeSearchUserPopup:function(){if($defined(this.searchUserPopup)){this.searchUserPopup.close();}},createSearchUserPopup:function(){this.searchUserPopup=new Popup({size:{x:350,y:110},resizable:false,dockable:false,className:"userSearch",onClose:this.destroySearchUserPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"search"},displayName:"Search for Users on Pip.io",closable:true});var content=new UserSearchPopupContent({});this.searchUserPopup.addContent("login",nav,content);},destroySearchUserPopup:function(){this.searchUserPopup=null;},searchEmailShow:function(){if($defined(this.searchEmailPopup)){this.searchEmailPopup._select();return;}this.createSearchEmailPopup();},closeSearchEmailPopup:function(){if($defined(this.searchEmailPopup)){this.searchEmailPopup.close();}},createSearchEmailPopup:function(){this.searchEmailPopup=new Popup({size:{x:350,y:140},resizable:false,dockable:false,className:"userSearch",onClose:this.destroySearchEmailPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"search"},displayName:"Search Contacts for Pip.io Users",closable:true});var content=new EmailSearchPopupContent({});this.searchEmailPopup.addContent("login",nav,content);},destroySearchEmailPopup:function(){this.searchEmailPopup=null;},inviteUserShow:function(email){if($defined(this.inviteUserPopup)){this.inviteUserPopup._select();return;}this.createInviteUserPopup(email);},closeInviteUserPopup:function(){if($defined(this.inviteUserPopup)){this.inviteUserPopup.close();}},createInviteUserPopup:function(email){this.inviteUserPopup=new Popup({size:{x:350,y:160},resizable:false,dockable:false,className:"userSearch",onClose:this.destroyInviteUserPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"users"},displayName:"Invite Friend to Join Pip.io",closable:true});var content=new UserInvitePopupContent({email:email});this.inviteUserPopup.addContent("login",nav,content);},destroyInviteUserPopup:function(){this.inviteUserPopup=null;}});var EmailSearchPopupContent=new Class({Extends:PopupContent,strings:{emailLabel:"Email:",passwordLabel:"Password:",userSearchMessage:"Search your email contacts for Pip.io users"},onInit:function(){new Element("div",{"class":"text_section centered light","text":this.strings.userSearchMessage}).inject(this.content);this.emailInput=new Element("input",{"type":"text","maxlength":"50"});this.emailInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"input_section email"}).adopt(new Element("div",{"class":"label light","text":this.strings.emailLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.emailInput)).inject(this.content);this.passwordInput=new Element("input",{"type":"password","maxlength":"50"});this.passwordInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"input_section email"}).adopt(new Element("div",{"class":"label light","text":this.strings.passwordLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.passwordInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Search",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.search.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key=="enter"){if(this.passwordInput.value.trim()!=""&&this.emailInput.value.trim()!=""){this.search();}}},search:function(){var email_address=this.emailInput.value.trim();var password=this.passwordInput.value.trim();var params={email_address:email_address,password:password};this.call("contacts","search_email",params,this.searchSuccess.bind(this),this.searchFail.bind(this));this.actionButton.showProgress();},searchSuccess:function(data){this.actionButton.hideProgress();if(!$defined(data.users)&&!$defined(data.contacts)){return;}if(data.users.length==0&&data.contacts.length==0){var name="search_user";var title="No Results";var message="Your search returned no results";this.fireEvent("showAlert",name,title,message);}else{this.showResultsPopup(data.users,data.contacts);}},searchFail:function(status){this.actionButton.hideProgress();var name="search_user";var title="Error";var message=status.message;this.fireEvent("showAlert",name,title,message);},showResultsPopup:function(users,contacts){if($defined(this.resultsPopup)){this.resultsPopup.close();}this.createResultsPopup(users,contacts);},closeResultsPopup:function(){if($defined(this.resultsPopup)){this.resultsPopup.close();}},createResultsPopup:function(users,contacts){this.resultsPopup=new Popup({size:{x:350,y:400},resizable:false,dockable:false,className:"userSearch",onClose:this.destroyResultsPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"search"},displayName:"Search Results",closable:true});var content=new UserSearchResultPopupContent({users:users,contacts:contacts});this.resultsPopup.addContent("results",nav,content);},destroyResultsPopup:function(){this.resultsPopup=null;},onShow:function(){this.focus();},focus:function(){this.emailInput.focus.delay(500,this.emailInput);},onClose:function(){this.closeResultsPopup();}});var UserInvitePopupContent=new Class({Extends:PopupContent,strings:{emailLabel:"Email:",messageLabel:"Message:",defaultMessage:"Connect with me on Pip.io!"},onBeforeInit:function(options){this.email=options.email;return options;},onInit:function(){this.emailInput=new Element("input",{"type":"text","maxlength":"50","value":this.email});new Element("div",{"class":"input_section email"}).adopt(new Element("div",{"class":"label light","text":this.strings.emailLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.emailInput)).inject(this.content);this.messageInput=new Element("textarea",{"value":TextUtility.unescape(this.strings.defaultMessage)});new Element("div",{"class":"input_section email message"}).adopt(new Element("div",{"class":"label light","text":this.strings.messageLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.messageInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Send Invite",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.sendInvite.bind(this));this.message=new Element("div",{"class":"message success"});this.actions=new Element("div",{"class":"actions"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},sendInvite:function(){var email=this.emailInput.value.trim();var message=this.messageInput.value.trim();if(email==""){var name="invite_user";var title="Error";var message="Please enter an email address";this.fireEvent("showAlert",name,title,message);return;}var params={email:email,message:message};this.call("contacts","invite_create",params,this.sendInviteSuccess.bind(this),this.sendInviteFail.bind(this));this.actionButton.showProgress();this.message.empty();},sendInviteSuccess:function(){this.actionButton.hideProgress();this.emailInput.value="";this.message.set("text","Invite sent");},sendInviteFail:function(status){this.actionButton.hideProgress();var name="invite_user";var title="Error";var message=status.message;this.fireEvent("showAlert",name,title,message);}});var UserSearchPopupContent=new Class({Extends:PopupContent,strings:{userSearchMessage:"You can enter a name or email to search",errorMessage:"There was an error creating this group"},onInit:function(){new Element("div",{"class":"text_section centered light","text":this.strings.userSearchMessage}).inject(this.content);this.searchInput=new Element("input",{"type":"text","maxlength":"50"});this.searchInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"textarea_wrapper"}).adopt(this.searchInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Search",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.search.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key=="enter"){if(this.searchInput.value.trim()!=""){this.search();}}},search:function(){var query=this.searchInput.value.trim();var params={query:query};this.call("contacts","search_user",params,this.searchSuccess.bind(this),this.searchFail.bind(this));this.actionButton.showProgress();},searchSuccess:function(data){this.actionButton.hideProgress();if(!$defined(data.users)&&!$defined(data.contacts)){return;}if(data.users.length==0&&data.contacts.length==0){var name="search_user";var title="No Results";var message="Your search returned no results";this.fireEvent("showAlert",name,title,message);}else{this.showResultsPopup(data.users,data.contacts);}},searchFail:function(status){this.actionButton.hideProgress();var name="search_user";var title="Error";var message=status.message;this.fireEvent("showAlert",name,title,message);},showResultsPopup:function(users,contacts){if($defined(this.resultsPopup)){this.resultsPopup.close();}this.createResultsPopup(users,contacts);},closeResultsPopup:function(){if($defined(this.resultsPopup)){this.resultsPopup.close();}},createResultsPopup:function(users,contacts){this.resultsPopup=new Popup({size:{x:350,y:400},resizable:false,dockable:false,className:"userSearch",onClose:this.destroyResultsPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"search"},displayName:"Search Results",closable:true});var content=new UserSearchResultPopupContent({users:users,contacts:contacts});this.resultsPopup.addContent("results",nav,content);},destroyResultsPopup:function(){this.resultsPopup=null;},onShow:function(){this.focus();},focus:function(){this.searchInput.focus.delay(500,this.searchInput);},onClose:function(){this.closeResultsPopup();}});var UserSearchResultPopupContent=new Class({Extends:PopupContent,strings:{searchResultMessage:"Search results"},onBeforeInit:function(options){this.users=options.users;this.contacts=options.contacts;return options;},onInit:function(){this.list=new Element("div",{"class":"itemList"}).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Close",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.closeButton)).inject(this.content);if(this.users.length>0){this.insertUsers();this.insertSeperator();}this.insertContacts();},insertContacts:function(){$H(this.contacts).each(function(name,email){this.insertContact(name,email);},this);},insertContact:function(name,email){var el=UserSearchUtility.createEmailItem(name,email);var button=new ButtonSmall({displayName:"Send Invite",className:"dark",action:"check"});$(button).inject(el);$(button).addEvent("click",this.fireEvent.bind(this,["inviteUserShow",email]));el.inject(this.list);},insertUsers:function(){this.users.each(function(user){user=UserUtility.processUser(user);this.insertUser(user);},this);},insertUser:function(user){var el=UserSearchUtility.createUserItem(user);if(!this.hasContact(user.username)){var button=new ButtonSmall({displayName:"Add Contact",className:"dark",action:"check"});$(button).inject(el);$(button).addEvent("click",this.contactRequest.bindWithEvent(this,[user.username,el]));}else{el.addClass("connected");}el.addEvent("click",this.fireEvent.bind(this,["showUser",user]));el.inject(this.list);},insertSeperator:function(){new Element("div",{"class":"listItem seperator"}).inject(this.list);},contactRequest:function(e,username,el){e.stopPropagation();this.fireEvent("connectionRequestCreate",username);el.addClass("invited");}});var UserSearchUtility={createUserItem:function(user){var el=new Element("div",{"class":"listItem user"});ItemUtility.createProfilePic(user,32).inject(el);var name=new Element("div",{"class":"listText text12 light","text":TextUtility.cleanText(user.fullname+" ("+user.username+")")}).inject(el);if($defined(user.about)&&$defined(user.about.bio)){new Element("div",{"class":"about_text text11 light3","text":TextUtility.cleanText(user.about.bio)}).inject(el);}new Element("div",{"class":"invited_text text11 success","text":"Request Sent"}).inject(el);new Element("div",{"class":"connected_text text11 success","text":"Connected"}).inject(el);return el;},createEmailItem:function(name,email){var el=new Element("div",{"class":"listItem"});var icon=new Icon20({iconName:"users"});$(icon).inject(el);new Element("div",{"class":"listText text12 light","text":TextUtility.cleanText(email)}).inject(el);var button=new ButtonSmall({displayName:"Invite",className:"dark",action:"check"});$(button).inject(el);new Element("div",{"class":"invited_text text11 success","text":"Invited"}).inject(el);return el;}};var Location=new Class({Extends:Base,EventHandlers:["showLocationEditPopup","showUsersMapPopup"],init:function(){},reset:function(){},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){},userLoggedOut:function(){this.closeLocationEditPopup();},showLocationEditPopup:function(){this.closeLocationEditPopup();this.createLocationEditPopup();},closeLocationEditPopup:function(){if($defined(this.locationEditPopup)){this.locationEditPopup.close();}},createLocationEditPopup:function(){this.locationEditPopup=new Popup({size:{x:350,y:110},resizable:false,dockable:false,closable:true,className:"locationSearch",onClose:(function(){this.locationEditPopup=null;}).bind(this)});var nav=new Nav({iconOptions:{iconName:"global"},displayName:"Edit Your Location",closable:true});var content=new UserLocationEditPopupContent({});content.resizePopup=this.locationEditPopup.resizePopup.bind(this.locationEditPopup);content.reCenter=this.locationEditPopup.reCenter.bind(this.locationEditPopup);this.locationEditPopup.addContent("edit_location",nav,content);},showUsersMapPopup:function(user){this.closeUsersMapPopup();this.createUsersMapPopup(user);},closeUsersMapPopup:function(){if($defined(this.usersMapPopup)){this.usersMapPopup.close();}},createUsersMapPopup:function(user){this.usersMapPopup=new Popup({size:{x:550,y:350},resizable:false,dockable:true,closable:true,className:"usersMap"});var nav=new Nav({iconOptions:{iconName:"location"},displayName:"Global Map",closable:true});var content=new UsersMapPopupContent({user:user,locations:this.getLocations()});this.usersMapPopup.addContent("users_maps",nav,content);}});var GlobalMapMenuSection=new Class({Extends:Base,EventHandlers:[],init:function(options){this.location=options.location;this.createMap();},createMap:function(){this.wrapper=new Element("div");this.updateMap();},updateMap:function(){this.wrapper.empty();if($defined(this.location)){this.mapWrapper=new Element("div",{"class":"gmap_content"});this.expandButton=new Element("div",{"class":"button_nav show"}).adopt(new Element("div",{"class":"action dock"}));var map=new Element("div",{"class":"map_section"}).adopt(new Element("div",{"class":"gmap"}).adopt(new Element("div",{"class":"gmap_border"}),this.mapWrapper));this.gmap=new GMap2(this.mapWrapper,{size:new GSize(156,156)});this.gmap.setCenter(new GLatLng(this.location.lat,this.location.lon),11);map.inject(this.wrapper);}this.updateLabel();},updateLabel:function(){if($defined(this.label)){this.label.destroy();}if($defined(this.location)){var locationLabel=DataUtility.getGeoLabel(this.location);var locationStr=DataUtility.getGeoLocality(this.location);if(locationLabel){locationStr=locationLabel+", "+locationStr;}this.label=new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Location: "}),new Element("span",{"html":TextUtility.unescape(locationStr)})).inject(this.wrapper,"top");}},toElement:function(){return this.wrapper;}});var UserMapMenuSection=new Class({Extends:Base,EventHandlers:["userLocationUpdated"],init:function(options){this.user=options.user;this.isSelf=this.user.user_id==this.getPrivateUser().user_id;this.location=this.getLocation(this.user.username);this.createMap();},createMap:function(){this.wrapper=new Element("div");this.updateMap();},updateMap:function(){this.wrapper.empty();if($defined(this.location)){this.mapWrapper=new Element("div",{"class":"gmap_content"});this.expandButton=new Element("div",{"class":"button_nav show"}).adopt(new Element("div",{"class":"action dock"}));this.expandButton.addEvent("click",this.fireEvent.bind(this,["showUsersMapPopup",this.user]));var map=new Element("div",{"class":"map_section"}).adopt(new Element("div",{"class":"gmap"}).adopt(new Element("div",{"class":"gmap_border"}),this.mapWrapper),this.expandButton);this.gmap=new GMap2(this.mapWrapper,{size:new GSize(156,156)});this.gmap.setCenter(new GLatLng(this.location.lat,this.location.lon),11);this.profilePic=ItemUtility.createProfilePic(this.user,60);this.marker=new Element("div",{"class":"map_marker"}).adopt(new Element("div",{"class":"profile_pic_wrapper"}).adopt(this.profilePic),new Element("div",{"class":"point_down"}),new Element("div",{"class":"spot"})).inject(map);map.inject(this.wrapper);}else{ItemUtility.createProfilePic(this.user,100).inject(this.wrapper);}this.updateLabel();},userLocationUpdated:function(username,location,location_enabled){if(username!=this.user.username){return;}this.user.location_enabled=location_enabled;this.location=$defined(location)?location:null;this.updateMap();},updateLabel:function(){if($defined(this.label)){this.label.destroy();}if($defined(this.location)){var locationLabel=DataUtility.getGeoLabel(this.location);var locationStr=DataUtility.getGeoLocality(this.location);if(locationLabel){locationStr=locationLabel+", "+locationStr;}this.label=new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Location: "}),new Element("span",{"html":TextUtility.unescape(locationStr)})).inject(this.wrapper,"top");}},toElement:function(){return this.wrapper;}});var LocationSearchResultPopupContent=new Class({Extends:PopupContent,strings:{searchResultMessage:"Search results"},onBeforeInit:function(options){this.locations=options.locations;this.locationSetFunc=options.locationSetFunc;return options;},onInit:function(){this.list=new Element("div",{"class":"itemList"}).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Close",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.closeButton)).inject(this.content);this.insertLocations();},insertLocations:function(){this.locations.each(function(location){this.insertLocation(location);},this);},insertLocation:function(location){var el=LocationSearchUtility.createLocationItem(location);var button=new ButtonSmall({displayName:"Set Location",className:"dark",action:"check"});$(button).inject(el);$(button).addEvent("click",this.setLocation.bind(this,location));el.inject(this.list);},setLocation:function(location){this.locationSetFunc(location);this.closeContent();}});var UserLocationEditPopupContent=new Class({Extends:PopupContent,strings:{locationSearchMessage:"Enter any address, city, or zip code",locationLabelLabel:"Location Name:"},onInit:function(){this.geocoder=new GClientGeocoder();this.searchTitle=new Element("div",{"class":"text_section centered light","text":this.strings.locationSearchMessage}).inject(this.content);this.searchInput=new Element("input",{"type":"text","maxlength":"50"});this.searchInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));this.searchInputSection=new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"textarea_wrapper"}).adopt(this.searchInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Search",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.search.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key=="enter"){if(this.searchInput.value.trim()!=""){this.search();}}},search:function(){var query=this.searchInput.value.trim();this.geocoder.getLocations(query,this.searchSuccess.bind(this));this.actionButton.showProgress();},searchSuccess:function(data){this.actionButton.hideProgress();if(data.Status.code==200){this.places=[];data.Placemark.each(function(place){this.places.push(this.parseLocation(place));},this);this.createResultsPopup();}else{var name="search_location";var title="No Results";var message="Your search returned no results";this.fireEvent("showAlert",name,title,message);}},parseLocation:function(location){var place={};place.name=location.address;place.country_code=location.AddressDetails.Country.CountryNameCode;place.country=location.AddressDetails.Country.CountryName;place.region=$defined(location.AddressDetails.Country.AdministrativeArea)?location.AddressDetails.Country.AdministrativeArea.AdministrativeAreaName:null;if($defined(location.AddressDetails.Country.AdministrativeArea)&&$defined(location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea)&&$defined(location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea.Locality)){place.city=location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea.Locality.LocalityName;}else{if($defined(location.AddressDetails.Country.AddressLine)&&$defined(location.AddressDetails.Country.AddressLine[0])){place.city=location.AddressDetails.Country.AddressLine[0];}}if($defined(location.AddressDetails.Country.AdministrativeArea)&&$defined(location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea)&&$defined(location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea.Locality)&&$defined(location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea.Locality.Thoroughfare)){place.address=location.AddressDetails.Country.AdministrativeArea.SubAdministrativeArea.Locality.Thoroughfare.ThoroughfareName;}place.lat=location.Point.coordinates[1];place.lon=location.Point.coordinates[0];place.geohash=GeoHash.encodeGeoHash(place.lat,place.lon);return place;},locationSelect:function(location){DomUtility.hide(this.searchTitle);DomUtility.hide(this.searchInputSection);DomUtility.hide(this.actions);this.searchTitle=new Element("div",{"class":"text_section centered light","text":TextUtility.unescape(location.name)}).inject(this.content);this.labelInput=new Element("input",{"type":"text","maxlength":"50"});if($defined(location.address)){this.labelInput.value=location.address;}new Element("div",{"class":"input_section label"}).adopt(new Element("div",{"class":"label light","text":this.strings.locationLabelLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.labelInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Save Location",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.locationSave.bind(this,[location]));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},locationSave:function(location){var label=this.labelInput.value.trim();var params={"label":label,"country_code":location.country_code,"country":location.country,"city":$defined(location.city)?location.city:"","region":$defined(location.region)?location.region:"","lat":location.lat,"lon":location.lon,"geohash":location.geohash};this.call("pipio","user_location_save",params,this.locationSaveSuccess.bind(this),this.locationSaveFail.bind(this));this.actionButton.showProgress();},locationSaveSuccess:function(data){this.closeContent();},locationSaveFail:function(status){this.actionButton.hideProgress();},searchFail:function(status){this.actionButton.hideProgress();var name="search_user";var title="Error";var message=status.message;this.fireEvent("showAlert",name,title,message);},showResultsPopup:function(users,contacts){if($defined(this.resultsPopup)){this.resultsPopup.close();}this.createResultsPopup(users,contacts);},closeResultsPopup:function(){if($defined(this.resultsPopup)){this.resultsPopup.close();}},createResultsPopup:function(){this.resultsPopup=new Popup({size:{x:350,y:400},resizable:false,dockable:false,className:"locationSearch",onClose:this.destroyResultsPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"global"},displayName:"Location Search Results",closable:true});var content=new LocationSearchResultPopupContent({locations:this.places,locationSetFunc:this.locationSelect.bind(this)});this.resultsPopup.addContent("results",nav,content);},destroyResultsPopup:function(){this.resultsPopup=null;},onShow:function(){this.focus();},focus:function(){this.searchInput.focus.delay(500,this.searchInput);},onClose:function(){this.closeResultsPopup();}});var UsersMapPopupContent=new Class({Extends:PopupContent,EventHandlers:["userLocationUpdated"],onBeforeInit:function(options){this.user=options.user;this.locations=options.locations;this.users=$H();return options;},onInit:function(){this.createMap();this.showUser(this.user.username);this.locations.each(function(location,username){this.showUser(username);},this);},createMap:function(){this.mapWrapper=new Element("div",{"class":"gmap_content"});var map=new Element("div",{"class":"map_section"}).adopt(new Element("div",{"class":"gmap"}).adopt(new Element("div",{"class":"gmap_border"}),this.mapWrapper));this.gmap=new GMap2(this.mapWrapper,{size:new GSize(526,326)});var location=this.getLocation(this.user.username);this.gmap.setCenter(new GLatLng(location.lat,location.lon),11);this.gmap.enableScrollWheelZoom();this.gmap.enableContinuousZoom();this.gmap.addControl(new GLargeMapControl());this.gmap.addControl(new GMapTypeControl());var mt=this.gmap.getMapTypes();for(var i=0;i<mt.length;i++){mt[i].getMinimumResolution=$lambda(3);mt[i].getMaximumResolution=$lambda(14);}map.inject(this.content);},userLocationUpdated:function(username,location,location_enabled){if($defined(location)){this.showUser(username);}else{this.removeUser(username);}},showUser:function(username){var user=this.getUser(username);var location=this.getLocation(username);if(!$defined(user)||!$defined(location)){return;}if(this.users.has(username)){this.gmap.removeOverlay(this.users.get(username));}var loc=new GLatLng(location.lat,location.lon);var marker=new MarkerLight(loc,{size:26,user:user});this.gmap.addOverlay(marker);this.users.set(username,marker);},removeUser:function(username){if(!this.users.has(username)){return;}this.gmap.removeOverlay(this.users.get(username));}});var LocationSearchUtility={createLocationItem:function(location){var el=new Element("div",{"class":"listItem"});var icon=new Icon20({iconName:"location"});$(icon).inject(el);var name=new Element("div",{"class":"listText text12 light","text":TextUtility.cleanText(location.name)}).inject(el);return el;}};var Login=new Class({Extends:Base,EventHandlers:["userSwitched","loginShow","signupShow","logoutShow","passwordResetRequestShow"],userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){this.closeLoginPopup();this.closePasswordResetRequestPopup();this.closePasswordResetPopup();this.closeSignupPopup();},userLoggedOut:function(){if(!this.checkCookie()){this.loginShow();}},checkCookie:function(){var destination=DataUtility.getCookie("destination");var token=DataUtility.getCookie("password_reset_token");var email=DataUtility.getCookie("password_reset_email");if(!$defined(destination)){return false;}if(destination=="password_reset"&&$defined(token)&&$defined(email)){this.passwordResetShow(token,email);return true;}else{if(destination=="signup"){var access_key=DataUtility.getCookie("invite_access_key");if(!$defined(access_key)){access_key="";}this.signupShow(access_key);return true;}else{if(destination=="email_block"){var token=DataUtility.getCookie("email_block_token");var email=DataUtility.getCookie("email_block_email");this.emailBlockShow(token,email);return true;}}}return false;},loginShow:function(){if($defined(this.loginPopup)){this.loginPopup._select();return;}this.createLoginPopup();},closeLoginPopup:function(){if($defined(this.loginPopup)){this.loginPopup.close();}},createLoginPopup:function(){this.loginPopup=new Popup({size:{x:350,y:226},resizable:false,dockable:false,className:"login",onClose:this.destroyLoginPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"power"},displayName:"Log In to Pip.io",closable:true});var content=new LoginPopupContent({});this.loginPopup.addContent("login",nav,content);},destroyLoginPopup:function(){this.loginPopup=null;},logoutShow:function(){if($defined(this.logoutPopup)){this.logoutPopup._select();return;}this.createLogoutPopup();},closeLogoutPopup:function(){if($defined(this.logoutPopup)){this.logoutPopup.close();}},createLogoutPopup:function(){this.logoutPopup=new Popup({size:{x:350,y:70},resizable:false,dockable:false,onClose:this.destroyLogoutPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"power"},displayName:"Log Out "+TextUtility.unescapeQuotes(this.getPrivateUser().fullname),closable:true});var content=new LogoutPopupContent({});this.logoutPopup.addContent("logout",nav,content);},destroyLogoutPopup:function(){this.logoutPopup=null;},passwordResetRequestShow:function(){if($defined(this.passwordResetRequestPopup)){this.passwordResetRequestPopup.close();}this.createPasswordResetRequestPopup();},closePasswordResetRequestPopup:function(){if($defined(this.passwordResetRequestPopup)){this.passwordResetRequestPopup.close();}},createPasswordResetRequestPopup:function(){this.passwordResetRequestPopup=new Popup({size:{x:350,y:112},resizable:false,dockable:false,className:"login",onClose:this.destroyPasswordResetRequestPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"pipio"},displayName:"Password Reset",closable:true});var content=new PasswordResetRequestPopupContent({});this.passwordResetRequestPopup.addContent("login",nav,content);},destroyPasswordResetRequestPopup:function(){this.passwordResetRequestPopup=null;},passwordResetShow:function(token,email){if($defined(this.passwordResetPopup)){this.passwordResetPopup.close();}this.createPasswordResetPopup(token,email);},closePasswordResetPopup:function(){if($defined(this.passwordResetPopup)){this.passwordResetPopup.close();}},createPasswordResetPopup:function(token,email){this.passwordResetPopup=new Popup({size:{x:350,y:142},resizable:false,dockable:false,className:"login",onClose:this.destroyPasswordResetPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"pipio"},displayName:"Password Reset",closable:true});var content=new PasswordResetPopupContent({token:token,email:email});this.passwordResetPopup.addContent("login",nav,content);},destroyPasswordResetPopup:function(){this.passwordResetPopup=null;},signupShow:function(access_key){if($defined(this.signupPopup)){this.signupPopup._select();return;}this.createSignupPopup(access_key);},closeSignupPopup:function(){if($defined(this.signupPopup)){this.signupPopup.close();}},createSignupPopup:function(access_key){this.signupPopup=new Popup({size:{x:350,y:366},resizable:false,dockable:false,className:"login",onClose:this.destroySignupPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"pipio"},displayName:"Sign Up for Pip.io",closable:true});if(!$defined(access_key)){access_key="";}var content=new SignupPopupContent({access_key:access_key});this.signupPopup.addContent("signup",nav,content);},destroySignupPopup:function(){this.signupPopup=null;},emailBlockShow:function(token,email){if($defined(this.emailBlockPopup)){this.emailBlockPopup.close();}this.createEmailBlockPopup(token,email);},closeEmailBlockPopup:function(){if($defined(this.signupPopup)){this.emailBlockPopup.close();}},createEmailBlockPopup:function(token,email){this.emailBlockPopup=new Popup({size:{x:350,y:110},resizable:false,dockable:false,className:"login",onClose:this.destroyEmailBlockPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"pipio"},displayName:"Email Settings",closable:true});var content=new EmailBlockPopupContent({token:token,email:email});this.emailBlockPopup.addContent("emailblock",nav,content);},destroyEmailBlockPopup:function(){this.emailBlockPopup=null;}});var EmailBlockPopupContent=new Class({Extends:PopupContent,strings:{emailBlockMessage:"Stop all Pip.io emails for:"},onBeforeInit:function(options){this.token=options.token;this.email=options.email;return options;},onInit:function(){new Element("div",{"class":"text_section centered light","text":TextUtility.unescape(this.strings.emailBlockMessage)}).inject(this.content);new Element("div",{"class":"text_section centered light","text":TextUtility.unescape(this.email)}).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Confirm",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.blockEmail.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},blockEmail:function(){var params={"token":this.token,"email":this.email};this.call("pipio","email_block",params,this.resetRequestSuccess.bind(this),this.resetRequestFail.bind(this));this.actionButton.showProgress();},resetRequestSuccess:function(data){var name="email_block";var title="Email Block Successful";var message="You will no longer receive emails from Pip.io";this.fireEvent("showAlert",name,title,message);this.actionButton.hideProgress();this.closeContent();},resetRequestFail:function(){var name="email_block";var title="Email Block Failed";var message="There was an error processing your request.  Please contact support@pip.io";this.fireEvent("showAlert",name,title,message);this.actionButton.hideProgress();}});var LoginPopupContent=new Class({Extends:PopupContent,strings:{loginMessage:"Log in to Pip.io",signupMessage:"Don't have an account?   Sign up now!",usernameLabel:"Username or email:",passwordLabel:"Password:",rememberMeLabel:"Remember me:",errorMessage:"Incorrect login",forgotPasswordMessage:"Forgot your password?"},onInit:function(){new Element("div",{"class":"text_section centered light","text":this.strings.loginMessage}).inject(this.content);var signupMsg=new Element("div",{"class":"text_section centered short text11 light3 clickable","text":this.strings.signupMessage}).inject(this.content);signupMsg.addEvent("click",this.fireEvent.bind(this,["signupShow"]));this.usernameInput=new Element("input",{"type":"text","maxlength":"32"});this.usernameInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.usernameLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.usernameInput)).inject(this.content);this.passwordInput=new Element("input",{"type":"password","maxlength":"32"});this.passwordInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.passwordLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.passwordInput)).inject(this.content);this.rememberToggle=new Toggle(true);new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.rememberMeLabel}),$(this.rememberToggle)).inject(this.content);var forgotPasswordMsg=new Element("div",{"class":"text_section centered short text11 light3 clickable","text":this.strings.forgotPasswordMessage}).inject(this.content);forgotPasswordMsg.addEvent("click",this.fireEvent.bind(this,["passwordResetRequestShow"]));this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Log In",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.login.bind(this));this.message=new Element("div",{"class":"message error"});this.actions=new Element("div",{"class":"actions"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},login:function(){var username=this.usernameInput.value.trim();var password=this.passwordInput.value.trim();var remember_me=this.rememberToggle.toInt();var params={"username":username,"password":password,"remember_me":remember_me};this.call("pipio","user_login",params,this.loginSuccess.bind(this),this.loginFail.bind(this));this.actionButton.showProgress();this.message.empty();},loginSuccess:function(data){this.fireEvent("userDataInit",data);this.actionButton.hideProgress();this.closeContent();},loginFail:function(){this.actionButton.hideProgress();this.message.set("text",this.strings.errorMessage);},inputKeyUp:function(e){if(e.key=="enter"){if(this.usernameInput.value.trim()!=""&&this.passwordInput.value.trim()!=""){this.login();}}},onShow:function(){this.focus();},focus:function(){this.usernameInput.focus.delay(500,this.usernameInput);}});var LogoutPopupContent=new Class({Extends:PopupContent,strings:{logoutMessage:"Are you sure you want to log out?"},onInit:function(){new Element("div",{"class":"text_section centered light","text":this.strings.logoutMessage}).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Log Out",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.logout.bind(this));this.message=new Element("div",{"class":"message"});this.actions=new Element("div",{"class":"actions"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},logout:function(){this.call("pipio","user_logout",null,this.logoutSuccess.bind(this),this.logoutFail.bind(this));this.actionButton.showProgress();},logoutSuccess:function(data){this.fireEvent("userDataInit",data);this.actionButton.hideProgress();this.closeContent();},logoutFail:function(){this.actionButton.hideProgress();this.closeContent();}});var PasswordResetPopupContent=new Class({Extends:PopupContent,strings:{passwordResetMessage:"Reset Pip.io password for {0}",passwordLabel:"New password:",verifyPasswordLabel:"Verify password"},onBeforeInit:function(options){this.token=options.token;this.email=options.email;return options;},onInit:function(){new Element("div",{"class":"text_section centered light","text":String.format(this.strings.passwordResetMessage,TextUtility.unescape(this.email))}).inject(this.content);this.passwordInput=new Element("input",{"type":"password","maxlength":"32"});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.passwordLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.passwordInput)).inject(this.content);this.verifyPasswordInput=new Element("input",{"type":"password","maxlength":"32"});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.verifyPasswordLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.verifyPasswordInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Set New Password",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.resetRequest.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},resetRequest:function(){var new_password=this.passwordInput.value.trim();var verify_password=this.verifyPasswordInput.value.trim();if(new_password==""||verify_password==""){var name="reset_request";var title="Password Reset Request Failed";var message="Please enter a new password";this.fireEvent("showAlert",name,title,message);return;}if(new_password!=verify_password){var name="reset_request";var title="Password Reset Request Failed";var message="The passwords you entered do not match";this.fireEvent("showAlert",name,title,message);return;}var params={"token":this.token,"email":this.email,"new_password":new_password,"verify_password":verify_password};this.call("pipio","user_password_reset",params,this.resetRequestSuccess.bind(this),this.resetRequestFail.bind(this));this.actionButton.showProgress();},resetRequestSuccess:function(data){var name="reset_request";var title="Password Reset Successful";var message="Your Pip.io password has been successfully reset";this.fireEvent("loginShow");this.fireEvent("showAlert",name,title,message);this.actionButton.hideProgress();this.closeContent();},resetRequestFail:function(){var name="reset_request";var title="Password Reset Failed";var message="There was an error resetting your password.  Please contact support@pip.io";this.fireEvent("showAlert",name,title,message);this.actionButton.hideProgress();},onShow:function(){this.focus();},focus:function(){this.passwordInput.focus.delay(500,this.passwordInput);}});var PasswordResetRequestPopupContent=new Class({Extends:PopupContent,strings:{passwordResetMessage:"Forgot your password to Pip.io?",usernameLabel:"Username or email:",forgotPasswordMessage:"Forgot your password?"},onInit:function(){new Element("div",{"class":"text_section centered light","text":this.strings.passwordResetMessage}).inject(this.content);this.usernameInput=new Element("input",{"type":"text","maxlength":"32"});this.usernameInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.usernameLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.usernameInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Request Reset",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.resetRequest.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},resetRequest:function(){var username=this.usernameInput.value.trim();if(username==""){var name="reset_request";var title="Password Reset Request Failed";var message="Please enter your username or email";this.fireEvent("showAlert",name,title,message);return;}var params={"username":username};this.call("pipio","user_password_resetrequest",params,this.resetRequestSuccess.bind(this),this.resetRequestFail.bind(this));this.actionButton.showProgress();},resetRequestSuccess:function(data){var name="reset_request";var title="Password Reset Request Sent";var message="Please check your email for directions to reset your password";this.fireEvent("showAlert",name,title,message);this.actionButton.hideProgress();this.closeContent();},resetRequestFail:function(){var name="reset_request";var title="Password Reset Request Failed";var message="We could not locate your account, please make sure the username or email you entered is correct";this.fireEvent("showAlert",name,title,message);this.actionButton.hideProgress();},inputKeyUp:function(e){if(e.key=="enter"){if(this.usernameInput.value.trim()!=""){this.resetRequest();}}},onShow:function(){this.focus();},focus:function(){this.usernameInput.focus.delay(500,this.usernameInput);}});var SignupPopupContent=new Class({Extends:PopupContent,strings:{signUpMessage:"Sign up for Pip.io",signUpDetailMessage:"It only takes a few seconds to create an account!",usernameLabel:"Username:",passwordLabel:"Password:",firstNameLabel:"First Name:",lastNameLabel:"Last Name:",emailLabel:"Email:",dobLabel:"Date of Birth:",inviteCodeLabel:"Invite Code:",inviteCodeMessage:"Leave this field blank if you do not have an invite code"},onBeforeInit:function(options){this.access_key=options.access_key;return options;},onInit:function(){new Element("div",{"class":"text_section centered light","text":this.strings.signUpMessage}).inject(this.content);new Element("div",{"class":"text_section centered light short text11 light3","text":this.strings.signUpDetailMessage}).inject(this.content);this.firstNameInput=new Element("input",{"type":"text","maxlength":"50"});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.firstNameLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.firstNameInput)).inject(this.content);this.lastNameInput=new Element("input",{"type":"text","maxlength":"50"});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.lastNameLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.lastNameInput)).inject(this.content);this.emailInput=new Element("input",{"type":"text","maxlength":"32"});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.emailLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.emailInput)).inject(this.content);this.usernameInput=new Element("input",{"type":"text","maxlength":"32"});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.usernameLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.usernameInput)).inject(this.content);this.passwordInput=new Element("input",{"type":"password","maxlength":"32"});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.passwordLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.passwordInput)).inject(this.content);this.monthInput=new Element("input",{"type":"text","maxlength":"2","value":"MM"});this.dayInput=new Element("input",{"type":"text","maxlength":"2","value":"DD"});this.yearInput=new Element("input",{"type":"text","maxlength":"4","value":"YYYY"});this.monthInput.addEvent("click",this.clearField.bind(this,[this.monthInput,"MM"]));this.dayInput.addEvent("click",this.clearField.bind(this,[this.dayInput,"DD"]));this.yearInput.addEvent("click",this.clearField.bind(this,[this.yearInput,"YYYY"]));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.dobLabel}),new Element("div",{"class":"textarea_wrapper month"}).adopt(this.monthInput),new Element("div",{"class":"textarea_wrapper day"}).adopt(this.dayInput),new Element("div",{"class":"textarea_wrapper year"}).adopt(this.yearInput)).inject(this.content);this.inviteCodeInput=new Element("input",{"type":"text","maxlength":"10","value":this.access_key});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.inviteCodeLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.inviteCodeInput)).inject(this.content);new Element("div",{"class":"text_section centered light short text11 light3","text":this.strings.inviteCodeMessage}).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Sign Up",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.signup.bind(this));this.message=new Element("div",{"class":"message success"});this.actions=new Element("div",{"class":"actions"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},clearField:function(el,def){if(el.value==def){el.value="";}},signup:function(){var first_name=this.firstNameInput.value.trim();var last_name=this.lastNameInput.value.trim();var username=this.usernameInput.value.trim();var password=this.passwordInput.value.trim();var email=this.emailInput.value.trim();var dob_month=this.monthInput.value.trim();var dob_day=this.dayInput.value.trim();var dob_year=this.yearInput.value.trim();var access_key=this.inviteCodeInput.value.trim();if(first_name==""||last_name==""){this.signupFail({message:"Please enter your name"});return;}if(email==""){this.signupFail({message:"Please enter your email"});return;}if(username==""){this.signupFail({message:"Please enter a username"});return;}if(password==""){this.signupFail({message:"Please enter a password"});return;}if(dob_month!=parseInt(dob_month)||dob_month<1||dob_month>12){this.signupFail({message:"Please enter a valid month"});return;}if(dob_day!=parseInt(dob_day)||dob_day<1||dob_day>31){this.signupFail({message:"Please enter a valid day"});return;}if(dob_year!=parseInt(dob_year)||dob_year<1900||dob_year>2010){this.signupFail({message:"Please enter a valid year"});return;}var params={"first_name":first_name,"last_name":last_name,"username":username,"password":password,"email":email,"dob_month":dob_month,"dob_day":dob_day,"dob_year":dob_year,"access_key":access_key};this.call("pipio","user_register",params,this.signupSuccess.bind(this),this.signupFail.bind(this));this.actionButton.showProgress();this.message.set("text","please wait...");},signupSuccess:function(data){this.fireEvent("userDataInit",data);this.actionButton.hideProgress();this.closeContent();this.message.set("success!");},signupFail:function(status){this.actionButton.hideProgress();var name="user_register";var title="Error";var message=status.message;this.message.empty();this.fireEvent("showAlert",name,title,message);},onShow:function(){this.focus();},focus:function(){this.firstNameInput.focus.delay(500,this.firstNameInput);}});var Notifications=new Class({Extends:Base,EventHandlers:["userSwitched","notificationAdd","titleMessageAdd","titleMessageDelete"],init:function(){this.notifications=$H();this.timers=$H();this.messages=[];this.messageTimer=0;this.createNotifications();},titleMessageAdd:function(message){if(this.messages.contains(message)){return;}this.messages.push(message);this.titleMessageCheck();},titleMessageDelete:function(message){if(this.messages.contains(message)){this.messages.erase(message);}this.titleMessageCheck();},titleMessageCheck:function(){if(this.messages.length>0&&this.messageTimer==0){this.messageTimer=this.titleMessageRotate.periodical(2000,this);}else{if(this.messages.length==0&&this.messageTimer!=0){$clear(this.messageTimer);document.title=this.getPageTitle();}}},titleMessageRotate:function(){if(this.messages.length==0){return;}if(!$defined(this.currentTitle)){this.currentTitle=this.getPageTitle();}if(this.getPageTitle()==this.currentTitle){var msg=this.messages.shift();this.messages.push(msg);document.title=msg;this.currentTitle=msg;}else{document.title=this.getPageTitle();this.currentTitle=this.getPageTitle();}},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){this.notifications=$H();},userLoggedOut:function(){this.closeAll();this.notifications=$H();},closeAll:function(){this.notifications.getKeys().each(function(name){this.close(name);},this);},close:function(name){if(!this.notifications.has(name)){return;}var notif=this.notifications.get(name);DomUtility.fadeOutDestroy($(notif));this.notifications.erase(name);$clear(this.timers.get(name));this.timers.erase(name);delete (notif);this.checkShow();},notificationAdd:function(name,notif){if(this.notifications.has(name)){return;}$(notif).inject(this.menu);DomUtility.fadeIn($(notif),1000);this.notifications.set(name,notif);notif.onClose=this.close.bind(this,name);var timer=this.close.delay(notif.timeout,this,[name]);this.timers.set(name,timer);this.checkShow();},checkShow:function(){if(this.notifications.getLength()>0){DomUtility.show(this.menu);}else{DomUtility.hide(this.menu);}},createNotifications:function(){this.menu=new Element("div",{"class":"menu flattop"});this.menu.inject("notifications");this.checkShow();}});var Notification=new Class({Extends:Base,init:function(options){if($defined(this.onBeforeInit)){options=this.onBeforeInit(options);}this.iconOptions=options.iconOptions;this.timeout=options.timeout||5000;this.hasActions=options.hasActions||false;this.createNotification();if($defined(this.onInit)){this.onInit();}},createNotification:function(){this.notif=new Element("div",{"class":"notification"});this.icon=new Icon20(this.iconOptions);$(this.icon).inject(this.notif);this.closeButton=new Element("div",{"class":"button_nav show"}).adopt(new Element("div",{"class":"action close"})).inject(this.notif);this.closeButton.addEvent("click",this.closeNotification.bind(this));this.getText().inject(this.notif);if(this.hasActions){this.actions=new Element("div",{"class":"actions"}).inject(this.notif);}},getText:function(){return new Element("div",{"class":"notification_text text11 light1"});},closeNotification:function(){if($defined(this.onClose)){this.onClose();}},toElement:function(){return this.notif;}});var Settings=new Class({Extends:Base,EventHandlers:["userSwitched","showSettings"],userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){},userLoggedOut:function(){this.closeSettings();},showSettings:function(){this.closeSettings();this.settingsPopup=new Popup({size:{x:350,y:368},resizable:false,dockable:false,className:"settings",onClose:this.destroySettings.bind(this)});var nav=new Nav({iconOptions:{iconName:"settings"},displayName:"Pip.io Settings",closable:true});var content=new PipioSettingsPopupContent();this.settingsPopup.addContent("pipio_settings",nav,content);},closeSettings:function(){if($defined(this.settingsPopup)){this.settingsPopup.close();}},destroySettings:function(){this.settingsPopup=null;}});var EmailChangePopupContent=new Class({Extends:PopupContent,strings:{emailLabel:"Email:"},onInit:function(){this.emailInput=new Element("input",{"type":"text","maxlength":"200"});this.emailInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.emailLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.emailInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Update Email",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.changeEmail.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key=="enter"){if(this.emailInput.value.trim()!=""){this.changeEmail();}}},changeEmail:function(){var email=this.emailInput.value.trim();var params={email:email};this.call("pipio","user_email_change",params,this.changeEmailSuccess.bind(this),this.changeEmailFail.bind(this));this.actionButton.showProgress();},changeEmailSuccess:function(){this.actionButton.hideProgress();this.closeContent();},changeEmailFail:function(status){this.actionButton.hideProgress();var name="email_change";var title="Error Updating Email";var message=status.message;this.fireEvent("showAlert",name,title,message);},onShow:function(){this.focus();},focus:function(){this.emailInput.focus.delay(500,this.emailInput);}});var PasswordChangePopupContent=new Class({Extends:PopupContent,strings:{passwordLabel:"Current Password:",newPasswordLabel:"New Password:",verifyPasswordLabel:"Verify Password:"},onInit:function(){this.passwordInput=new Element("input",{"type":"password","maxlength":"50"});new Element("div",{"class":"input_section passwordChange"}).adopt(new Element("div",{"class":"label light","text":this.strings.passwordLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.passwordInput)).inject(this.content);this.newPasswordInput=new Element("input",{"type":"password","maxlength":"50"});new Element("div",{"class":"input_section passwordChange"}).adopt(new Element("div",{"class":"label light","text":this.strings.newPasswordLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.newPasswordInput)).inject(this.content);this.verifyPasswordInput=new Element("input",{"type":"password","maxlength":"50"});new Element("div",{"class":"input_section passwordChange"}).adopt(new Element("div",{"class":"label light","text":this.strings.verifyPasswordLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.verifyPasswordInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Change Password",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.changePassword.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},changePassword:function(){var password=this.passwordInput.value.trim();var newPassword=this.newPasswordInput.value.trim();var verifyPassword=this.verifyPasswordInput.value.trim();var params={password:password,new_password:newPassword,verify_password:verifyPassword};this.call("pipio","user_password_change",params,this.changePasswordSuccess.bind(this),this.changePasswordFail.bind(this));this.actionButton.showProgress();},changePasswordSuccess:function(){this.actionButton.hideProgress();var name="email_change";var title="Password Changed";var message="Your Pip.io password has been updated";this.fireEvent("showAlert",name,title,message);this.closeContent();},changePasswordFail:function(status){this.actionButton.hideProgress();var name="email_change";var title="Error Updating Email";var message=status.message;this.fireEvent("showAlert",name,title,message);},onShow:function(){this.focus();},focus:function(){this.passwordInput.focus.delay(500,this.passwordInput);}});var PipioSettingsPopupContent=new Class({Extends:PopupContent,EventHandlers:["emailBlockUpdated","userEmailUpdated"],strings:{settingsMessage:"Change your Pip.io settings",accountSectionLabel:"Account Settings",emailSectionLabel:"Email Settings",generalEmailLabel:"Pip.io service updates:",postReplyEmailLabel:"Reply notifications:",targetedPostEmailLabel:"Targeted post notifications:",contactRequestEmailLabel:"Contact request notifications:",roomInviteEmailLabel:"Room invite notifications:"},onInit:function(){new Element("div",{"class":"text_section centered light","text":this.strings.settingsMessage}).inject(this.content);new Element("div",{"class":"text_section light","text":this.strings.accountSectionLabel}).inject(this.content);var emailChangeButton=new ButtonSmall({displayName:"Update Email",className:"dark",action:"edit"});$(emailChangeButton).addEvent("click",this.showEmailChangePopup.bind(this));this.emailLabel=new Element("div",{"class":"label light2","text":this.getPrivateUser().email});new Element("div",{"class":"input_section"}).adopt(this.emailLabel,$(emailChangeButton)).inject(this.content);var passwordChangeButton=new ButtonSmall({displayName:"Change Password",className:"dark",action:"lock"});$(passwordChangeButton).addEvent("click",this.showPasswordChangePopup.bind(this));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light2","text":"**********"}),$(passwordChangeButton)).inject(this.content);new Element("div",{"class":"text_section light","text":this.strings.emailSectionLabel}).inject(this.content);this.generalEmailToggle=new Toggle(true);$(this.generalEmailToggle).addEvent("click",this.updateBlock.bind(this,[18,this.generalEmailToggle]));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light2","text":this.strings.generalEmailLabel}),$(this.generalEmailToggle)).inject(this.content);this.postReplyEmailToggle=new Toggle(true);$(this.postReplyEmailToggle).addEvent("click",this.updateBlock.bind(this,[9,this.postReplyEmailToggle]));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light2","text":this.strings.postReplyEmailLabel}),$(this.postReplyEmailToggle)).inject(this.content);this.targetedPostEmailToggle=new Toggle(true);$(this.targetedPostEmailToggle).addEvent("click",this.updateBlock.bind(this,[14,this.targetedPostEmailToggle]));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light2","text":this.strings.targetedPostEmailLabel}),$(this.targetedPostEmailToggle)).inject(this.content);this.contactRequestEmailToggle=new Toggle(true);$(this.contactRequestEmailToggle).addEvent("click",this.updateBlock.bind(this,[5,this.contactRequestEmailToggle]));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light2","text":this.strings.contactRequestEmailLabel}),$(this.contactRequestEmailToggle)).inject(this.content);this.roomInviteEmailToggle=new Toggle(true);$(this.roomInviteEmailToggle).addEvent("click",this.updateBlock.bind(this,[11,this.roomInviteEmailToggle]));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light2","text":this.strings.roomInviteEmailLabel}),$(this.roomInviteEmailToggle)).inject(this.content);this.actionButton=new ButtonMedium({displayName:"Done",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.closeContent.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton)).inject(this.content);this.loadBlocks();},userEmailUpdated:function(data){if(!$defined(data.email)){return;}this.emailLabel.set("text",data.email);},loadBlocks:function(){this.call("pipio","emailblock_load",null,this.loadBlocksSuccess.bind(this));},loadBlocksSuccess:function(data){if(!$defined(data.blocks)){return;}data.blocks.each(function(block){this.updateBlockToggle(block.email_type,block.blocked);},this);},emailBlockUpdated:function(data){if(!$defined(data.email_type)||!$defined(data.blocked)){return;}this.updateBlockToggle(data.email_type,data.blocked);},updateBlockToggle:function(email_type,blocked){switch(email_type){case 5:this.contactRequestEmailToggle.set(blocked==0);break;case 9:this.postReplyEmailToggle.set(blocked==0);break;case 11:this.roomInviteEmailToggle.set(blocked==0);break;case 14:this.targetedPostEmailToggle.set(blocked==0);break;case 18:this.generalEmailToggle.set(blocked==0);break;}},updateBlock:function(email_type,toggle){var enabled=toggle.toInt();var blocked=(enabled==1)?0:1;var params={email_type:email_type,blocked:blocked};this.call("pipio","emailblock_update",params);},onClose:function(){this.closeEmailChangePopup();},showEmailChangePopup:function(){this.closeEmailChangePopup();this.emailChangePopup=new Popup({size:{x:350,y:74},resizable:false,dockable:false,className:"settings",onClose:this.destroyEmailChangePopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"settings"},displayName:"Update Your Email",closable:true});var content=new EmailChangePopupContent();this.emailChangePopup.addContent("pipio_settings",nav,content);},closeEmailChangePopup:function(){if($defined(this.emailChangePopup)){this.emailChangePopup.close();}},destroyEmailChangePopup:function(){this.emailChangePopup=null;},showPasswordChangePopup:function(){this.closePasswordChangePopup();this.passwordChangePopup=new Popup({size:{x:350,y:142},resizable:false,dockable:false,className:"settings",onClose:this.destroyPasswordChangePopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"settings"},displayName:"Change Your Password",closable:true});var content=new PasswordChangePopupContent();this.passwordChangePopup.addContent("pipio_settings",nav,content);},closePasswordChangePopup:function(){if($defined(this.passwordChangePopup)){this.passwordChangePopup.close();}},destroyPasswordChangePopup:function(){this.passwordChangePopup=null;}});var ShareBox=new Class({Extends:Base,EventHandlers:["userSwitched","shareBoxShow","replyShareBoxShow","forwardShareBoxShow","roomShareBoxShow"],init:function(){this.shareboxes=$H();},userSwitched:function(){if(!this.isLoggedIn()){this.userLoggedOut();}},userLoggedOut:function(){this.shareboxes.each(function(sharebox,key){sharebox.close();this.shareboxes.erase(key);},this);this.shareboxes=$H();},forwardShareBoxShow:function(forward_id,username,forward_body){if($defined(this.sharebox)){this.sharebox.close();}this.createForwardShareBox(forward_id,username,forward_body);},createForwardShareBox:function(forward_id,username,forward_body){this.sharebox=new Popup({size:{x:500,y:160},resizable:false,dockable:false,className:"sharebox",onClose:this.destroyShareBox.bind(this)});var displayName="Forward a Post";var nav=new Nav({iconOptions:{user:this.getPrivateUser()},displayName:displayName,closable:true});var forward_user=this.getUser(username);if(!$defined(forward_user)){forward_user=this.getRoom(username);}var content=new ShareBoxPopupContent({user:this.getPrivateUser(),forward_id:forward_id,forward_user:forward_user,forward_body:forward_body});this.sharebox.addContent("sharebox",nav,content);},replyShareBoxShow:function(reply_id){if($defined(this.sharebox)){this.sharebox.close();}this.createReplyShareBox(reply_id);},createReplyShareBox:function(reply_id){this.sharebox=new Popup({size:{x:500,y:160},resizable:false,dockable:false,className:"sharebox",onClose:this.destroyShareBox.bind(this)});var displayName="Reply to a Post";var nav=new Nav({iconOptions:{user:this.getPrivateUser()},displayName:displayName,closable:true});var content=new ShareBoxPopupContent({user:this.getPrivateUser(),reply_id:reply_id});this.sharebox.addContent("sharebox",nav,content);},shareBoxShow:function(user){if($defined(this.sharebox)){this.sharebox.close();}this.createShareBox(user);},createShareBox:function(user){this.sharebox=new Popup({size:{x:500,y:160},resizable:false,dockable:false,className:"sharebox",onClose:this.destroyShareBox.bind(this)});var displayName=(user.user_id==this.getPrivateUser().user_id)?"Write in Your Stream":"Write in "+user.first_name+"'s Stream";var nav=new Nav({iconOptions:{user:user},displayName:displayName,closable:true});var content=new ShareBoxPopupContent({user:user});this.sharebox.addContent("sharebox",nav,content);},destroyShareBox:function(name){this.sharebox=null;},roomShareBoxShow:function(room){if($defined(this.sharebox)){this.sharebox.close();}this.createRoomShareBox(room);},createRoomShareBox:function(room){this.sharebox=new Popup({size:{x:500,y:160},resizable:false,dockable:false,className:"sharebox",onClose:this.destroyShareBox.bind(this)});var displayName="Write in "+room.room_name+"'s Stream";var nav=new Nav({iconOptions:{user:room},displayName:displayName,closable:true});var content=new ShareBoxPopupContent({room:room});this.sharebox.addContent("sharebox",nav,content);}});var AttachLinkPopupContent=new Class({Extends:PopupContent,defaultText:"Please enter the URL below",errorText:"The URL you entered is invalid",validText:"Click attach to add this link to your post",onBeforeInit:function(options){this.attachFunc=options.attachFunc;return options;},onInit:function(){this.valid=false;this.url="";this.text=new Element("div",{"class":"help_text light","text":this.defaultText}).inject(this.content);this.input=new Element("input",{"type":"text","value":"http://","maxlength":200});this.input.addEvent("change",this.validate.bind(this));this.input.addEvent("keyup",this.validate.bindWithEvent(this));new Element("div",{"class":"textarea_wrapper"}).adopt(this.input).inject(this.content);this.attachButton=new ButtonMedium({displayName:"Attach",className:"dark",action:"check"});$(this.attachButton).addEvent("click",this.attach.bind(this));$(this.attachButton).inject(this.content);},onShow:function(){this.focus();},focus:function(){this.input.focus.delay(500,this.input);},validate:function(e){if(e&&e.key=="enter"){this.attach();return;}this.url=this.input.value.trim();if(DataUtility.validateUrl(this.url)){this.text.removeClass("error");this.text.addClass("success");this.text.set("text",this.validText);this.valid=true;}else{this.text.removeClass("success");this.text.addClass("error");this.text.set("text",this.errorText);this.valid=false;}},attach:function(){if(!this.valid){return;}var attachment={type:AttachmentType.Link,text:this.url,url:this.url};this.attachFunc(attachment);this.closeContent();}});var AttachPhotoPopupContent=new Class({Extends:PopupContent,defaultText:"Please choose a photo",errorText:"The file you selected is not a photo",validText:"Click attach to add this photo to your post",onBeforeInit:function(options){this.attachFunc=options.attachFunc;return options;},onInit:function(){this.valid=false;this.url="";this.text=new Element("div",{"class":"help_text light","text":this.defaultText}).inject(this.content);this.input=new Element("input",{"type":"text","value":"click to choose a file"});this.fileInput=new Element("input",{"type":"file","name":"file"});this.form=new Element("form").adopt(this.fileInput);this.fileInput.addEvent("change",this.validate.bind(this));new Element("div",{"class":"textarea_wrapper"}).adopt(this.input,this.form).inject(this.content);this.attachButton=new ButtonMedium({displayName:"Attach",className:"dark",action:"check"});$(this.attachButton).addEvent("click",this.attach.bind(this));$(this.attachButton).inject(this.content);},validate:function(){Logger().log("validating file");if(DataUtility.validatePhotoFile(this.fileInput.value)){this.text.removeClass("error");this.text.addClass("success");this.text.set("text",this.validText);this.input.value=this.fileInput.value;this.valid=true;}else{this.text.removeClass("success");this.text.addClass("error");this.text.set("text",this.errorText);this.input.value="click to choose a file";this.valid=false;}},attach:function(){if(!this.valid){return;}this.form.inject("hidden");var attachment={type:AttachmentType.Photo,text:this.fileInput.value};this.attachFunc(attachment,this.form);this.closeContent();}});var AttachmentType={None:0,Photo:1,Link:2};var ShareBoxPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){if($defined(options.user)){this.user=options.user;this.isRoom=false;this.source_id=this.user.user_id;}else{this.user=options.room;this.isRoom=true;this.source_id=this.user.room_id;}this.reply_id=options.reply_id||0;this.source_type=(this.isRoom)?3:1;this.forward_id=options.forward_id||0;this.forward_user=options.forward_user;this.forward_body=options.forward_body;if(this.source_id!=this.getPrivateUser().user_id||!$defined(this.forward_user)){this.forward_id=0;}this.is_forward=this.forward_id!=0;this.is_reply=this.reply_id!=0;this.is_direct=this.source_id!=this.getPrivateUser().user_id;return options;},reset:function(){Logger().log("resetting");this.closeContactPickerPopup();this.closeAttachmentPopup();this.content.empty();this.onInit();},onInit:function(){this.targetContacts=$H();this.targetGroups=$H();this.targetContactEls=$H();this.targetGroupEls=$H();this.targetAllContacts=false;this.allContactsEl=null;this.formEl=null;this.isPublic=true;this.readyToPost=false;this.attachment={type:AttachmentType.None};this.channel_id=0;this.res=this.getSession();if(!this.is_direct&&!this.is_reply){this.privateButton=new ButtonSmall({displayName:"Private",className:"privacy red",action:"lock dark"});$(this.privateButton).addEvent("click",this.togglePrivacy.bind(this));$(this.privateButton).inject(this.content);this.publicButton=new ButtonSmall({displayName:"Public",className:"privacy green",action:"broadcast dark"});$(this.publicButton).addEvent("click",this.togglePrivacy.bind(this));$(this.publicButton).inject(this.content);this.addRecipientButton=new ButtonSmall({displayName:"Add Recipient",className:"dark",action:"status dark"});$(this.addRecipientButton).addEvent("click",this.showContactPickerPopup.bind(this));var selfRecip=new Element("div",{"class":"target self"});var icon=new Icon20({user:this.getPrivateUser()});$(icon).inject(selfRecip);selfRecip.adopt(new Element("div",{"class":"target_text text11 light","text":"Yourself"}));this.norecipients=new Element("div",{"class":"recipients","text":"Everyone can view this post"}).inject(this.content);this.recipients=new Element("div",{"class":"recipients"}).adopt(new Element("div",{"class":"target","text":"To: "}),selfRecip,$(this.addRecipientButton),new Element("div",{"style":"clear: both"})).inject(this.content);this.setPrivacyView();}else{if(this.is_direct){this.norecipients=new Element("div",{"class":"recipients","text":"Everyone can view this post"}).inject(this.content);}else{this.norecipients=new Element("div",{"class":"recipients","text":"All recipients of the original can view this post"}).inject(this.content);}}this.input=new Element("textarea",{"maxlength":2000});this.input.addEvent("keydown",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"textarea_wrapper"}).adopt(this.input).inject(this.content);this.linkButton=new ButtonSmall({displayName:"Link",className:"dark",action:"link"});$(this.linkButton).addEvent("click",this.showAttachmentPopup.bind(this,["link"]));this.photoButton=new ButtonSmall({displayName:"Photo",className:"dark",action:"photo"});$(this.photoButton).addEvent("click",this.showAttachmentPopup.bind(this,["photo"]));this.fileButton=new ButtonSmall({displayName:"File",className:"dark",action:"file"});this.attachments=new Element("div",{"class":"attachments"}).inject(this.content);this.attachmentSelect=new Element("div").adopt(new Element("div",{"class":"attachment_text light","text":"Attach:"}),$(this.linkButton),$(this.photoButton)).inject(this.attachments);this.attachmentItems=new Element("div").inject(this.attachments);this.cancelButton=new ButtonMedium({displayName:"Close",className:"dark",action:"cross"});$(this.cancelButton).addEvent("click",this.closeContent.bind(this));this.updateButton=new ButtonMedium({displayName:"Post",className:"dark",action:"check"});$(this.updateButton).addEvent("click",this.post.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.updateButton),$(this.cancelButton)).inject(this.content);this.focus();if(this.forward_id!=0){this.attachForward();}},setPrivacyView:function(){if(this.isPublic){DomUtility.show(this.publicButton);DomUtility.hide(this.privateButton);DomUtility.show(this.norecipients);DomUtility.hide(this.recipients);}else{DomUtility.hide(this.publicButton);DomUtility.show(this.privateButton);DomUtility.hide(this.norecipients);DomUtility.show(this.recipients);}},togglePrivacy:function(){if(this.isPublic){this.showContactPickerPopup();}else{this.closeContactPickerPopup();}this.isPublic=!this.isPublic;this.setPrivacyView();},inputKeyUp:function(e){if(e.shift&&e.key=="enter"){e.preventDefault();this.post();}if(DomUtility.textareaAutoSize(e.target,40)){this.updateSize();}},updateSize:function(){var h=(this.isPublic)?this.norecipients.getSize().y:this.recipients.getSize().y;h+=this.input.getSize().y+10;h+=this.attachments.getSize().y+20;h+=this.actions.getSize().y+30;this.resizePopup(500,h);},parseTargets:function(){if(this.isPublic){return"";}var targets=[this.getPrivateUser().user_id];if(this.targetAllContacts){this.getContacts().each(function(user){targets.include(user.user_id);},this);return targets.join(",");}this.targetGroups.each(function(group){var contacts=this.getContactsByGroup(group.group_id);contacts.each(function(user){targets.include(user.user_id);},this);},this);this.targetContacts.each(function(user){targets.include(user.user_id);},this);return targets.join(",");},post:function(){var targets=this.parseTargets();var body=this.input.value.trim();var is_public=(this.isPublic)?1:0;Logger().log(targets);Logger().log(body);if(this.forward_id==0){if(body==""&&this.attachment.type==AttachmentType.None){this.fireEvent("showAlert","empty_post","Problem Posting","Please enter some content to post.");return;}var params={"body":body,"targets":targets,"source_id":this.source_id,"source_type":this.source_type,"reply_id":this.reply_id,"channel_id":this.channel_id,"is_public":is_public,"res":this.res,"attachment":JSON.encode(this.attachment)};this.call("home","publish",params,this.postSuccess.bind(this),this.postFail.bind(this),this.formEl);}else{var params={"body":body,"targets":targets,"source_id":this.source_id,"source_type":this.source_type,"forward_id":this.forward_id,"channel_id":this.channel_id,"is_public":is_public,"res":this.res};this.call("home","forward",params,this.postSuccess.bind(this),this.postFail.bind(this));}this.updateButton.showProgress();},postSuccess:function(){this.updateButton.hideProgress();this.closeContent();},postFail:function(){this.updateButton.hideProgress();},addAllContacts:function(){if(this.isPublic||$defined(this.allContactsEl)){return;}var el=ShareBoxUtility.createAllContactsItem();el.addEvent("click",this.removeAllContacts.bind(this));el.inject($(this.addRecipientButton),"before");this.allContactsEl=el;this.targetAllContacts=true;this.updateSize();},removeAllContacts:function(){if(!$defined(this.allContactsEl)){return;}this.allContactsEl.destroy();this.targetAllContacts=false;this.updateSize();},addTargetGroup:function(group){if(this.isPublic||this.targetGroupEls.has(group.group_id)){return;}var el=ShareBoxUtility.createGroupItem(group);el.addEvent("click",this.removeTargetGroup.bind(this,[group.group_id]));el.inject($(this.addRecipientButton),"before");this.targetGroupEls.set(group.group_id,el);this.targetGroups.set(group.group_id,group);this.updateSize();},removeTargetGroup:function(group_id){if(!this.targetGroupEls.has(group_id)){return;}this.targetGroupEls.get(group_id).destroy();this.targetGroupEls.erase(group_id);this.targetGroups.erase(group_id);this.updateSize();},addTargetContact:function(user){if(this.isPublic||this.targetContactEls.has(user.username)){return;}var el=ShareBoxUtility.createContactItem(user);el.addEvent("click",this.removeTargetContact.bind(this,[user.username]));el.inject($(this.addRecipientButton),"before");this.targetContactEls.set(user.username,el);this.targetContacts.set(user.username,user);this.updateSize();},removeTargetContact:function(username){if(!this.targetContactEls.has(username)){return;}this.targetContactEls.get(username).destroy();this.targetContactEls.erase(username);this.targetContacts.erase(username);this.updateSize();},showContactPickerPopup:function(){if($defined(this.contactPicker)){this.contactPicker._select();return;}this.createContactPickerPopup();},closeContactPickerPopup:function(){if($defined(this.contactPicker)){this.contactPicker.close();}},createContactPickerPopup:function(){this.contactPicker=new Popup({size:{x:200,y:350},resizable:false,dockable:false,className:"contactPicker",onClose:this.destroyContactPickerPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"users"},displayName:"Select Recipients",closable:true});var content=new ContactPickerPopupContent({groups:this.getGroups(),contacts:this.getContacts(),groupAddFunc:this.addTargetGroup.bind(this),contactAddFunc:this.addTargetContact.bind(this),allContactsAddFunc:this.addAllContacts.bind(this)});this.contactPicker.addContent("contactPicker",nav,content);},destroyContactPickerPopup:function(){this.contactPicker=null;},showAttachmentPopup:function(type){if($defined(this.attachmentPopup)){if(this.attachmentPopupType==type){this.attachmentPopup._select();return;}else{this.closeAttachmentPopup();}}this.createAttachmentPopup(type);},closeAttachmentPopup:function(){if($defined(this.attachmentPopup)){this.attachmentPopup.close();}},createAttachmentPopup:function(type){var popupClass;var typeName;switch(type){case"link":popupClass=AttachLinkPopupContent;typeName="Link";break;case"photo":popupClass=AttachPhotoPopupContent;typeName="Photo";break;}this.attachmentPopup=new Popup({size:{x:400,y:74},resizable:false,dockable:false,className:"attachments",onClose:this.destroyAttachmentPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:type},displayName:"Attach "+typeName,closable:true});var content=new popupClass({attachFunc:this.attachContent.bind(this)});this.attachmentPopupType=type;this.attachmentPopup.addContent("attachment",nav,content);},destroyAttachmentPopup:function(){this.attachmentPopup=null;this.attachmentPopupType=null;},attachForward:function(){DomUtility.show(this.attachmentItems);DomUtility.hide(this.attachmentSelect);var attachElement=ShareBoxUtility.createForwardAttachmentItem(this.forward_user,this.forward_body);attachElement.inject(this.attachmentItems);},attachContent:function(attachment,formEl){this.attachment=attachment;if($defined(formEl)){this.formEl=formEl;}Logger().log("attached "+this.formEl);DomUtility.show(this.attachmentItems);DomUtility.hide(this.attachmentSelect);var attachElement=ShareBoxUtility.createAttachmentItem(attachment);var removeButton=new ButtonSmall({displayName:"Remove",className:"dark",action:"cross"});$(removeButton).addEvent("click",this.removeAttachment.bind(this));$(removeButton).inject(attachElement);attachElement.inject(this.attachmentItems);},removeAttachment:function(){this.attachment=null;this.attachmentItems.empty();if($defined(this.formEl)){this.formEl.destroy();}this.formEl=null;DomUtility.hide(this.attachmentItems);DomUtility.show(this.attachmentSelect);this.forward_id=0;},onShow:function(){this.focus();},focus:function(){this.input.focus.delay(500,this.input);}});var ShareBoxUtility={createContactRoomInviteItem:function(user){var el=new Element("div",{"class":"listItem"});var icon=new Icon20({user:user});$(icon).inject(el);new Element("div",{"class":"listText text12 light","text":TextUtility.cleanText(user.fullname)}).inject(el);el.set("val1",user.fullname.toLowerCase());el.set("val2",user.last_name.toLowerCase());var button=new ButtonSmall({displayName:"Invite",className:"dark",action:"check"});$(button).inject(el);new Element("div",{"class":"invited_text text11 success","text":"Invited"}).inject(el);return el;},createContactPickerItem:function(user){var el=new Element("div",{"class":"listItem"});var icon=new Icon20({user:user});$(icon).inject(el);new Element("div",{"class":"listText text12 light","text":TextUtility.cleanText(user.fullname)}).inject(el);el.set("val1",user.fullname.toLowerCase());el.set("val2",user.last_name.toLowerCase());return el;},createGroupPickerItem:function(group){var el=new Element("div",{"class":"listItem"});var icon=new Icon20({iconName:"group"});$(icon).inject(el);new Element("div",{"class":"listText text12 light","text":TextUtility.cleanText(group.name)}).inject(el);el.set("val1",group.name.toLowerCase());return el;},createAllContactsPickerItem:function(){var el=new Element("div",{"class":"listItem"});var icon=new Icon20({iconName:"contacts"});$(icon).inject(el);new Element("div",{"class":"listText text12 light","text":"All Contacts"}).inject(el);el.set("val1","all contacts");return el;},createContactItem:function(user){var el=new Element("div",{"class":"target"});var icon=new Icon20({user:user});$(icon).inject(el);el.adopt(new Element("div",{"class":"target_text text11 light","text":TextUtility.cleanText(user.first_name)}),new Element("div",{"class":"action cross"}));return el;},createGroupItem:function(group){var el=new Element("div",{"class":"target"});var icon=new Icon20({iconName:"group"});$(icon).inject(el);el.adopt(new Element("div",{"class":"target_text text11 light","text":TextUtility.cleanText(group.name)}),new Element("div",{"class":"action cross"}));return el;},createAllContactsItem:function(){var el=new Element("div",{"class":"target"});var icon=new Icon20({iconName:"contacts"});$(icon).inject(el);el.adopt(new Element("div",{"class":"target_text text11 light","text":"All Contacts"}),new Element("div",{"class":"action cross"}));return el;},createForwardAttachmentItem:function(forward_user,forward_body){var el=new Element("div",{"class":"attachment"});var name=($defined(forward_user.user_id))?forward_user.fullname:forward_user.room_name;el.adopt(new Element("span",{"class":"indicator","html":"&raquo;"}),new Element("span",{"class":"attachment_title light2"}).adopt(new Element("span",{"text":"Forwarding: "}),new Element("span",{"class":"user_name","text":TextUtility.unescape(name)}),new Element("span",{"text":" "+TextUtility.unescape(forward_body)})));return el;},createAttachmentItem:function(attachment){var el=new Element("div",{"class":"attachment"});el.adopt(new Element("span",{"class":"indicator","html":"&raquo;"}),new Element("span",{"class":"attachment_title light2","text":attachment.text}));return el;}};var UI=new Class({Extends:Base,EventHandlers:["userSwitched","viewSwitch","menuAdd","contentAdd","menuClose","contentClose","appClose","showUser","showRoom","showConvo","showGlobal","showConfirmation","showAlert","showVideoPopup","showPhotoPopup","showPipioUpdatePopup","showSearchRoomPopup"],init:function(){this.historyManager=new HistoryManager();this.historyManager.addEvent("onHistoryChange",this.historyChanged.bind(this));this.history=$H();this.navScrollBar=new ScrollBar("nav","nav_wrapper");this.idleTimeout=10*60*1000;this.updateTimestamps.periodical(1000*90,this);this.menus=$H();this.contents=$H();this.confirms=$H();this.alerts=$H();this.reset();},reset:function(){this.currentMenu=null;this.currentContent=null;},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){this.reset();this.setCurrentUser();this.toggleHeader(true);},userLoggedOut:function(){this.reset();this.resetCurrentUser();this.toggleHeader(false);},appClose:function(app){this.contents.each(function(content,key){var appId=key.split("_",1)[0];if(appId==app){this.contentCloseKey(key);}},this);this.menus.each(function(menu,key){var appId=key.split("_",1)[0];if(appId==app){this.menuCloseKey(key);}},this);},viewSwitch:function(appId,contentName,menuName){var menuKey=appId+"_"+menuName;var contentKey=appId+"_"+contentName;if(!this.contents.has(contentKey)){Logger().log("content "+contentName+" not found!");return false;}if($defined(menuName)&&!this.menus.has(menuKey)){Logger().log("menu "+menuName+" not found!");return false;}if($defined(menuName)){this.contentSwitch(contentKey);this.menuSwitch(menuKey);$("content").addClass("hasmenu");}else{this.contentSwitch(contentKey);$("content").removeClass("hasmenu");}this.historyChange(appId,contentName,menuName);return true;},historyChange:function(appId,contentName,menuName){if(parseInt(appId)==appId){var app=this.getAppById(appId);if(!app){return;}var hash=app.name+"/"+contentName;this.history.set(hash,{appId:appId,contentName:contentName,menuName:menuName});this.historyManager.addState(hash);}else{var appParts=appId.split("_");var appName=appParts[0];var appParam=appParts[1];var hash=appName+"/"+appParam+"/"+contentName;this.history.set(hash,{appId:appId,contentName:contentName,menuName:menuName});this.historyManager.addState(hash);}},historyChanged:function(hash){Logger().log("historyChanged - "+hash);if(this.history.has(hash)){var state=this.history.get(hash);var found=this.viewSwitch(state.appId,state.contentName,state.menuName);if(!found){window.history.back();}}},menuAdd:function(appId,menuName,menu){var menuKey=appId+"_"+menuName;Logger().log("adding menu "+menuKey);if(this.menus.has(menuKey)){return;}$(menu).inject("menu_wrapper");menu.off();this.menus.set(menuKey,menu);},menuClose:function(appId,menuName){var menuKey=appId+"_"+menuName;this.menuCloseKey(menuKey);},menuCloseKey:function(key){if(!this.menus.has(key)){return;}if(key==this.currentMenu){this.currentMenu=null;}var menu=this.menus.get(key);menu.destroy();this.menus.erase(key);delete (menu);},contentAdd:function(appId,contentName,content){var contentKey=appId+"_"+contentName;Logger().log("adding content "+contentKey);if(this.contents.has(contentKey)){return;}$(content).inject("content_wrapper");content.off();this.contents.set(contentKey,content);},contentClose:function(appId,contentName){var contentKey=appId+"_"+contentName;this.contentCloseKey(contentKey);if(!$defined(this.currentContent)){window.history.back();}},contentCloseKey:function(key){Logger().log(key);if(!this.contents.has(key)){return;}if(key==this.currentContent){this.currentContent=null;}var content=this.contents.get(key);content.destroy();this.contents.erase(key);delete (content);},menuSwitch:function(menuKey){if(!this.menus.has(menuKey)){return;}if(menuKey==this.currentMenu){return;}if($defined(this.currentMenu)){this.menus.get(this.currentMenu).off();}this.menus.get(menuKey).on();this.currentMenu=menuKey;},contentSwitch:function(contentKey){if(!this.contents.has(contentKey)){return;}if(contentKey==this.currentContent){return;}if($defined(this.currentContent)){this.contents.get(this.currentContent).off();}this.contents.get(contentKey).on();this.fireEvent("contentSwitched",contentKey);this.currentContent=contentKey;},toggleHeader:function(loggedIn){if(loggedIn){DomUtility.show("self");$("header").get("tween").start("left",201).chain(function(){$("self").setStyle("z-index",6);$("header_loggedOut").get("tween").start("top",-36).chain(function(){$("header_loggedIn").get("tween").start("top",0);});});$("nav_wrapper").get("tween").start("left",0);$("content").get("tween").start("left",201);$("dock").inject("dock_loggedIn");}else{$("self").setStyle("z-index",4);$("header").get("tween").start("left",0).chain(function(){DomUtility.hide("self");$("header_loggedIn").get("tween").start("top",-36).chain(function(){$("header_loggedOut").get("tween").start("top",0);});});$("nav_wrapper").get("tween").start("left",-210);$("content").get("tween").start("left",0);$("dock").inject("dock_loggedOut");}},setCurrentUser:function(){$("self_name").set("text",this.getPrivateUser().fullname);$("self_profile_pic_26").set("src",this.getPrivateUser().profile_pic_26);$("self_profile_pic_26").addClass("profile_pic_26_"+this.getPrivateUser().username);$("self_online_status").addClass("online_status_"+this.getPrivateUser().username);},resetCurrentUser:function(){$("self_name").set("text","");$("self_profile_pic_26").set("src","");$("self_profile_pic_26").set("class","profile_pic");$("self_online_status").set("class","online_status");},showUser:function(user){var options={user:user};this.fireEvent("startAppInstance","user",user.username,options);},showRoom:function(room){var options={room:room};this.fireEvent("startAppInstance","room",room.username,options);},showGlobal:function(location){var options={location:location};var geohash=location.geohash.substring(0,6);this.fireEvent("startAppInstance","global",geohash,options);},showConvo:function(){},showConfirmation:function(name,title,message,confirmFunc){if(this.confirms.has(name)){this.confirms.get(name)._select();return;}this.createConfirmation(name,title,message,confirmFunc);},createConfirmation:function(name,title,message,confirmFunc){var popup=new Popup({size:{x:350,y:100},resizable:false,dockable:false,className:"confirm",onClose:this.destroyConfirmation.bind(this,[name])});var nav=new Nav({iconOptions:{iconName:"info"},displayName:title,closable:true});var content=new ConfirmPopupContent({confirmMessage:message,confirmFunc:confirmFunc});popup.addContent("confirm",nav,content);this.confirms.set(name,popup);},destroyConfirmation:function(name){this.confirms.erase(name);},showAlert:function(name,title,message){if(this.alerts.has(name)){this.alerts.get(name)._select();return;}this.createAlert(name,title,message);},createAlert:function(name,title,message){var popup=new Popup({size:{x:350,y:100},resizable:false,dockable:false,className:"confirm",onClose:this.destroyAlert.bind(this,[name])});var nav=new Nav({iconOptions:{iconName:"info"},displayName:title,closable:true});var content=new AlertPopupContent({alertMessage:message});popup.addContent("confirm",nav,content);this.alerts.set(name,popup);},destroyAlert:function(name){this.alerts.erase(name);},updateTimestamps:function(){$$(".timestamp").each(function(el){if($defined(el.get("ts"))){var ts=new Date(el.get("ts"));var format=el.get("ts_format");var timeStr=DateUtility.getTimestamp(ts,format);el.set("text",timeStr);}});}});UI.implement({showVideoPopup:function(attachment){switch(attachment.video_type){case"youtube":this.createYoutubePopup(attachment);break;case"vimeo":this.createVimeoPopup(attachment);break;case"ch":this.createChPopup(attachment);break;case"hulu":this.createHuluPopup(attachment);break;case"break":this.createBreakPopup(attachment);break;}},showPhotoPopup:function(attachment){this.createPhotoPopup(attachment);},createPhotoPopup:function(attachment){var popup=new Popup({size:{x:300,y:100},resizable:false,dockable:false,closable:true,className:"photoViewer"});var displayName=attachment.filename;var nav=new Nav({iconOptions:{iconName:"photo"},displayName:displayName,closable:true});var content=new PhotoPopupContent({attachment:attachment});content.resizePopup=popup.resizePopup.bind(popup);content.reCenter=popup.reCenter.bind(popup);popup.addContent("photo",nav,content);},createYoutubePopup:function(attachment){var popup=new Popup({size:{x:425,y:350},resizable:false,dockable:false,noHide:true,closable:true,className:"videoPlayer"});var displayName="Youtube Video";var nav=new Nav({iconOptions:{iconName:"youtube"},displayName:displayName,closable:true});var content=new YoutubePopupContent({attachment:attachment});popup.addContent("video",nav,content);},createVimeoPopup:function(attachment){var popup=new Popup({size:{x:425,y:350},resizable:false,dockable:false,noHide:true,closable:true,className:"videoPlayer"});var displayName="Vimeo Video";var nav=new Nav({iconOptions:{iconName:"tv"},displayName:displayName,closable:true});var content=new VimeoPopupContent({attachment:attachment});popup.addContent("video",nav,content);},createChPopup:function(attachment){var popup=new Popup({size:{x:425,y:350},resizable:false,dockable:false,noHide:true,closable:true,className:"videoPlayer"});var displayName="College Humor Video";var nav=new Nav({iconOptions:{iconName:"tv"},displayName:displayName,closable:true});var content=new ChPopupContent({attachment:attachment});popup.addContent("video",nav,content);},createBreakPopup:function(attachment){var popup=new Popup({size:{x:425,y:350},resizable:false,dockable:false,noHide:true,closable:true,className:"videoPlayer"});var displayName="Break.com Video";var nav=new Nav({iconOptions:{iconName:"tv"},displayName:displayName,closable:true});var content=new BreakPopupContent({attachment:attachment});popup.addContent("video",nav,content);},createHuluPopup:function(attachment){var popup=new Popup({size:{x:512,y:296},resizable:false,dockable:false,noHide:true,closable:true,className:"videoPlayer"});var displayName="Hulu Video";var nav=new Nav({iconOptions:{iconName:"tv"},displayName:displayName,closable:true});var content=new HuluPopupContent({attachment:attachment});popup.addContent("video",nav,content);},showPipioUpdatePopup:function(version){if($defined(this.updatePopup)){return;}this.updatePopup=popup=new Popup({size:{x:350,y:70},resizable:false,dockable:false,closable:false,className:"login"});var nav=new Nav({iconOptions:{iconName:"pipio"},displayName:"Pip.io Updated",closable:true});var content=new PipioUpdatePopupContent({version:version});this.updatePopup.addContent("update",nav,content);},showSearchRoomPopup:function(){this.closeSearchRoomPopup();this.createSearchRoomPopup();},closeSearchRoomPopup:function(){if($defined(this.searchRoomPopup)){this.searchRoomPopup.close();}},createSearchRoomPopup:function(){this.searchRoomPopup=new Popup({size:{x:350,y:110},resizable:false,dockable:false,className:"roomSearch",onClose:this.destroySearchRoomPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"search"},displayName:"Search for Rooms on Pip.io",closable:true});var content=new RoomSearchPopupContent({});this.searchRoomPopup.addContent("roomSearch",nav,content);},destroySearchRoomPopup:function(){this.searchRoomPopup=null;}});var BreakPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.attachment=options.attachment;return options;},onInit:function(){this.call("home","parse_break_url",{url:this.attachment.url},this.parseSuccess.bind(this),this.parseFail.bind(this));},parseSuccess:function(data){var swf="http://embed.break.com/"+data.id;var vid=new Swiff(swf,{id:swf,width:425,height:350,params:{movie:swf,allowfullscreen:true}});vid.inject(this.content);},parseFail:function(){this.closeContent();}});var ChPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.attachment=options.attachment;return options;},onInit:function(){var swf="http://www.collegehumor.com/moogaloop/moogaloop.swf?clip_id="+this.attachment.vimeoId+"&autoplay=1&fullscreen=1";var vid=new Swiff(swf,{id:swf,width:425,height:350,params:{movie:swf,allowfullscreen:true}});vid.inject(this.content);}});var HuluPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.attachment=options.attachment;return options;},onInit:function(){this.call("home","parse_hulu_url",{url:this.attachment.url},this.parseSuccess.bind(this),this.parseFail.bind(this));},parseSuccess:function(data){var swf="http://www.hulu.com/embed/"+data.id;var vid=new Swiff(swf,{id:swf,width:512,height:296,params:{movie:swf,allowfullscreen:true}});vid.inject(this.content);},parseFail:function(){this.closeContent();}});var PhotoPopupContent=new Class({Extends:PopupContent,strings:{loadingMessage:"Photo loading..."},onBeforeInit:function(options){this.attachment=options.attachment;return options;},onInit:function(){this.loadingMsg=new Element("div",{"class":"loading_message"}).adopt(new Element("div",{"class":"loading_text light","text":this.strings.loadingMessage}),new Element("div",{"class":"progress"})).inject(this.content);Logger().log(this.attachment.url);this.image=new Asset.image(this.attachment.url,{title:this.attachment.filename,onload:this.photoLoaded.bind(this)});},photoLoaded:function(){var imageW=this.image.width;var imageH=this.image.height;if(imageW>=imageH&&imageW>1000){imageH=(1000/imageW)*imageH;imageW=1000;}else{if(imageW<imageH&&imageH>1000){imageW=(1000/imageH)*imageW;imageH=1000;}}var w=imageW+20;var h=imageH+20;DomUtility.hide(this.loadingMsg);this.image.inject(this.content);this.resizePopup(w,h);this.reCenter();}});var PipioUpdatePopupContent=new Class({Extends:PopupContent,strings:{updateMessage:"A new version of Pip.io (v{0}) is available"},onBeforeInit:function(options){this.version=options.version;return options;},onInit:function(){new Element("div",{"class":"text_section centered light","text":String.format(this.strings.updateMessage,this.version)}).inject(this.content);this.actionButton=new ButtonMedium({displayName:"Reload",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.reload.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton)).inject(this.content);},reload:function(){this.actionButton.showProgress();window.location="/";}});var VimeoPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.attachment=options.attachment;return options;},onInit:function(){var swf="http://vimeo.com/moogaloop.swf?clip_id="+this.attachment.vimeoId+"&autoplay=1&fullscreen=1";Logger().log(swf);var vid=new Swiff(swf,{id:swf,width:425,height:350,params:{movie:swf,allowfullscreen:true}});vid.inject(this.content);}});var YoutubePopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.attachment=options.attachment;return options;},onInit:function(){var swf="http://www.youtube.com/v/"+this.attachment.youtubeId+"&rel=1&autoplay=1";var vid=new Swiff(swf,{id:swf,width:425,height:350,params:{movie:swf,allowfullscreen:true}});vid.inject(this.content);}});var VideoChat=new Class({Extends:Base,EventHandlers:["userSwitched","videoChatStart","videoChatReset","videoChatEnd","videoChatRequestReceived","videoChatRequestAccepted","videoChatAccept"],init:function(){window.sim=new VideoChatInterface();this.callTimeout=0;this.createVideoChatPopup();},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){window.sim.ChatReady();},userLoggedOut:function(){window.sim.ChatNotReady();},videoChatStart:function(user){if(!this.videoEnabled()){var name="video_chat";var title="Unable to Start Video Conference";var message="Your system does not support video conferencing";this.fireEvent("showAlert",name,title,message);return;}if(window.sim.SwfState==window.sim.SwfReady){this.fireEvent("sendVideoChatInvite",user);window.sim.CallInitiate(this.getPrivateUser().username,user.username);this.callTimeout=this.videoChatEnd.delay(20000,this);this.showVideoChatPopup(user);}},videoChatAccept:function(user,stratusId){this.showVideoChatPopup(user);window.sim.CallAccept(stratusId,this.getPrivateUser().username,user.username);this.fireEvent("sendVideoChatAccept",user);},videoChatReset:function(){Logger().log("reset video chat");this.popup.close();this.fireEvent("videoChatEnable",true);this.fireEvent("videoInUse",false);this.fireEvent("selfPresenceUpdate");$clear(this.callTimeout);},videoChatEnd:function(){Logger().log("reset video chat");window.sim.CallEnd();this.popup.close();this.fireEvent("videoChatEnable",true);this.fireEvent("videoInUse",false);this.fireEvent("selfPresenceUpdate");$clear(this.callTimeout);},videoChatRequestAccepted:function(username,stratusId){$clear(this.callTimeout);window.sim.CallAccepted(stratusId,username);},videoChatRequestReceived:function(username,stratusId){var user=this.getContact(username);var notif=new VideoChatNotification({user:user,stratusId:stratusId});this.fireEvent("notificationAdd","videoChat_request_"+username,notif);window.sim.CallReceived(username);},showVideoChatPopup:function(user){this.popup.show(user);},createVideoChatPopup:function(){this.popup=new VideoChatPopup({size:{x:400,y:340},resizable:false,dockable:false,noHide:true,closable:false,className:"pipioVideoChat"});var nav=new Nav({iconOptions:{iconName:"video_chat"},displayName:"Video Conference",closable:true});var content=new VideoChatPopupContent({});this.popup.addContent("video_chat",nav,content);}});var VideoChatInterface=new Class({Extends:Base,EventHandlers:[],init:function(){this.flexApp=null;this.SwfState=null;this.SwfError=-1;this.SwfNotLoaded=0;this.SwfLoaded=1;this.SwfNotReady=2;this.SwfReady=3;this.SwfCalling=4;this.SwfRinging=5;this.SwfConnecting=6;this.SwfConnected=7;this.SwfDisconnecting=8;},CallInitiate:function(nearUsername,farUsername){if(this.SwfState==this.SwfReady){this.flexApp.AttachOutgoingStream(nearUsername);this.SwfState=this.SwfCalling;}},CallReceived:function(farUsername){if(this.SwfState==this.SwfReady){this.SwfState=this.SwfRinging;}},CallAccept:function(farID,nearUsername,farUsername){if(this.SwfState==this.SwfRinging){this.SwfState=this.SwfConnecting;this.flexApp.AttachIncomingStream(farID,farUsername);this.flexApp.AttachOutgoingStream(nearUsername);this.SwfState=this.SwfConnected;}},CallReject:function(farUsername){if(this.SwfState==this.SwfRinging){this.SwfState=this.SwfDisconnecting;this.SwfState=this.SwfReady;}},CallAccepted:function(farID,farUsername){if(this.SwfState==this.SwfCalling){this.SwfState=this.SwfConnecting;this.flexApp.AttachIncomingStream(farID,farUsername);this.SwfState=this.SwfConnected;}},CallRejected:function(farID,farUsername){if(this.SwfState==this.SwfCalling){this.SwfState=this.SwfReady;}},CallEnd:function(farUsername){if((this.SwfState==this.SwfCalling)||(this.SwfState==this.SwfConnected)||(this.SwfState==this.SwfConnecting)){this.SwfState=this.SwfDisconnecting;this.flexApp.ClientReset();this.SwfState=this.SwfReady;}},ClientReset:function(){if(this.SwfState>=this.SwfReady){this.CallEnd();}this.flexApp.ClientReset();},GetLog:function(logging){if(this.SwfState>=this.SwfLoaded){if(logging==null){logging=true;}return this.flexApp.GetLog(logging);}},GetFarID:function(){id="";if(this.SwfState>=this.SwfLoaded){id=this.flexApp.GetFarID();}return id;},GetNearID:function(){id="";if(this.SwfState>=this.SwfLoaded){id=this.flexApp.GetNearID();}return id;},SetSpeakerVolume:function(volume){if(this.SwfState!=this.SwfError){if(volume<0){volume=0;}else{if(volume>1){volume=1;}}this.flexApp.SetSpeakerVolume(volume);}},SetMicGain:function(gain){if(this.SwfState!=this.SwfError){if(gain<0){gain=0;}else{if(gain>100){gain=100;}}this.flexApp.SetMicGain(gain);}},AudioMute:function(){if(this.SwfState==this.SwfConnected){this.flexApp.AudioMute();}},AudioStart:function(){if(this.SwfState==this.SwfConnected){this.flexApp.AudioStart();}},AudioToggle:function(){if(this.SwfState==this.SwfConnected){this.flexApp.AudioToggle();}},VideoPause:function(){if(this.SwfState==this.SwfConnected){this.flexApp.VideoPause();}},VideoStart:function(){if(this.SwfState==this.SwfConnected){this.flexApp.VideoStart();}},VideoToggle:function(){if(this.SwfState==this.SwfConnected){this.flexApp.VideoToggle();}},LoginError:function(){this.SwfState=this.SwfError;Logger().log("LoginError()");},LoginNotConnected:function(){this.SwfState=this.SwfNotReady;Logger().log("LoginNotConnected()");},LoginConnecting:function(){this.SwfState=this.SwfNotReady;Logger().log("LoginConnecting()");},LoginConnected:function(){this.SwfState=this.SwfReady;Logger().log("LoginConnected()");Logger().log("Got Stratus ID of "+this.GetNearID());},LoginDisconnecting:function(){this.SwfState=this.SwfNotReady;$("loginstate").fireEvent("burn","LoginDisconnecting()");},ChatError:function(){this.SwfState=this.SwfError;Logger().log("ChatError()");},ChatNotReady:function(){this.SwfState=this.SwfNotReady;Logger().log("ChatNotReady()");},ChatReady:function(){this.SwfState=this.SwfReady;Logger().log("ChatReady()");},ChatInitiated:function(){this.SwfState=this.SwfCalling;Logger().log("ChatInitiated()");},ChatEstablished:function(){this.SwfState=this.SwfConnected;Logger().log("ChatEstablished()");},AudioError:function(){this.SwfState=this.SwfError;Logger().log("AudioError()");},AudioNotReady:function(){this.SwfState=this.SwfNotReady;Logger().log("AudioNotReady()");},AudioReady:function(){Logger().log("AudioReady()");},AudioTransmitting:function(){Logger().log("AudioTransmitting()");},AudioPaused:function(){Logger().log("AudioPaused()");},VideoError:function(){this.SwfState=this.SwfError;Logger().log("VideoError()");},VideoNotReady:function(){this.SwfState=this.SwfNotReady;Logger().log("VideoNotReady()");},VideoReady:function(){Logger().log("VideoReady()");Logger().log("Camera found.");this.fireEvent("videoChatReset");},VideoTransmitting:function(){Logger().log("VideoTransmitting()");},VideoPaused:function(){Logger().log("VideoPaused()");},LogChanged:function(){},VideoChatLoaded:function(){this.SwfState=this.SwfLoaded;this.flexApp=$("videochat");},SpeakerVolumeChanged:function(){},MicGainChanged:function(){}});var VideoChatNotification=new Class({Extends:Notification,onBeforeInit:function(options){this.user=options.user;this.stratusId=options.stratusId;options.iconOptions={user:this.user};options.timeout=15000;options.hasActions=true;return options;},onInit:function(){this.acceptButton=new ButtonSmall({displayName:"Accept",className:"dark",action:"check"});this.ignoreButton=new ButtonSmall({displayName:"Ignore",className:"dark",action:"cross"});$(this.ignoreButton).addEvent("click",this.closeNotification.bind(this));$(this.acceptButton).addEvent("click",this.fireEvent.bind(this,["videoChatAccept",this.user,this.stratusId]));$(this.acceptButton).addEvent("click",this.closeNotification.bind(this));$(this.acceptButton).inject(this.actions);$(this.ignoreButton).inject(this.actions);},getText:function(){var el=new Element("div",{"class":"notification_text text11 light1"}).adopt(new Element("span",{"text":this.user.fullname})).appendText(" invited you to a video conference.");return el;}});var VideoChatPopup=new Class({Extends:Popup,onCreate:function(){this.shown=true;this.close();},close:function(){if(!this.shown){return;}this.left=this.popup.getStyle("left");this.popup.setStyle("left","-5000px");this.shown=false;},show:function(user){if(this.shown){return;}this.setTitleCustom(user);this.popup.setStyle("left",this.left);this.shown=true;this._select();},setTitleCustom:function(user){var nav=this.navs.get(this.currentContent);var icon=new Icon20({user:user});var titleText=new Element("div",{"class":"title_text","text":TextUtility.unescapeQuotes("Video Conference with "+user.fullname)});this.titleIcon=$(icon).replaces(this.titleIcon);this.titleText=titleText.replaces(this.titleText);},resetSwf:function(){this.contents.get(this.currentContent).resetSwf();}});var VideoChatPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){options.destroy=false;return options;},onInit:function(){this.videochatWrapper=new Element("div",{"id":"videochatWrapper"}).inject(this.content);this.actions=new Element("div",{"class":"actions"}).inject(this.content);this.endButton=new ButtonMedium({displayName:"End Conference",className:"dark",action:"cross"});$(this.endButton).inject(this.actions);$(this.endButton).addEvent("click",this.fireEvent.bind(this,["videoChatEnd"]));},onShow:function(){this.resetSwf();},resetSwf:function(){var flashvars={bridgeName:"videochat"};var params={menu:"false",allowscriptaccess:"always",play:"true",quality:"high",flashvars:"bridgeName=videochat",allowFullScreen:"true",wmode:"window"};var attributes={id:"videochat",name:"videochat"};swfobject.embedSWF("/swf/VideoChat.swf","videochatWrapper","400","300","10.0.0","expressInstall.swf",flashvars,params,attributes);},onHide:function(){}});var Appstore=new Class({Extends:App,onStart:function(){this.setupNav();},onStop:function(){},userLoggedIn:function(){},userLoggedOut:function(){this.stop();}});Appstore.implement({requests:[{name:"apps_get_all",url:"/api/apps/app/get_all"},{name:"app_create",params:["name","type","likes","state"],url:"/api/apps/app/create"},{name:"app_update",params:["app_id","name","type","likes","state"],url:"/api/apps/app/update"},{name:"app_likes_increment",params:["app_id"],url:"/api/apps/app/increment"},{name:"app_likes_decrement",params:["app_id"],url:"/api/apps/app/decrement"}]});Appstore.implement({setupNav:function(){this.navAdd(new Nav({iconOptions:{iconName:"updates"},displayName:"All Applications",name:"apps",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"apps","apps"])}));var menu=new AppstoreMenu({isDefault:true,closeFunc:this.stop.bind(this)});this.menuAdd("apps",menu);var content=new AppstoreContent({isDefault:true});this.contentAdd("apps",content);}});var AppstoreContent=new Class({Extends:Content,EventHandlers:["appInstalled","appUninstalled"],onBeforeInit:function(options){return options;},onInit:function(){this.loaded=false;this.loader=new ItemLoader({idField:"app_id",sortField:"name",sortAlpha:true,createElementFunc:AppstoreItemUtility.createAppstoreItem,emptyEl:new Element("div",{"class":"post empty","text":"There are no apps to install"}),loadingEl:new Element("div",{"class":"post empty","text":"Applications loading..."})});$(this.loader).inject(this.content);this.appsInstalled=UserUtility.getInstalledApps();},onShow:function(first){if(first){this.call("appstore","apps_get_all",null,this.loadAppsSuccess.bind(this),null);}this.loader.showLoading();},onHide:function(){},loadAppsSuccess:function(data){this.loader.hideLoading();if(!$defined(data.apps)||data.apps.length==0){}data.apps.each(function(app){if($defined(this.appsInstalled[app.app_id])){app.installed=true;}else{app.installed=false;}this.loader.process(app);},this);},appInstalled:function(data){if(!$defined(data.app_id)){return;}if($defined($("appstore_item_"+data.app_id))){$("appstore_item_"+data.app_id).addClass("installed");$("appstore_item_"+data.app_id).removeClass("uninstalled");}},appUninstalled:function(data){if(!$defined(data.app_id)){return;}if($defined($("appstore_item_"+data.app_id))){$("appstore_item_"+data.app_id).removeClass("installed");$("appstore_item_"+data.app_id).addClass("uninstalled");}}});var AppstoreMenu=new Class({Extends:Menu,EventHandlers:[],onBeforeInit:function(options){options.displayName="Pip.io App Store";return options;},onInit:function(){var appstoreText="You can install apps on your Pip.io account to add additional features.  More apps are coming very soon!";var appstoreText2="If you're a developer and interested in creating an app for the Pip.io platform, please contact developers@pip.io";new Element("div",{"class":"text_section light1","text":TextUtility.unescape(appstoreText)}).inject(this.menu);new Element("div",{"class":"text_section light1 text11","text":TextUtility.unescape(appstoreText2)}).inject(this.menu);}});var AppstoreItemUtility={createAppstoreItem:function(app){var el=ItemUtility.createPostBubble("post app",true);el.set("id","appstore_item_"+app.app_id);var installMethod=app.name+"Install";var uninstallMethod=app.name+"Uninstall";new Element("img",{"class":"app_icon","src":app.info.icon}).inject(el);new Element("div",{"class":"description","text":TextUtility.unescape(app.info.description)}).inject(el);var appname=new Element("div",{"class":"user_name clickable","text":TextUtility.unescape(app.display_name)}).inject(el);if(app.type==3){var installButton=new ButtonMedium({displayName:"Coming Soon!",action:"goto dark"});new Element("div",{"class":"actions"}).adopt($(installButton)).inject(el);}else{var uninstallButton=new ButtonMedium({className:"uninstall",displayName:"Uninstall Application",action:"goto dark"});$(uninstallButton).addEvent("click",pipio.dispatchEvent.bind(pipio,[uninstallMethod,app]));var installButton=new ButtonMedium({className:"install",displayName:"Install Application",action:"goto dark"});$(installButton).addEvent("click",pipio.dispatchEvent.bind(pipio,[installMethod,app]));if(app.installed){el.addClass("installed");}else{el.addClass("uninstalled");}new Element("div",{"class":"actions"}).adopt($(installButton),$(uninstallButton)).inject(el);}return el;}};var Contacts=new Class({Extends:App,EventHandlers:["userSwitched","userStatusUpdated","userStatusCleared","userOnline","userOffline","userPresenceReceived","selfPresenceReceived","selfPresenceUpdate","userVideoEnabled","showStatusUpdatePopup","userProfilePicUpdated","xmppConnected","xmppConnecting","xmppDisconnected","contactAdded","contactGroupAdded","contactDeleted","contactGroupDeleted","contactGroupMoved","contactRequestAdded","contactRequestDeleted","connectionRequestAccept","connectionRequestDelete","connectionRequestCreate","connectionDelete","userSubscribe","userUnsubscribe","showGroupPickerPopup","showCreateGroupPopup"],onStart:function(){this.setupNav();},onStop:function(){},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){this.start();this.initBuddylist();},userLoggedOut:function(){this.stop();},onCreate:function(){this.minButtonAction=new Element("div",{"class":"action pivot_up"});this.minButton=new Element("div",{"class":"button_nav"}).adopt(this.minButtonAction).inject("self");this.minButton.addEvent("click",this.toggleNav.bind(this));this.navHeader.destroy();this.connecting=new Element("div",{"class":"connect_state"}).adopt(new Element("div",{"class":"connect_text light2","text":"Connecting to Pip.io..."}),new Element("div",{"class":"progress"})).inject("nav");DomUtility.hide(this.navSection);},onDestroy:function(){this.connecting.destroy();},toggleNav:function(){if(!this.isExpanded){this.expand();}else{this.collapse();}},expand:function(){if(!this.isExpanded){DomUtility.expand(this.navWrapper);this.minButtonAction.addClass("pivot_up");this.minButtonAction.removeClass("pivot_down");this.isExpanded=true;}},collapse:function(){if(this.isExpanded){DomUtility.collapse(this.navWrapper);this.minButtonAction.addClass("pivot_down");this.minButtonAction.removeClass("pivot_up");this.isExpanded=false;}},xmppConnected:function(){DomUtility.show(this.navSection);DomUtility.hide(this.connecting);},xmppDisconnected:function(){DomUtility.show(this.connecting);DomUtility.hide(this.navSection);},xmppConnecting:function(){DomUtility.show(this.connecting);DomUtility.hide(this.navSection);},connectionDelete:function(username){this.call("contacts","connection_delete",{username:username},null,null);},connectionRequestCreate:function(username){this.call("contacts","connection_request_create",{username:username},null,null);},connectionRequestAccept:function(username){this.call("contacts","connection_request_accept",{username:username},null,null);},connectionRequestDelete:function(username){this.call("contacts","connection_request_delete",{username:username},null,null);},userSubscribe:function(username){this.call("contacts","user_subscribe",{username:username},null,null);},userUnsubscribe:function(username){this.call("contacts","user_unsubscribe",{username:username},null,null);},userProfilePicUpdated:function(data){if(!$defined(data.username)){return;}var user=this.getUser(data.username);var user_id=user.user_id;var username=user.username;var version=UserUtility.profilePicVersionGet(user_id);version++;UserUtility.profilePicVersionSet(user_id,version);user.profile_pic_16=user.profile_pic_16.split("?")[0]+"?"+version;user.profile_pic_20=user.profile_pic_20.split("?")[0]+"?"+version;user.profile_pic_26=user.profile_pic_26.split("?")[0]+"?"+version;user.profile_pic_32=user.profile_pic_32.split("?")[0]+"?"+version;user.profile_pic_42=user.profile_pic_42.split("?")[0]+"?"+version;user.profile_pic_60=user.profile_pic_60.split("?")[0]+"?"+version;user.profile_pic_100=user.profile_pic_100.split("?")[0]+"?"+version;user.profile_pic_200=user.profile_pic_200.split("?")[0]+"?"+version;$$(".profile_pic_16_"+username).each(function(el){el.set("src",user.profile_pic_16);});$$(".profile_pic_20_"+username).each(function(el){el.set("src",user.profile_pic_20);});$$(".profile_pic_60_"+username).each(function(el){el.set("src",user.profile_pic_60);});$$(".profile_pic_26_"+username).each(function(el){el.set("src",user.profile_pic_26);});$$(".profile_pic_32_"+username).each(function(el){el.set("src",user.profile_pic_32);});$$(".profile_pic_42_"+username).each(function(el){el.set("src",user.profile_pic_42);});$$(".profile_pic_100_"+username).each(function(el){el.set("src",user.profile_pic_100);});$$(".profile_pic_200_"+username).each(function(el){el.set("src",user.profile_pic_200);});},destroyApp:function(){this.contents.each(function(content){content.destroy();});this.contents.empty();this.menus.each(function(menu){menu.destroy();});this.menus.empty();this.navs.each(function(nav){nav.destroy();});this.navs.empty();this.navHeader.destroy();this.nav.destroy();this.navSection.destroy();this.fireEvent("appClose",this.appId);if($defined(this.onDestroy)){this.onDestroy();}}});Contacts.implement({initBuddylist:function(){this.contacts=$H();this.contactRequests=$H();this.groups=$H();this.css=new CSS();this.getGroups().each(function(group){this.groupAdd(group);},this);this.getContacts().each(function(user){this.contactAdd(user);},this);this.getContactRequests().each(function(user){this.contactRequestAdd(user);},this);},contactAdded:function(user){if(this.contacts.has(user.username)){return;}this.contactAdd(user);},contactDeleted:function(username){this.contactDelete(username);},contactRequestAdded:function(user){if(this.contactRequests.has(user.username)){return;}this.contactRequestAdd(user);},contactRequestDeleted:function(username){if(!this.contactRequests.has(username)){return;}this.contactRequestDelete(username);},contactGroupAdded:function(group){if(this.groups.has(group.group_id)){return;}this.groupAdd(group);},contactGroupDeleted:function(group){if(!this.groups.has(group.group_id)){return;}this.groupDelete(group);},contactGroupMoved:function(user){this.contactDelete(user.username);Logger().log("contactGroupMoved "+user.username+" group_id "+user.group_id);this.contactAdd(user);},selfPresenceUpdate:function(show){if($defined(show)&&this.getPrivateUser().show==show){return;}if($defined(show)){this.getPrivateUser().show=show;}this.p.xmpp.updateSelfPresence(this.getPrivateUser().show,true);},userVideoEnabled:function(username,videoEnabled){if(this.contacts.has(username)){this.contacts.get(username).videoEnabled(videoEnabled);}},userStatusUpdated:function(data){if($defined(this.contacts)&&this.contacts.has(data.username)){this.contacts.get(data.username).statusMsgUpdated(data.status_message.status);}},userStatusCleared:function(data){if($defined(this.contacts)&&this.contacts.has(data.username)){this.contacts.get(data.username).statusMsgUpdated("");}},userOnline:function(username){if(this.contacts.has(username)){var user=this.getContact(username);if(user.status_message.status==""){this.contacts.get(username).online(false);}else{this.contacts.get(username).online(true);}if(!user.online){user.online=true;}}},userOffline:function(username){if(this.contacts.has(username)){this.contacts.get(username).offline();var user=this.getContact(username);if(user.online){user.online=false;}}},userPresenceReceived:function(username,show,online){if(online){this.userOnline(username);if(show==""){this.setUserOnlineClass(username);}else{if(show=="away"){this.setUserAwayClass(username);}else{if(show=="xa"){this.setUserIdleClass(username);}else{if(show=="dnd"){this.userOffline(username);this.setUserOfflineClass(username);}}}}}else{this.userOffline(username);this.setUserOfflineClass(username);}this.getContact(username).show=show;},selfPresenceReceived:function(show,online){if(online){if(show==""){this.setUserOnlineClass(this.getPrivateUser().username);}else{if(show=="away"){this.setUserAwayClass(this.getPrivateUser().username);}else{if(show=="xa"){this.setUserIdleClass(this.getPrivateUser().username);}else{if(show=="dnd"){this.setUserOfflineClass(this.getPrivateUser().username);}}}}}else{this.setUserOfflineClass(this.getPrivateUser().username);}},setUserOnlineClass:function(username){this.css.add_rule(".online_status_"+username,{"border-color":"#42a409 !important"}).refresh();},setUserIdleClass:function(username){this.css.add_rule(".online_status_"+username,{"border-color":"#cc8513 !important"}).refresh();},setUserAwayClass:function(username){this.css.add_rule(".online_status_"+username,{"border-color":"#b0191f !important"}).refresh();},setUserOfflineClass:function(username){this.css.remove_rule(".online_status_"+username);this.css.refresh();}});Contacts.implement({requests:[{name:"connection_group_create",params:["name"],url:"/api/user/connection/group/create"},{name:"connection_group_delete",params:["group_id"],url:"/api/user/connection/group/delete"},{name:"connection_group_move",params:["username","group_id"],url:"/api/user/connection/group/move"},{name:"connection_delete",params:["username"],url:"/api/user/connection/delete"},{name:"connection_request_create",params:["username"],url:"/api/user/connection/request/create"},{name:"connection_request_accept",params:["username"],url:"/api/user/connection/request/accept"},{name:"connection_request_delete",params:["username"],url:"/api/user/connection/request/delete"},{name:"user_subscribe",params:["username"],url:"/api/user/stream/subscribe"},{name:"user_unsubscribe",params:["username"],url:"/api/user/stream/unsubscribe"},{name:"search_user",params:["query"],url:"/api/user/search/user"},{name:"search_email",params:["email_address","password"],url:"/api/user/search/email"},{name:"invite_create",params:["email","message"],url:"/api/user/invite/create"}]});Contacts.implement({setupNav:function(){this.navAdd(new Nav({iconOptions:{iconName:"contacts",iconAction:"add"},hasSubnavs:true,onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"contact_requests","contact_requests"]),displayName:"Contact Requests",defaultClosed:true,name:"requests"}));var contactRequestsMenu=new ContactRequestsMenu({displayName:"Contact Requests"});this.menuAdd("contact_requests",contactRequestsMenu);var content=new ContactRequestsContent();this.contentAdd("contact_requests",content);this.navAdd(new Nav({iconOptions:{iconName:"search"},displayName:"Search Users...",onClick:this.fireEvent.bind(this,["searchUserShow"]),name:"search_user",bottom:true}));this.navAdd(new Nav({iconOptions:{iconName:"contacts",iconAction:"add"},displayName:"Create New Group...",onClick:this.fireEvent.bind(this,["showCreateGroupPopup"]),name:"new_group",bottom:true}));},groupAdd:function(group){var groupNav=new GroupNav({group:group,onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"group_"+group.group_id,"menu_"+group.group_id])});this.navAdd(groupNav);this.groups.set(group.group_id,groupNav);if(group.group_id!=0){var groupMenu=new GroupMenu({displayName:group.name,group:group});}else{var groupMenu=new GroupMenu({displayName:group.name,group:group,unsorted:true});}this.menuAdd("menu_"+group.group_id,groupMenu);var content=new GroupContent({group:group});this.contentAdd("group_"+group.group_id,content);},groupDelete:function(group){this.navDelete("group_"+group.group_id);this.menuClose("menu_"+group.group_id);this.contentClose("group_"+group.group_id);},contactAdd:function(user){var contactNav=new ContactNav({user:user});this.navAdd(contactNav);this.contacts.set(user.username,contactNav);},contactDelete:function(username){if(!this.contacts.has(username)){return;}this.contacts.get(username).destroy();this.navDelete("contact_"+username);this.contacts.erase(username);},contactRequestAdd:function(user){var contactNav=new ContactRequestNav({user:user});this.navAdd(contactNav);this.contactRequests.set(user.username,contactNav);this.fireEvent("alertAdd","1_requests");},contactRequestDelete:function(username){if(!this.contactRequests.has(username)){return;}Logger().log("deleting contact request nav "+username);this.contactRequests.get(username).destroy();this.contactRequests.erase(username);this.navDelete("contact_request_"+username);this.fireEvent("alertClear","1_requests",1);},showStatusUpdatePopup:function(){if($defined(this.statusUpdatePopup)){this.statusUpdatePopup.close();}this.createStatusUpdatePopup();},createStatusUpdatePopup:function(){this.statusUpdatePopup=new Popup({size:{x:350,y:100},resizable:false,dockable:false,className:"statusUpdate",onClose:this.destroyStatusUpdatePopup.bind(this)});var nav=new Nav({iconOptions:{user:this.getPrivateUser()},displayName:"Update Your Status",closable:true});var content=new StatusUpdatePopupContent({user:this.getPrivateUser()});this.statusUpdatePopup.addContent("status_update",nav,content);},destroyStatusUpdatePopup:function(){this.statusUpdatePopup=null;},showGroupPickerPopup:function(user){if($defined(this.groupPickerPopup)){this.groupPickerPopup.close();}this.createGroupPickerPopup(user);},createGroupPickerPopup:function(user){this.groupPickerPopup=new Popup({size:{x:200,y:250},resizable:false,dockable:false,className:"groupPicker",onClose:this.destroyGroupPickerPopup.bind(this)});var nav=new Nav({iconOptions:{user:user},displayName:"Edit "+TextUtility.unescape(user.fullname),closable:true});var content=new GroupPickerPopupContent({user:user});this.groupPickerPopup.addContent("group_picker",nav,content);},destroyGroupPickerPopup:function(){this.groupPickerPopup=null;},showCreateGroupPopup:function(){if($defined(this.createGroupPopup)){this.createGroupPopup.close();}this.createCreateGroupPopup();},createCreateGroupPopup:function(){this.createGroupPopup=new Popup({size:{x:350,y:74},resizable:false,dockable:false,className:"createGroup",onClose:this.destroyCreateGroupPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"contacts",iconAction:"add"},displayName:"Create New Group",closable:true});var content=new CreateGroupPopupContent({});this.createGroupPopup.addContent("create_group",nav,content);},destroyCreateGroupPopup:function(){this.createGroupPopup=null;}});var ContactRequestsContent=new Class({Extends:Content,EventHandlers:["contactRequestAdded","contactRequestDeleted"],onInit:function(){this.loaded=false;this.loader=new ItemLoader({idField:"username",sortField:"last_name",sortAlpha:true,createElementFunc:ContactItemUtility.createContactRequestItem,emptyEl:new Element("div",{"class":"post empty","text":"You do not have any contact requests"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.populateContacts();}},onHide:function(){},populateContacts:function(){var contacts=this.getContactRequests();contacts.each(function(user){this.loader.process(user);},this);this.loaded=true;},contactRequestAdded:function(user){this.loader.process(user);},contactRequestDeleted:function(username){this.loader.remove(username);}});var GroupContent=new Class({Extends:Content,EventHandlers:["contactAdded","contactDeleted","contactGroupMoved"],onBeforeInit:function(options){this.group=options.group;return options;},onInit:function(){this.loaded=false;this.loader=new ItemLoader({idField:"user_id",sortField:"last_name",sortAlpha:true,createElementFunc:ContactItemUtility.createContactItem,emptyEl:new Element("div",{"class":"post empty","text":"There are no contacts in this group"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.populateContacts();}},onHide:function(){},populateContacts:function(){var contacts=this.group.users;contacts.each(function(user){this.loader.process(user);},this);this.loaded=true;},contactAdded:function(user){if(!this.loaded||user.group_id!=this.group.group_id){return;}this.loader.process(user);},contactDeleted:function(username,group_id){if(!this.loaded||group_id!=this.group.group_id){return;}var user=this.getUser(username);this.loader.remove(user.user_id);},contactGroupMoved:function(user){if(user.group_id==this.group.group_id){this.loader.process(user);}else{this.loader.remove(user.user_id);}}});var ContactRequestsMenu=new Class({Extends:Menu,strings:{contactRequestsText:"These users requested to add you as their contact"},onInit:function(){new Element("div",{"class":"text_section light1","text":this.strings.contactRequestsText}).inject(this.menu);}});var GroupMenu=new Class({Extends:Menu,strings:{groupMenuText:'These are contacts in your group "{0}"',unsortedGroupMenuText:"These are contacts that have not been added to a group"},onBeforeInit:function(options){this.group=options.group;this.unsorted=options.unsorted||false;return options;},onInit:function(){if(this.unsorted){new Element("div",{"class":"text_section light1","text":String.format(this.strings.unsortedGroupMenuText)}).inject(this.menu);}else{new Element("div",{"class":"text_section light1","text":String.format(this.strings.groupMenuText,TextUtility.unescape(this.group.name))}).inject(this.menu);}if(!this.unsorted){this.deleteButton=new ButtonMedium({displayName:"Delete Group",className:"dark",action:"cross"});var name="groupDelete_"+this.group.group_id;var title="Delete "+this.group.name;var message="Are you sure you want to delete the group "+this.group.name+"?";var func=this.deleteGroup.bind(this);$(this.deleteButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showConfirmation",name,title,message,func]));new Element("div",{"class":"button_section"}).adopt($(this.deleteButton)).inject(this.menu);}},deleteGroup:function(){var params={group_id:this.group.group_id};this.call("contacts","connection_group_delete",params,this.deleteGroupSuccess.bind(this),this.deleteGroupFail.bind(this));this.deleteButton.showProgress();},deleteGroupSuccess:function(data){this.deleteButton.hideProgress();},deleteGroupFail:function(){this.deleteButton.hideProgress();}});var ContactNav=new Class({Extends:Nav,onBeforeInit:function(options){this.user=options.user;this.isOnline=false;options.name="contact_"+this.user.username;options.iconOptions={user:this.user};options.onClick=this.fireEvent.bind(this,["chatStart",this.user.username]);options.displayName=this.user.fullname;options.className="contact";options.parentName="group_"+this.user.group_id;return options;},onInit:function(){$(this.icon).destroy();this.icon=new Icon20(this.iconOptions);$(this.icon).inject(this.nav);$(this.icon).addEvent("click",this.openUser.bindWithEvent(this));this.videoChatIcon=new Icon({iconName:"video_chat"});$(this.videoChatIcon).inject(this.nav);$(this.videoChatIcon).addEvent("click",this.videoChatStart.bindWithEvent(this));var statusMsg=($defined(this.user.status_message)&&$defined(this.user.status_message.status))?this.user.status_message.status:"";this.statusMsg=new Element("div",{"class":"status_msg status_msg_"+this.user.username,"text":TextUtility.unescape(statusMsg)}).inject(this.nav);if(this.user.online){if(statusMsg==""){this.online(false);}else{this.online(true);}}},statusMsgUpdated:function(statusMsg){this.statusMsg.set("text",TextUtility.unescape(statusMsg));if(this.isOnline){if(statusMsg==""){DomUtility.setHeight(this.nav,22);}else{DomUtility.setHeight(this.nav,36);}}},online:function(hasStatus){if(hasStatus){DomUtility.expandFade(this.nav,36);}else{DomUtility.expandFade(this.nav,22);}this.navWrapper.addClass("online");this.isOnline=true;},offline:function(){DomUtility.collapseFade(this.nav);this.navWrapper.removeClass("online");this.isOnline=false;},videoEnabled:function(enabled){if(enabled){this.nav.addClass("videoEnabled");}else{this.nav.removeClass("videoEnabled");}},openUser:function(e){e.stopPropagation();this.fireEvent("showUser",this.user);},videoChatStart:function(e){e.stopPropagation();this.fireEvent("videoChatStart",this.user);}});var ContactRequestNav=new Class({Extends:Nav,onBeforeInit:function(options){this.user=options.user;options.name="contact_request_"+this.user.username;options.iconOptions={user:this.user};options.onClick=this.fireEvent.bind(this,["showUser",this.user]);options.displayName=this.user.fullname;options.className="contact request";options.parentName="requests";return options;},onInit:function(){$(this.icon).destroy();this.icon=new Icon20(this.iconOptions);$(this.icon).inject(this.nav);}});var GroupNav=new Class({Extends:Nav,onBeforeInit:function(options){this.group=options.group;options.name="group_"+this.group.group_id;options.iconOptions={iconName:"contacts"};options.displayName=this.group.name;options.className="group_nav";options.hasSubnavs=true;return options;},onInit:function(){this.onlineCount=new Element("div",{"class":"online_count text11 light2"}).inject(this.nav);DomUtility.hide(this.onlineCount);},onExpand:function(){this.hideOnlineCount();},onCollapse:function(){this.showOnlineCount();},showOnlineCount:function(){this.onlineCount.set("text",this.getOnlineCount());DomUtility.show(this.onlineCount);},hideOnlineCount:function(){DomUtility.hide(this.onlineCount);},getOnlineCount:function(){return this.subnavItems.getChildren(".online").length+"/"+this.subnavItems.getChildren().length;}});var SubscribersNav=new Class({Extends:Nav,onBeforeInit:function(options){this.users=$H();options.name="subscribers";options.iconOptions={iconName:"broadcast"};options.displayName="Subscribers";options.className="subscribers_nav";options.hasSubnavs=true;return options;},onInit:function(){this.clear=new Element("div",{"style":"clear: both"});this.list=new Element("div",{"class":"menu_list"}).adopt(this.clear).inject(this.subnavs);},addUsers:function(users){$splat(users).each(function(user){user=UserUtility.processUser(user);if(!this.users.has(user.username)){var pic=ItemUtility.createProfilePic(user,"16a");pic.addEvent("click",this.fireEvent.bind(this,["showUser",user]));pic.inject(this.clear,"before");this.users.set(user.username,pic);}},this);},removeUser:function(username){if(!this.users.has(username)){return;}this.users.get(username).destroy();this.users.erase(username);}});var SubscriptionsNav=new Class({Extends:Nav,onBeforeInit:function(options){this.users=$H();options.name="subscriptions";options.iconOptions={iconName:"broadcast"};options.displayName="Subscriptions";options.className="subscribers_nav";options.hasSubnavs=true;return options;},onInit:function(){this.clear=new Element("div",{"style":"clear: both"});this.list=new Element("div",{"class":"menu_list"}).adopt(this.clear).inject(this.subnavs);},addUsers:function(users){$splat(users).each(function(user){user=UserUtility.processSource(user);if(!this.users.has(user.username)){var pic=ItemUtility.createProfilePic(user,"16a");if($defined(user.user_id)){pic.addEvent("click",this.fireEvent.bind(this,["showUser",user]));}else{if($defined(user.room_id)){pic.addEvent("click",this.fireEvent.bind(this,["showRoom",user]));}}pic.inject(this.clear,"before");this.users.set(user.username,pic);}},this);},removeUser:function(username){if(!this.users.has(username)){return;}this.users.get(username).destroy();this.users.erase(username);}});var ContactPickerPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.contacts=options.contacts;this.contactAddFunc=options.contactAddFunc;this.hasGroups=options.hasGroups||true;if(this.hasGroups){this.groups=options.groups;this.groupAddFunc=options.groupAddFunc;}this.hasAllContacts=options.hasAllContacts||true;if(this.hasAllContacts){this.allContactsAddFunc=options.allContactsAddFunc;}return options;},onInit:function(){this.css=new CSS();this.input=new Element("input",{"type":"text","maxlength":50});this.input.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"textarea_wrapper"}).adopt(this.input).inject(this.content);this.list=new Element("div",{"class":"itemList"}).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Close",className:"dark",action:"cross"});new Element("div",{"class":"actions"}).adopt($(this.closeButton)).inject(this.content);$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.insertContacts();this.scroll=new Fx.Scroll(this.list);},insertContacts:function(){if(this.hasAllContacts){var el=ShareBoxUtility.createAllContactsPickerItem();el.addEvent("click",this.addAllContacts.bind(this,[el]));el.inject(this.list);this.insertSeperator();}if(this.hasGroups){this.groups.each(function(group){var el=ShareBoxUtility.createGroupPickerItem(group);el.addEvent("click",this.addGroup.bind(this,[group,el]));el.inject(this.list);},this);this.insertSeperator();}this.contacts.getValues().sort(DataUtility.sortUsers).each(function(user){var el=ShareBoxUtility.createContactPickerItem(user);el.addEvent("click",this.addContact.bind(this,[user,el]));el.inject(this.list);},this);},insertSeperator:function(){new Element("div",{"class":"listItem seperator"}).inject(this.list);},addAllContacts:function(el){this.allContactsAddFunc();el.destroy();this.closeContent();},addContact:function(user,el){this.contactAddFunc(user);el.destroy();},addGroup:function(group,el){this.groupAddFunc(group);el.destroy();},inputKeyUp:function(e){if(e.key=="esc"){e.target.value="";}var val=e.target.value.trim().toLowerCase();if(val.length<2){this.list.removeClass("search");return;}this.list.addClass("search");if($defined(this.lastSelector)){this.css.remove_rule(this.lastSelector);}var selector=".listItem[val1^='"+val+"'], .listItem[val2^='"+val+"']";this.css.add_rule(selector,{"display":"block !important"}).refresh();this.lastSelector=selector;},focus:function(){this.input.focus.delay(500,this.input);},onClose:function(){if($defined(this.lastSelector)){this.css.remove_rule(this.lastSelector).refresh();}},onShow:function(){if($defined(this.scrollY)){this.scroll.set(0,this.scrollY);}this.focus();},onHide:function(){if($defined(this.list)){this.scrollY=this.list.getScroll().y;}}});var CreateGroupPopupContent=new Class({Extends:PopupContent,strings:{groupNameLabel:"Group Name:",errorMessage:"There was an error creating this group"},onInit:function(){this.groupNameInput=new Element("input",{"type":"text","maxlength":"32"});this.groupNameInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.groupNameLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.groupNameInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Create Group",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.createGroup.bind(this));this.message=new Element("div",{"class":"message error"});this.actions=new Element("div",{"class":"actions"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key=="enter"){if(this.groupNameInput.value.trim()!=""){this.createGroup();}}},createGroup:function(){var name=this.groupNameInput.value.trim();var params={name:name};this.call("contacts","connection_group_create",params,this.createGroupSuccess.bind(this),this.createGroupFail.bind(this));this.actionButton.showProgress();},createGroupSuccess:function(){this.actionButton.hideProgress();this.closeContent();},createGroupFail:function(){this.actionButton.hideProgress();this.closeContent();},onShow:function(){this.focus();},focus:function(){this.groupNameInput.focus.delay(500,this.groupNameInput);}});var GroupPickerPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.user=options.user;return options;},onInit:function(){this.list=new Element("div",{"class":"itemList"}).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Close",className:"dark",action:"cross"});new Element("div",{"class":"actions"}).adopt($(this.closeButton)).inject(this.content);$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.insertGroups();},insertGroups:function(){var groups=this.getGroups();groups.each(function(group){var el=ShareBoxUtility.createGroupPickerItem(group);if(this.user.group_id==group.group_id){el.addClass("on");this.selectedEl=el;}else{el.addEvent("click",this.groupMove.bind(this,[group,el]));}el.inject(this.list);},this);},groupMove:function(group,el){var params={username:this.user.username,group_id:group.group_id};this.call("contacts","connection_group_move",params,this.groupMoveSucess.bind(this),this.groupMoveFail.bind(this));this.selectedEl.removeClass("on");new Element("div",{"class":"progress"}).inject(el);},groupMoveSucess:function(data){this.closeContent();},groupMoveFail:function(){this.closeContent();}});var StatusUpdatePopupContent=new Class({Extends:PopupContent,onInit:function(){this.statusInput=new Element("textarea",{"maxlength":500});this.statusInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"textarea_wrapper"}).adopt(this.statusInput).inject(this.content);this.cancelButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.cancelButton).addEvent("click",this.closeContent.bind(this));this.updateButton=new ButtonMedium({displayName:"Update Status",className:"dark",action:"check"});$(this.updateButton).addEvent("click",this.updateStatus.bind(this));new Element("div",{"class":"actions"}).adopt($(this.updateButton),$(this.cancelButton)).inject(this.content);},onShow:function(){this.focus();},focus:function(){this.statusInput.focus.delay(500,this.statusInput);},inputKeyUp:function(e){if(e.key=="enter"){var msg=e.target.value.trim();if(msg==""){return;}this.updateStatus();}},updateStatus:function(){var params={username:"",body:this.statusInput.value.trim(),res:this.getSession()};this.call("pipio","publish_status",params,this.updateStatusSuccess.bind(this),this.updateStatusFail.bind(this));this.updateButton.showProgress();},updateStatusSuccess:function(){this.closeContent();},updateStatusFail:function(){alert("There was an error updating your status!");}});var ContactItemUtility={createContactItem:function(user){var el=ItemUtility.createPostBubble("post contact",true);ItemUtility.createProfilePic(user,60).inject(el);var header=new Element("div",{"class":"heading"}).inject(el);var username=new Element("span",{"class":"user_name clickable","text":TextUtility.unescape(user.fullname)}).inject(header);username.addEvent("click",pipio.dispatchEvent.bind(pipio,["showUser",user]));var status=new Element("span",{"class":"status status_msg_"+user.username}).inject(header);if(user.status_message.status.trim()!=""){status.set("text"," "+TextUtility.unescape(user.status_message.status.trim()));}var viewButton=new ButtonMedium({displayName:"View Profile",action:"goto dark"});$(viewButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showUser",user]));var editButton=new ButtonMedium({displayName:"Edit Group",action:"status dark"});$(editButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showGroupPickerPopup",user]));var deleteButton=new ButtonMedium({displayName:"Delete Contact",action:"cross"});var name="contactDelete_"+user.username;var title="Delete "+user.fullname;var message="Are you sure you want to delete "+user.fullname+" from your contacts?";var func=pipio.dispatchEvent.bind(pipio,["connectionDelete",user.username]);$(deleteButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showConfirmation",name,title,message,func]));new Element("div",{"class":"actions"}).adopt($(viewButton),$(editButton),$(deleteButton)).inject(el);return el;},createContactRequestItem:function(user){var el=ItemUtility.createPostBubble("post contact",true);ItemUtility.createProfilePic(user,60).inject(el);var header=new Element("div",{"class":"heading"}).inject(el);var username=new Element("span",{"class":"user_name clickable","text":TextUtility.unescape(user.fullname)}).inject(header);username.addEvent("click",pipio.dispatchEvent.bind(pipio,["showUser",user]));var status=new Element("span",{"class":"status status_msg_"+user.username}).inject(header);if(user.status_message.status.trim()!=""){status.set("text"," "+TextUtility.unescape(user.status_message.status.trim()));}var viewButton=new ButtonMedium({displayName:"View Profile",action:"goto dark"});$(viewButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showUser",user]));var acceptButton=new ButtonMedium({displayName:"Accept Request",action:"check"});$(acceptButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["connectionRequestAccept",user.username]));var deleteButton=new ButtonMedium({displayName:"Delete Request",action:"cross"});$(deleteButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["connectionRequestDelete",user.username]));new Element("div",{"class":"actions"}).adopt($(viewButton),$(acceptButton),$(deleteButton)).inject(el);return el;},createRoomMemberItemFactory:function(room,isAdmin){return function(user){return ContactItemUtility.createRoomMemberItem.run([user,room,isAdmin]);};},createRoomMemberItem:function(user,room,isAdmin){var el=ItemUtility.createPostBubble("post contact",true);ItemUtility.createProfilePic(user,60).inject(el);var header=new Element("div",{"class":"heading"}).inject(el);var username=new Element("span",{"class":"user_name clickable","text":TextUtility.unescape(user.fullname)}).inject(header);username.addEvent("click",pipio.dispatchEvent.bind(pipio,["showUser",user]));var status=new Element("span",{"class":"status status_msg_"+user.username}).inject(header);if(user.status_message.status.trim()!=""){status.set("text"," "+TextUtility.unescape(user.status_message.status.trim()));}if(isAdmin&&user.user_id!=pipio.currentUser.user_id){var viewButton=new ButtonMedium({displayName:"View Profile",action:"goto dark"});$(viewButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showUser",user]));var removeButton=new ButtonMedium({displayName:"Remove Member",action:"cross"});$(removeButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["feedRoomKick",user.username,room.username]));new Element("div",{"class":"actions"}).adopt($(viewButton),$(removeButton)).inject(el);}else{var viewButton=new ButtonMedium({displayName:"View Profile",action:"goto dark"});$(viewButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showUser",user]));new Element("div",{"class":"actions"}).adopt($(viewButton)).inject(el);}return el;},createRoomSubscriberItem:function(user){var el=ItemUtility.createPostBubble("post contact",true);ItemUtility.createProfilePic(user,60).inject(el);var header=new Element("div",{"class":"heading"}).inject(el);var username=new Element("span",{"class":"user_name clickable","text":TextUtility.unescape(user.fullname)}).inject(header);username.addEvent("click",pipio.dispatchEvent.bind(pipio,["showUser",user]));var status=new Element("span",{"class":"status status_msg_"+user.username}).inject(header);if(user.status_message.status.trim()!=""){status.set("text"," "+TextUtility.unescape(user.status_message.status.trim()));}var viewButton=new ButtonMedium({displayName:"View Profile",action:"goto dark"});$(viewButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showUser",user]));new Element("div",{"class":"actions"}).adopt($(viewButton)).inject(el);return el;},createRoomRequestItemFactory:function(room){return function(user){return ContactItemUtility.createRoomRequestItem.run([user,room]);};},createRoomRequestItem:function(user,room){var el=ItemUtility.createPostBubble("post contact",true);ItemUtility.createProfilePic(user,60).inject(el);var header=new Element("div",{"class":"heading"}).inject(el);var username=new Element("span",{"class":"user_name clickable","text":TextUtility.unescape(user.fullname)}).inject(header);username.addEvent("click",pipio.dispatchEvent.bind(pipio,["showUser",user]));var status=new Element("span",{"class":"status status_msg_"+user.username}).inject(header);if(user.status_message.status.trim()!=""){status.set("text"," "+TextUtility.unescape(user.status_message.status.trim()));}var viewButton=new ButtonMedium({displayName:"View Profile",action:"goto dark"});$(viewButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showUser",user]));var removeButton=new ButtonMedium({displayName:"Reject Member",action:"cross"});$(removeButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["feedRoomRequestDelete",user.username,room.username]));var acceptButton=new ButtonMedium({displayName:"Accept Member",action:"check"});$(acceptButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["feedRoomRequestAccept",user.username,room.username]));new Element("div",{"class":"actions"}).adopt($(viewButton),$(removeButton),$(acceptButton)).inject(el);return el;}};var Facebook=new Class({Extends:App,EventHandlers:["facebookInstall","facebookUninstall","facebookShowUserFeed","facebookShowUserAlbums","facebookTaggedPhotos","userSwitched"],parseOptions:function(options){this.settings=options.settings;},userSwitched:function(){if(!this.isLoggedIn()){this.userLoggedOut();}},userLoggedOut:function(){FB.Connect.logout();this.stop();},onStart:function(){this.appId=5;FB_RequireFeatures(["Connect"],function(){FB.Facebook.init("d29a9328a49d798da896066499c0d9d8","/xd_receiver.htm",{"forceBrowserPopupForLogin":true,"doNotUseCachedConnectState":true});});this.appsInstalled=UserUtility.getInstalledApps();if($defined(this.appsInstalled[this.appId])){this.external_user_id=this.appsInstalled[this.appId];}this.setupNav();this.albums=$H();},onStop:function(){},userLoggedIn:function(){},userLoggedOut:function(){this.stop();},facebookInstall:function(){this.facebookInstallPopup=new Popup({size:{x:350,y:80},resizable:false,dockable:false,className:"appInstall",onClose:this.destroyFacebookInstallPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"facebook"},displayName:"Install Facebook",closable:true});var content=new FacebookInstallPopupContent({});this.facebookInstallPopup.addContent("facebook_install",nav,content);},destroyFacebookInstallPopup:function(){this.facebookInstallPopup=null;},facebookUninstall:function(app){this.call("facebook","facebook_disable",null,this.facebookUninstallSuccess.bind(this),null);},facebookUninstallSuccess:function(data){this.stop();},facebookShowUserFeed:function(user){this.userAdd(user);},facebookShowUserAlbums:function(user){this.userAlbumsAdd(user);},facebookTaggedPhotos:function(uid){var newAlbum=new Album({id:uid});this.albums.set(uid,newAlbum);var params={user_id:uid,aid:""};this.call("facebook","facebook_photos",params,this.facebookTaggedPhotosSuccess.bind(this),this.facebookTaggedPhotosFail.bind(this));},facebookTaggedPhotosSuccess:function(data){if(!$defined(data.photos)){return;}var album=this.albums.get(data.uid);data.photos.each(function(photo){album.addPhoto(photo.pid,photo.src,photo.src_big,photo.caption);photo.auid=photo.uid;},this);var photo=album.getPhoto(data.photos[0].pid);this.fireEvent("viewAlbum",album,photo,data.uid);},facebookTaggedPhotosFail:function(data){}});Facebook.implement({requests:[{name:"facebook_enable",params:["sync_posts","session_key","uid"],url:"/api/app/facebook/account/enable"},{name:"facebook_disable",url:"/api/app/facebook/account/disable"},{name:"facebook_friends_info",params:["uid","limit","sort_field","number"],url:"/api/app/facebook/friends/info"},{name:"facebook_newsfeed_load",params:["start_time","end_time"],url:"/api/app/facebook/newsfeed/load"},{name:"facebook_user_show",params:["user_id"],url:"/api/app/facebook/user/profile_load"},{name:"facebook_user_feed",params:["user_id","start_time","end_time"],url:"/api/app/facebook/user/newsfeed_load"},{name:"facebook_settings_update",params:["key","value"],url:"/api/app/facebook/settings/update"},{name:"facebook_albums",params:["user_id","num_photos"],url:"/api/app/facebook/albums/get"},{name:"facebook_photos",params:["user_id","aid"],url:"/api/app/facebook/photos/get"},{name:"facebook_notification_send",params:["user_id","message"],url:"/api/app/facebook/notification/send"},{name:"facebook_post_text",params:["body","post_id","target_id"],url:"/api/app/facebook/text/item_create"},{name:"facebook_post_link",params:["body","url","post_id","target_id"],url:"/api/app/facebook/link/item_create"},{name:"facebook_post_photo",params:["body","photo","post_id","target_id"],url:"/api/app/facebook/photo/item_create",multipart:true},{name:"facebook_comments",params:["post_id"],url:"/api/app/facebook/comments/get"},{name:"facebook_feed_delete",params:["post_id","created_time"],url:"/api/app/facebook/item/delete"},{name:"facebook_settings_get",url:"/api/app/facebook/settings/get"},{name:"facebook_contacts_list",params:["uid","limit","sort_field","number"],url:"/api/app/facebook/friends/info"},{name:"facebook_post_like",params:["post_id","like_count"],url:"/api/app/facebook/like"},{name:"facebook_post_unlike",params:["post_id","like_count"],url:"/api/app/facebook/unlike"}]});Facebook.implement({setupNav:function(){this.users=$H();this.fb_albums=$H();this.navAdd(new Nav({iconOptions:{iconName:"updates"},displayName:"News Feed",name:"updates",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"updates","fb_self_menu"])}));this.navAdd(new Nav({iconOptions:{iconName:"profile_pic"},displayName:"My Wall",name:"wall",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"wall","fb_self_menu"])}));this.navAdd(new Nav({iconOptions:{iconName:"profile_pic"},displayName:"Friends",name:"friends",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"friends","fb_self_menu"])}));this.navAdd(new Nav({iconOptions:{iconName:"photo"},displayName:"My Albums",name:"albums",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"albums","fb_self_menu"])}));var user=this.getPrivateUser();var fbSelfMenu=new FacebookSelfMenu({user:user,isDefault:true,uid:this.settings.uid,closeFunc:this.stop.bind(this)});this.menuAdd("fb_self_menu",fbSelfMenu);var content=new FacebookFeedContent({isDefault:true});this.contentAdd("updates",content);var friendsContent=new FacebookFriendContent({user:user,uid:this.settings.uid});this.contentAdd("friends",friendsContent);var wallContent=new FacebookWallContent({user:user,uid:this.settings.uid});this.contentAdd("wall",wallContent);var albumsContent=new FacebookAlbumContent({uid:this.settings.uid});this.contentAdd("albums",albumsContent);},userClose:function(uid){if(!this.users.has(uid)){return;}this.users.get(uid).destroy();this.navDelete(uid);this.users.erase(uid);this.menuClose(uid);this.contentClose(uid);if(this.users.getLength()==0){this.navDelete("users");this.usersNav=null;}},userAdd:function(user){if(!$defined(this.usersNav)){this.usersNav=new Nav({iconOptions:{iconName:"users"},hasSubnavs:true,displayName:"Users",name:"users"});this.navAdd(this.usersNav);}var nav=new Nav({iconOptions:{iconName:user.pic},displayName:user.username,closable:true,name:user.uid,parentName:"users",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,user.uid,user.uid])});this.navAdd(nav);this.users.set(user.uid,nav);var userContent=new FacebookUserContent({uid:user.uid});this.contentAdd(user.uid,userContent);var fbUserMenu=new FacebookUserMenu({user:user,uid:user.uid,closeFunc:this.userClose.bind(this,[user.uid])});this.menuAdd(user.uid,fbUserMenu);this.fireEvent("viewSwitch",this.appId,user.uid,user.uid);},albumClose:function(uid){if(!this.fb_albums.has(uid)){return;}this.fb_albums.get(uid).destroy();this.navDelete(uid+"_albums");this.fb_albums.erase(uid);this.menuClose(uid+"_albums");this.contentClose(uid+"_albums");if(this.fb_albums.getLength()==0){this.navDelete("albums");this.userAlbumNav=null;}},userAlbumsAdd:function(user){if(!$defined(this.userAlbumNav)){this.usersAlbumNav=new Nav({iconOptions:{iconName:"photo"},hasSubnavs:true,displayName:"Albums",name:"fb_albums"});this.navAdd(this.usersAlbumNav);}var nav=new Nav({iconOptions:{iconName:user.pic_square},displayName:user.name,closable:true,name:user.uid+"_albums",parentName:"fb_albums",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,user.uid+"_albums",user.uid])});this.navAdd(nav);this.fb_albums.set(user.uid,nav);var userAlbumContent=new FacebookAlbumContent({uid:user.uid});this.contentAdd(user.uid+"_albums",userAlbumContent);var fbUserMenu=new FacebookUserMenu({user:user,uid:user.uid,closeFunc:this.albumClose.bind(this,[user.uid])});this.menuAdd(user.uid+"_albums",fbUserMenu);this.fireEvent("viewSwitch",this.appId,user.uid+"_albums",user.uid);}});var FacebookAlbumContent=new Class({Extends:Content,EventHandlers:["facebookAlbumView"],onBeforeInit:function(options){this.uid=options.uid;options.displayName="Facebook Albums";return options;},onInit:function(){this.albums=$H();this.albumsLoader=new ItemLoader({idField:"aid",sortField:"modified_major",createElementFunc:FacebookAlbumUtility.createFacebookAlbumItem,emptyEl:new Element("div",{"class":"post empty","text":"There are no albums here"}),errorEl:new Element("div",{"class":"post empty","text":"You are not able to view these albums"})});$(this.albumsLoader).inject(this.content);},onShow:function(first){if(first){this.getFacebookAlbums();}},onHide:function(){},getFacebookAlbums:function(){var params={user_id:this.uid};this.call("facebook","facebook_albums",params,this.facebookGetAlbumsSuccess.bind(this),this.facebookGetAlbumsFail.bind(this));},facebookGetAlbumsSuccess:function(data){if($defined(data.albums)){data.albums.albums.each(function(album){var pid=album.cover_pid;album.coverSrc=data.albums.sources[pid];this.albumsLoader.process(album);},this);}},facebookGetAlbumsFail:function(data){this.albumsLoader.showError();},facebookAlbumView:function(album){var newAlbum=new Album({id:album.aid});this.albums.set(album.aid,newAlbum);var params={user_id:"",aid:album.aid};this.call("facebook","facebook_photos",params,this.facebookAlbumViewSuccess.bind(this),null);},facebookAlbumViewSuccess:function(data){if(!$defined(data.photos)){return;}var album=this.albums.get(data.aid);data.photos.each(function(photo){album.addPhoto(photo.pid,photo.src,photo.src_big,photo.caption);photo.auid=photo.aid;},this);var photo=album.getPhoto(data.photos[0].pid);this.fireEvent("viewAlbum",album,photo,data.aid);}});var FacebookFeedContent=new Class({Extends:Content,EventHandlers:["facebookItemDelete","facebookItemLike","facebookCommentsShow","facebookSelfData","facebookCommentsUpdated","facebookFeed"],onInit:function(){this.loader=new ItemLoader({idField:"post_id",sortField:"created_time",sortAscending:false,createElementFunc:FacebookFeedItemUtility.createFacebookFeedItem,emptyEl:new Element("div",{"class":"post empty","text":"You have no updates"})});$(this.loader).inject(this.content);this.comments=new Hash();this.commentLoaders=new Hash();this.posts=new Hash();},onShow:function(first){if(first){this.startPoll();}},onHide:function(){},facebookSelfData:function(user){this.statusBox=new FacebookStatusBox(user,true);$(this.statusBox).inject(this.content,"top");},startPoll:function(){if(!$defined(this.pollTimer)){this.pollTimer=this.facebookFeed.periodical(55*1000,this);this.facebookFeed();}},facebookFeed:function(){var startTime=this.loader.lowestSortValue;var params={start_time:startTime,end_time:0};this.call("facebook","facebook_newsfeed_load",params,this.loadMoreSuccess.bind(this),null);},loadMore:function(){var endTime=this.loader.lowestSortValue;var startTime=parseInt(endTime)-259200;var params={start_time:startTime,end_time:endTime};this.call("facebook","facebook_newsfeed_load",params,this.loadMoreSuccess.bind(this),null);},loadMoreSuccess:function(data){if(!$defined(data)||data.length==0){this.atBottom=true;return;}data.each(function(item){this.loader.process(item);this.processComments(item);},this);this.bottomFuncCalled=false;},processComments:function(item){if(this.posts.has(item.post_id)){if(this.posts.get(item.post_id)!=item.comment_count){$$(".comments_"+item.post_id).each(function(el){var commentText=TextUtility.pluralText(item.comment_count,"Comment","Comments");el.set("comments",item.comment_count);el.empty();el.adopt(new Element("div",{"class":"action convo"}));el.appendText(commentText);});}var likePost=$$(".likes_"+item.post_id);if($defined(likePost[0])){var likesCount=parseInt(likePost[0].get("likes"));if(likesCount!=parseInt(item.like_count)){this.facebookItemLikeSuccess({post_id:item.post_id,liked:item.user_likes,like_count:item.like_count});}}}else{this.posts.set(item.post_id,item.comment_count);}},bottomFunc:function(){Logger().log("facebook content bottom");this.loadMore();},facebookItemDelete:function(post_id,created_time){var params={"post_id":post_id,"created_time":created_time};this.call("facebook","facebook_feed_delete",params,this.facebookItemDeleteSuccess.bind(this),null);},facebookItemDeleteSuccess:function(data){if(!$defined(data.post_id)){return;}this.loader.remove(data.post_id);},facebookItemLike:function(post_id,likeEl){var user_likes=parseInt(likeEl.get("is_liked"));var like_count=parseInt(likeEl.get("likes"));var params={"post_id":post_id,"like_count":like_count};if(parseInt(user_likes)==0){this.call("facebook","facebook_post_like",params,this.facebookItemLikeSuccess.bind(this),null);}else{this.call("facebook","facebook_post_unlike",params,this.facebookItemLikeSuccess.bind(this),null);}},facebookItemLikeSuccess:function(data){if(!$defined(data.post_id)){return;}$$(".likes_"+data.post_id).each(function(el){el.set("likes",data.like_count);if(data.liked!=-1){el.set("is_liked",data.liked);}el.empty();new Element("div",{"class":"text grey text11","text":data.like_count,"likes":data.like_count}).inject(el);if(data.like_count>0){el.addClass("other_liked");}else{el.removeClass("other_liked");}if(data.liked!=-1){if(data.liked==1){el.addClass("on");}else{el.removeClass("on");}}});},facebookCommentsShow:function(el,post_id){if(this.comments.has(post_id)){this.facebookCommentsHide(post_id);}else{this.comments.set(post_id,el);var commentsLoader=new ItemLoader({idField:"id",sortField:"time",sortAscending:true,createElementFunc:FacebookCommentItemUtility.createFacebookCommentItem});$(commentsLoader).inject(el,"after");this.commentLoaders.set(post_id,commentsLoader);var params={"post_id":post_id};this.call("facebook","facebook_comments",params,this.facebookCommentsSuccess.bind(this),null);}},facebookCommentsUpdated:function(post_id){var params={"post_id":post_id};this.call("facebook","facebook_comments",params,this.facebookCommentsSuccess.bind(this),null);},facebookCommentsHide:function(post_id){var loader=this.commentLoaders.get(post_id);loader.items.each(function(value,key){loader.remove(key);},this);this.commentLoaders.erase(post_id);this.comments.erase(post_id);},facebookCommentsSuccess:function(data){if(!$defined(data.post_id)){return;}var loader=this.commentLoaders.get(data.post_id);if(!$defined(data.comment_list)||data.comment_list.length==0){this.atBottom=true;return;}data.comment_list.each(function(item){loader.process(item);},this);this.bottomFuncCalled=false;}});var FacebookFriendContent=new Class({Extends:Content,EventHandlers:[],onBeforeInit:function(options){this.user=options.user;this.uid=options.uid;},onInit:function(){this.loader=new ItemLoader({idField:"uid",sortField:"last_name",createElementFunc:FacebookFriendItemUtility.createFacebookFriendItem,emptyEl:new Element("div",{"class":"post empty","text":"You have no friends!"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){var params={"uid":this.uid,"limit":50,"sort_field":"last_name","number":""};this.call("facebook","facebook_friends_info",params,this.facebookFriendsSuccess.bind(this),null);}},onHide:function(){},facebookFriendsSuccess:function(data){if(!$defined(data)||data.length==0){return;}data.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){var curBatch=this.loader.count();var nextBatch=curBatch+50;var params={"uid":this.uid,"limit":curBatch+","+nextBatch,"sort_field":"last_name","number":""};this.call("facebook","facebook_friends_info",params,this.facebookFriendsSuccess.bind(this),null);}});var FacebookUserContent=new Class({Extends:Content,EventHandlers:["facebookUserData"],onBeforeInit:function(options){this.uid=options.uid;this.name=options.username;options.displayName=options.username;return options;},onInit:function(){this.loader=new ItemLoader({idField:"post_id",sortField:"created_time",sortAscending:false,createElementFunc:FacebookFeedItemUtility.createFacebookFeedItem,emptyEl:new Element("div",{"class":"post empty","text":"This user has no updates"})});$(this.loader).inject(this.content);if($defined(this.uid)){this.startPoll();}},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},startPoll:function(){if(!$defined(this.userPollTimer)){this.userPollTimer=this.fbUserFeed.periodical(55*1000,this);this.fbUserFeed();}},fbUserFeed:function(){var startTime=this.loader.lowestSortValue;var params={user_id:this.uid,start_time:startTime,end_time:0};this.call("facebook","facebook_user_feed",params,this.loadMoreSuccess.bind(this),null);},facebookUserData:function(user){if((user.uid!=this.uid)||($defined(this.statusBox))){return;}this.statusBox=new FacebookStatusBox(user,false);$(this.statusBox).inject(this.content,"top");},loadMore:function(){var endTime=this.loader.lowestSortValue;var startTime=parseInt(endTime)-259200;var params={user_id:this.uid,start_time:startTime,end_time:endTime};this.call("facebook","facebook_user_feed",params,this.loadMoreSuccess.bind(this),null);},loadMoreSuccess:function(data){if(!$defined(data.feed)||data.feed.length==0){this.atBottom=true;return;}data.feed.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){Logger().log("facebook content bottom");this.loadMore();}});var FacebookWallContent=new Class({Extends:Content,EventHandlers:["facebookSelfData"],onBeforeInit:function(options){this.uid=options.uid;options.displayName=options.username;return options;},onInit:function(){this.loader=new ItemLoader({idField:"post_id",sortField:"created_time",sortAscending:false,createElementFunc:FacebookFeedItemUtility.createFacebookFeedItem,emptyEl:new Element("div",{"class":"post empty","text":"You have no updates"})});$(this.loader).inject(this.content);if($defined(this.uid)){this.startPoll();}},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},startPoll:function(){if(!$defined(this.wallPollTimer)){this.wallPollTimer=this.fbUserFeed.periodical(55*1000,this);this.fbUserFeed();}},fbUserFeed:function(){var startTime=this.loader.lowestSortValue;var params={user_id:this.uid,start_time:startTime,end_time:0};this.call("facebook","facebook_user_feed",params,this.loadMoreSuccess.bind(this),null);},facebookSelfData:function(user){if($defined(this.statusBox)){return;}this.statusBox=new FacebookStatusBox(user,true);$(this.statusBox).inject(this.content,"top");},loadMore:function(){var endTime=this.loader.lowestSortValue;var startTime=parseInt(endTime)-259200;var params={user_id:this.uid,start_time:startTime,end_time:endTime};this.call("facebook","facebook_user_feed",params,this.loadMoreSuccess.bind(this),null);},loadMoreSuccess:function(data){if(!$defined(data.feed)||data.feed.length==0){this.atBottom=true;return;}data.feed.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){Logger().log("facebook content bottom");this.loadMore();}});var FacebookShareBox=new Class({Extends:Base,EventHandlers:["userSwitched","facebookShareBoxShow","facebookCommentBoxShow"],init:function(){this.shareboxes=$H();},userSwitched:function(){if(!this.isLoggedIn()){this.userLoggedOut();}},userLoggedOut:function(){this.shareboxes.each(function(sharebox,key){sharebox.close();this.shareboxes.erase(key);},this);this.shareboxes=$H();},facebookShareBoxShow:function(user,isSelf){if($defined(this.sharebox)){this.sharebox.close();}this.createShareBox(user,isSelf);},createShareBox:function(user,isSelf){this.sharebox=new Popup({size:{x:500,y:100},resizable:false,dockable:false,className:"facebook sharebox",onClose:this.destroyShareBox.bind(this)});var displayName=(isSelf)?"Write in Your Facebook Feed":"Write on "+user.first_name+"'s Wall";var nav=new Nav({iconOptions:{iconName:user.pic_square},displayName:displayName,closable:true});var content=new FacebookShareBoxPopupContent({user:user,is_self:isSelf});this.sharebox.addContent("sharebox",nav,content);},facebookCommentBoxShow:function(post_id){if($defined(this.commentbox)){this.commentbox.close();}this.createCommentBox(post_id);},createCommentBox:function(post_id){this.sharebox=new Popup({size:{x:500,y:100},resizable:false,dockable:false,className:"facebook sharebox",onClose:this.destroyShareBox.bind(this)});var displayName="Comment on a post";var nav=new Nav({iconOptions:{iconName:"updates"},displayName:displayName,closable:true});var content=new FacebookShareBoxPopupContent({post_id:post_id,is_self:true});this.sharebox.addContent("sharebox",nav,content);},destroyShareBox:function(name){this.sharebox=null;}});var FacebookShareBoxPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.user=options.user;this.post_id=options.post_id;if(!options.is_self){this.target_id=this.user.uid;}return options;},reset:function(){Logger().log("resetting");this.closeAttachmentPopup();this.content.empty();this.onInit();},onInit:function(){this.formEl=null;this.isPublic=true;this.readyToPost=false;this.input=new Element("textarea",{"maxlength":2000});this.input.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"textarea_wrapper"}).adopt(this.input).inject(this.content);this.cancelButton=new ButtonMedium({displayName:"Close",className:"dark",action:"cross"});$(this.cancelButton).addEvent("click",this.closeContent.bind(this));this.updateButton=new ButtonMedium({displayName:"Post",className:"dark",action:"check"});$(this.updateButton).addEvent("click",this.post.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.updateButton),$(this.cancelButton)).inject(this.content);this.focus();},inputKeyUp:function(e){if(e.shift&&e.key=="enter"){e.preventDefault();this.post();}if(DomUtility.textareaAutoSize(e.target,40)){this.updateSize();}},updateSize:function(){var h=this.input.getSize().y+10;h+=this.actions.getSize().y+30;this.resizePopup(500,h);},post:function(){var body=this.input.value.trim();Logger().log(body);if(body==""&&this.attachment.type==AttachmentType.None){this.fireEvent("showAlert","empty_post","Problem Posting","Please enter some content to post.");return;}if(!$defined(this.post_id)){this.post_id="";}if(!$defined(this.target_id)){this.target_id=0;}var params={"body":body,"post_id":this.post_id,"target_id":this.target_id};this.call("facebook","facebook_post_text",params,this.postSuccess.bind(this),this.postFail.bind(this),this.formEl);this.updateButton.showProgress();},postSuccess:function(){this.updateButton.hideProgress();this.closeContent();if($defined(this.post_id)){this.fireEvent("facebookCommentsUpdated",this.post_id);}this.fireEvent("facebookFeed");},postFail:function(){this.updateButton.hideProgress();},onShow:function(){this.focus();},focus:function(){this.input.focus.delay(500,this.input);}});var FacebookStatusBox=new Class({Extends:Base,EventHandlers:[],init:function(user,isSelf){this.user=user;this.isSelf=isSelf;this.defaultStatus="has no current status";this.createStatusBox();},createStatusBox:function(){this.box=ItemUtility.createPostBubble("post status_message haspic");ItemUtility.createItemPic(this.user.pic_square).inject(this.box);var buttonText=this.isSelf?"Write in Your Feed":"Write on "+this.user.first_name+"'s Wall";this.writeButton=new Element("div",{"class":"button","text":TextUtility.unescape(buttonText)}).inject(this.box);this.writeButton.addEvent("click",this.fireEvent.bind(this,["facebookShareBoxShow",this.user,this.isSelf]));this.content=new Element("div",{"class":"post_content"}).inject(this.box);var header=new Element("div",{"class":"header"}).inject(this.content);var creator=new Element("span",{"class":"user_name","text":TextUtility.unescapeQuotes(this.user.name)}).inject(header);this.status=new Element("span",{"class":"status"}).inject(header);this.updateStatus();},updateStatus:function(){if($defined(this.user.status.message)&&this.user.status.message!=""){this.status.removeClass("empty");this.status.set("text"," "+TextUtility.unescape(this.user.status.message.trim()));}else{this.status.addClass("empty");this.status.set("text"," "+TextUtility.unescape(this.defaultStatus));}},toElement:function(){return this.box;}});var FacebookUserMenu=new Class({Extends:Menu,onBeforeInit:function(options){this.uid=options.user.uid;this.name=options.user.username;options.displayName=this.name;options.className="facebook";this.pic=options.user.pic;this.user=options.user;return options;},onInit:function(){this.aboutSection=new Element("div",{"class":"text_section light1"}).inject(this.menu);this.call("facebook","facebook_user_show",{user_id:this.uid},this.profileShowSuccess.bind(this),null);},profileShowSuccess:function(data){if(!$defined(data)||data==""){return;}this.user=data;if(data.pic_square==""){data.pic_square;}this.pic=new Element("div",{"class":"user_pic"}).inject(this.menu);ItemUtility.createItemPic(data.pic_square).inject(this.pic);var location="";if($defined(data.current_location.city)){location=data.current_location.city;if($defined(data.current_location.state)){location=location+", "+data.current_location.state;}}else{if($defined(data.current_location.state)){location=data.current_location.state;}else{if($defined(data.current_location.country)){location+=" "+data.current_location.country;}}}if(location!=""){this.locSection=new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Location: "}),new Element("span",{"text":location})).inject(this.menu);}if($defined(data.affiliations)&&data.affiliations.length>0){var networks="";for(var i=0;i<data.affiliations.length-1;i++){networks+=data.affiliations[i].name+", ";}networks+=data.affiliations[i].name;this.networksSection=new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Networks: "}),new Element("span",{"text":networks})).inject(this.menu);}if($defined(data.sex)&&data.sex!=""){this.genderSection=new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Gender: "}),new Element("span",{"text":data.sex})).inject(this.menu);}if($defined(data.birthday)&&data.birthday!=""){this.genderSection=new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Birthday: "}),new Element("span",{"text":data.birthday})).inject(this.menu);}if($defined(data.relationship_status)&&data.relationship_status!=""){this.relationSection=new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Relationship Status: "}),new Element("span",{"text":data.relationship_status})).inject(this.menu);}this.fireEvent("facebookUserData",data);}});var FacebookSelfMenu=new Class({Extends:Menu,onBeforeInit:function(options){this.appId=5;this.user=options.user;options.displayName=this.user.fullname;options.className="facebook";this.fb_uid=options.uid;return options;},onInit:function(){this.aboutSection=new Element("div",{"class":"text_section light1"}).inject(this.menu);this.call("facebook","facebook_user_show",{user_id:this.fb_uid},this.profileShowSuccess.bind(this),null);},profileShowSuccess:function(data){if(!$defined(data)||data==""){return;}this.user=data;if(data.pic_square==""){data.pic_square;}this.pic=new Element("div",{"class":"user_pic"}).inject(this.menu);ItemUtility.createItemPic(data.pic_square).inject(this.pic);var location="";if($defined(data.current_location.city)){location=data.current_location.city;if($defined(data.current_location.state)){location=location+", "+data.current_location.state;}}else{if($defined(data.current_location.state)){location=data.current_location.state;}else{if($defined(data.current_location.country)){location+=" "+data.current_location.country;}}}if(location!=""){this.locSection=new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Location: "}),new Element("span",{"text":location})).inject(this.menu);}if($defined(data.affiliations)&&data.affiliations.length>0){var networks="";for(var i=0;i<data.affiliations.length-1;i++){networks+=data.affiliations[i].name+", ";}networks+=data.affiliations[i].name;this.networksSection=new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Networks: "}),new Element("span",{"text":networks})).inject(this.menu);}if($defined(data.sex)&&data.sex!=""){this.genderSection=new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Gender: "}),new Element("span",{"text":data.sex})).inject(this.menu);}if($defined(data.birthday)&&data.birthday!=""){this.genderSection=new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Birthday: "}),new Element("span",{"text":data.birthday})).inject(this.menu);}if($defined(data.relationship_status)&&data.relationship_status!=""){this.relationSection=new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Relationship Status: "}),new Element("span",{"text":data.relationship_status})).inject(this.menu);}this.call("facebook","facebook_settings_get",{},this.settingsGetSuccess.bind(this),null);this.fireEvent("facebookSelfData",data);},settingsGetSuccess:function(data){if(!$defined(data.settings.sync_posts)){return;}this.sync_posts=data.settings.sync_posts;new Element("div",{"class":"nav_seperator"}).inject(this.menu);this.syncPosts=new Toggle(this.sync_posts==1);$(this.syncPosts).addEvent("click",this.syncToggle.bind(this));new Element("div",{"class":"toggle_section"}).adopt(new Element("div",{"class":"text light","text":"Sync Posts:"}),$(this.syncPosts)).inject(this.menu);},syncToggle:function(){var params={key:"sync_posts",value:this.syncPosts.toInt()};this.call("facebook","facebook_settings_update",params);}});var FacebookInstallPopupContent=new Class({Extends:PopupContent,strings:{postSyncLabel:"Sync posts to Facebook:",errorMessage:"There was an error connecting to Facebook"},onInit:function(){this.appId=5;FB_RequireFeatures(["Connect"],function(){FB.Facebook.init("d29a9328a49d798da896066499c0d9d8","/xd_receiver.htm",{"forceBrowserPopupForLogin":true,"doNotUseCachedConnectState":true});});this.syncPostsToggle=new Toggle(true);new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.postSyncLabel}),$(this.syncPostsToggle)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Install Facebook",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.facebookConnect.bind(this));this.message=new Element("div",{"class":"message error"});this.actions=new Element("div",{"class":"actions"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},facebookConnect:function(){FB.Connect.requireSession(this.facebookGetPermission.bind(this),this.facebookConnectFail.bind(this));},facebookGetPermission:function(){FB.Connect.showPermissionDialog("offline_access,publish_stream,read_stream,status_update,email,xmpp_login",this.facebookEnable.bind(this));},facebookEnable:function(){this.fb_session=FB.Facebook.apiClient.get_session();var sync=this.syncPostsToggle.toInt();var params={sync_posts:this.syncPostsToggle.toInt(),session_key:this.fb_session.session_key,uid:this.fb_session.uid};this.call("facebook","facebook_enable",params,this.facebookEnableSuccess.bind(this),null);},facebookEnableSuccess:function(){this.closeContent();},facebookConnectFail:function(){var name="facebook_connect";var title="Error Connecting to Facebook";var message=this.strings.errorMessage;this.fireEvent("showAlert",name,title,message);}});var FacebookAlbumUtility={createFacebookAlbumItem:function(album){var el=ItemUtility.createPostBubble("post album",true);var thumb=new Element("div",{"class":"cover"}).adopt(new Element("img",{"src":album.coverSrc,"alt":album.description,"title":album.description})).inject(el);thumb.addEvent("click",pipio.dispatchEvent.bind(pipio,["facebookAlbumView",album]));var title=new Element("div",{"class":"user_name clickable","text":TextUtility.unescape(album.name)});var header=new Element("div",{"class":"heading"}).adopt(title).inject(el);title.addEvent("click",pipio.dispatchEvent.bind(pipio,["facebookAlbumView",album]));var size=new Element("span",{"class":"size","text":TextUtility.pluralText(album.size,"Photo","Photos")}).inject(header);var location=new Element("span",{"class":"location"}).inject(header);if(album.location.trim()!=""){location.set("text"," | "+TextUtility.unescape(album.location.trim()));}var description=new Element("div",{"class":"description"}).inject(el);if(album.description.trim()!=""){description.set("text"," "+TextUtility.unescape(album.description.trim()));}var viewButton=new ButtonMedium({displayName:"View Album",action:"goto dark"});$(viewButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["facebookAlbumView",album]));new Element("div",{"class":"actions"}).adopt($(viewButton)).inject(el);return el;}};var FacebookCommentItemUtility={createFacebookCommentItem:function(item){var el=ItemUtility.createPostBubble("post haspic fbComment");ItemUtility.createItemPic(item.profile_pic).inject(el);var content=new Element("div",{"class":"post_content"}).inject(el);FacebookCommentItemUtility.createFacebookItemHeader(item).inject(content);FacebookCommentItemUtility.createFacebookItemFooter(item).inject(content);return el;},createFacebookItemHeader:function(item){var el=new Element("div",{"class":"header"});var user={username:item.name,uid:item.fromid,pic:item.profile_pic};var creatorName=new Element("span",{"class":"user_name clickable","text":TextUtility.unescapeQuotes(item.name)}).inject(el);creatorName.addEvent("click",pipio.dispatchEvent.bind(pipio,["facebookShowUserFeed",user]));if($defined(item.text)&&item.text!=""){new Element("span",{"html":" "+TextUtility.replaceUrls(TextUtility.stripHtml(TextUtility.unescape(item.text)))}).inject(el);}return el;},createFacebookItemFooter:function(item){var el=new Element("div",{"class":"footer"});if(!$defined(item.time)){return el;}var date=DateUtility.convertFromTimestamp(item.time);var ts=new Element("span",{"class":"timestamp","text":DateUtility.getTimestamp(date,"%B %D at %I:%M%p"),"ts":date,"ts_format":"%B %D at %I:%M%p"}).inject(el);return el;}};var FacebookFeedItemUtility={createFacebookFeedItem:function(item){var el=ItemUtility.createPostBubble("post haspic");ItemUtility.createItemPic(item.profile_pic).inject(el);var content=new Element("div",{"class":"post_content facebook"}).inject(el);FacebookFeedItemUtility.createFacebookItemHeader(item).inject(content);FacebookFeedItemUtility.createFacebookItemBody(item).inject(content);FacebookFeedItemUtility.createFacebookItemFooter(item,el).inject(content);FacebookFeedItemUtility.createFacebookItemActions(item).inject(el);return el;},createFacebookItemHeader:function(item){var el=new Element("div",{"class":"header"});var user={username:item.name,uid:item.actor_id,pic:item.profile_pic};var target={username:item.target_name,uid:item.target_id,pic:""};var creatorName=new Element("span",{"class":"user_name clickable","text":TextUtility.unescapeQuotes(item.name)}).inject(el);creatorName.addEvent("click",pipio.dispatchEvent.bind(pipio,["facebookShowUserFeed",user]));if(item.target_id>0){StreamItemUtility.createStreamUserAction("direct").inject(el);var targetName=new Element("span",{"class":"user_name clickable","text":TextUtility.unescapeQuotes(item.target_name)}).inject(el);targetName.addEvent("click",pipio.dispatchEvent.bind(pipio,["facebookShowUserFeed",target]));}if($defined(item.message)&&item.message!=""){new Element("span",{"html":" "+TextUtility.replaceUrls(TextUtility.stripHtml(TextUtility.unescape(item.message)))}).inject(el);}return el;},createFacebookItemBody:function(item){var el=new Element("div",{"class":"body"});var fbUrl;if(item.attachment!=""&&$defined(item.attachment.media)&&$defined(item.attachment.media.length)){for(var i=0,n=item.attachment.media.length;i<n;i++){if(item.attachment.media[i].type=="photo"){fbUrl=DataUtility.getFacebookPhotoUrl(item.attachment.media[i].src);}else{fbUrl=item.attachment.media[i].src;}var image=new Element("img",{"src":item.attachment.media[i].src,"class":"fbPhoto"}).inject(el);var attachment={url:fbUrl,filename:"Facebook Photo"};image.addEvent("click",pipio.dispatchEvent.bind(pipio,["showPhotoPopup",attachment]));}new Element("br",{}).inject(el);}if($defined(item.attachment.name)){new Element("a",{"href":item.attachment.href,"target":"_blank","text":item.attachment.name}).inject(el);new Element("br",{}).inject(el);}new Element("span",{"text":item.attachment.description}).inject(el);return el;},createFacebookItemFooter:function(item,postElement){var el=new Element("div",{"class":"footer foot_"+item.post_id});if(!$defined(item.date_created)){return el;}var date=DateUtility.convertFromTimestamp(item.created_time);var ts=new Element("span",{"class":"timestamp","text":DateUtility.getTimestamp(date,"%B %D at %I:%M%p"),"ts":date,"ts_format":"%B %D at %I:%M%p"}).inject(el);FacebookFeedItemUtility.createFacebookFooterActions(item,el,postElement);return el;},createFacebookFooterActions:function(item,el,postElement){var commentsAction=new Element("span",{"class":"footer_action has_action comments_"+item.post_id,"comments":item.comment_count}).adopt(new Element("div",{"class":"action convo"}));commentsAction.appendText(TextUtility.pluralText(item.comment_count,"Comment","Comments"));commentsAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["facebookCommentsShow",postElement,item.post_id]));commentsAction.inject(el);var replyAction=FacebookFeedItemUtility.createFacebookFooterAction("reply","Comment",true);replyAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["facebookCommentBoxShow",item.post_id]));replyAction.inject(el);},createFacebookItemActions:function(item){var el=new Element("div",{"class":"post_actions"});if(item.can_delete){var deleteAction=new Element("div",{"class":"post_action delete"}).inject(el);deleteAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["facebookItemDelete",item.post_id,item.created_time]));}var likeAction=new Element("div",{"class":"post_action like likes_"+item.post_id,"is_liked":item.user_likes,"likes":item.like_count}).inject(el);likeAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["facebookItemLike",item.post_id,likeAction]));new Element("div",{"class":"text grey text11","text":item.like_count,"likes":item.like_count}).inject(likeAction);if(item.like_count>0){likeAction.addClass("other_liked");}if(item.user_likes==1){likeAction.addClass("on");}return el;},createFacebookFooterAction:function(actionName,actionText,hide){var el=new Element("span",{"class":"footer_action has_action"}).adopt(new Element("div",{"class":"action "+actionName}));el.appendText(actionText);if(hide){el.addClass("hide");}return el;}};var FacebookFriendItemUtility={createFacebookFriendItem:function(user){var el=ItemUtility.createPostBubble("post contact",true);new Element("img",{"class":"profile_pic_wrapper_60 afb_profile_pic","src":user.pic}).inject(el);var username=new Element("div",{"class":"user_name clickable","text":TextUtility.unescape(user.username)});new Element("div",{"class":"heading"}).adopt(username).inject(el);username.addEvent("click",pipio.dispatchEvent.bind(pipio,["facebookShowUserFeed",user]));var viewButton=new ButtonMedium({displayName:"View Wall",action:"goto dark"});$(viewButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["facebookShowUserFeed",user]));new Element("div",{"class":"actions"}).adopt($(viewButton)).inject(el);return el;}};var Global=new Class({Extends:AppInstance,EventHandlers:["userSwitched"],parseOptions:function(options){this.location=options.location;this.displayName="global",this.appId="global_"+this.location.geohash;this.iconOptions={iconName:"location"};},userSwitched:function(){this.stop();},onStart:function(){this.setupNav();},onStop:function(){var params={geohashs:this.location.geohash,location:JSON.encode(this.location),zoom:4,subscribe:0};this.call("global","global_subscribe_delete",params);}});Global.implement({requests:[{name:"global_subscribe_add",params:["geohashs","location","zoom","subscribe"],url:"/api/pipio/global/subscribe/add"},{name:"global_subscribe_delete",params:["geohashs","location","zoom","subscribe"],url:"/api/pipio/global/subscribe/delete"}]});Global.implement({setupNav:function(){Logger().log("global setup");this.navAdd(new Nav({iconOptions:{iconName:"global"},displayName:"Updates",name:"updates",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"updates","global_menu"])}));var globalMenu=new GlobalMenu({location:this.location,isDefault:true,closeFunc:this.stop.bind(this)});this.menuAdd("global_menu",globalMenu);var content=new GlobalContent({isDefault:true,location:this.location});this.contentAdd("updates",content);}});var GlobalContent=new Class({Extends:Content,EventHandlers:["globalItemReceived"],onBeforeInit:function(options){this.location=options.location;},onInit:function(){this.loader=new StreamLoader({createElementFunc:StreamItemUtility.createUserStreamItem,emptyEl:new Element("div",{"class":"post empty","text":"This location has no updates"}),loadingEl:new Element("div",{"class":"post empty","text":"Updates loading..."})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},globalItemReceived:function(data){if(data.item.geohash.substring(0,4)==this.location.geohash.substring(0,4)){this.loader.process(data.item);}},loadMore:function(){var params={geohash:this.location.geohash.substring(0,4),date_created:this.loader.oldestTimestamp,item_id:this.loader.oldestId};this.call("home","stream_global_load",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(this.loader.empty){var params={geohashs:this.location.geohash,location:JSON.encode(this.location),zoom:4,subscribe:0};this.call("global","global_subscribe_add",params);}if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){this.loader.hideLoading();if(status.code==2002){this.loader.showError();}},bottomFunc:function(){this.loadMore();}});var GlobalMenu=new Class({Extends:Menu,EventHandlers:[],onBeforeInit:function(options){this.location=options.location;var locationLabel=DataUtility.getGeoLabel(this.location);var locationStr=DataUtility.getGeoLocality(this.location);if(locationLabel){locationStr=locationLabel+", "+locationStr;}options.displayName=locationStr;return options;},onInit:function(){this.map=new GlobalMapMenuSection({location:this.location});$(this.map).inject(this.menu);new Element("div",{"class":"text_section light1 text11","text":"You are viewing updates near this location"}).inject(this.menu);}});var Home=new Class({Extends:App,EventHandlers:["userSwitched","streamItemReplyCountUpdated","streamItemDelete","userStreamItemLiked","streamItemLike","roomProfilePicUpdated","feedRoomKick","feedRoomRequestAccept","feedRoomRequestDelete","feedRoomAdded","feedRoomDeleted","feedRoomDelete","showCreateRoomPopup","showRoomInvitePopup","showRoomStatusUpdatePopup","showEditProfilePopup","showEditRoomProfilePopup","showConvo"],onStart:function(){this.setupNav();this.initRooms();this.convos=$H();},onStop:function(){},userSwitched:function(){if(this.isLoggedIn()){this.start();}else{this.stop();}},onCreate:function(){this.closeButton.destroy();$("app_button_2").addEvent("click",this.switchDefault.bind(this));},dock:function(){DomUtility.hide(this.navSection);$(this.alert).inject("app_button_2");$("app_button_2").addClass("has_submenu");this.navWrapper.inject("app_button_2","after");$("app_button_2").removeEvents("click");$("app_button_2").addEvent("click",this.undock.bind(this));this.isDocked=true;},undock:function(){this.navWrapper.inject(this.navSection);$("app_button_2").removeClass("has_submenu");$("app_button_2").removeEvents("click");$("app_button_2").addEvent("click",this.switchDefault.bind(this));DomUtility.show(this.navSection);this.isDocked=false;if($defined(this.defaultContent)){this.fireEvent("viewSwitch",this.appId,this.defaultContent,this.defaultMenu);}},streamItemReplyCountUpdated:function(data){if(!$defined(data.item_id)||!$defined(data.count)){return;}StreamItemUtility.updateReplyCount(data.item_id,data.count);},userStreamItemLiked:function(data){if(!$defined(data.item)||!$defined(data.username)){return;}if(data.username==this.getPrivateUser().username){StreamItemUtility.updateItemLiked(data.item.item_id,data.likes,data.is_liked);}else{StreamItemUtility.updateItemLiked(data.item.item_id,data.likes,-1);}},streamItemLike:function(item_id,el){this.call("home","stream_item_like",{item_id:item_id},null,null);var is_liked=parseInt(el.get("is_liked"));var likes=parseInt(el.get("likes"));if(is_liked==1){StreamItemUtility.updateItemLiked(item_id,likes-1,0);}else{StreamItemUtility.updateItemLiked(item_id,likes+1,1);}},streamItemDelete:function(item_id){var name="stream_item_delete";var title="Delete Post";var message="Are you sure you want to delete this post?";var func=this.streamItemDeleteCall.bind(this,[item_id]);this.fireEvent("showConfirmation",name,title,message,func);},streamItemDeleteCall:function(item_id){var params={item_id:item_id};this.call("home","delete",params,null,null);},showRoom:function(room){if(this.rooms.has(room.username)){this.fireEvent("viewSwitch",this.appId,"room_"+room.username,"room_"+room.username);}else{var options={room:room};this.fireEvent("startAppInstance","room",room.username,options);}},roomProfilePicUpdated:function(data){if(!$defined(data.username)){return;}var room=this.getRoom(data.username);var room_id=room.room_id;var username=room.username;var version=UserUtility.profilePicVersionGet(room_id);version++;UserUtility.profilePicVersionSet(room_id,version);room.profile_pic_16=room.profile_pic_16.split("?")[0]+"?"+version;room.profile_pic_20=room.profile_pic_20.split("?")[0]+"?"+version;room.profile_pic_26=room.profile_pic_26.split("?")[0]+"?"+version;room.profile_pic_32=room.profile_pic_32.split("?")[0]+"?"+version;room.profile_pic_42=room.profile_pic_42.split("?")[0]+"?"+version;room.profile_pic_60=room.profile_pic_60.split("?")[0]+"?"+version;room.profile_pic_100=room.profile_pic_100.split("?")[0]+"?"+version;room.profile_pic_200=room.profile_pic_200.split("?")[0]+"?"+version;$$(".profile_pic_16_"+username).each(function(el){el.set("src",room.profile_pic_16);});$$(".profile_pic_20_"+username).each(function(el){el.set("src",room.profile_pic_20);});$$(".profile_pic_60_"+username).each(function(el){el.set("src",room.profile_pic_60);});$$(".profile_pic_26_"+username).each(function(el){el.set("src",room.profile_pic_26);});$$(".profile_pic_32_"+username).each(function(el){el.set("src",room.profile_pic_32);});$$(".profile_pic_42_"+username).each(function(el){el.set("src",room.profile_pic_42);});$$(".profile_pic_100_"+username).each(function(el){el.set("src",room.profile_pic_100);});$$(".profile_pic_200_"+username).each(function(el){el.set("src",room.profile_pic_200);});}});Home.implement({requests:[{name:"stream_in_load",params:["date_created","item_id"],url:"/api/pipio/stream/in/load"},{name:"stream_user_load",params:["username","date_created","item_id"],url:"/api/pipio/stream/user/load"},{name:"public_stream_user_load",params:["username","date_created","item_id"],url:"/api/public/stream/user/load"},{name:"stream_room_load",params:["username","date_created","item_id"],url:"/api/pipio/stream/room/load"},{name:"public_stream_room_load",params:["username","date_created","item_id"],url:"/api/public/stream/room/load"},{name:"stream_convo_load",params:["convo_id","date_created","item_id"],url:"/api/pipio/stream/convo/load"},{name:"stream_likes_load",params:["username","date_created","item_id"],url:"/api/pipio/stream/likes/load"},{name:"stream_global_load",params:["geohash","date_created","item_id"],url:"/api/pipio/stream/global/load"},{name:"stream_item_like",params:["item_id"],url:"/api/pipio/stream/like"},{name:"publish",url:"/api/pipio/stream/publish",params:["body","targets","source_id","source_type","reply_id","channel_id","is_public","res","attachment"]},{name:"forward",url:"/api/pipio/stream/forward",params:["body","targets","source_id","source_type","forward_id","channel_id","is_public","res"]},{name:"delete",url:"/api/pipio/stream/delete",params:["item_id"]},{name:"parse_hulu_url",url:"/api/pipio/link/parse/hulu",params:["url"]},{name:"parse_break_url",url:"/api/pipio/link/parse/break",params:["url"]},{name:"room_create",url:"/api/pipio/room/create",params:["username","room_name","room_description","is_public"]},{name:"room_delete",url:"/api/pipio/room/delete",params:["username"]},{name:"room_leave",url:"/api/pipio/room/leave",params:["username"]},{name:"room_kick",url:"/api/pipio/room/kick",params:["username","room_username"]},{name:"room_subscribe",url:"/api/pipio/room/subscribe",params:["username"]},{name:"room_unsubscribe",url:"/api/pipio/room/unsubscribe",params:["username"]},{name:"room_request_create",url:"/api/pipio/room/request/create",params:["username"]},{name:"room_request_delete",url:"/api/pipio/room/request/delete",params:["username","room_username"]},{name:"room_request_accept",url:"/api/pipio/room/request/accept",params:["username","room_username"]},{name:"room_invite_create",url:"/api/pipio/room/invite/create",params:["username","room_username"]},{name:"room_invite_accept",url:"/api/pipio/room/invite/accept",params:["username"]},{name:"room_invite_delete",url:"/api/pipio/room/invite/delete",params:["username","room_username"]},{name:"room_info_load",url:"/api/pipio/room/info/load",params:["username"]},{name:"public_room_info_load",url:"/api/public/room/info/load",params:["username"]},{name:"public_user_info_load",url:"/api/public/user/info/load",params:["username"]},{name:"room_privacy_set",url:"/api/pipio/room/privacy/set",params:["username","is_public"]},{name:"room_profile_update",url:"/api/pipio/room/profile/update",params:["username","bio","url"]},{name:"room_search",url:"/api/pipio/room/search",params:["query"]}]});Home.implement({initRooms:function(){this.rooms=$H();this.roomInvites=$H();this.getRooms().each(function(room){this.roomAdd(room);},this);},feedRoomAdded:function(room){if(!this.rooms.has(room.username)){this.roomAdd(room);}},feedRoomKick:function(username,room_username){this.call("home","room_kick",{username:username,room_username:room_username},null,null);},feedRoomRequestAccept:function(username,room_username){this.call("home","room_request_accept",{username:username,room_username:room_username},null,null);},feedRoomRequestDelete:function(username,room_username){this.call("home","room_request_delete",{username:username,room_username:room_username},null,null);},feedRoomDelete:function(username){this.call("home","room_delete",{username:username},null,null);},feedRoomDeleted:function(username){if(!this.rooms.has(username)){return;}this.roomDelete(username);},showCreateRoomPopup:function(){if($defined(this.createRoomPopup)){this.createRoomPopup.close();}this.createCreateRoomPopup();},createCreateRoomPopup:function(){this.createRoomPopup=new Popup({size:{x:350,y:176},resizable:false,dockable:false,className:"createRoom",onClose:this.destroyCreateRoomPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"rooms",iconAction:"add"},displayName:"Create New Room",closable:true});var content=new CreateRoomPopupContent({});this.createRoomPopup.addContent("create_room",nav,content);},destroyCreateRoomPopup:function(){this.createRoomPopup=null;}});Home.implement({setupNav:function(){Logger().log("home setup");var homeNav=new Nav({iconOptions:{iconName:"updates"},displayName:"Updates",name:"updates",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"updates","self_menu"])});this.navAdd(homeNav);this.navAdd(new Nav({iconOptions:{iconName:"star"},displayName:"Favorites",name:"likes",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"likes","likes_menu"])}));this.navAdd(new Nav({iconOptions:{iconName:"rooms"},hasSubnavs:true,displayName:"Rooms",name:"rooms"}));this.navAdd(new Nav({iconOptions:{iconName:"search"},displayName:"Search Rooms...",onClick:this.fireEvent.bind(this,["showSearchRoomPopup"]),name:"find_room",parentName:"rooms",bottom:true}));this.navAdd(new Nav({iconOptions:{iconName:"rooms",iconAction:"add"},displayName:"Create New Room...",onClick:this.fireEvent.bind(this,["showCreateRoomPopup"]),name:"new_room",parentName:"rooms",bottom:true}));var selfMenu=new SelfMenu({user:this.getPrivateUser(),isDefault:true});this.menuAdd("self_menu",selfMenu);var content=new HomeContent({isDefault:true,navId:homeNav.navId});this.contentAdd("updates",content);var likesMenu=new LikesMenu({user:this.getPrivateUser()});this.menuAdd("likes_menu",likesMenu);var likesContent=new LikesContent({user:this.getPrivateUser()});this.contentAdd("likes",likesContent);},roomAdd:function(room){var nav=new Nav({iconOptions:{user:room},displayName:room.room_name,name:"room_"+room.username,parentName:"rooms",onClick:this.fireEvent.bind(this,["showRoom",room])});this.navAdd(nav);this.rooms.set(room.username,nav);},roomDelete:function(username){if(!this.rooms.has(username)){return;}this.rooms.get(username).destroy();this.navDelete("room_"+username);this.rooms.erase(username);this.menuClose("room_"+username);this.contentClose("room_"+username);},showRoomInvitePopup:function(room){if($defined(this.roomInvitePopup)){this.roomInvitePopup.close();}this.createRoomInvitePopup(room);},createRoomInvitePopup:function(room){this.roomInvitePopup=new Popup({size:{x:250,y:350},resizable:false,dockable:false,className:"roomInvite",onClose:this.destroyCreateRoomPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"rooms",iconAction:"add"},displayName:"Invite Users to "+room.room_name,closable:true});var content=new RoomInvitePopupContent({contacts:this.getContacts(),room:room});this.roomInvitePopup.addContent("create_room",nav,content);},destroyRoomInvitePopup:function(){this.roomInvitePopup=null;},showRoomStatusUpdatePopup:function(room){if($defined(this.roomStatusUpdatePopup)){this.roomStatusUpdatePopup.close();}this.createRoomStatusUpdatePopup(room);},createRoomStatusUpdatePopup:function(room){this.roomStatusUpdatePopup=new Popup({size:{x:350,y:100},resizable:false,dockable:false,className:"statusUpdate",onClose:this.destroyRoomStatusUpdatePopup.bind(this)});var nav=new Nav({iconOptions:{user:room},displayName:"Update Status for "+room.room_name,closable:true});var content=new RoomStatusUpdatePopupContent({room:room});this.roomStatusUpdatePopup.addContent("status_update",nav,content);},destroyRoomStatusUpdatePopup:function(){this.roomStatusUpdatePopup=null;},showConvo:function(convo_id){if(this.convos.has(convo_id)){this.convos.get(convo_id)._select();return;}this.createConvoPopup(convo_id);},createConvoPopup:function(convo_id){var popup=new Popup({size:{x:500,y:400},resizable:false,dockable:true,className:"convoViewer",onClose:this.destroyConvoPopup.bind(this,[convo_id])});var nav=new Nav({iconOptions:{iconName:"convo"},displayName:"View Conversation",closable:true});var content=new ConvoPopupContent({convo_id:convo_id});popup.addContent("convo",nav,content);this.convos.set(convo_id,popup);},destroyConvoPopup:function(convo_id){this.convos.erase(convo_id);},showEditProfilePopup:function(){if($defined(this.editProfilePopup)){this.editProfilePopup.close();}this.createEditProfilePopup();},createEditProfilePopup:function(room){this.editProfilePopup=new Popup({size:{x:350,y:200},resizable:false,dockable:false,className:"editProfile",onClose:this.destroyEditProfilePopup.bind(this)});var nav=new Nav({iconOptions:{user:this.getPrivateUser()},displayName:"Edit Your Profile",closable:true});var content=new EditProfilePopupContent({user:this.getPrivateUser()});this.editProfilePopup.addContent("edit_profile",nav,content);},destroyEditProfilePopup:function(){this.editProfilePopup=null;},showEditRoomProfilePopup:function(room){if($defined(this.editRoomProfilePopup)){this.editRoomProfilePopup.close();}this.createEditRoomProfilePopup(room);},createEditRoomProfilePopup:function(room){this.editRoomProfilePopup=new Popup({size:{x:350,y:140},resizable:false,dockable:false,className:"editProfile",onClose:this.destroyEditRoomProfilePopup.bind(this)});var nav=new Nav({iconOptions:{user:room},displayName:"Edit Room Profile",closable:true});var content=new RoomEditProfilePopupContent({room:room});this.editRoomProfilePopup.addContent("edit_room_profile",nav,content);},destroyEditRoomProfilePopup:function(){this.editRoomProfilePopup=null;}});var HomeContent=new Class({Extends:Content,EventHandlers:["streamItemReceived","streamItemDeleted"],onBeforeInit:function(options){this.navId=options.navId;return options;},onInit:function(){this.statusBox=new StatusBox(this.getPrivateUser());$(this.statusBox).inject(this.content);this.loader=new StreamLoader({createElementFunc:StreamItemUtility.createInStreamItem,emptyEl:new Element("div",{"class":"post empty","text":"You have no updates"}),loadingEl:new Element("div",{"class":"post empty","text":"Your updates loading..."}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},streamItemReceived:function(data){if($defined(data.item)){this.loader.process(data.item);}Logger().log(JSON.encode(data.item.item_id));if(data.item.source_id!=this.getPrivateUser().user_id&&data.item.source_type==3){data.username=data.item.source.username;this.fireEvent("roomStreamItemReceived",data);}},alertCheck:function(item){if(item.creator_id!=this.getPrivateUser().user_id){this.fireEvent("alertAdd",this.navId);}},streamItemDeleted:function(data){if(!$defined(data.item_id)){return;}this.loader.remove(data.item_id);if($defined(data.source_id)&&data.source_id!=this.getPrivateUser().user_id){if(data.source_type==1){this.fireEvent("userStreamItemDeleted",data);}else{if(data.source_type==3){this.fireEvent("roomStreamItemDeleted",data);}}}},loadMore:function(){var params={date_created:this.loader.oldestTimestamp,item_id:this.loader.oldestId};this.call("home","stream_in_load",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){Logger().log("home content bottom");this.loadMore();}});var LikesContent=new Class({Extends:Content,EventHandlers:["userStreamItemLiked","streamItemLike"],onBeforeInit:function(options){this.user=options.user;},onInit:function(){var createFunc=StreamItemUtility.createLikesStreamItem;if(this.user.user_id==this.getPrivateUser().user_id){createFunc=StreamItemUtility.createSelfLikesStreamItem;}this.loader=new ItemLoader({createElementFunc:createFunc,idField:"item_id",sortField:"date_created",sortAscending:false,emptyEl:new Element("div",{"class":"post empty","text":TextUtility.unescape(this.user.fullname)+" has no favorites"}),emptyEl:new Element("div",{"class":"post empty","text":TextUtility.unescape(this.user.fullname)+"'s favorites loading..."}),errorEl:new Element("div",{"class":"post empty","text":TextUtility.unescape(this.user.fullname)+"'s stream is private"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},userStreamItemLiked:function(data){if($defined(data.item)&&data.username==this.user.username){if(data.is_liked==1){this.loader.process(data.item);}else{this.loader.remove(data.item.item_id);}}},streamItemLike:function(item_id,likes,is_liked){if(is_liked==1){this.loader.remove(item_id);}},loadMore:function(){var params={username:this.user.username,date_created:this.loader.oldestTimestamp,item_id:this.loader.oldestId};this.call("home","stream_likes_load",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){this.loader.hideLoading();if(status.code==2002){this.loader.showError();}},bottomFunc:function(){this.loadMore();}});var ConvoPopupContent=new Class({Extends:PopupContent,EventHandlers:[],onBeforeInit:function(options){this.convo_id=options.convo_id;return options;},onInit:function(){this.convoWrapper=new Element("div",{"class":"convoWrapper"}).inject(this.content);this.loader=new ItemLoader({idField:"item_id",sortField:"date_created",createElementFunc:StreamItemUtility.createConvoStreamItem,emptyEl:new Element("div",{"class":"post empty","text":"This conversation is empty"}),loadingEl:new Element("div",{"class":"post empty","text":"Conversation loading..."})});this.convoWrapper.addEvent("mousewheel",this.checkScroll.bind(this));$(this.loader).inject(this.convoWrapper);this.scroll=new Fx.Scroll(this.convoWrapper);this.loadMore();},onShow:function(){if($defined(this.scrollY)){this.scroll.set(0,this.scrollY);}},onHide:function(){if($defined(this.convoWrapper)){this.scrollY=this.convoWrapper.getScroll().y;}},loadMore:function(){var params={convo_id:this.convo_id,date_created:this.loader.highestSortValue,item_id:this.loader.highestId};this.call("home","stream_convo_load",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){Logger().log("home content bottom");this.loadMore();},checkScroll:function(){var maxY=this.convoWrapper.getScrollSize().y;var bottomY=this.convoWrapper.getScroll().y+this.convoWrapper.getSize().y+100;if(bottomY>maxY&&!this.bottomFuncCalled&&!this.atBottom){this.bottomFuncCalled=true;this.bottomFunc();}}});var CreateRoomPopupContent=new Class({Extends:PopupContent,strings:{roomUsernameLabel:"Nickname:",roomNameLabel:"Room Name:",roomDescriptionLabel:"Description:",publicLabel:"Public:",errorMessage:"There was an error creating this room"},onInit:function(){this.roomUsernameInput=new Element("input",{"type":"text","maxlength":"32"});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.roomUsernameLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.roomUsernameInput)).inject(this.content);this.roomNameInput=new Element("input",{"type":"text","maxlength":"32"});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.roomNameLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.roomNameInput)).inject(this.content);this.roomDescriptionInput=new Element("input",{"type":"text","maxlength":"32"});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.roomDescriptionLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.roomDescriptionInput)).inject(this.content);this.publicToggle=new Toggle(true);new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.publicLabel}),$(this.publicToggle)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Create Room",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.createRoom.bind(this));this.message=new Element("div",{"class":"message error"});this.actions=new Element("div",{"class":"actions"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},createRoom:function(){var username=this.roomUsernameInput.value.trim();var room_name=this.roomNameInput.value.trim();var room_description=this.roomDescriptionInput.value.trim();var is_public=this.publicToggle.toInt();var params={username:username,room_name:room_name,room_description:room_description,is_public:is_public};this.call("home","room_create",params,this.createRoomSuccess.bind(this),this.createRoomFail.bind(this));this.actionButton.showProgress();},createRoomSuccess:function(){this.actionButton.hideProgress();this.closeContent();},createRoomFail:function(status){this.actionButton.hideProgress();var name="create_room";var title="Error Creating Room";var message=status.message;this.fireEvent("showAlert",name,title,message);},onShow:function(){this.focus();},focus:function(){this.roomUsernameInput.focus.delay(500,this.roomUsernameInput);}});var EditProfilePopupContent=new Class({Extends:PopupContent,strings:{bioLabel:"Bio:",interestsLabel:"Interests:",urlLabel:"Website:"},onBeforeInit:function(options){this.user=options.user;return options;},onInit:function(){this.bioInput=new Element("textarea",{"maxlength":500});new Element("div",{"class":"input_section bio"}).adopt(new Element("div",{"class":"label light","text":this.strings.bioLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.bioInput)).inject(this.content);this.interestsInput=new Element("textarea",{"maxlength":500});new Element("div",{"class":"input_section bio"}).adopt(new Element("div",{"class":"label light","text":this.strings.interestsLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.interestsInput)).inject(this.content);this.urlInput=new Element("input",{"type":"text","maxlength":200});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.urlLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.urlInput)).inject(this.content);var about=this.getProfile(this.user.username);if($defined(about)){if($defined(about.bio)){this.bioInput.set("text",about.bio);}if($defined(about.interests)){this.interestsInput.set("text",about.interests);}if($defined(about.url)){this.urlInput.value=about.url;}}this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Update",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.updateProfile.bind(this));this.message=new Element("div",{"class":"message error"});this.actions=new Element("div",{"class":"actions"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},updateProfile:function(){var bio=this.bioInput.value.trim();var url=this.urlInput.value.trim();var interests=this.interestsInput.value.trim();var params={bio:bio,url:url,interests:interests};this.call("pipio","user_profile_update",params,this.updateProfileSuccess.bind(this),this.updateProfileFail.bind(this));this.actionButton.showProgress();this.message.empty();},updateProfileSuccess:function(data){this.actionButton.hideProgress();this.closeContent();},updateProfileFail:function(){this.actionButton.hideProgress();this.message.set("text",this.strings.errorMessage);},onShow:function(){this.focus();},focus:function(){this.bioInput.focus.delay(500,this.bioInput);}});var RoomInvitePopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.contacts=options.contacts;this.room=options.room;return options;},onInit:function(){this.css=new CSS();this.input=new Element("input",{"type":"text","maxlength":50});this.input.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"textarea_wrapper"}).adopt(this.input).inject(this.content);this.list=new Element("div",{"class":"itemList"}).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Close",className:"dark",action:"cross"});new Element("div",{"class":"actions"}).adopt($(this.closeButton)).inject(this.content);$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.insertContacts();this.scroll=new Fx.Scroll(this.list);},insertContacts:function(){this.contacts.each(function(user){var el=ShareBoxUtility.createContactRoomInviteItem(user);el.addEvent("click",this.inviteUser.bind(this,[user,el]));el.inject(this.list);},this);},insertSeperator:function(){new Element("div",{"class":"listItem seperator"}).inject(this.list);},inviteUser:function(user,el){var params={username:user.username,room_username:this.room.username};this.call("home","room_invite_create",params,null,null);el.addClass("invited");},inputKeyUp:function(e){if(e.key=="esc"){e.target.value="";}var val=e.target.value.trim().toLowerCase();if(val.length<2){this.list.removeClass("search");return;}this.list.addClass("search");if($defined(this.lastSelector)){this.css.remove_rule(this.lastSelector);}var selector=".listItem[val1^='"+val+"'], .listItem[val2^='"+val+"']";this.css.add_rule(selector,{"display":"block !important"}).refresh();this.lastSelector=selector;},focus:function(){this.input.focus.delay(500,this.input);},onClose:function(){if($defined(this.lastSelector)){this.css.remove_rule(this.lastSelector).refresh();}},onShow:function(){if($defined(this.scrollY)){this.scroll.set(0,this.scrollY);}this.focus();},onHide:function(){if($defined(this.list)){this.scrollY=this.list.getScroll().y;}}});var RoomStatusUpdatePopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.room=options.room;return options;},onInit:function(){this.statusInput=new Element("textarea",{"maxlength":500});this.statusInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"textarea_wrapper"}).adopt(this.statusInput).inject(this.content);this.cancelButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.cancelButton).addEvent("click",this.closeContent.bind(this));this.updateButton=new ButtonMedium({displayName:"Update Status",className:"dark",action:"check"});$(this.updateButton).addEvent("click",this.updateStatus.bind(this));new Element("div",{"class":"actions"}).adopt($(this.updateButton),$(this.cancelButton)).inject(this.content);},onShow:function(){this.focus();},focus:function(){this.statusInput.focus.delay(500,this.statusInput);},inputKeyUp:function(e){if(e.key=="enter"){var msg=e.target.value.trim();if(msg==""){return;}this.updateStatus();}},updateStatus:function(){var params={username:this.room.username,body:this.statusInput.value.trim(),res:this.getSession()};this.call("pipio","publish_roomstatus",params,this.updateStatusSuccess.bind(this),this.updateStatusFail.bind(this));this.updateButton.showProgress();},updateStatusSuccess:function(){this.closeContent();},updateStatusFail:function(){alert("There was an error updating your status!");}});var LikesMenu=new Class({Extends:Menu,EventHandlers:[],onBeforeInit:function(options){this.user=options.user;options.displayName=this.user.first_name+"'s Favorites";return options;},onInit:function(){this.aboutText=new Element("span");var likesText="These are posts "+this.user.first_name+" likes";this.aboutSection=new Element("div",{"class":"text_section light1","text":TextUtility.unescape(likesText)}).inject(this.menu);}});var SelfMenu=new Class({Extends:Menu,EventHandlers:["userLocationUpdated"],onBeforeInit:function(options){this.user=options.user;options.displayName=this.user.fullname;return options;},onInit:function(){this.map=new UserMapMenuSection({user:this.user});$(this.map).inject(this.menu);this.aboutSection=new UserProfileMenuSection({user:this.user});$(this.aboutSection).inject(this.menu);new Element("div",{"class":"nav_seperator"}).inject(this.menu);this.locationEnabled=new Toggle(this.user.location_enabled==1);$(this.locationEnabled).addEvent("click",this.locationToggle.bind(this));new Element("div",{"class":"toggle_section"}).adopt(new Element("div",{"class":"text light","text":"Location:"}),$(this.locationEnabled)).inject(this.menu);this.privacy=new Toggle(this.user.is_public==1);$(this.privacy).addEvent("click",this.privacyToggle.bind(this));new Element("div",{"class":"toggle_section"}).adopt(new Element("div",{"class":"text light","text":"Public:"}),$(this.privacy)).inject(this.menu);this.profilePicUploadButton=new ButtonMedium({displayName:"Change Picture",className:"dark",action:"photo"});this.fileInput=new Element("input",{"type":"file","name":"file"});this.form=new Element("form").adopt(this.fileInput);this.fileInput.addEvent("change",this.profilePicUpload.bind(this));this.profilePicUploadSection=new Element("div",{"class":"button_section"}).adopt($(this.profilePicUploadButton).adopt(this.form)).inject(this.menu);var editProfileButton=new ButtonMedium({displayName:"Edit Profile",className:"dark",action:"edit"});$(editProfileButton).addEvent("click",this.fireEvent.bind(this,["showEditProfilePopup"]));new Element("div",{"class":"button_section"}).adopt($(editProfileButton)).inject(this.menu);var editLocationButton=new ButtonMedium({displayName:"Edit Location",className:"dark",action:"global"});$(editLocationButton).addEvent("click",this.fireEvent.bind(this,["showLocationEditPopup"]));this.editLocationSection=new Element("div",{"class":"button_section"}).adopt($(editLocationButton)).inject(this.menu);if(this.user.location_enabled==0){DomUtility.hide(this.editLocationSection);}var searchUserButton=new ButtonMedium({displayName:"Find Friends",className:"dark",action:"search"});$(searchUserButton).addEvent("click",this.fireEvent.bind(this,["searchUserShow"]));new Element("div",{"class":"button_section"}).adopt($(searchUserButton)).inject(this.menu);var inviteUserButton=new ButtonMedium({displayName:"Invite Friends",className:"dark",action:"forward"});$(inviteUserButton).addEvent("click",this.fireEvent.bind(this,["inviteUserShow"]));new Element("div",{"class":"button_section"}).adopt($(inviteUserButton)).inject(this.menu);var searchContactButton=new ButtonMedium({displayName:"Search Contacts",className:"dark",action:"status"});$(searchContactButton).addEvent("click",this.fireEvent.bind(this,["searchEmailShow"]));new Element("div",{"class":"button_section"}).adopt($(searchContactButton)).inject(this.menu);},privacyToggle:function(){this.call("pipio","user_privacy_set",{is_public:this.privacy.toInt()});},userLocationUpdated:function(username,location,location_enabled){if(username!=this.user.username){return;}if(location_enabled==1){DomUtility.show(this.editLocationSection);}else{DomUtility.hide(this.editLocationSection);}},locationToggle:function(){this.call("pipio","user_location_enabled",{location_enabled:this.locationEnabled.toInt()});},resetForm:function(){this.profilePicUploadSection.empty();this.profilePicUploadButton=new ButtonMedium({displayName:"Change Picture",className:"dark",action:"photo"});this.fileInput=new Element("input",{"type":"file","name":"file"});this.form=new Element("form").adopt(this.fileInput);this.fileInput.addEvent("change",this.profilePicUpload.bind(this));this.profilePicUploadSection.adopt($(this.profilePicUploadButton).adopt(this.form));},profilePicUpload:function(){if(DataUtility.validatePhotoFile(this.fileInput.value)){this.call("pipio","user_profilepic_upload",{},this.profilePicUploadSuccess.bind(this),this.profilePicUploadFail.bind(this),this.form);this.profilePicUploadButton.showProgress();}},profilePicUploadSuccess:function(){this.profilePicUploadButton.hideProgress();this.resetForm();},profilePicUploadFail:function(){this.profilePicUploadButton.hideProgress();this.resetForm();}});var MemberRequestsNav=new Class({Extends:Nav,EventHandlers:[],onBeforeInit:function(options){this.room=options.room;this.users=$H();options.name="member_requests_"+this.room.username;options.iconOptions={iconName:"contacts",iconAction:"add"};options.displayName="Member Requests";options.className="members_nav";options.hasSubnavs=true;return options;},onInit:function(){this.clear=new Element("div",{"style":"clear: both"});this.list=new Element("div",{"class":"menu_list"}).adopt(this.clear).inject(this.subnavs);},addUsers:function(users){$splat(users).each(function(user){user=UserUtility.processUser(user);if(!this.users.has(user.username)){var pic=ItemUtility.createProfilePic(user,"16a");pic.addEvent("click",this.fireEvent.bind(this,["showUser",user]));pic.inject(this.clear,"before");this.users.set(user.username,pic);}},this);},removeUser:function(username){if(!this.users.has(username)){return;}this.users.get(username).destroy();this.users.erase(username);}});var MembersNav=new Class({Extends:Nav,onBeforeInit:function(options){this.room=options.room;this.users=$H();options.name="members_"+this.room.username;options.iconOptions={iconName:"contacts"};options.displayName="Members";options.className="members_nav";options.hasSubnavs=true;return options;},onInit:function(){this.clear=new Element("div",{"style":"clear: both"});this.list=new Element("div",{"class":"menu_list"}).adopt(this.clear).inject(this.subnavs);},addUsers:function(users){$splat(users).each(function(user){user=UserUtility.processUser(user);if(!this.users.has(user.username)){var pic=ItemUtility.createProfilePic(user,"16a");pic.addEvent("click",this.fireEvent.bind(this,["showUser",user]));pic.inject(this.clear,"before");this.users.set(user.username,pic);}},this);},removeUser:function(username){if(!this.users.has(username)){return;}this.users.get(username).destroy();this.users.erase(username);}});var StreamItemUtility={createDateSeperatorItem:function(ts){var date=DateUtility.convertFromTimestamp(ts);var timetext=date.format("%B %D");var el=new Element("div",{"class":"post seperator","ts":ts}).adopt(new Element("div",{"class":"seperator_text","text":timetext}));return el;},createSeperatorItem:function(str){var el=new Element("div",{"class":"post seperator"}).adopt(new Element("div",{"class":"seperator_text","text":TextUtility.unescape(str)}));return el;},createInStreamItem:function(item){return StreamItemUtility.createStreamItem(item,true,false);},createUserStreamItem:function(item){return StreamItemUtility.createStreamItem(item,false,false);},createSelfLikesStreamItem:function(item){return StreamItemUtility.createStreamItem(item,true,true);},createLikesStreamItem:function(item){return StreamItemUtility.createStreamItem(item,false,true);},createStreamItem:function(item,inbound,likes_stream){var el=ItemUtility.createPostBubble("post haspic");item.creator=UserUtility.processSource(item.creator);item.source=UserUtility.processSource(item.source);if($defined(item.post.reply_user)){item.post.reply_user=UserUtility.processSource(item.post.reply_user);}if($defined(item.post.convo_user)){item.post.convo_user=UserUtility.processSource(item.post.convo_user);}if($defined(item.post.forward_user)){item.post.forward_user=UserUtility.processSource(item.post.forward_user);}item.can_delete=false;if(!$defined(item.private_replies)){item.private_replies=0;}var user_id=pipio.currentUser.user_id;if(inbound){item.can_delete=true;}else{if(item.creator_id==user_id){item.can_delete=true;}}if(likes_stream){item.can_delete=false;}if(inbound){item.can_like=true;}else{item.can_like=false;}ItemUtility.createProfilePic(item.creator,32).inject(el);if(item.reply_id!=item.item_id&&$defined(item.post.reply_user)){ItemUtility.createProfilePic(item.post.reply_user,20).inject(el);el.addClass("reply");}if(item.source_id!=item.creator_id){ItemUtility.createProfilePic(item.source,20).inject(el);}var content=new Element("div",{"class":"post_content"}).inject(el);StreamItemUtility.createStreamItemPostActions(item).inject(el);StreamItemUtility.createStreamItemHeader(item).inject(content);var attachments=StreamItemUtility.createStreamItemAttachments(item);if(attachments){attachments.inject(content);}StreamItemUtility.createStreamItemFooter(item).inject(content);return el;},createConvoStreamItem:function(item){var el=ItemUtility.createPostBubble("post haspic");item.creator=UserUtility.processSource(item.creator);item.source=UserUtility.processSource(item.source);if($defined(item.post.reply_user)){item.post.reply_user=UserUtility.processSource(item.post.reply_user);}if($defined(item.post.convo_user)){item.post.convo_user=UserUtility.processSource(item.post.convo_user);}if($defined(item.post.forward_user)){item.post.forward_user=UserUtility.processSource(item.post.forward_user);}item.can_delete=false;ItemUtility.createProfilePic(item.creator,32).inject(el);if(item.reply_id!=item.item_id&&$defined(item.post.reply_user)){ItemUtility.createProfilePic(item.post.reply_user,20).inject(el);el.addClass("reply");}if(item.source_id!=item.creator_id){ItemUtility.createProfilePic(item.source,20).inject(el);}var content=new Element("div",{"class":"post_content"}).inject(el);StreamItemUtility.createStreamItemPostActions(item).inject(el);StreamItemUtility.createStreamItemHeader(item).inject(content);var attachments=StreamItemUtility.createStreamItemAttachments(item);if(attachments){attachments.inject(content);}StreamItemUtility.createConvoStreamItemFooter(item).inject(content);return el;},createStreamMemberRoomItem:function(item){return StreamItemUtility.createStreamRoomItem(item,true);},createStreamPublicRoomItem:function(item){return StreamItemUtility.createStreamRoomItem(item,false);},createStreamRoomItem:function(item,is_member){var el=ItemUtility.createPostBubble("post haspic");item.creator=UserUtility.processSource(item.creator);item.source=UserUtility.processSource(item.source);if($defined(item.post.reply_user)){item.post.reply_user=UserUtility.processSource(item.post.reply_user);}if($defined(item.post.convo_user)){item.post.convo_user=UserUtility.processSource(item.post.convo_user);}if($defined(item.post.forward_user)){item.post.forward_user=UserUtility.processSource(item.post.forward_user);}item.can_delete=false;if(!$defined(item.private_replies)){item.private_replies=0;}var user_id=pipio.currentUser.user_id;if(item.creator_id==user_id){item.can_delete=true;}if(is_member&&item.source_id==item.creator_id){item.can_delete=true;}ItemUtility.createProfilePic(item.creator,32).inject(el);if(item.reply_id!=item.item_id&&$defined(item.post.reply_user)){ItemUtility.createProfilePic(item.post.reply_user,20).inject(el);el.addClass("reply");}var content=new Element("div",{"class":"post_content"}).inject(el);StreamItemUtility.createStreamItemPostActions(item).inject(el);StreamItemUtility.createStreamRoomItemHeader(item).inject(content);var attachments=StreamItemUtility.createStreamItemAttachments(item);if(attachments){attachments.inject(content);}StreamItemUtility.createStreamItemFooter(item).inject(content);return el;},createStreamItemPostActions:function(item){var el=new Element("div",{"class":"post_actions"});if(item.can_delete){var deleteAction=new Element("div",{"class":"post_action delete"}).inject(el);deleteAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["streamItemDelete",item.item_id]));}if(item.can_like){var likeAction=new Element("div",{"class":"post_action like likes_"+item.item_id,"is_liked":item.is_liked,"likes":item.likes}).inject(el);likeAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["streamItemLike",item.item_id,likeAction]));new Element("div",{"class":"text grey text11","text":item.likes,"likes":item.likes}).inject(likeAction);if(item.likes>0){likeAction.addClass("other_liked");}if(item.is_liked==1){likeAction.addClass("on");}}return el;},createStreamRoomItemHeader:function(item){var el=new Element("div",{"class":"header"});var is_question=false;var creator_action="broadcast dark";if(item.is_public==0){creator_action="lock dark";}else{if(item.post_type==4){creator_action="status dark";}else{if(item.post_type==5){creator_action="question dark";is_question=true;}}}StreamItemUtility.createStreamUserAction(creator_action).inject(el);StreamItemUtility.createUsernameElement(item.creator).inject(el);if(is_question){new Element("span",{"class":"grey2","text":" asks "}).inject(el);}if(item.post_type==3){StreamItemUtility.createStreamUserAction("forward").inject(el);StreamItemUtility.createUsernameElement(item.post.forward_user).inject(el);}if(item.reply_id!=item.item_id){StreamItemUtility.createStreamUserAction("reply").inject(el);StreamItemUtility.createUsernameElement(item.post.reply_user).inject(el);}var body=new Element("span",{"html":" "+TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescapeQuotes(item.post.body)))}).inject(el);if($defined(item.post.forward_body)&&item.post.forward_body!=""){body.appendText(" - "+TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescape(item.post.forward_body))));}return el;},createUsernameElement:function(user){if($defined(user.user_id)){var el=new Element("span",{"class":"user_name clickable","text":TextUtility.unescapeQuotes(user.fullname)});el.addEvent("click",pipio.dispatchEvent.bind(pipio,["showUser",user]));return el;}else{if($defined(user.room_id)){var el=new Element("span",{"class":"user_name clickable","text":TextUtility.unescapeQuotes(user.room_name)});el.addEvent("click",pipio.dispatchEvent.bind(pipio,["showRoom",user]));return el;}}},createStreamItemHeader:function(item){var el=new Element("div",{"class":"header"});var is_question=false;var creator_action="broadcast dark";if(item.is_public==0){creator_action="lock dark";}else{if(item.post_type==4){creator_action="status dark";}else{if(item.post_type==5){creator_action="question dark";is_question=true;}}}StreamItemUtility.createStreamUserAction(creator_action).inject(el);if($defined(item.source.room_id)){StreamItemUtility.createUsernameElement(item.source).inject(el);new Element("span",{"class":"dark","text":": "}).inject(el);}StreamItemUtility.createUsernameElement(item.creator).inject(el);if(is_question){new Element("span",{"class":"dark","text":" asks "}).inject(el);}if(item.post_type==3){StreamItemUtility.createStreamUserAction("forward").inject(el);StreamItemUtility.createUsernameElement(item.post.forward_user).inject(el);}if(item.reply_id!=item.item_id){StreamItemUtility.createStreamUserAction("reply").inject(el);StreamItemUtility.createUsernameElement(item.post.reply_user).inject(el);}else{if(item.creator_id!=item.source_id&&!$defined(item.source.room_id)){StreamItemUtility.createStreamUserAction("direct").inject(el);StreamItemUtility.createUsernameElement(item.source).inject(el);}}var body=new Element("span",{"html":" "+TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescapeQuotes(item.post.body)))}).inject(el);if($defined(item.post.forward_body)&&item.post.forward_body!=""){body.appendText(" - "+TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescape(item.post.forward_body))));}return el;},createStreamItemAttachments:function(item){if(item.attachment_type==0){return false;}var el=new Element("div",{"class":"attachment"}).adopt(new Element("span",{"class":"indicator","html":"&raquo;"}));switch(item.attachment_type){case 1:var pipioUrl=DataUtility.getPipioUrl(null,item.attachment[0].hash);item.attachment[0]=AttachmentUtility.parsePhotoAttachment(item.attachment[0]);item.attachment[0].url=pipioUrl;new Element("a",{"target":"_blank","href":pipioUrl,"text":TextUtility.unescape(item.attachment[0].filename)}).inject(el);if(item.attachment[0].is_photo){el.addClass("has_thumbnail");var playButton=new ButtonSmall({displayName:"View Photo",action:"photo"});$(playButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showPhotoPopup",item.attachment[0]]));$(playButton).inject(el);var thumb=new InlineImage(item.attachment[0]);$(thumb).inject(el);}break;case 2:var pipioUrl=DataUtility.getPipioUrl(item.attachment[0].url,item.attachment[0].hash);item.attachment[0]=AttachmentUtility.parseLinkAttachment(item.attachment[0]);new Element("a",{"target":"_blank","href":pipioUrl,"text":TextUtility.unescape(item.attachment[0].url)}).inject(el);if(item.attachment[0].is_video){var playButton=new ButtonSmall({displayName:"Play Video",action:"pivot_right dark"});$(playButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showVideoPopup",item.attachment[0]]));$(playButton).inject(el);}else{if(item.attachment[0].is_photo){el.addClass("has_thumbnail");var playButton=new ButtonSmall({displayName:"View Photo",action:"photo"});$(playButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showPhotoPopup",{filename:"Photo",url:item.attachment[0].url}]));$(playButton).inject(el);var thumb=new InlineImage({filename:"Photo",url:item.attachment[0].url});$(thumb).inject(el);}}break;}return new Element("div",{"class":"attachments"}).adopt(el);},createStreamItemFooter:function(item){var el=new Element("div",{"class":"footer"});if(!$defined(item.date_created)){return el;}var date=DateUtility.convertFromTimestamp(item.date_created);var ts=new Element("span",{"class":"timestamp","text":DateUtility.getTimestamp(date,"%B %D at %I:%M%p"),"ts":date,"ts_format":"%B %D at %I:%M%p"}).inject(el);if($defined(item.location)&&$defined(item.geohash)&&item.geohash!=""){var loc=DataUtility.getGeoString(item.location);if(loc){el.appendText(" from ");var location=new Element("span",{"class":"clickable","text":TextUtility.unescape(loc)}).inject(el);location.addEvent("click",pipio.dispatchEvent.bind(pipio,["showGlobal",item.location]));}}StreamItemUtility.createFooterActions(item,el);return el;},createConvoStreamItemFooter:function(item){var el=new Element("div",{"class":"footer"});if(!$defined(item.date_created)){return el;}var date=DateUtility.convertFromTimestamp(item.date_created);var ts=new Element("span",{"class":"timestamp","text":DateUtility.getTimestamp(date,"%B %D at %I:%M%p"),"ts":date,"ts_format":"%B %D at %I:%M%p"}).inject(el);if($defined(item.location)&&$defined(item.geohash)&&item.geohash!=""){var loc=DataUtility.getGeoString(item.location);if(loc){el.appendText(" from ");var location=new Element("span",{"class":"clickable","text":TextUtility.unescape(loc)}).inject(el);location.addEvent("click",pipio.dispatchEvent.bind(pipio,["showGlobal",item.location]));}}StreamItemUtility.createConvoFooterActions(item,el);return el;},createFooterActions:function(item,el){if(!pipio.isLoggedIn()){return;}if(item.convo_id!=item.item_id){var convoAction=StreamItemUtility.createFooterAction("convo","View Conversation",true);convoAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["showConvo",item.convo_id]));convoAction.inject(el);}else{var convoAction=StreamItemUtility.createRepliesAction(item);convoAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["showConvo",item.convo_id]));convoAction.inject(el);}var replyAction=StreamItemUtility.createFooterAction("reply","Reply",true);replyAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["replyShareBoxShow",item.item_id]));replyAction.inject(el);if(item.is_public==1){var forward_id=(item.post_type==3&&item.forward_id!=0)?item.forward_id:item.item_id;var forwardAction=StreamItemUtility.createFooterAction("forward","Forward",true).inject(el);forwardAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["forwardShareBoxShow",forward_id,item.creator.username,item.post.body]));}},createConvoFooterActions:function(item,el){var replyAction=StreamItemUtility.createFooterAction("reply","Reply",true);replyAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["replyShareBoxShow",item.item_id]));replyAction.inject(el);if(item.is_public==1){var forward_id=(item.forward_id!=0)?item.forward_id:item.item_id;var forwardAction=StreamItemUtility.createFooterAction("forward","Forward",true).inject(el);forwardAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["forwardShareBoxShow",forward_id,item.creator.username,item.post.body]));}},createRepliesAction:function(item){var repliesClass="replies_"+item.item_id;var replies=item.replies+item.private_replies;var el=new Element("span",{"class":"footer_action has_action "+repliesClass,"replies":replies}).adopt(new Element("div",{"class":"action convo"}));el.appendText(TextUtility.pluralText(replies,"Reply","Replies"));return el;},updateReplyCount:function(item_id,count){$$(".replies_"+item_id).each(function(el){var replies=parseInt(el.get("replies"))+count;el.set("replies",replies);el.empty();el.adopt(new Element("div",{"class":"action convo"}));el.appendText(TextUtility.pluralText(replies,"Reply","Replies"));});},updateItemLiked:function(item_id,likes,is_liked){Logger().log(item_id+"-"+likes+"-"+is_liked);$$(".likes_"+item_id).each(function(el){el.set("likes",likes);if(is_liked!=-1){el.set("is_liked",is_liked);}el.empty();new Element("div",{"class":"text grey text11","text":likes,"likes":likes}).inject(el);if(likes>0){el.addClass("other_liked");}else{el.removeClass("other_liked");}if(is_liked!=-1){if(is_liked==1){el.addClass("on");}else{el.removeClass("on");}}});},createFooterAction:function(actionName,actionText,hide){var el=new Element("span",{"class":"footer_action has_action"}).adopt(new Element("div",{"class":"action "+actionName}));el.appendText(actionText);if(hide){el.addClass("hide");}return el;},createStreamUserAction:function(user_action){var el=new Element("span",{"class":"user_action"}).adopt(new Element("div",{"class":"action "+user_action}));return el;},createStatusBoxFooter:function(status_message){var el=new Element("div",{"class":"footer"});if(!$defined(status_message)){return el;}if(!$defined(status_message.date_created)){return el;}var date=DateUtility.convertFromTimestamp(status_message.date_created);var ts=new Element("span",{"class":"timestamp","text":DateUtility.getTimestamp(date,"%B %D at %I:%M%p"),"ts":date,"ts_format":"%B %D at %I:%M%p"}).inject(el);if($defined(status_message.location)&&$defined(status_message.location.geohash)&&status_message.location.geohash!=""){var loc=DataUtility.getGeoString(status_message.location);if(loc){el.appendText(" from ");new Element("span",{"text":TextUtility.unescape(loc)}).inject(el);}}return el;}};var Room=new Class({Extends:AppInstance,EventHandlers:["roomClosed","userSwitched"],parseOptions:function(options){this.room=options.room;this.displayName=this.room.room_name;this.appId="room_"+this.room.username;this.iconOptions={user:this.room};},userSwitched:function(){this.stop();},onStart:function(){this.setupNav();},onStop:function(){},roomClosed:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.stop();}});Room.implement({setupNav:function(){Logger().log("home setup");this.navAdd(new Nav({iconOptions:{iconName:"updates"},displayName:"Updates",name:"updates",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"updates","room_menu"])}));var roomMenu=new RoomMenu({displayName:this.room.room_name,room:this.room,appId:this.appId,isDefault:true,closeFunc:this.stop.bind(this)});this.menuAdd("room_menu",roomMenu);var content=new RoomContent({isDefault:true,room:this.room});this.contentAdd("updates",content);var membersContent=new RoomMembersContent({room:this.room});this.contentAdd("room_members",membersContent);var subscribersContent=new RoomSubscribersContent({room:this.room});this.contentAdd("room_subscribers",subscribersContent);var requestsContent=new RoomRequestsContent({room:this.room});this.contentAdd("room_requests",requestsContent);}});var RoomContent=new Class({Extends:Content,EventHandlers:["streamItemReceived","roomStreamItemDeleted"],onBeforeInit:function(options){this.room=options.room;},onInit:function(){this.statusBox=new RoomStatusBox(this.room);$(this.statusBox).inject(this.content);this.loader=new StreamLoader({createElementFunc:StreamItemUtility.createStreamMemberRoomItem,emptyEl:new Element("div",{"class":"post empty","text":"This room has no updates"}),loadingEl:new Element("div",{"class":"post empty","text":"Room updates loading..."}),errorEl:new Element("div",{"class":"post empty","text":"This room is private"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},roomStreamItemReceived:function(data){if(!$defined(data.item)||!$defined(data.username)||data.username!=this.room.username){return;}Logger().log("roomItemRecevied, processing");this.loader.process(data.item);},streamItemReceived:function(data){if($defined(data.item)&&data.item.source.username==this.room.username){this.loader.process(data.item);}},roomStreamItemDeleted:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.loader.remove(data.item_id);},alertCheck:function(item){if(item.creator_id!=this.getPrivateUser().user_id){this.fireEvent("alertAdd","2_room_"+this.room.username);}},loadMore:function(){var params={username:this.room.username,date_created:this.loader.oldestTimestamp,item_id:this.loader.oldestId};if(this.isLoggedIn()){this.call("home","stream_room_load",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));}else{this.call("home","public_stream_room_load",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));}this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){if(status.code==2002){this.loader.showError();}},bottomFunc:function(){this.loadMore();}});var RoomMembersContent=new Class({Extends:Content,EventHandlers:["roomMemberAdded","roomMemberDeleted"],onBeforeInit:function(options){this.room=options.room;this.isCreator=this.room.creator_id==this.getPrivateUser().user_id;return options;},onInit:function(){this.statusBox=new RoomStatusBox(this.room);$(this.statusBox).inject(this.content);StreamItemUtility.createSeperatorItem("Members").inject(this.content);this.loader=new ItemLoader({idField:"user_id",sortField:"date_created",sortAscending:false,createElementFunc:ContactItemUtility.createRoomMemberItemFactory(this.room,this.isCreator),emptyEl:new Element("div",{"class":"post empty","text":"There are no members in this room"}),loadingEl:new Element("div",{"class":"post empty","text":"Room members loading..."})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},loadMore:function(){var params={username:this.room.username,date_created:this.loader.lowestSortValue};this.call("pipio","room_members",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.members)||data.members.length==0){this.atBottom=true;return;}data.members.each(function(user){var user_copy=UserUtility.processUser(user);user_copy.date_created=user.date_created;this.loader.process(user_copy);},this);this.bottomFuncCalled=false;},bottomFunc:function(){this.loadMore();},roomMemberAdded:function(data){if(!$defined(data.room_username)||!$defined(data.user)||data.room_username!=this.room.username){return;}var user=UserUtility.processUser(data.user);user.date_created=new Date().getTime()/1000;this.loader.process(user);},roomMemberDeleted:function(data){if(!$defined(data.username)||!$defined(data.room_username)||data.room_username!=this.room.username){return;}if(!$defined(this.getUser(data.username))){return;}var user=this.getUser(data.username);this.loader.remove(user.user_id);}});var RoomRequestsContent=new Class({Extends:Content,EventHandlers:["roomMemberRequestDeleted","roomMemberRequestAdded","roomMemberAdded"],onBeforeInit:function(options){this.room=options.room;return options;},onInit:function(){this.statusBox=new RoomStatusBox(this.room);$(this.statusBox).inject(this.content);StreamItemUtility.createSeperatorItem("Membership Requests").inject(this.content);this.loader=new ItemLoader({idField:"user_id",sortField:"date_created",sortAscending:false,createElementFunc:ContactItemUtility.createRoomRequestItemFactory(this.room),emptyEl:new Element("div",{"class":"post empty","text":"There are no membership requests to this room"}),loadingEl:new Element("div",{"class":"post empty","text":"Room member requests loading..."})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},loadMore:function(){var params={username:this.room.username,date_created:this.loader.lowestSortValue};this.call("pipio","room_requests",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.requests)||data.requests.length==0){this.atBottom=true;return;}data.requests.each(function(user){var user_copy=UserUtility.processUser(user);user_copy.date_created=user.date_created;this.loader.process(user_copy);},this);this.bottomFuncCalled=false;},bottomFunc:function(){this.loadMore();},roomMemberAdded:function(data){if(!$defined(data.room_username)||!$defined(data.user)||data.room_username!=this.room.username){return;}this.loader.remove(data.user.user_id);},roomMemberRequestDeleted:function(data){if(!$defined(data.room_username)||!$defined(data.username)||data.room_username!=this.room.username){return;}if(!$defined(this.getUser(data.username))){return;}var user=this.getUser(data.username);this.loader.remove(user.user_id);},roomMemberRequestAdded:function(data){if(!$defined(data.room_username)||!$defined(data.user)||data.room_username!=this.room.username){return;}var user=UserUtility.processUser(data.user);user.date_created=new Date().getTime()/1000;this.loader.process(user);}});var RoomSubscribersContent=new Class({Extends:Content,EventHandlers:["roomSubscriberAdded","roomSubscriberDeleted"],onBeforeInit:function(options){this.room=options.room;return options;},onInit:function(){this.statusBox=new RoomStatusBox(this.room);$(this.statusBox).inject(this.content);StreamItemUtility.createSeperatorItem("Subscribers").inject(this.content);this.loader=new ItemLoader({idField:"user_id",sortField:"date_created",sortAscending:false,createElementFunc:ContactItemUtility.createRoomSubscriberItem,emptyEl:new Element("div",{"class":"post empty","text":"There are no subscribers to this room"}),loadingEl:new Element("div",{"class":"post empty","text":"Room subscribers loading..."})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},roomSubscriberAdded:function(data){if(!$defined(data.username)||!$defined(data.user)||data.username!=this.room.username){return;}var user=UserUtility.processUser(data.user);user.date_created=new Date().getTime()/1000;this.loader.process(user);},roomSubscriberDeleted:function(data){if(!$defined(data.username)||!$defined(data.room_username)||data.room_username!=this.room.username){return;}if(!$defined(this.getUser(data.username))){return;}var user=this.getUser(data.username);this.loader.remove(user.user_id);},loadMore:function(){var params={username:this.room.username,date_created:this.loader.lowestSortValue};this.call("pipio","room_subscribers",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.subscribers)||data.subscribers.length==0){this.atBottom=true;return;}data.subscribers.each(function(user){var user_copy=UserUtility.processUser(user);user_copy.date_created=user.date_created;this.loader.process(user_copy);},this);this.bottomFuncCalled=false;},bottomFunc:function(){this.loadMore();}});var RoomEditProfilePopupContent=new Class({Extends:PopupContent,strings:{bioLabel:"About:",urlLabel:"Website:"},onBeforeInit:function(options){this.room=options.room;return options;},onInit:function(){this.bioInput=new Element("textarea",{"maxlength":500});new Element("div",{"class":"input_section bio"}).adopt(new Element("div",{"class":"label light","text":this.strings.bioLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.bioInput)).inject(this.content);this.urlInput=new Element("input",{"type":"text","maxlength":200});new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.urlLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.urlInput)).inject(this.content);var about=this.getProfile(this.room.username);if($defined(about)){if($defined(about.bio)){this.bioInput.set("text",about.bio);}if($defined(about.url)){this.urlInput.value=about.url;}}this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Update",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.updateProfile.bind(this));this.message=new Element("div",{"class":"message error"});this.actions=new Element("div",{"class":"actions"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},updateProfile:function(){var bio=this.bioInput.value.trim();var url=this.urlInput.value.trim();var params={username:this.room.username,bio:bio,url:url};this.call("home","room_profile_update",params,this.updateProfileSuccess.bind(this),this.updateProfileFail.bind(this));this.actionButton.showProgress();this.message.empty();},updateProfileSuccess:function(data){this.actionButton.hideProgress();this.closeContent();},updateProfileFail:function(){this.actionButton.hideProgress();this.message.set("text",this.strings.errorMessage);},onShow:function(){this.focus();},focus:function(){this.bioInput.focus.delay(500,this.bioInput);}});var RoomSearchPopupContent=new Class({Extends:PopupContent,strings:{roomSearchMessage:"Enter any terms to search for a room",errorMessage:"There was an error creating this group"},onInit:function(){new Element("div",{"class":"text_section centered light","text":this.strings.roomSearchMessage}).inject(this.content);this.searchInput=new Element("input",{"type":"text","maxlength":"50"});this.searchInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"textarea_wrapper"}).adopt(this.searchInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Search",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.search.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key=="enter"){if(this.searchInput.value.trim()!=""){this.search();}}},search:function(){var query=this.searchInput.value.trim();var params={query:query};this.call("home","room_search",params,this.searchSuccess.bind(this),this.searchFail.bind(this));this.actionButton.showProgress();},searchSuccess:function(data){this.actionButton.hideProgress();if(!$defined(data.rooms)){return;}if(data.rooms.length==0){var name="room_search";var title="No Results";var message="Your search returned no results";this.fireEvent("showAlert",name,title,message);}else{this.showResultsPopup(data.rooms);}},searchFail:function(status){this.actionButton.hideProgress();var name="search_user";var title="Error";var message=status.message;this.fireEvent("showAlert",name,title,message);},showResultsPopup:function(rooms){if($defined(this.resultsPopup)){this.resultsPopup.close();}this.createResultsPopup(rooms);},closeResultsPopup:function(){if($defined(this.resultsPopup)){this.resultsPopup.close();}},createResultsPopup:function(rooms){this.resultsPopup=new Popup({size:{x:350,y:400},resizable:false,dockable:false,className:"roomSearch",onClose:this.destroyResultsPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"search"},displayName:"Search Results",closable:true});var content=new RoomSearchResultPopupContent({rooms:rooms});this.resultsPopup.addContent("results",nav,content);},destroyResultsPopup:function(){this.resultsPopup=null;},onShow:function(){this.focus();},focus:function(){this.searchInput.focus.delay(500,this.searchInput);},onClose:function(){this.closeResultsPopup();}});var RoomSearchResultPopupContent=new Class({Extends:PopupContent,strings:{searchResultMessage:"Search results"},onBeforeInit:function(options){this.rooms=options.rooms;return options;},onInit:function(){this.list=new Element("div",{"class":"itemList"}).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Close",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.closeButton)).inject(this.content);this.insertRooms();},insertRooms:function(){this.rooms.each(function(room){room=UserUtility.processRoom(room);this.insertRoom(room);},this);},insertRoom:function(room){var el=RoomItemUtility.createRoomItem(room);el.addEvent("click",this.fireEvent.bind(this,["showRoom",room]));el.inject(this.list);}});var RoomItemUtility={createRoomItem:function(room){var el=new Element("div",{"class":"listItem"});ItemUtility.createProfilePic(room,32).inject(el);new Element("div",{"class":"listText text12 light","text":TextUtility.cleanText(room.room_name+" ("+room.username+")")}).inject(el);if($defined(room.about)&&$defined(room.about.bio)){new Element("div",{"class":"about_text text11 light3","text":TextUtility.cleanText(room.about.bio)}).inject(el);}return el;}};var RoomConnectionMenuSection=new Class({Extends:Base,EventHandlers:["roomStreamSubscriptionAdded","roomStreamSubscriptionDeleted","roomMembershipUpdated"],init:function(options){this.room=this.getRoom(options.room.username);this.subscribed=parseInt(this.room.subscribed)==1;this.isCreator=this.room.creator_id==this.getPrivateUser().user_id;this.createSection();},createSection:function(){this.wrapper=new Element("div");this.generateSection();},setRoom:function(room){this.room=room;this.generateSection();},generateSection:function(){this.wrapper.empty();this.generateSubscriptionSection();if(this.isCreator){this.generatePrivacySection();new Element("div",{"class":"text_section light centered text11","text":"You are the creator"}).inject(this.wrapper);this.button=new ButtonMedium({displayName:"Close Room",className:"dark",action:"cross"});var name="roomDelete_"+this.room.username;var title="Close "+this.room.room_name;var message="Are you sure you want to close the room "+this.room.room_name+"?";var func=pipio.dispatchEvent.bind(pipio,["feedRoomDelete",this.room.username]);$(this.button).addEvent("click",pipio.dispatchEvent.bind(pipio,["showConfirmation",name,title,message,func]));new Element("div",{"class":"button_section"}).adopt($(this.button)).inject(this.wrapper);}else{switch(parseInt(this.room.status)){case 1:this.createConnectedSection();break;case 2:this.createRequestSection();break;case 3:this.createRequestOutSection();break;default:this.createNotConnectedSection();break;}}},createNotConnectedSection:function(){this.button=new ButtonMedium({displayName:"Join Room",className:"dark",action:"check"});var name="roomRequest_"+this.room.username;var title="Join "+this.room.room_name;var message="Send membership request to "+this.room.room_name+"?";var func=this.roomRequestCreate.bind(this);$(this.button).addEvent("click",pipio.dispatchEvent.bind(pipio,["showConfirmation",name,title,message,func]));new Element("div",{"class":"button_section"}).adopt($(this.button)).inject(this.wrapper);},createConnectedSection:function(){new Element("div",{"class":"text_section light centered text11","text":"You are a member"}).inject(this.wrapper);this.button=new ButtonMedium({displayName:"Leave Room",className:"dark",action:"cross"});var name="roomLeave_"+this.room.username;var title="Leave "+this.room.room_name;var message="Are you sure you want to leave "+this.room.room_name+"?";var func=this.roomMembershipDelete.bind(this);$(this.button).addEvent("click",pipio.dispatchEvent.bind(pipio,["showConfirmation",name,title,message,func]));new Element("div",{"class":"button_section"}).adopt($(this.button)).inject(this.wrapper);},createRequestSection:function(){this.button=new ButtonMedium({displayName:"Accept Membership",className:"dark",action:"check"});$(this.button).addEvent("click",this.roomInviteAccept.bind(this));new Element("div",{"class":"button_section"}).adopt($(this.button)).inject(this.wrapper);this.button2=new ButtonMedium({displayName:"Reject Membership",className:"dark",action:"cross"});$(this.button2).addEvent("click",this.roomInviteDelete.bind(this));new Element("div",{"class":"button_section"}).adopt($(this.button2)).inject(this.wrapper);},roomInviteAccept:function(){this.call("home","room_invite_accept",{username:this.room.username},null,null);this.button.showProgress();},roomInviteDelete:function(){var params={username:this.getPrivateUser().username,room_username:this.room.username};this.call("home","room_invite_delete",params,null,null);this.button2.showProgress();},createRequestOutSection:function(){new Element("div",{"class":"text_section light centered text11","text":"Membership request pending"}).inject(this.wrapper);},roomRequestCreate:function(){this.call("home","room_request_create",{username:this.room.username},null,null);this.button.showProgress();},roomMembershipDelete:function(){this.call("home","room_leave",{username:this.room.username},null,null);this.button.showProgress();},generateSubscriptionSection:function(){this.subscription=new Toggle(this.subscribed);$(this.subscription).addEvent("click",this.subscriptionToggle.bind(this));new Element("div",{"class":"toggle_section"}).adopt(new Element("div",{"class":"text light","text":"Subscribe:"}),$(this.subscription)).inject(this.wrapper);},generatePrivacySection:function(){this.privacy=new Toggle(this.room.is_public==1);$(this.privacy).addEvent("click",this.privacyToggle.bind(this));new Element("div",{"class":"toggle_section"}).adopt(new Element("div",{"class":"text light","text":"Public:"}),$(this.privacy)).inject(this.wrapper);},privacyToggle:function(){this.call("home","room_privacy_set",{username:this.room.username,is_public:this.privacy.toInt()});},subscriptionToggle:function(){Logger().log(this.subscribed);if(this.subscribed){this.streamUnsubscribe();}else{this.streamSubscribe();}},streamUnsubscribe:function(){this.subscription.off();this.call("home","room_unsubscribe",{username:this.room.username});},streamSubscribe:function(){this.subscription.on();this.call("home","room_subscribe",{username:this.room.username},null,this.streamSubscribeFail.bind(this));},streamSubscribeFail:function(status){if(status.code==2002){this.subscription.off();var name="subscription";var title="Error";var message=status.message;this.fireEvent("showAlert",name,title,message);}},roomPrivacyUpdated:function(data){if(!$defined(data.username)||data.username!=this.room.username,!$defined(data.is_public)){return;}if(data.is_public==1){this.privacy.on();}else{this.privacy.off();}},roomStreamSubscriptionAdded:function(data){if(!$defined(data.room)||data.room.username!=this.room.username){return;}this.subscribed=true;this.generateSection();},roomStreamSubscriptionDeleted:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.subscribed=false;this.generateSection();},roomMembershipUpdated:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.room.status=parseInt(data.status);this.generateSection();},toElement:function(){return this.wrapper;}});var RoomMenu=new Class({Extends:Menu,EventHandlers:["roomMemberAdded","roomMemberDeleted","roomSubscriberAdded","roomSubscriberDeleted","roomMemberRequestDeleted","roomMemberRequestAdded"],strings:{groupMenuText:'These are contacts in your group "{0}"',unsortedGroupMenuText:"These are contacts that have not been added to a group"},onBeforeInit:function(options){this.room=options.room;this.appId=options.appId;this.isCreator=this.room.creator_id==this.getPrivateUser().user_id;return options;},onInit:function(){ItemUtility.createProfilePic(this.room,100).inject(this.menu);this.aboutSection=new RoomProfileMenuSection({room:this.room});$(this.aboutSection).inject(this.menu);if(this.isLoggedIn()){this.connect=new RoomConnectionMenuSection({room:this.room});$(this.connect).inject(this.menu);if(this.isCreator){this.profilePicUploadButton=new ButtonMedium({displayName:"Change Picture",className:"dark",action:"photo"});this.fileInput=new Element("input",{"type":"file","name":"file"});this.form=new Element("form").adopt(this.fileInput);this.fileInput.addEvent("change",this.profilePicUpload.bind(this));this.profilePicUploadSection=new Element("div",{"class":"button_section"}).adopt($(this.profilePicUploadButton).adopt(this.form)).inject(this.menu);var editProfileButton=new ButtonMedium({displayName:"Edit Profile",className:"dark",action:"edit"});$(editProfileButton).addEvent("click",this.fireEvent.bind(this,["showEditRoomProfilePopup",this.room]));new Element("div",{"class":"button_section"}).adopt($(editProfileButton)).inject(this.menu);this.inviteButton=new ButtonMedium({displayName:"Invite Members",className:"dark",action:"forward"});$(this.inviteButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showRoomInvitePopup",this.room]));new Element("div",{"class":"button_section"}).adopt($(this.inviteButton)).inject(this.menu);}}new Element("div",{"class":"nav_seperator"}).inject(this.menu);this.members=new MembersNav({room:this.room,appId:this.appId,onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"room_members","room_menu"])});$(this.members).inject(this.menu);this.subscribers=new SubscribersNav({user:this.room,appId:this.appId,onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"room_subscribers","room_menu"])});$(this.subscribers).inject(this.menu);if(this.isCreator){this.requests=new MemberRequestsNav({room:this.room,appId:this.appId,onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"room_requests","room_menu"])});$(this.requests).inject(this.menu);}},onShow:function(first){if(first){this.roomInfoLoad();}},roomInfoLoad:function(){if(this.isLoggedIn()){this.call("home","room_info_load",{username:this.room.username},this.roomInfoLoadSuccess.bind(this),null);}else{this.call("home","public_room_info_load",{username:this.room.username},this.roomInfoLoadSuccess.bind(this),null);}},roomMemberAdded:function(data){if(!$defined(data.room_username)||!$defined(data.user)||data.room_username!=this.room.username){return;}this.members.addUsers(data.user);this.requests.removeUser(data.user.username);},roomMemberDeleted:function(data){if(!$defined(data.username)||!$defined(data.room_username)||data.room_username!=this.room.username){return;}this.members.removeUser(data.username);},roomSubscriberAdded:function(data){if(!$defined(data.username)||!$defined(data.user)||data.username!=this.room.username){return;}this.subscribers.addUsers(data.user);},roomSubscriberDeleted:function(data){if(!$defined(data.username)||!$defined(data.room_username)||data.room_username!=this.room.username){return;}this.subscribers.removeUser(data.username);},roomMemberRequestDeleted:function(data){if(!$defined(data.room_username)||!$defined(data.username)||data.room_username!=this.room.username){return;}this.requests.removeUser(data.username);},roomMemberRequestAdded:function(data){if(!$defined(data.room_username)||!$defined(data.user)||data.room_username!=this.room.username){return;}this.requests.addUsers(data.user);},roomInfoLoadSuccess:function(data){if(!$defined(data.room)){return;}var room=UserUtility.processRoom(data.room);this.subscribers.addUsers(data.subscribers);this.members.addUsers(data.members);if($defined(data.requests)&&$defined(this.requests)){this.requests.addUsers(data.requests);}},profilePicUpload:function(){if(DataUtility.validatePhotoFile(this.fileInput.value)){this.call("pipio","room_profilepic_upload",{username:this.room.username},this.profilePicUploadSuccess.bind(this),this.profilePicUploadFail.bind(this),this.form);this.profilePicUploadButton.showProgress();}},profilePicUploadSuccess:function(){this.profilePicUploadButton.hideProgress();this.resetForm();},profilePicUploadFail:function(){this.profilePicUploadButton.hideProgress();this.resetForm();},resetForm:function(){this.profilePicUploadSection.empty();this.profilePicUploadButton=new ButtonMedium({displayName:"Change Picture",className:"dark",action:"photo"});this.fileInput=new Element("input",{"type":"file","name":"file"});this.form=new Element("form").adopt(this.fileInput);this.fileInput.addEvent("change",this.profilePicUpload.bind(this));this.profilePicUploadSection.adopt($(this.profilePicUploadButton).adopt(this.form));}});var RoomProfileMenuSection=new Class({Extends:Base,EventHandlers:["roomProfileUpdated"],init:function(options){this.room=options.room;this.createSection();},createSection:function(){this.wrapper=new Element("div");this.bioText=new Element("span");this.bioSection=new Element("div",{"class":"text_section light1 text11 edit_option"}).adopt(new Element("span",{"class":"bold","text":"About: "}),this.bioText).inject(this.wrapper);this.urlText=new Element("a",{"target":"_blank"});this.urlSection=new Element("div",{"class":"text_section light1 text11 nowrap edit_option"}).adopt(new Element("span",{"class":"bold","text":"Web: "}),this.urlText).inject(this.wrapper);this.roomProfileUpdated(this.room.username,this.getProfile(this.room.username));},roomProfileUpdated:function(username,about){if(username!=this.room.username){return;}if(!$defined(about)){DomUtility.hide(this.bioSection);DomUtility.hide(this.urlSection);return;}if(!$defined(about.bio)||about.bio==""){DomUtility.hide(this.bioSection);}else{this.bioText.set("text",TextUtility.unescape(about.bio));DomUtility.show(this.bioSection);}if(!$defined(about.url)||about.url==""){DomUtility.hide(this.urlSection);}else{this.urlText.set("text",TextUtility.unescape(about.url));this.urlText.set("href",about.url);DomUtility.show(this.urlSection);}},toElement:function(){return this.wrapper;}});var Rss=new Class({Extends:App,EventHandlers:["userSwitched","rssInstall","rssUninstall","rssFeedSubscribed","rssFeedUnsubscribed","showAddRssFeedPopup"],onStart:function(){this.setupNav();this.feeds=$H();this.loadSubscriptions();},onStop:function(){},userSwitched:function(){if(!this.isLoggedIn()){this.stop();}},loadSubscriptions:function(){this.call("rss","rss_subscriptions",null,this.loadSubscriptionsSuccess.bind(this),null);},loadSubscriptionsSuccess:function(data){if(!$defined(data.subscriptions)){return;}data.subscriptions.each(function(subscription){this.rssFeedAdd(subscription);},this);},rssFeedSubscribed:function(data){if(!$defined(data.subscription)){return;}this.rssFeedAdd(data.subscription);},rssFeedUnsubscribed:function(data){if(!$defined(data.atom_id)){return;}this.rssFeedDelete(data.atom_id);},rssUninstall:function(){this.call("rss","rss_uninstall",null,this.rssUninstallSuccess.bind(this),null);},rssUninstallSuccess:function(){this.stop();},rssInstall:function(){this.call("rss","rss_install",null,this.rssInstallSuccess.bind(this),null);},rssInstallSuccess:function(){this.start();}});Rss.implement({requests:[{name:"rss_subscriptions",url:"/api/app/rss/subscriptions"},{name:"rss_subscriptions_add",params:["feed_url"],url:"/api/app/rss/subscriptions/add"},{name:"rss_subscriptions_delete",params:["subscription_id"],url:"/api/app/rss/subscriptions/delete"},{name:"rss_feed",params:["atom_id","item_id"],url:"/api/app/rss/feed"},{name:"rss_feed_all",url:"/api/app/rss/feed/all"},{name:"rss_feed_subscribers",params:["atom_id"],url:"/api/app/rss/feed/subscribers"},{name:"rss_install",params:[],url:"/api/app/rss/install"},{name:"rss_uninstall",params:[],url:"/api/app/rss/uninstall"}]});Rss.implement({setupNav:function(){var homeNav=new Nav({iconOptions:{iconName:"updates"},displayName:"All News Updates",name:"updates",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"updates","rss_menu"])});this.navAdd(homeNav);this.navAdd(new Nav({iconOptions:{iconName:"rss"},hasSubnavs:true,displayName:"Feeds",name:"feeds"}));this.navAdd(new Nav({iconOptions:{iconName:"broadcast",iconAction:"add"},displayName:"Add New Feed...",onClick:this.showAddRssFeedPopup.bind(this),name:"new_feed",parentName:"feeds",bottom:true}));var rssMenu=new RssMenu({isDefault:true,closeFunc:this.stop.bind(this),navId:homeNav.navId});this.menuAdd("rss_menu",rssMenu);var content=new RssContent({isDefault:true});this.contentAdd("updates",content);},rssFeedAdd:function(feed){if(this.feeds.has(feed.atom_id)){return;}var nav=new Nav({iconOptions:{"iconName":"rss"},displayName:feed.title,name:"rss_"+feed.atom_id,parentName:"feeds",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"rss_"+feed.atom_id,"rss_"+feed.atom_id])});this.navAdd(nav);this.feeds.set(feed.atom_id,nav);var feedMenu=new RssFeedMenu({displayName:feed.title,feed:feed});this.menuAdd("rss_"+feed.atom_id,feedMenu);var content=new RssFeedContent({feed:feed});this.contentAdd("rss_"+feed.atom_id,content);},rssFeedDelete:function(atom_id){if(!this.feeds.has(atom_id)){return;}this.feeds.get(atom_id).destroy();this.navDelete("rss_"+atom_id);this.feeds.erase(atom_id);this.menuClose("rss_"+atom_id);this.contentClose("rss_"+atom_id);},showAddRssFeedPopup:function(){if($defined(this.addFeedPopup)){this.addFeedPopup.close();}this.createAddRssFeedPopup();},createAddRssFeedPopup:function(){this.addFeedPopup=new Popup({size:{x:350,y:94},resizable:false,dockable:false,className:"addFeed",onClose:this.destroyAddRssFeedPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"rss",iconAction:"add"},displayName:"Subscribe to a Feed",closable:true});var content=new AddRssFeedPopupContent({});this.addFeedPopup.addContent("add_feed",nav,content);},destroyAddRssFeedPopup:function(){this.addFeedPopup=null;}});var RssContent=new Class({Extends:Content,EventHandlers:["rssItemReceived"],onBeforeInit:function(options){this.feed=options.feed;this.sessionTimestamp=(new Date().getTime())/1000;return options;},onInit:function(){this.loader=new ItemLoader({createElementFunc:RssItemUtility.createRssAllItem,idField:"atom_item_id",sortField:"date_created",sortAscending:false,emptyEl:new Element("div",{"class":"post empty","text":"This feed has no items"}),loadingEl:new Element("div",{"class":"post empty","text":"Feed loading..."}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);},alertCheck:function(item){if(item.date_created>this.sessionTimestamp){this.fireEvent("alertAdd",this.navId);}},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},rssItemReceived:function(data){if($defined(data.item)){this.loader.process(data.item);}},loadMore:function(){var params={date_created:this.loader.lowestSortValue};this.call("rss","rss_feed_all",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){item.feed=this.feed;this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){this.loadMore();}});var RssFeedContent=new Class({Extends:Content,EventHandlers:["rssItemReceived"],onBeforeInit:function(options){this.feed=options.feed;return options;},onInit:function(){this.loader=new ItemLoader({createElementFunc:RssItemUtility.createRssFeedItem,idField:"atom_item_id",sortField:"date_created",sortAscending:false,emptyEl:new Element("div",{"class":"post empty","text":"This feed has no items"}),loadingEl:new Element("div",{"class":"post empty","text":"Feed loading..."})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},rssItemReceived:function(data){if($defined(data.item)&&data.item.atom_id==this.feed.atom_id){this.loader.process(data.item);}},loadMore:function(){var params={atom_id:this.feed.atom_id,date_created:this.loader.oldestTimestamp};this.call("rss","rss_feed",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){item.feed=this.feed;this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){Logger().log("rss content bottom");}});var RssFeedMenu=new Class({Extends:Menu,onBeforeInit:function(options){this.feed=options.feed;return options;},onInit:function(){this.urlText=new Element("a",{"target":"_blank","href":this.feed.link,"text":TextUtility.unescape(this.feed.link)});new Element("div",{"class":"text_section nowrap text11 light1"}).adopt(new Element("span",{"class":"bold","text":"Web: "}),this.urlText).inject(this.menu);new Element("div",{"class":"text_section light1","text":TextUtility.unescape(this.feed.description)}).inject(this.menu);this.deleteButton=new ButtonMedium({displayName:"Unsubscribe",className:"dark",action:"cross"});var name="rssFeedUnsubscribe_"+this.feed.atom_id;var title="Unsubscribe "+this.feed.title;var message="Are you sure you want to unsubscribe from the feed "+this.feed.title+"?";var func=this.rssUnsubscribe.bind(this);$(this.deleteButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showConfirmation",name,title,message,func]));new Element("div",{"class":"button_section"}).adopt($(this.deleteButton)).inject(this.menu);new Element("div",{"class":"nav_seperator"}).inject(this.menu);this.subscribers=new SubscribersNav({user:this.feed});$(this.subscribers).inject(this.menu);},onShow:function(first){if(first){this.subscribersLoad();}},subscribersLoad:function(){this.call("rss","rss_feed_subscribers",{atom_id:this.feed.atom_id},this.subscribersLoadSuccess.bind(this),null);},subscribersLoadSuccess:function(data){if(!$defined(data.subscribers)){return;}this.subscribers.addUsers(data.subscribers);},rssUnsubscribe:function(){var params={subscription_id:this.feed.subscription_id};this.call("rss","rss_subscriptions_delete",params,this.rssUnsubscribeSuccess.bind(this),this.rssUnsubscribeFail.bind(this));this.deleteButton.showProgress();},rssUnsubscribeSuccess:function(data){this.deleteButton.hideProgress();},rssUnsubscribeFail:function(){this.deleteButton.hideProgress();}});var RssMenu=new Class({Extends:Menu,onBeforeInit:function(options){options.displayName="News Reader";return options;},onInit:function(){new Element("div",{"class":"text_section light1","text":TextUtility.unescape("All updates from your subscriptions will be visible here")}).inject(this.menu);}});var AddRssFeedPopupContent=new Class({Extends:PopupContent,strings:{feedUrlLabel:"Feed URL:",errorMessage:"There was an error subscribing to this feed"},onInit:function(){this.feedUrlInput=new Element("textarea",{"maxlength":200});this.feedUrlInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.feedUrlLabel}),new Element("div",{"class":"textarea_wrapper"}).adopt(this.feedUrlInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Subscribe",className:"dark",action:"check"});$(this.actionButton).addEvent("click",this.feedSubscribe.bind(this));this.message=new Element("div",{"class":"message success"});this.actions=new Element("div",{"class":"actions"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key=="enter"){if(this.feedUrlInput.value.trim()!=""){this.feedSubscribe();}}},feedSubscribe:function(){var url=this.feedUrlInput.value.trim();var params={feed_url:url};this.call("rss","rss_subscriptions_add",params,this.feedSubscribeSuccess.bind(this),this.feedSubscribeFail.bind(this));this.actionButton.showProgress();this.message.set("text","please wait...");},feedSubscribeSuccess:function(){this.actionButton.hideProgress();this.closeContent();},feedSubscribeFail:function(status){this.actionButton.hideProgress();var name="feed_subscribe";var title="Error Subscribing to Feed";var message=status.message;this.message.empty();this.fireEvent("showAlert",name,title,message);},onShow:function(){this.focus();},focus:function(){this.feedUrlInput.focus.delay(500,this.feedUrlInput);}});var RssItemUtility={createRssFeedItem:function(item){return RssItemUtility.createRssItem(item,false);},createRssAllItem:function(item){return RssItemUtility.createRssItem(item,true);},createRssItem:function(item,showFeed){var el=ItemUtility.createPostBubble("post haspic");ItemUtility.createItemPic("/images/v5/apps/rss/feed_icon.png").inject(el);var content=new Element("div",{"class":"post_content"}).inject(el);RssItemUtility.createRssItemHeader(item,showFeed).inject(content);RssItemUtility.createRssItemFooter(item,showFeed).inject(content);return el;},createRssItemHeader:function(item,showFeed){var el=new Element("div",{"class":"header"});new Element("span",{}).adopt(new Element("a",{"href":item.link,"class":"user_name clickable","text":TextUtility.unescape(item.title),"target":"_blank"})).inject(el);if($defined(item.summary)&&item.summary!=""){new Element("span",{"html":" "+TextUtility.replaceUrls(TextUtility.stripHtml(TextUtility.unescape(item.summary)))}).inject(el);}return el;},createRssItemFooter:function(item){var el=new Element("div",{"class":"footer"});if(!$defined(item.date_created)){return el;}var date=DateUtility.convertFromTimestamp(item.date_created);var ts=new Element("span",{"class":"timestamp","text":DateUtility.getTimestamp(date,"%B %D at %I:%M%p"),"ts":date,"ts_format":"%B %D at %I:%M%p"}).inject(el);return el;}};var Twitter=new Class({Extends:App,EventHandlers:["userSwitched","twitterInstall","twitterUninstall","showTwitterUser","twitterShowFollowing","twitterShowFollowers","showTwitterList","twitterListSubscribed","twitterListUnsubscribed","twitterListsLoaded","showTwitterSearchPopup","twitterSearch","twitterRetweet","twitterDelete","twitterSavedSearchesLoaded","twitterSavedSearchAdd","twitterSavedSearchDelete"],parseOptions:function(options){this.settings=options.settings;},onStart:function(){this.setupNav();},onStop:function(){},userSwitched:function(){if(!this.isLoggedIn()){this.userLoggedOut();}},userLoggedOut:function(){this.stop();},twitterInstall:function(){this.installPopup=new Popup({size:{x:350,y:80},resizable:false,dockable:false,className:"appInstall",onClose:this.destroyTwitterInstallPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"twitter"},displayName:"Install Twitter",closable:true});var content=new TwitterInstallPopupContent({});this.installPopup.addContent("install",nav,content);},destroyTwitterInstallPopup:function(){this.installPopup=null;},twitterUninstall:function(){this.call("twitter","twitter_uninstall",null,this.twitterUninstallSuccess.bind(this));},twitterUninstallSuccess:function(){this.stop();},twitterRetweet:function(id){var name="twitterRetweet_"+id;var title="Retweet an Update";var message="Retweet this update?";var func=this.twitterRetweetCall.bind(this,[id]);this.fireEvent("showConfirmation",name,title,message,func);},twitterRetweetCall:function(id){this.call("twitter","twitter_retweet",{id:id},this.twitterRetweetSuccess.bind(this));},twitterRetweetSuccess:function(data){},twitterDelete:function(id){var name="twitterDelete_"+id;var title="Delete Update";var message="Delete this update?";var func=this.twitterDeleteCall.bind(this,[id]);this.fireEvent("showConfirmation",name,title,message,func);},twitterDeleteCall:function(id){this.call("twitter","twitter_item_delete",{id:id},this.twitterDeleteSuccess.bind(this));},twitterDeleteSuccess:function(data){if(!$defined(data.id)){return;}TwitterItemUtility.deleteTwitterItem(data.id);}});Twitter.implement({requests:[{name:"twitter_auth_request",url:"/api/app/twitter/auth/request"},{name:"twitter_install",params:["sync_posts"],url:"/api/app/twitter/install"},{name:"twitter_uninstall",url:"/api/app/twitter/uninstall"},{name:"twitter_user_show",params:["screen_name"],url:"/api/app/twitter/user/show"},{name:"twitter_list_show",params:["screen_name","slug"],url:"/api/app/twitter/list/show"},{name:"twitter_self_show",params:["screen_name"],url:"/api/app/twitter/self/show"},{name:"twitter_home_timeline",params:["since_id","max_id"],url:"/api/app/twitter/home/timeline"},{name:"twitter_user_timeline",params:["username","since_id","max_id"],url:"/api/app/twitter/user/timeline"},{name:"twitter_lists_timeline",params:["screen_name","list_id","since_id","max_id"],url:"/api/app/twitter/lists/timeline"},{name:"twitter_mentions",params:["since_id","max_id","count","page"],url:"/api/app/twitter/mentions"},{name:"twitter_settings_update",params:["key","value"],url:"/api/app/twitter/settings/update"},{name:"twitter_follow",params:["screen_name"],url:"/api/app/twitter/follow"},{name:"twitter_unfollow",params:["screen_name"],url:"/api/app/twitter/unfollow"},{name:"twitter_settings_set",params:["key","value"],url:"/api/app/twitter/settings/update"},{name:"twitter_friends",params:["username","page"],url:"/api/app/twitter/friends"},{name:"twitter_followers",params:["username","page"],url:"/api/app/twitter/followers"},{name:"twitter_block",params:["screen_name"],url:"/api/app/twitter/block"},{name:"twitter_post_text",params:["body","post_id"],url:"/api/app/twitter/text/item_create"},{name:"twitter_search",params:["q","page"],url:"/api/app/twitter/search"},{name:"twitter_searches_create",params:["query"],url:"/api/app/twitter/searches/create"},{name:"twitter_searches_delete",params:["id"],url:"/api/app/twitter/searches/delete"},{name:"twitter_retweet",params:["id"],url:"/api/app/twitter/retweet"},{name:"twitter_item_delete",params:["id"],url:"/api/app/twitter/item/delete"},{name:"twitter_dm_inbox",url:"/api/app/twitter/dm/inbox"},{name:"twitter_dm_all",url:"/api/app/twitter/dm/all"},{name:"twitter_dm_delete",params:["id"],url:"/api/app/twitter/dm/delete"},{name:"twitter_dm_send",params:["recipient","message"],url:"/api/app/twitter/dm/send"},{name:"twitter_searches_saved",url:"/api/app/twitter/searches/saved"},{name:"twitter_trends",url:"/api/app/twitter/trends"},{name:"twitter_favorites",url:"/api/app/twitter/favorites"},{name:"twitter_favorites_create",params:["id","element_id"],url:"/api/app/twitter/favorites/create"},{name:"twitter_favorites_delete",params:["id","element_id"],url:"/api/app/twitter/favorites/delete"},{name:"twitter_lists",params:["screen_name"],url:"/api/app/twitter/lists"},{name:"twitter_lists_members",url:"/api/app/twitter/lists/members"},{name:"twitter_lists_create",params:["name","mode","description"],url:"/api/app/twitter/lists/create"},{name:"twitter_lists_delete",params:["list_id"],url:"/api/app/twitter/lists/delete"},{name:"twitter_lists_statuses",params:["screen_name","list_id","cursor","page"],url:"/api/app/twitter/lists/statuses"},{name:"twitter_lists_add_user",params:["list_id","id"],url:"/api/app/twitter/lists/add_user"},{name:"twitter_lists_get_users",params:["screen_name","list_id"],url:"/api/app/twitter/lists/get_users"},{name:"twitter_lists_delete_user",params:["list_id","id"],url:"/api/app/twitter/lists/delete_user"},{name:"twitter_lists_subscribe",params:["screen_name","list_id"],url:"/api/app/twitter/lists/subscribe"},{name:"twitter_lists_subscribers",params:["screen_name","list_id"],url:"/api/app/twitter/lists/subscribers"},{name:"twitter_lists_unsubscribe",params:["screen_name","list_id"],url:"/api/app/twitter/lists/unsubscribe"},{name:"twitter_lists_subscriptions",params:["screen_name"],url:"/api/app/twitter/lists/subscriptions"},{name:"twitter_lists_memberships",params:["screen_name"],url:"/api/app/twitter/lists/memberships"},{name:"twitter_post_link",params:["body","url","post_id"],url:"/api/app/twitter/link/item_create"},{name:"twitter_post_photo",params:["body","photo","post_id"],url:"/api/app/twitter/photo/item_create",multipart:true},]});Twitter.implement({twitterSavedSearchesLoaded:function(searches){this.saved_searches=$H();searches.each(function(search){this.saved_searches.set(search.id,search);},this);},twitterSavedSearchAdd:function(search){this.saved_searches.set(search.id,search);},twitterSavedSearchDelete:function(id){this.saved_searches.erase(id);},twitterSearch:function(query,search_id){if(!$defined(search_id)){search_id=0;}var search={query:query,id:search_id};if(this.searches.has(query)){this.fireEvent("viewSwitch",this.appId,"search_"+query,"search_"+query);return;}this.searchAdd(search);},searchAdd:function(search){if(!$defined(this.searchNav)){this.searchNav=new Nav({iconOptions:{iconName:"search"},hasSubnavs:true,displayName:"Searches",name:"searches"});this.navAdd(this.searchNav);}var nav=new Nav({displayName:search.query,closable:true,name:"search_"+search.query,parentName:"searches",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"search_"+search.query,"search_"+search.query])});this.navAdd(nav);this.searches.set(search.query,search);var content=new TwitterSearchContent({search:search,navId:nav.navId});this.contentAdd("search_"+search.query,content);var menu=new TwitterSearchMenu({search:search,searches:this.saved_searches,closable:true,closeFunc:this.searchClose.bind(this,search)});this.menuAdd("search_"+search.query,menu);this.fireEvent("viewSwitch",this.appId,"search_"+search.query,"search_"+search.query);},searchClose:function(search){Logger().log("attempting to close "+search.query);if(!this.searches.has(search.query)){return;}this.navDelete("search_"+search.query);this.menuClose("search_"+search.query);this.contentClose("search_"+search.query);this.searches.erase(search.query);if(this.searches.getLength()==0){this.navDelete("searches");this.searchNav=null;}}});Twitter.implement({setupNav:function(){this.searches=$H();this.users=$H();this.lists=$H();this.listSubs=$H();var homeNav=new Nav({iconOptions:{iconName:"updates"},displayName:"Home",name:"updates",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"updates","self_menu"])});this.navAdd(homeNav);var mentionsNav=new Nav({iconOptions:{iconName:"at"},displayName:this.settings.screen_name,name:"mentions",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"mentions","self_menu"])});this.navAdd(mentionsNav);var selfMenu=new TwitterSelfMenu({settings:this.settings,isDefault:true,closeFunc:this.stop.bind(this)});this.menuAdd("self_menu",selfMenu);var content=new TwitterHomeContent({settings:this.settings,isDefault:true,navId:homeNav.navId});this.contentAdd("updates",content);var mentionsContent=new TwitterMentionsContent({settings:this.settings,navId:mentionsNav.navId});this.contentAdd("mentions",mentionsContent);},showTwitterUser:function(screen_name){if(this.users.has(screen_name)){this.fireEvent("viewSwitch",this.appId,screen_name,screen_name);}else{this.call("twitter","twitter_user_show",{screen_name:screen_name},this.userLoaded.bind(this),null);return;}},showTwitterList:function(list_id){if(this.lists.has(list_id)){this.fireEvent("viewSwitch",this.appId,list_id,list_id);}else{var parts=list_id.split("/");this.call("twitter","twitter_list_show",{screen_name:parts[0],slug:parts[1]},this.listLoaded.bind(this),null);return;}},listLoaded:function(data){if(!$defined(data.list)){return;}data.list.following=false;this.listAdd(data.list);},userLoaded:function(data){this.userAdd(data);},twitterListSubscribed:function(list){list.following=true;if(list.following){if(!$defined(this.listsNav)){this.listsNav=new Nav({iconOptions:{iconName:"contacts"},hasSubnavs:true,displayName:"Lists",name:"lists"});this.navAdd(this.listsNav);}var nav=new Nav({iconOptions:{iconName:list.user.profile_image_url},displayName:list.user.screen_name+"/"+list.slug,closable:true,name:list.id,parentName:"lists",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,list.id,list.id]),onClose:this.listClose.bind(this,[list.id])});this.navAdd(nav);this.lists.set(list.id,nav);this.listSubs.set(list.id,list);}},twitterListUnsubscribed:function(list){if(this.listSubs.has(list.id)){this.lists.get(list.id).destroy();this.navDelete(list.id);this.lists.erase(list.id);this.listSubs.erase(list.id);}},twitterListsLoaded:function(data){data.lists.lists.each(function(list){list.following=true;this.listAdd(list);},this);data.list_subscriptions.lists.each(function(list){list.following=true;this.listAdd(list);},this);},userClose:function(screen_name){if(!this.users.has(screen_name)){return;}this.users.get(screen_name).destroy();this.navDelete(screen_name);this.users.erase(screen_name);this.menuClose(screen_name);this.contentClose(screen_name);if(this.users.getLength()==0){this.navDelete("users");this.usersNav=null;}},userAdd:function(user){if(!$defined(this.usersNav)){this.usersNav=new Nav({iconOptions:{iconName:"users"},hasSubnavs:true,displayName:"Users",name:"users"});this.navAdd(this.usersNav);}var nav=new Nav({iconOptions:{iconName:user.profile_image_url},displayName:user.screen_name,closable:true,name:user.screen_name,parentName:"users",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,user.screen_name,user.screen_name]),onClose:this.userClose.bind(this,[user.screen_name])});this.navAdd(nav);this.users.set(user.screen_name,nav);var content=new TwitterUserContent({screen_name:user.screen_name,navId:nav.navId});this.contentAdd(user.screen_name,content);var menu=new TwitterUserMenu({user:user,closable:true,closeFunc:this.userClose.bind(this,user.screen_name)});this.menuAdd(user.screen_name,menu);this.fireEvent("viewSwitch",this.appId,user.screen_name,user.screen_name);},twitterShowFollowing:function(screen_name){var content=new TwitterFollowingContent({screen_name:screen_name});this.contentAdd(screen_name+"_following",content);if(screen_name==this.settings.screen_name){this.fireEvent("viewSwitch",this.appId,screen_name+"_following","self_menu");}else{this.fireEvent("viewSwitch",this.appId,screen_name+"_following",screen_name);}},twitterShowFollowers:function(screen_name){var content=new TwitterFollowersContent({screen_name:screen_name});this.contentAdd(screen_name+"_followers",content);if(screen_name==this.settings.screen_name){this.fireEvent("viewSwitch",this.appId,screen_name+"_followers","self_menu");}else{this.fireEvent("viewSwitch",this.appId,screen_name+"_followers",screen_name);}},listAdd:function(list){if(list.following){if(!$defined(this.listsNav)){this.listsNav=new Nav({iconOptions:{iconName:"contacts"},hasSubnavs:true,displayName:"Lists",name:"lists"});this.navAdd(this.listsNav);}var nav=new Nav({iconOptions:{iconName:list.user.profile_image_url},displayName:list.user.screen_name+"/"+list.slug,closable:true,name:list.id,parentName:"lists",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,list.id,list.id]),onClose:this.listClose.bind(this,[list.id])});this.navAdd(nav);this.lists.set(list.id,nav);this.listSubs.set(list.id,list);}var content=new TwitterListContent({list:list,navId:nav.navId});this.contentAdd(list.id,content);var menu=new TwitterListMenu({list:list,closable:true,closeFunc:this.listClose.bind(this,list.id)});this.menuAdd(list.id,menu);if(!list.following){this.fireEvent("viewSwitch",this.appId,list.id,list.id);}},listClose:function(list_id){if(!this.listSubs.has(list_id)){this.menuClose(list_id);this.contentClose(list_id);}else{this.switchDefault();}},showTwitterSearchPopup:function(){if($defined(this.twitterSearchPopup)){this.twitterSearchPopup.close();}this.createTwitterSearchPopup();},createTwitterSearchPopup:function(){this.twitterSearchPopup=new Popup({size:{x:350,y:74},resizable:false,dockable:false,className:"twitterSearch",onClose:this.destroyTwitterSearchPopup.bind(this)});var nav=new Nav({iconOptions:{iconName:"twitter"},displayName:"Search Twitter",closable:true});var content=new TwitterSearchPopupContent({});this.twitterSearchPopup.addContent("twitter_search",nav,content);},destroyTwitterSearchPopup:function(){this.twitterSearchPopup=null;}});var TwitterFollowersContent=new Class({Extends:Content,EventHandlers:["twitterFollow","twitterUnfollow","twitterBlock"],onBeforeInit:function(options){this.screen_name=options.screen_name;},onInit:function(){this.loader=new ItemLoader({idField:"id",sortField:"name",createElementFunc:TwitterFollowsItemUtility.createTwitterFollowItem,emptyEl:new Element("div",{"class":"post empty","text":this.screen_name+" has no followers"}),loadingEl:new Element("div",{"class":"post empty","text":this.screen_name+"'s followers loading..."})});$(this.loader).inject(this.content);},onShow:function(first){if(first){var params={"username":this.screen_name,"page":-1};this.call("twitter","twitter_followers",params,this.twitterFollowersSuccess.bind(this),null);this.loader.showLoading();}},onHide:function(){},twitterFollowersSuccess:function(data){this.loader.hideLoading();if(!$defined(data.users)||data.users.length==0){return;}this.nextCursor=data.next_cursor;data.users.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){var params={"username":this.screen_name,"page":this.nextCursor};this.call("twitter","twitter_followers",params,this.twitterFollowersSuccess.bind(this),null);},twitterFollow:function(screen_name){var params={screen_name:screen_name};this.call("twitter","twitter_follow",params,this.twitterFollowSuccess.bind(this),null);},twitterFollowSuccess:function(data){if(!$defined(data)){return;}},twitterUnfollow:function(screen_name){var params={screen_name:screen_name};this.call("twitter","twitter_unfollow",params,this.twitterUnfollowSuccess.bind(this),null);},twitterUnfollowSuccess:function(data){if(!$defined(data)){return;}this.loader.remove(data.id);},twitterBlock:function(screen_name){var answer=confirm("Blocking will prevent this user from following you. And you won't see their tweets in your timeline. Are you sure you want to block?");if(!answer){return;}var params={screen_name:screen_name};this.call("twitter","twitter_block",params,this.twitterBlockSuccess.bind(this),null);},twitterBlockSuccess:function(data){if(!$defined(data)){return;}this.loader.remove(data.id);}});var TwitterFollowingContent=new Class({Extends:Content,EventHandlers:["twitterFollow","twitterUnfollow","twitterBlock"],onBeforeInit:function(options){this.screen_name=options.screen_name;},onInit:function(){this.loader=new ItemLoader({idField:"id",sortField:"name",createElementFunc:TwitterFollowsItemUtility.createTwitterFollowItem,emptyEl:new Element("div",{"class":"post empty","text":this.screen_name+" has no friends"}),loadingEl:new Element("div",{"class":"post empty","text":this.screen_name+"'s friends loading..."})});$(this.loader).inject(this.content);},onShow:function(first){if(first){var params={"username":this.screen_name,"page":-1};this.call("twitter","twitter_friends",params,this.twitterFollowingSuccess.bind(this),null);this.loader.showLoading();}},onHide:function(){},twitterFollowingSuccess:function(data){this.loader.hideLoading();if(!$defined(data.users)||data.users.length==0){return;}this.nextCursor=data.next_cursor;data.users.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},bottomFunc:function(){var params={"username":this.screen_name,"page":this.nextCursor};this.call("twitter","twitter_friends",params,this.twitterFollowingSuccess.bind(this),null);},twitterUnfollow:function(screen_name){var params={screen_name:screen_name};this.call("twitter","twitter_unfollow",params,this.twitterUnfollowSuccess.bind(this),null);},twitterUnfollowSuccess:function(data){if(!$defined(data)){return;}this.loader.remove(data.id);},twitterBlock:function(screen_name){var answer=confirm("Blocking will prevent this user from following you. And you won't see their tweets in your timeline. Are you sure you want to block?");if(!answer){return;}var params={screen_name:screen_name};this.call("twitter","twitter_block",params,this.twitterBlockSuccess.bind(this),null);},twitterBlockSuccess:function(data){if(!$defined(data)){return;}this.loader.remove(data.id);}});var TwitterHomeContent=new Class({Extends:Content,EventHandlers:["twitterUserLoaded","twitterHomeReload"],onBeforeInit:function(options){this.settings=options.settings;this.navId=options.navId;this.sessionTimestamp=(new Date().getTime())/1000;this.screen_name=options.settings.screen_name;return options;},onInit:function(){this.slowTimerDuration=60*1000*3;this.fastTimerDuration=60*1000*1;this.loader=new StreamLoader({idField:"id",dateField:"created_at",createElementFunc:TwitterItemUtility.createTwitterItem,emptyEl:new Element("div",{"class":"post empty","text":"You have no updates"}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);},alertCheck:function(item){var ts=Date.parse(item.created_at)/1000;if(ts>this.sessionTimestamp){this.fireEvent("alertAdd",this.navId);}},onShow:function(first){if(first){this.loadMore();}this.updatePoll();},onHide:function(){this.updatePoll();},onDestroy:function(){$clear(this.pollTimer);},twitterHomeReload:function(){this.loadNew();},twitterUserLoaded:function(user){if($defined(this.statusBox)){return;}this.statusBox=new TwitterStatusBox(user,true);$(this.statusBox).inject(this.content,"top");},updatePoll:function(){if($defined(this.pollTimer)){$clear(this.pollTimer);}if(this.isOn){this.pollTimer=this.loadNew.periodical(this.fastTimerDuration,this);Logger().log("home on fast timer");}else{this.pollTimer=this.loadNew.periodical(this.slowTimerDuration,this);Logger().log("home on slow timer");}},loadNew:function(){var params={since_id:this.loader.newestId};this.call("twitter","twitter_home_timeline",params,this.loadNewSuccess.bind(this),this.loadMoreFail.bind(this));},loadMore:function(){var params={since_id:""};if(this.loader.oldestId!=0){params.max_id=this.loader.oldestId;}this.call("twitter","twitter_home_timeline",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));},loadNewSuccess:function(data){if(!$defined(data.items)||data.items.length==0){return;}data.items.each(function(item){this.loader.process(item);},this);},loadMoreSuccess:function(data){if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.reverse().each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){},bottomFunc:function(){this.loadMore();}});var TwitterListContent=new Class({Extends:Content,EventHandlers:[],onBeforeInit:function(options){this.list=options.list;this.navId=options.navId;this.sessionTimestamp=(new Date().getTime())/1000;return options;},onInit:function(){this.slowTimerDuration=60*1000*5;this.fastTimerDuration=60*1000*2;this.loader=new StreamLoader({idField:"id",dateField:"created_at",createElementFunc:TwitterItemUtility.createTwitterItem,emptyEl:new Element("div",{"class":"post empty","text":"This list has no updates"}),loadingEl:new Element("div",{"class":"post empty","text":"Updates loading..."}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);},alertCheck:function(item){var ts=Date.parse(item.created_at)/1000;if(ts>this.sessionTimestamp){this.fireEvent("alertAdd",this.navId);}},onShow:function(first){if(first){this.loadMore();}this.updatePoll();},onHide:function(){this.updatePoll();},onDestroy:function(){$clear(this.pollTimer);},updatePoll:function(){if($defined(this.pollTimer)){$clear(this.pollTimer);}if(this.isOn){this.pollTimer=this.loadNew.periodical(this.fastTimerDuration,this);}else{this.pollTimer=this.loadNew.periodical(this.slowTimerDuration,this);}},loadNew:function(){var params={screen_name:this.list.user.screen_name,list_id:this.list.id,since_id:this.loader.newestId};this.call("twitter","twitter_lists_timeline",params,this.loadNewSuccess.bind(this),this.loadMoreFail.bind(this));},loadMore:function(){var params={screen_name:this.list.user.screen_name,list_id:this.list.id,since_id:""};if(this.loader.oldestId!=0){params.max_id=this.loader.oldestId;}this.call("twitter","twitter_lists_timeline",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));this.loader.showLoading();},loadNewSuccess:function(data){if(!$defined(data.items)||data.items.length==0){return;}data.items.reverse().each(function(item){this.loader.process(item);},this);},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){this.loader.hideLoading();},bottomFunc:function(){this.loadMore();}});var TwitterMentionsContent=new Class({Extends:Content,EventHandlers:[],onBeforeInit:function(options){this.settings=options.settings;this.navId=options.navId;this.screen_name=options.screen_name;this.sessionTimestamp=(new Date().getTime())/1000;return options;},onInit:function(){this.slowTimerDuration=60*1000*5;this.fastTimerDuration=60*1000*2;this.loader=new StreamLoader({idField:"id",dateField:"created_at",createElementFunc:TwitterItemUtility.createTwitterItem,emptyEl:new Element("div",{"class":"post empty","text":"You have no mentions"}),loadingEl:new Element("div",{"class":"post empty","text":"Mentions loading..."}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);},alertCheck:function(item){var ts=Date.parse(item.created_at)/1000;if(ts>this.sessionTimestamp){this.fireEvent("alertAdd",this.navId);}},onShow:function(first){if(first){this.loadMore();}this.updatePoll();},onHide:function(){this.updatePoll();},onDestroy:function(){$clear(this.pollTimer);},updatePoll:function(){if($defined(this.pollTimer)){$clear(this.pollTimer);}if(this.isOn){this.pollTimer=this.loadNew.periodical(this.fastTimerDuration,this);}else{this.pollTimer=this.loadNew.periodical(this.slowTimerDuration,this);}},loadNew:function(){var params={since_id:this.loader.newestId};this.call("twitter","twitter_mentions",params,this.loadNewSuccess.bind(this),this.loadMoreFail.bind(this));},loadMore:function(){var params={since_id:""};if(this.loader.oldestId!=0){params.max_id=this.loader.oldestId;}this.call("twitter","twitter_mentions",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));this.loader.showLoading();},loadNewSuccess:function(data){if(!$defined(data.items)||data.items.length==0){return;}data.items.each(function(item){this.loader.process(item);},this);},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.reverse().each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){this.loader.hideLoading();},bottomFunc:function(){this.loadMore();}});var TwitterSearchContent=new Class({Extends:Content,EventHandlers:[],onBeforeInit:function(options){this.search=options.search;this.navId=options.navId;this.sessionTimestamp=(new Date().getTime())/1000;return options;},onInit:function(){this.slowTimerDuration=60*1000*2;this.fastTimerDuration=30*1000;this.loader=new StreamLoader({idField:"id",dateField:"created_at",createElementFunc:TwitterItemUtility.createTwitterSearchItem,emptyEl:new Element("div",{"class":"post empty","text":"No search results"}),loadingEl:new Element("div",{"class":"post empty","text":"Search results loading..."}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);this.page=1;},alertCheck:function(item){var ts=Date.parse(item.created_at)/1000;if(ts>this.sessionTimestamp){this.fireEvent("alertAdd",this.navId);}},onShow:function(first){if(first){this.loadMore();}this.updatePoll();},onHide:function(){this.updatePoll();},onDestroy:function(){$clear(this.pollTimer);},updatePoll:function(){if($defined(this.pollTimer)){$clear(this.pollTimer);}if(this.isOn){this.pollTimer=this.loadNew.periodical(this.fastTimerDuration,this);}else{this.pollTimer=this.loadNew.periodical(this.slowTimerDuration,this);}},loadNew:function(){var params={since_id:this.loader.newestId,q:this.search.query};this.call("twitter","twitter_search",params,this.loadNewSuccess.bind(this),this.loadMoreFail.bind(this));},loadMore:function(){var params={since_id:"",q:this.search.query};if(this.loader.oldestId!=0){params.page=this.page++;}this.call("twitter","twitter_search",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));this.loader.showLoading();},loadNewSuccess:function(data){if(!$defined(data.items)||data.items.length==0){return;}data.items.reverse().each(function(item){this.loader.process(item);},this);},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){this.loader.hideLoading();},bottomFunc:function(){this.loadMore();}});var TwitterUserContent=new Class({Extends:Content,EventHandlers:["twitterUserLoaded"],onBeforeInit:function(options){this.navId=options.navId;this.screen_name=options.screen_name;this.sessionTimestamp=(new Date().getTime())/1000;},onInit:function(){this.slowTimerDuration=60*1000*5;this.fastTimerDuration=60*1000*2;this.loader=new StreamLoader({idField:"id",dateField:"created_at",createElementFunc:TwitterItemUtility.createTwitterItem,emptyEl:new Element("div",{"class":"post empty","text":TextUtility.unescape(this.screen_name)+" has no updates"}),loadingEl:new Element("div",{"class":"post empty","text":TextUtility.unescape(this.screen_name)+"'s updates loading..."}),alertFunc:this.alertCheck.bind(this)});$(this.loader).inject(this.content);},alertCheck:function(item){var ts=Date.parse(item.created_at)/1000;if(ts>this.sessionTimestamp){this.fireEvent("alertAdd",this.navId);}},onShow:function(first){if(first){this.loadMore();}this.updatePoll();},onHide:function(){this.updatePoll();},onDestroy:function(){$clear(this.pollTimer);},twitterUserLoaded:function(user){if($defined(this.statusBox)){return;}this.statusBox=new TwitterStatusBox(user,false);$(this.statusBox).inject(this.content,"top");},updatePoll:function(){if($defined(this.pollTimer)){$clear(this.pollTimer);}if(this.isOn){this.pollTimer=this.loadNew.periodical(this.fastTimerDuration,this);}else{this.pollTimer=this.loadNew.periodical(this.slowTimerDuration,this);}},loadNew:function(){var params={username:this.screen_name,since_id:this.loader.newestId};this.call("twitter","twitter_user_timeline",params,this.loadNewSuccess.bind(this),this.loadMoreFail.bind(this));},loadMore:function(){var params={username:this.screen_name,since_id:""};if(this.loader.oldestId!=0){params.max_id=this.loader.oldestId;}this.call("twitter","twitter_user_timeline",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));this.loader.showLoading();},loadNewSuccess:function(data){if(!$defined(data.items)||data.items.length==0){return;}data.items.each(function(item){this.loader.process(item);},this);},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.reverse().each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){this.loader.hideLoading();},bottomFunc:function(){this.loadMore();}});var TwitterListMenu=new Class({Extends:Menu,EventHandlers:[],onBeforeInit:function(options){this.list=options.list;options.displayName=this.list.user.screen_name+"/"+this.list.slug;options.className="twitter";return options;},onInit:function(){this.userShowSuccess(this.list.user);},userShowSuccess:function(data){if(!$defined(data)){return;}this.profile=new Element("div",{"class":"user_profile"}).inject(this.menu);ItemUtility.createItemPic(data.profile_image_url).inject(this.profile);new Element("div",{"class":"screen_name text12 light","text":data.screen_name}).inject(this.profile);new Element("div",{"class":"tweets text11 light2","text":data.statuses_count+" tweets"}).inject(this.profile);new Element("div",{"class":"text_section light1 text11 nowrap"}).adopt(new Element("span",{"class":"bold","text":"Name: "}),new Element("span",{"text":TextUtility.unescape(data.name)})).inject(this.menu);if($defined(data.location)&&data.location!=""){new Element("div",{"class":"text_section light1 text11 nowrap"}).adopt(new Element("span",{"class":"bold","text":"Location: "}),new Element("span",{"text":TextUtility.unescape(data.location)})).inject(this.menu);}if($defined(data.url)&&data.url!=""){new Element("div",{"class":"text_section light1 text11 nowrap"}).adopt(new Element("span",{"class":"bold","text":"Web: "}),new Element("a",{"target":"_blank","href":data.url,"text":data.url})).inject(this.menu);}if($defined(data.description)&&data.description!=""){new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Bio: "}),new Element("span",{"text":TextUtility.unescape(data.description)})).inject(this.menu);}new Element("div",{"class":"nav_seperator"}).inject(this.menu);this.follow=new Toggle(this.list.following);$(this.follow).addEvent("click",this.followToggle.bind(this));new Element("div",{"class":"toggle_section"}).adopt(new Element("div",{"class":"text light","text":"Following list:"}),$(this.follow)).inject(this.menu);},followToggle:function(){if(this.follow.isOn){this.call("twitter","twitter_lists_subscribe",{screen_name:this.list.user.screen_name,list_id:this.list.id},this.subscribeSuccess.bind(this));}else{this.call("twitter","twitter_lists_unsubscribe",{screen_name:this.list.user.screen_name,list_id:this.list.id},this.unsubscribeSuccess.bind(this));}},subscribeSuccess:function(data){if(!$defined(data.list)){return;}this.fireEvent("twitterListSubscribed",this.list);},unsubscribeSuccess:function(data){if(!$defined(data.list)){return;}this.fireEvent("twitterListUnsubscribed",this.list);}});var TwitterSearchMenu=new Class({Extends:Menu,EventHandlers:["twitterSavedSearchAdd","twitterSavedSearchDelete"],onBeforeInit:function(options){this.search=options.search;this.searches=options.searches;options.displayName=this.search.query;options.className="twitter";return options;},onInit:function(){new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Query: "}),new Element("span",{"text":TextUtility.unescape(this.search.query)})).inject(this.menu);new Element("div",{"class":"nav_seperator"}).inject(this.menu);this.saved=new Toggle(this.search.id!=0);$(this.saved).addEvent("click",this.saveToggle.bind(this));new Element("div",{"class":"toggle_section"}).adopt(new Element("div",{"class":"text light","text":"Save Search:"}),$(this.saved)).inject(this.menu);this.searchButton=new ButtonMedium({displayName:"Search Twitter",className:"dark",action:"search"});$(this.searchButton).addEvent("click",this.fireEvent.bind(this,["showTwitterSearchPopup"]));this.searchSection=new Element("div",{"class":"button_section"}).adopt($(this.searchButton)).inject(this.menu);this.savedSearchesNav=new TwitterSavedSearchesNav({});$(this.savedSearchesNav).inject(this.menu);this.searches.each(function(search){this.twitterSavedSearchAdd(search);},this);},twitterSavedSearchAdd:function(search){this.savedSearchesNav.savedSearchAdd(search);},twitterSavedSearchDelete:function(id){this.savedSearchesNav.savedSearchDelete(id);},saveToggle:function(){if(this.saved.isOn){this.searchSave();}else{this.searchDelete();}},searchSave:function(){this.call("twitter","twitter_searches_create",{query:this.search.query},this.searchSaveSuccess.bind(this));},searchSaveSuccess:function(data){if(!$defined(data.id)){return;}var search={query:data.query,id:data.id};this.search.id=data.id;this.fireEvent("twitterSavedSearchAdd",search);},searchDelete:function(){this.call("twitter","twitter_searches_delete",{id:this.search.id},this.searchDeleteSuccess.bind(this));},searchDeleteSuccess:function(data){if(!$defined(data.id)){return;}this.search.id=0;this.fireEvent("twitterSavedSearchDelete",data.id);}});var TwitterSelfMenu=new Class({Extends:Menu,EventHandlers:["twitterSavedSearchAdd","twitterSavedSearchDelete"],onBeforeInit:function(options){this.settings=options.settings;this.screen_name=this.settings.screen_name;this.sync_posts=this.settings.sync_posts;options.displayName=this.settings.screen_name;options.className="twitter";return options;},onInit:function(){this.call("twitter","twitter_self_show",{screen_name:this.settings.screen_name},this.userShowSuccess.bind(this),null);},userShowSuccess:function(data){if(!$defined(data.user)){return;}var user=data.user;this.profile=new Element("div",{"class":"user_profile"}).inject(this.menu);ItemUtility.createItemPic(user.profile_image_url).inject(this.profile);new Element("div",{"class":"screen_name text12 light","text":user.screen_name}).inject(this.profile);new Element("div",{"class":"tweets text11 light2","text":user.statuses_count+" tweets"}).inject(this.profile);new Element("div",{"class":"text_section light1 text11 nowrap"}).adopt(new Element("span",{"class":"bold","text":"Name: "}),new Element("span",{"text":TextUtility.unescape(user.name)})).inject(this.menu);if($defined(user.location)&&user.location!=""){new Element("div",{"class":"text_section light1 text11 nowrap"}).adopt(new Element("span",{"class":"bold","text":"Location: "}),new Element("span",{"text":TextUtility.unescape(user.location)})).inject(this.menu);}if($defined(user.url)&&user.url!=""){new Element("div",{"class":"text_section light1 text11 nowrap"}).adopt(new Element("span",{"class":"bold","text":"Web: "}),new Element("a",{"target":"_blank","href":user.url,"text":user.url})).inject(this.menu);}if($defined(user.description)&&user.description!=""){new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Bio: "}),new Element("span",{"text":TextUtility.unescape(user.description)})).inject(this.menu);}var followers=new Element("span",{"class":"clickable","text":user.followers_count});followers.addEvent("click",pipio.dispatchEvent.bind(pipio,["twitterShowFollowers",user.screen_name]));new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Followers: "}),followers).inject(this.menu);var following=new Element("span",{"class":"clickable","text":user.friends_count});following.addEvent("click",pipio.dispatchEvent.bind(pipio,["twitterShowFollowing",user.screen_name]));new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Following: "}),following).inject(this.menu);new Element("div",{"class":"nav_seperator"}).inject(this.menu);this.syncPosts=new Toggle(this.sync_posts==1);$(this.syncPosts).addEvent("click",this.syncToggle.bind(this));new Element("div",{"class":"toggle_section"}).adopt(new Element("div",{"class":"text light","text":"Sync Posts:"}),$(this.syncPosts)).inject(this.menu);this.searchButton=new ButtonMedium({displayName:"Search Twitter",className:"dark",action:"search"});$(this.searchButton).addEvent("click",this.fireEvent.bind(this,["showTwitterSearchPopup"]));this.searchSection=new Element("div",{"class":"button_section"}).adopt($(this.searchButton)).inject(this.menu);this.savedSearchesNav=new TwitterSavedSearchesNav({});$(this.savedSearchesNav).inject(this.menu);this.fireEvent("twitterUserLoaded",data.user);this.fireEvent("twitterListsLoaded",data);this.fireEvent("twitterSavedSearchesLoaded",data.saved_searches);data.saved_searches.each(function(search){this.twitterSavedSearchAdd(search);},this);},syncToggle:function(){var params={key:"sync_posts",value:this.syncPosts.toInt()};this.call("twitter","twitter_settings_update",params);},twitterSavedSearchAdd:function(search){this.savedSearchesNav.savedSearchAdd(search);},twitterSavedSearchDelete:function(id){this.savedSearchesNav.savedSearchDelete(id);}});var TwitterUserMenu=new Class({Extends:Menu,EventHandlers:[],onBeforeInit:function(options){this.user=options.user;options.displayName=this.user.screen_name;options.className="twitter";return options;},onInit:function(){this.userShowSuccess(this.user);},userShowSuccess:function(data){if(!$defined(data)){return;}this.fireEvent("twitterUserLoaded",data);this.profile=new Element("div",{"class":"user_profile"}).inject(this.menu);ItemUtility.createItemPic(data.profile_image_url).inject(this.profile);new Element("div",{"class":"screen_name text12 light","text":data.screen_name}).inject(this.profile);new Element("div",{"class":"tweets text11 light2","text":data.statuses_count+" tweets"}).inject(this.profile);new Element("div",{"class":"text_section light1 text11 nowrap"}).adopt(new Element("span",{"class":"bold","text":"Name: "}),new Element("span",{"text":TextUtility.unescape(data.name)})).inject(this.menu);if($defined(data.location)&&data.location!=""){new Element("div",{"class":"text_section light1 text11 nowrap"}).adopt(new Element("span",{"class":"bold","text":"Location: "}),new Element("span",{"text":TextUtility.unescape(data.location)})).inject(this.menu);}if($defined(data.url)&&data.url!=""){new Element("div",{"class":"text_section light1 text11 nowrap"}).adopt(new Element("span",{"class":"bold","text":"Web: "}),new Element("a",{"target":"_blank","href":data.url,"text":data.url})).inject(this.menu);}if($defined(data.description)&&data.description!=""){new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Bio: "}),new Element("span",{"text":TextUtility.unescape(data.description)})).inject(this.menu);}var followers=new Element("span",{"class":"clickable","text":data.followers_count});followers.addEvent("click",pipio.dispatchEvent.bind(pipio,["twitterShowFollowers",data.screen_name]));new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Followers: "}),followers).inject(this.menu);var following=new Element("span",{"class":"clickable","text":data.friends_count});following.addEvent("click",pipio.dispatchEvent.bind(pipio,["twitterShowFollowing",data.screen_name]));new Element("div",{"class":"text_section light1 text11"}).adopt(new Element("span",{"class":"bold","text":"Following: "}),following).inject(this.menu);new Element("div",{"class":"nav_seperator"}).inject(this.menu);this.follow=new Toggle(data.following);$(this.follow).addEvent("click",this.followToggle.bind(this));new Element("div",{"class":"toggle_section"}).adopt(new Element("div",{"class":"text light","text":"Following:"}),$(this.follow)).inject(this.menu);},followToggle:function(){if(this.follow.isOn){this.call("twitter","twitter_follow",{screen_name:this.user.screen_name});}else{this.call("twitter","twitter_unfollow",{screen_name:this.user.screen_name});}}});var TwitterSavedSearchesNav=new Class({Extends:Nav,onBeforeInit:function(options){options.name="savedSearches";options.hasSubnavs=true;options.iconOptions={iconName:"search"};options.displayName="Saved Searches";return options;},onInit:function(){this.savedSearches=$H();this.updateNav();},savedSearchAdd:function(search){if(this.hasSubnav(search.query)){return;}var nav=new Nav({displayName:search.query,name:search.id,parentName:"savedSearches",onClick:this.fireEvent.bind(this,["twitterSearch",search.query,search.id])});this.addSubnav(nav);this.savedSearches.set(search.id,search);this.updateNav();},savedSearchDelete:function(id){this.deleteSubnav(id);this.savedSearches.erase(id);this.updateNav();},updateNav:function(){if(this.savedSearches.getLength()==0){DomUtility.hide(this.navWrapper);}else{DomUtility.show(this.navWrapper);}}});var TwitterInstallPopupContent=new Class({Extends:PopupContent,EventHandlers:["twitterOauthAccess"],strings:{postSyncLabel:"Sync posts to Twitter:",errorMessage:"There was an error connecting to Twitter"},onInit:function(){this.appId=5;this.syncPostsToggle=new Toggle(true);new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"label light","text":this.strings.postSyncLabel}),$(this.syncPostsToggle)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Install Twitter",className:"dark",action:"check"});this.message=new Element("div",{"class":"message error"});this.actions=new Element("div",{"class":"actions"}).adopt(this.message,$(this.actionButton),$(this.closeButton)).inject(this.content);this.authRequest();},authRequest:function(){this.call("twitter","twitter_auth_request",null,this.authRequestSuccess.bind(this));},authRequestSuccess:function(data){if(!$defined(data.authorize_url)){return;}new Element("a",{"href":data.authorize_url,"target":"_blank"}).wraps(this.actionButton);},twitterOauthAccess:function(data){if(data.oauth!="success"){return;}var params={sync_posts:this.syncPostsToggle.toInt()};this.call("twitter","twitter_install",params,this.twitterInstallSuccess.bind(this));},twitterInstallSuccess:function(){this.closeContent();}});var TwitterRetweetPopupContent=new Class({Extends:PopupContent,strings:{},EventHandlers:[],onBeforeInit:function(options){this.post_id=options.post_id;return options;},onInit:function(){this.searchInput=new Element("input",{"type":"text","maxlength":"50"});this.searchInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));this.searchInputSection=new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"textarea_wrapper"}).adopt(this.searchInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Search",className:"dark",action:"search"});$(this.actionButton).addEvent("click",this.search.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key=="enter"){if(this.searchInput.value.trim()!=""){this.search();}}},search:function(){var query=this.searchInput.value.trim();if(query!=""){this.fireEvent("twitterSearch",query);}this.closeContent();},onShow:function(){this.focus();},focus:function(){this.searchInput.focus.delay(500,this.searchInput);}});var TwitterSearchPopupContent=new Class({Extends:PopupContent,strings:{},EventHandlers:[],onInit:function(){this.searchInput=new Element("input",{"type":"text","maxlength":"50"});this.searchInput.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));this.searchInputSection=new Element("div",{"class":"input_section"}).adopt(new Element("div",{"class":"textarea_wrapper"}).adopt(this.searchInput)).inject(this.content);this.closeButton=new ButtonMedium({displayName:"Cancel",className:"dark",action:"cross"});$(this.closeButton).addEvent("click",this.closeContent.bind(this));this.actionButton=new ButtonMedium({displayName:"Search",className:"dark",action:"search"});$(this.actionButton).addEvent("click",this.search.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.actionButton),$(this.closeButton)).inject(this.content);},inputKeyUp:function(e){if(e.key=="enter"){if(this.searchInput.value.trim()!=""){this.search();}}},search:function(){var query=this.searchInput.value.trim();if(query!=""){this.fireEvent("twitterSearch",query);}this.closeContent();},onShow:function(){this.focus();},focus:function(){this.searchInput.focus.delay(500,this.searchInput);}});var TwitterShareBox=new Class({Extends:Base,EventHandlers:["userSwitched","twitterShareBoxShow"],init:function(){this.shareboxes=$H();},userSwitched:function(){if(!this.isLoggedIn()){this.userLoggedOut();}},userLoggedOut:function(){this.shareboxes.each(function(sharebox,key){sharebox.close();this.shareboxes.erase(key);},this);this.shareboxes=$H();},twitterShareBoxShow:function(user,isSelf,post_id){if($defined(this.sharebox)){this.sharebox.close();}this.createShareBox(user,isSelf,post_id);},createShareBox:function(user,isSelf,post_id){this.sharebox=new Popup({size:{x:500,y:100},resizable:false,dockable:false,className:"facebook sharebox",onClose:this.destroyShareBox.bind(this)});var displayName=(isSelf)?"Tweet":"Mention "+user.screen_name;if($defined(post_id)){displayName="Reply to "+user.screen_name;}var nav=new Nav({iconOptions:{iconName:user.profile_image_url},displayName:displayName,closable:true});var content=new TwitterShareBoxPopupContent({user:user,is_self:isSelf,post_id:post_id});this.sharebox.addContent("sharebox",nav,content);},destroyShareBox:function(name){this.sharebox=null;}});var TwitterShareBoxPopupContent=new Class({Extends:PopupContent,onBeforeInit:function(options){this.user=options.user;options.displayName=this.user.screen_name;this.post_id=($defined(options.post_id))?options.post_id:"";this.isSelf=options.is_self;return options;},reset:function(){Logger().log("resetting");this.closeAttachmentPopup();this.content.empty();this.onInit();},onInit:function(){this.formEl=null;this.isPublic=true;this.readyToPost=false;if(this.isSelf){this.input=new Element("textarea",{"maxlength":140});}else{this.input=new Element("textarea",{"maxlength":140,"value":"@"+this.user.screen_name+" "});}this.input.addEvent("keyup",this.inputKeyUp.bindWithEvent(this));new Element("div",{"class":"textarea_wrapper"}).adopt(this.input).inject(this.content);this.cancelButton=new ButtonMedium({displayName:"Close",className:"dark",action:"cross"});$(this.cancelButton).addEvent("click",this.closeContent.bind(this));this.updateButton=new ButtonMedium({displayName:"Post",className:"dark",action:"check"});$(this.updateButton).addEvent("click",this.post.bind(this));this.actions=new Element("div",{"class":"actions"}).adopt($(this.updateButton),$(this.cancelButton)).inject(this.content);this.focus();},inputKeyUp:function(e){if(e.shift&&e.key=="enter"){e.preventDefault();this.post();}if(DomUtility.textareaAutoSize(e.target,40)){this.updateSize();}},updateSize:function(){h+=this.input.getSize().y+10;h+=this.actions.getSize().y+30;this.resizePopup(500,h);},post:function(){var body=this.input.value.trim();if(body==""&&this.attachment.type==AttachmentType.None){this.fireEvent("showAlert","empty_post","Problem Posting","Please enter some content to post.");return;}var params={"body":body,"post_id":this.post_id};this.call("twitter","twitter_post_text",params,this.postSuccess.bind(this),this.postFail.bind(this),this.formEl);this.updateButton.showProgress();},postSuccess:function(){this.updateButton.hideProgress();this.fireEvent("twitterHomeReload");this.closeContent();},postFail:function(){this.updateButton.hideProgress();},onShow:function(){this.focus();},focus:function(){this.input.focus.delay(500,this.input);}});var TwitterStatusBox=new Class({Extends:Base,EventHandlers:[],init:function(user,isSelf){this.user=user;this.user.status.can_delete=1;this.isSelf=isSelf;this.defaultStatus="has no current status";this.createStatusBox();},createStatusBox:function(){this.box=ItemUtility.createPostBubble("post status_message haspic");ItemUtility.createItemPic(this.user.profile_image_url).inject(this.box);var buttonText=this.isSelf?"Tweet":"Mention "+this.user.screen_name;this.writeButton=new Element("div",{"class":"button","text":TextUtility.unescape(buttonText)}).inject(this.box);this.writeButton.addEvent("click",this.fireEvent.bind(this,["twitterShareBoxShow",this.user,this.isSelf]));this.content=new Element("div",{"class":"post_content"}).inject(this.box);var header=new Element("div",{"class":"header"}).inject(this.content);var creator=new Element("span",{"class":"user_name","text":TextUtility.unescapeQuotes(this.user.name)}).inject(header);this.status=new Element("span",{"class":"status"}).inject(header);TwitterItemUtility.createTwitterItemFooter(this.user.status).inject(this.content);this.updateStatus();},updateStatus:function(){if($defined(this.user.status.text)&&this.user.status.text!=""){this.status.removeClass("empty");this.status.set("html"," "+TwitterItemUtility.parseTwitterUsernames(TwitterItemUtility.parseTwitterLists(TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescapeQuotes(this.user.status.text))))));}else{this.status.addClass("empty");this.status.set("text"," "+TextUtility.unescape(this.defaultStatus));}},toElement:function(){return this.box;}});var TwitterFollowsItemUtility={createTwitterFollowItem:function(user){var el=ItemUtility.createPostBubble("post contact",true);new Element("img",{"class":"profile_pic_wrapper_60 afb_profile_pic","src":user.profile_image_url}).inject(el);var username=new Element("div",{"class":"user_name clickable","text":TextUtility.unescape(user.screen_name)});new Element("div",{"class":"heading"}).adopt(username).inject(el);username.addEvent("click",pipio.dispatchEvent.bind(pipio,["showTwitterUser",user.screen_name]));var viewButton=new ButtonMedium({displayName:"View "+user.screen_name,action:"goto dark"});$(viewButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["showTwitterUser",user.screen_name]));if(user.following){var unfollowButton=new ButtonMedium({displayName:"Unfollow "+user.screen_name,action:"cross"});$(unfollowButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["twitterUnfollow",user.screen_name]));}var blockButton=new ButtonMedium({displayName:"Block "+user.screen_name,action:"goto dark"});$(blockButton).addEvent("click",pipio.dispatchEvent.bind(pipio,["twitterBlock",user.screen_name]));var buttons=new Element("div",{"class":"actions"}).adopt($(viewButton),$(blockButton)).inject(el);if($defined(unfollowButton)){buttons.adopt($(unfollowButton));}return el;}};var TwitterItemUtility={createTwitterSearchItem:function(item){var el=ItemUtility.createPostBubble("post haspic");ItemUtility.createItemPic(item.profile_image_url).inject(el);var content=new Element("div",{"class":"post_content"}).inject(el);TwitterItemUtility.createTwitterSearchItemHeader(item).inject(content);TwitterItemUtility.createTwitterSearchItemFooter(item).inject(content);TwitterItemUtility.createTwitterItemPostActions(item).inject(el);return el;},createTwitterSearchItemHeader:function(item){var el=new Element("div",{"class":"header"});TwitterItemUtility.createSearchUsernameElement(item.from_user).inject(el);var body=new Element("span",{"html":" "+TwitterItemUtility.parseTwitterUsernames(TwitterItemUtility.parseTwitterLists(TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescapeQuotes(item.text)))))}).inject(el);return el;},createSearchUsernameElement:function(screen_name){var el=new Element("span",{"class":"user_name clickable","text":TextUtility.unescapeQuotes(screen_name)});el.addEvent("click",pipio.dispatchEvent.bind(pipio,["showTwitterUser",screen_name]));return el;},createTwitterSearchItemFooter:function(item){var el=new Element("div",{"class":"footer"});var date=DateUtility.convertFromTimestamp(Date.parse(item.created_at)/1000);var ts=new Element("span",{"class":"timestamp","text":DateUtility.getTimestamp(date,"%B %D at %I:%M%p"),"ts":date,"ts_format":"%B %D at %I:%M%p"}).inject(el);el.appendText(" from ");new Element("span",{"html":TwitterItemUtility.parseTwitterSource(TextUtility.unescapeHtml(item.source))}).inject(el);if($defined(item.to_user)){el.appendText(" in reply to ");var userEl=new Element("span",{"text":item.to_user});new Element("span").adopt(userEl).inject(el);userEl.addEvent("click",pipio.dispatchEvent.bind(pipio,["showTwitterUser",item.to_user]));}var reply=TwitterItemUtility.createFooterAction("reply","Reply",true).inject(el);var user={screen_name:item.from_user,profile_image_url:item.profile_image_url};reply.addEvent("click",pipio.dispatchEvent.bind(pipio,["twitterShareBoxShow",user,false,item.id]));var retweet=TwitterItemUtility.createFooterAction("forward","Retweet",true).inject(el);retweet.addEvent("click",pipio.dispatchEvent.bind(pipio,["twitterRetweet",item.id]));return el;},deleteTwitterItem:function(id){$$(".twitter_item_"+id).each(function(el){DomUtility.fadeOutDestroy(el);});},createTwitterItem:function(item){var el=ItemUtility.createPostBubble("post haspic twitter_item_"+item.id);ItemUtility.createItemPic(item.user.profile_image_url).inject(el);var content=new Element("div",{"class":"post_content"}).inject(el);TwitterItemUtility.createTwitterItemHeader(item).inject(content);TwitterItemUtility.createTwitterItemFooter(item).inject(content);TwitterItemUtility.createTwitterItemPostActions(item).inject(el);return el;},createTwitterItemPostActions:function(item){var el=new Element("div",{"class":"post_actions"});if($defined(item.can_delete)&&item.can_delete==1){var deleteAction=new Element("div",{"class":"post_action delete"}).inject(el);deleteAction.addEvent("click",pipio.dispatchEvent.bind(pipio,["twitterDelete",item.id]));}return el;},createTwitterItemHeader:function(item){var el=new Element("div",{"class":"header"});TwitterItemUtility.createUsernameElement(item.user).inject(el);var body=new Element("span",{"html":" "+TwitterItemUtility.parseTwitterUsernames(TwitterItemUtility.parseTwitterLists(TextUtility.replaceUrls(TextUtility.convertNewLine(TextUtility.unescapeQuotes(item.text)))))}).inject(el);return el;},createUsernameElement:function(user){var el=new Element("span",{"class":"user_name clickable","text":TextUtility.unescapeQuotes(user.screen_name)});el.addEvent("click",pipio.dispatchEvent.bind(pipio,["showTwitterUser",user.screen_name]));return el;},createTwitterItemFooter:function(item){var el=new Element("div",{"class":"footer"});var date=DateUtility.convertFromTimestamp(Date.parse(item.created_at)/1000);var ts=new Element("span",{"class":"timestamp","text":DateUtility.getTimestamp(date,"%B %D at %I:%M%p"),"ts":date,"ts_format":"%B %D at %I:%M%p"}).inject(el);el.appendText(" from ");new Element("span",{"html":TwitterItemUtility.parseTwitterSource(item.source)}).inject(el);if($defined(item.in_reply_to_status_id)){el.appendText(" in reply to ");new Element("span").adopt(new Element("a",{"target":"_blank","href":"http://twitter.com/"+item.in_reply_to_screen_name+"/status/"+item.in_reply_to_status_id,"text":item.in_reply_to_screen_name})).inject(el);}var is_self=$defined(item.can_delete)&&item.can_delete==1;if(!is_self){var reply=TwitterItemUtility.createFooterAction("reply","Reply",true).inject(el);reply.addEvent("click",pipio.dispatchEvent.bind(pipio,["twitterShareBoxShow",item.user,is_self,item.id]));var retweet=TwitterItemUtility.createFooterAction("forward","Retweet",true).inject(el);retweet.addEvent("click",pipio.dispatchEvent.bind(pipio,["twitterRetweet",item.id]));}return el;},createFooterAction:function(actionName,actionText,hide){var el=new Element("span",{"class":"footer_action has_action"}).adopt(new Element("div",{"class":"action "+actionName}));el.appendText(actionText);if(hide){el.addClass("hide");}return el;},parseTwitterLists:function(content){if(!$defined(content)){return"";}content=content.replace(/([^A-Za-z0-9'>\/_-])@([A-Za-z0-9_-]+\/[A-Za-z0-9_-]+)/gi,"$1<a href=\"#\" onclick=\"pipio.dispatchEvent('showTwitterList', '$2');return false;\">@$2</a>");content=content.replace(/^(@[A-Za-z0-9'>\/_-]+\/[A-Za-z0-9_-]+)\s/gi,"<a href=\"#\" onclick=\"pipio.dispatchEvent('showTwitterList', '$1');return false;\">@$1</a> ");return content;},parseTwitterUsernames:function(content){if(!$defined(content)){return"";}content=content.replace(/([^A-Za-z0-9'>\/_-])@([A-Za-z0-9_-]+)/gi,"$1<a href=\"#\" onclick=\"pipio.dispatchEvent('showTwitterUser', '$2');return false;\">@$2</a>");content=content.replace(/^@([A-Za-z0-9'>\/_-]+)\s/gi,"<a href=\"#\" onclick=\"pipio.dispatchEvent('showTwitterUser', '$1');return false;\">@$1</a> ");return content;},replaceTwitterHashes:function(content){if(!$defined(content)){return"";}content=content.replace(/([^A-Za-z0-9'>\/_-])(#[A-Za-z0-9_-]+)/gi,"$1<a href=\"#\" onclick=\"pipio.dispatchEvent('twitterSearchShow', '$2');\">$2</a>");content=content.replace(/^(#[A-Za-z0-9'>\/_-]+)\s/gi,"<a href=\"#\" onclick=\"pipio.dispatchEvent('twitterSearchShow', '$1');\">$1</a> ");return content;},parseTwitterSource:function(source){if(!$defined(source)){return"";}return source.replace(/<a href/g,'<a target="_blank" href');},replaceTwitterSearchSource:function(source){if(!$defined(source)){return"";}source=DomUtility.unescapeHtml(source);return source.replace(/<a href/g,'<a target="_blank" href');}};var User=new Class({Extends:AppInstance,EventHandlers:["userInfoLoaded","userSwitched"],parseOptions:function(options){this.user=options.user;this.displayName=this.user.fullname;this.appId="user_"+this.user.username;this.iconOptions={user:this.user};},userSwitched:function(){this.stop();},onStart:function(){this.setupNav();},onStop:function(){}});User.implement({requests:[{name:"info_load",params:["username"],url:"api/user/info/load"}]});User.implement({setupNav:function(){this.hasRooms=false;Logger().log("home setup");this.navAdd(new Nav({iconOptions:{iconName:"updates"},displayName:"Updates",name:"updates",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"updates","user_menu"])}));this.navAdd(new Nav({iconOptions:{iconName:"star"},displayName:"Favorites",name:"likes",onClick:this.fireEvent.bind(this,["viewSwitch",this.appId,"likes","likes_menu"])}));var userMenu=new UserMenu({user:this.user,isDefault:true,closeFunc:this.stop.bind(this)});this.menuAdd("user_menu",userMenu);var content=new UserContent({isDefault:true,user:this.user});this.contentAdd("updates",content);var likesMenu=new LikesMenu({user:this.user});this.menuAdd("likes_menu",likesMenu);var likesContent=new LikesContent({user:this.user});this.contentAdd("likes",likesContent);},roomAdd:function(room){if(!this.hasRooms){this.navAdd(new Nav({iconOptions:{iconName:"rooms"},hasSubnavs:true,displayName:"Rooms",name:"rooms"}));this.hasRooms=true;}var nav=new Nav({iconOptions:{iconName:"rooms"},displayName:room.room_name,name:"room_"+room.username,parentName:"rooms",onClick:this.fireEvent.bind(this,["showRoom",room])});this.navAdd(nav);},userInfoLoaded:function(data){if(!$defined(data.user)||data.user.username!=this.user.username){return;}data.rooms.each(function(room){room=UserUtility.processRoom(room);this.roomAdd(room);},this);}});var UserConnectionMenuSection=new Class({Extends:Base,EventHandlers:["contactAdded","contactDeleted","contactRequestAdded","contactRequestDeleted","contactRequestOutAdded","contactRequestOutDeleted","streamSubscriptionAdded","streamSubscriptionDeleted"],init:function(options){this.user=options.user;this.subscribed=false;this.isSelf=this.user.user_id==this.getPrivateUser().user_id;this.createSection();},createSection:function(){this.wrapper=new Element("div");this.generateSection();},contactAdded:function(user){if(this.user.username!=user.username){return;}this.generateSection();},contactDeleted:function(username){if(this.user.username!=username){return;}this.generateSection();},contactRequestAdded:function(user){if(this.user.username!=user.username){return;}this.generateSection();},contactRequestDeleted:function(username){if(this.user.username!=username){return;}this.generateSection();},contactRequestOutAdded:function(user){if(this.user.username!=user.username){return;}this.generateSection();},contactRequestOutDeleted:function(username){if(this.user.username!=username){return;}this.generateSection();},generateSection:function(){this.wrapper.empty();if(this.isSelf){new Element("div",{"class":"text_section light centered text11","text":"This is you"}).inject(this.wrapper);}else{this.generateSubscriptionSection();var connectionState=this.getConnectionState(this.user.username);switch(connectionState){case 0:this.createNotConnectedSection();break;case 1:this.createConnectedSection();break;case 2:this.createRequestSection();break;case 3:this.createRequestOutSection();break;}}},setSubscription:function(subscribed){this.subscribed=subscribed;this.generateSection();},generateSubscriptionSection:function(){this.subscription=new Toggle(this.subscribed);$(this.subscription).addEvent("click",this.subscriptionToggle.bind(this));new Element("div",{"class":"toggle_section"}).adopt(new Element("div",{"class":"text light","text":"Subscribe:"}),$(this.subscription)).inject(this.wrapper);},subscriptionToggle:function(){if(this.subscribed){this.streamUnsubscribe();}else{this.streamSubscribe();}},streamUnsubscribe:function(){this.subscription.off();this.fireEvent("userUnsubscribe",this.user.username);},streamSubscribe:function(){this.subscription.on();this.call("contacts","user_subscribe",{username:this.user.username},null,this.streamSubscribeFail.bind(this));},streamSubscribeFail:function(status){if(status.code==2002){this.subscription.off();var name="subscription";var title="Error";var message=status.message;this.fireEvent("showAlert",name,title,message);}},streamSubscriptionAdded:function(data){if(!$defined(data.user)||data.user.username!=this.user.username){return;}this.subscribed=true;this.generateSection();},streamSubscriptionDeleted:function(data){if(!$defined(data.username)||data.username!=this.user.username){return;}this.subscribed=false;this.generateSection();},createNotConnectedSection:function(){this.connectButton=new ButtonMedium({displayName:"Add Contact",className:"dark",action:"check"});$(this.connectButton).addEvent("click",this.sendContactRequest.bind(this));new Element("div",{"class":"button_section"}).adopt($(this.connectButton)).inject(this.wrapper);},createConnectedSection:function(){new Element("div",{"class":"text_section light centered text11","text":TextUtility.unescape(this.user.first_name)+" is your contact"}).inject(this.wrapper);},createRequestOutSection:function(){new Element("div",{"class":"text_section light centered text11","text":"Contact request pending"}).inject(this.wrapper);},createRequestSection:function(){var button=new ButtonMedium({displayName:"Accept Request",className:"dark",action:"check"});$(button).addEvent("click",this.fireEvent.bind(this,["connectionRequestAccept",this.user.username]));new Element("div",{"class":"button_section"}).adopt($(button)).inject(this.wrapper);},toElement:function(){return this.wrapper;},sendContactRequest:function(){this.fireEvent("connectionRequestCreate",this.user.username);this.connectButton.showProgress();}});var UserContent=new Class({Extends:Content,EventHandlers:["streamItemReceived","userStreamItemDeleted"],onBeforeInit:function(options){this.user=options.user;},onInit:function(){this.statusBox=new StatusBox(this.user);$(this.statusBox).inject(this.content);this.loader=new StreamLoader({createElementFunc:StreamItemUtility.createUserStreamItem,emptyEl:new Element("div",{"class":"post empty","text":TextUtility.unescape(this.user.fullname)+" has no updates"}),loadingEl:new Element("div",{"class":"post empty","text":TextUtility.unescape(this.user.fullname)+"'s updates loading..."}),errorEl:new Element("div",{"class":"post empty","text":TextUtility.unescape(this.user.fullname)+"'s stream is private"})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},streamItemReceived:function(data){if($defined(data.item)&&data.item.source.username==this.user.username&&data.item.is_public==1){this.loader.process(data.item);}},userStreamItemDeleted:function(data){if(!$defined(data.username)||data.username!=this.room.username){return;}this.loader.remove(data.item_id);},loadMore:function(){var params={username:this.user.username,date_created:this.loader.oldestTimestamp,item_id:this.loader.oldestId};if(this.isLoggedIn()){this.call("home","stream_user_load",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));}else{this.call("home","public_stream_user_load",params,this.loadMoreSuccess.bind(this),this.loadMoreFail.bind(this));}this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.items)||data.items.length==0){this.atBottom=true;return;}data.items.each(function(item){this.loader.process(item);},this);this.bottomFuncCalled=false;},loadMoreFail:function(status){if(status.code==2002){this.loader.showError();}},bottomFunc:function(){this.loadMore();}});var UserMenu=new Class({Extends:Menu,EventHandlers:["userSubscriberAdded","userSubscriberDeleted","userSubscriptionAdded","userSubscriptionDeleted"],onBeforeInit:function(options){this.user=options.user;options.displayName=this.user.fullname;return options;},onInit:function(){this.map=new UserMapMenuSection({user:this.user});$(this.map).inject(this.menu);this.aboutSection=new UserProfileMenuSection({user:this.user});$(this.aboutSection).inject(this.menu);if(this.isLoggedIn()){this.connect=new UserConnectionMenuSection({user:this.user});$(this.connect).inject(this.menu);}new Element("div",{"class":"nav_seperator"}).inject(this.menu);this.subscriptions=new SubscriptionsNav({user:this.user});$(this.subscriptions).inject(this.menu);this.subscribers=new SubscribersNav({user:this.user});$(this.subscribers).inject(this.menu);},onShow:function(first){if(first){this.userInfoLoad();}},userInfoLoad:function(){if(this.isLoggedIn()){this.call("user","info_load",{username:this.user.username},this.userInfoLoadSuccess.bind(this),null);}else{this.call("home","public_user_info_load",{username:this.user.username},this.userInfoLoadSuccess.bind(this),null);}},userInfoLoadSuccess:function(data){if(!$defined(data.user)){return;}this.fireEvent("userInfoLoaded",data);Logger().log("processing user");var user=UserUtility.processUser(data.user);this.subscribers.addUsers(data.subscribers);this.subscriptions.addUsers(data.subscriptions);var subscribed=(data.subscription_id!=0);this.connect.setSubscription(subscribed);},userSubscriberAdded:function(data){if(!$defined(data.source_username)||!$defined(data.user)||data.source_username!=this.user.username){return;}this.subscribers.addUsers(data.user);},userSubscriberDeleted:function(data){if(!$defined(data.source_username)||!$defined(data.username)||data.source_username!=this.user.username){return;}this.subscribers.removeUser(data.username);},userSubscriptionAdded:function(data){if(!$defined(data.subscriber)||!$defined(data.user)||data.subscriber!=this.user.username){return;}this.subscriptions.addUsers(data.user);},userSubscriptionDeleted:function(data){if(!$defined(data.subscriber)||!$defined(data.username)||data.subscriber!=this.user.username){return;}this.subscriptions.removeUser(data.username);}});var UserProfileMenuSection=new Class({Extends:Base,EventHandlers:["userProfileUpdated"],init:function(options){this.user=options.user;this.isSelf=this.user.user_id==this.getPrivateUser().user_id;this.createSection();},createSection:function(){this.wrapper=new Element("div");this.bioText=new Element("span");this.bioSection=new Element("div",{"class":"text_section light1 text11 edit_option"}).adopt(new Element("span",{"class":"bold","text":"Bio: "}),this.bioText).inject(this.wrapper);this.interestsText=new Element("span");this.interestsSection=new Element("div",{"class":"text_section light1 text11 edit_option"}).adopt(new Element("span",{"class":"bold","text":"Interests: "}),this.interestsText).inject(this.wrapper);this.urlText=new Element("a",{"target":"_blank"});this.urlSection=new Element("div",{"class":"text_section light1 text11 nowrap edit_option"}).adopt(new Element("span",{"class":"bold","text":"Web: "}),this.urlText).inject(this.wrapper);this.userProfileUpdated(this.user.username,this.getProfile(this.user.username));},userProfileUpdated:function(username,about){if(username!=this.user.username){return;}if(!$defined(about)){DomUtility.hide(this.bioSection);DomUtility.hide(this.urlSection);DomUtility.hide(this.interestsSection);return;}if(!$defined(about.bio)||about.bio==""){DomUtility.hide(this.bioSection);}else{this.bioText.set("text",TextUtility.unescape(about.bio));DomUtility.show(this.bioSection);}if(!$defined(about.interests)||about.interests==""){DomUtility.hide(this.interestsSection);}else{this.interestsText.set("text",TextUtility.unescape(about.interests));DomUtility.show(this.interestsSection);}if(!$defined(about.url)||about.url==""){DomUtility.hide(this.urlSection);}else{this.urlText.set("text",TextUtility.unescape(about.url));this.urlText.set("href",about.url);DomUtility.show(this.urlSection);}},toElement:function(){return this.wrapper;}});var UserSubscribersContent=new Class({Extends:Content,EventHandlers:["userSubscriberAdded","userSubscriberDeleted"],onBeforeInit:function(options){this.user=options.user;return options;},onInit:function(){this.statusBox=new StatusBox(this.user);$(this.statusBox).inject(this.content);StreamItemUtility.createSeperatorItem("Subscribers").inject(this.content);this.loader=new ItemLoader({idField:"user_id",sortField:"date_created",sortAscending:false,createElementFunc:ContactItemUtility.createRoomSubscriberItem,emptyEl:new Element("div",{"class":"post empty","text":"This user has no subscribers"}),loadingEl:new Element("div",{"class":"post empty","text":"User subscribers loading..."})});$(this.loader).inject(this.content);},onShow:function(first){if(first){this.loadMore();}},onHide:function(){},userSubscriberAdded:function(data){if(!$defined(data.source_username)||!$defined(data.user)||data.source_username!=this.user.username){return;}var user=UserUtility.processUser(data.user);user.date_created=new Date().getTime()/1000;this.loader.process(user);},userSubscriberDeleted:function(data){if(!$defined(data.source_username)||!$defined(data.username)||data.source_username!=this.user.username){return;}if(!$defined(this.getUser(data.username))){return;}var user=this.getUser(data.username);this.loader.remove(user.user_id);},loadMore:function(){var params={username:this.room.username,date_created:this.loader.lowestSortValue};this.call("pipio","room_subscribers",params,this.loadMoreSuccess.bind(this),null);this.loader.showLoading();},loadMoreSuccess:function(data){this.loader.hideLoading();if(!$defined(data.subscribers)||data.subscribers.length==0){this.atBottom=true;return;}data.subscribers.each(function(user){var user_copy=UserUtility.processUser(user);user_copy.date_created=user.date_created;this.loader.process(user_copy);},this);this.bottomFuncCalled=false;},bottomFunc:function(){this.loadMore();}});var Pipio=new Class({Implements:Events,initialize:function(){this.version=pipio_version;this.versionTimer=0;this.initApi();this.initVideo();this.registerApis();this.eventHandlers=new Hash();this.pageTitle="Pip.io";this.loggedIn=false;window.addEvent("domready",this.initCore.bind(this));this.registerHandler("userDataInit",this.userDataInit.bind(this));this.registerHandler("videoChatEnable",this.videoChatEnable.bind(this));this.registerHandler("videoInUse",this.videoChatInUse.bind(this));this.registerHandler("startApp",this.startApp.bind(this));this.registerHandler("startAppInstance",this.startAppInstance.bind(this));this.registerHandler("appInstalled",this.appInstalled.bind(this));this.registerHandler("appUninstalled",this.appUninstalled.bind(this));},initCore:function(){this.xmpp=new Xmpp();this.initProfiles();this.initConnections();this.initConnectionEventHandlers();this.initModules();this.initApps();this.setSessionTimestamp();this.userDataInit();this.checkCookie();},checkCookie:function(){var destination=DataUtility.getCookie("destination");if(destination!="room"&&destination!="user"){return;}var userval=DataUtility.getCookie("user");var user=JSON.decode(userval);if($defined(user)){if(destination=="user"){user=UserUtility.processUser(user);this.dispatchEvent("showUser",user);}else{user=UserUtility.processRoom(user);this.dispatchEvent("showRoom",user);}}},initModules:function(){this.modules=new Pipio.modules(this);},initApps:function(){this.apps=new Pipio.apps(this);},setSessionTimestamp:function(){this.sessionTimestamp=new Date();},checkTimestamp:function(time){return time>this.sessionTimestamp.getTime()/1000;},userDataInit:function(data){if($defined(data)){user_data=data;}if(user_data.logged_in==1){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){this.initInstalledApps(user_data.apps);this.initProfiles();this.initLoggedInConnections();this.currentUser=UserUtility.processUser(user_data.user);this.currentUser.email=$defined(user_data.user.email)?user_data.user.email:undefined;this.loggedIn=true;if(!$defined(this.versionTimer)||this.versionTimer==0){$clear(this.versionTimer);}this.versionTimer=this.ping.periodical(1000*60*2,this);this.dispatchEvent("userSwitched");},userLoggedOut:function(){this.initInstalledApps();this.initProfiles();this.initLoggedOutConnections();this.currentUser={user_id:0};this.currentLocation=null;this.loggedIn=false;$clear(this.versionTimer);this.dispatchEvent("userSwitched");},isConnected:function(username){return this.connections.connsByUsername.has(username);},isRequestPending:function(user_id){return this.connections.requestsById.has(user_id)||this.connections.requestsOutById.has(user_id);},isLoggedIn:function(){return this.loggedIn;},dispatchEvent:function(){var eventName=arguments[0];var args=[];for(var i=1;i<arguments.length;i++){args.push(arguments[i]);}Logger().log("fired event "+eventName+" - "+args.join(","));this.fireEvent(eventName,args);},registerHandler:function(eventName,func){if(this.eventHandlers.has(eventName)){this.eventHandlers.get(eventName).push(func);this.addEvent(eventName,func);}else{this.eventHandlers.set(eventName,[func]);this.addEvent(eventName,func);}},getSession:function(){return this.xmpp.clientName;},ping:function(){this.call("pipio","ping",{},this.pong.bind(this));},pong:function(data){if(!$defined(data.v)){return;}if(this.version!=data.v){this.dispatchEvent("showPipioUpdatePopup",data.v);}}});Pipio.implement({initApi:function(){this.apiMethods=new Hash();},registerCall:function(app,call){var apiKey=app+"_"+call.name;this.apiMethods.set(apiKey,call);},call:function(app,name,params,callbackSuccess,callbackFail,form){var apiKey=app+"_"+name;if(!this.apiMethods.has(apiKey)){Logger().log("api call not found!");return;}var call=this.apiMethods.get(apiKey);var paramList=$defined(call.params)?call.params:[];var url=call.url;var method=$defined(call.method)?call.method:"post";var multipart=$defined(form);Logger().log("multipart "+multipart);var parsedParams=new Hash();paramList.each(function(paramName){parsedParams.set(paramName,params[paramName]);});if(!multipart){var req=new Request({method:method,url:url,onFailure:function(){var res={status:{code:6000,message:"request failed"}};if($defined(callbackFail)){callbackFail(res.status);}},onSuccess:function(response){var res=response;if(res.status==null){try{res=JSON.decode(response);}catch(err){res={status:{code:6000,message:"request failed"}};if($defined(callbackFail)){callbackFail(res.status);}}}if($defined(res)&&$defined(res.status)&&res.status.code==0){if($defined(callbackSuccess)){if($defined(res.data)){callbackSuccess(res.data);}else{callbackSuccess();}}}else{if(!$defined(res)||!$defined(res.status)){res={status:{code:6000,message:"request failed"}};}if($defined(callbackFail)){callbackFail(res.status);}}}});if(method=="post"){req.send(parsedParams.toQueryString());}else{req.send();}}else{var iframeId="postIframe"+$random(10000,99999);form.set("target",iframeId);form.set("action",url);form.set("method","post");form.set("enctype","multipart/form-data");parsedParams.each(function(val,name){new Element("input",{"type":"hidden","name":name,"value":val}).inject(form);},this);var iframe=new IFrame({"id":iframeId,"events":{load:function(){var response=window.frames[iframeId].document.body.innerHTML;if(response==""){return;}Logger().log(response);var res=JSON.decode(response);if($defined(res)&&$defined(res.status)&&res.status.code==0){if($defined(callbackSuccess)){if($defined(res.data)){callbackSuccess(res.data);}else{callbackSuccess();}}}else{if(!$defined(res)||!$defined(res.status)){res={status:{code:6000,message:"request failed"}};}if($defined(callbackSuccess)){callbackFail(res.status);}}}}});iframe.inject("hidden");form.submit();}}});Pipio.implement({moduleList:[{name:"ui",classRef:UI},{name:"login",classRef:Login},{name:"background",classRef:Background},{name:"chat",classRef:Chat},{name:"videochat",classRef:VideoChat},{name:"notifications",classRef:Notifications},{name:"sharebox",classRef:ShareBox},{name:"invite",classRef:Invite},{name:"settings",classRef:Settings},{name:"albumViewer",classRef:AlbumViewer},{name:"facebookSharebox",classRef:FacebookShareBox},{name:"twitterSharebox",classRef:TwitterShareBox},{name:"location",classRef:Location}],initModules:function(){this.modules=new Hash();this.moduleList.each(function(module){this.initModule(module.name,module.classRef);},this);},initModule:function(name,classRef){var o=new classRef();this.modules.set(name,o);}});Pipio.implement({initProfiles:function(){this.locationsByUsername=$H();this.profilesByUsername=$H();},locationUpdated:function(data){Logger().log("location updated called for "+data.username);if(!$defined(data.username)||!$defined(data.location_enabled)){return;}if($defined(this.getUser(data.username))){this.getUser(data.username).location_enabled=data.location_enabled;}if($defined(data.location)){this.locationsByUsername.set(data.username,data.location);}this.dispatchEvent("userLocationUpdated",data.username,data.location,data.location_enabled);},locationCleared:function(data){if(!$defined(data.username)){return;}this.locationsByUsername.erase(data.username);this.dispatchEvent("userLocationUpdated",data.username,null,0);},getLocation:function(username){if(this.locationsByUsername.has(username)){return this.locationsByUsername.get(username);}else{return null;}},profileUpdated:function(data){if(!$defined(data.username)||!$defined(data.about)){return;}this.profilesByUsername.set(data.username,data.about);if($defined(this.getUser(data.username))){this.dispatchEvent("userProfileUpdated",data.username,data.about);}else{if($defined(this.getRoom(data.username))){this.dispatchEvent("roomProfileUpdated",data.username,data.about);}}},getProfile:function(username){if(this.profilesByUsername.has(username)){return this.profilesByUsername.get(username);}else{return null;}}});Pipio.implement({initVideo:function(){this.videoEnabled=false;this.videoInUse=false;},videoChatEnable:function(enabled){this.videoEnabled=enabled;},videoChatInUse:function(inUse){if(!this.videoEnabled){return;}this.videoInUse=inUse;}});var Xmpp=new Class({Extends:Base,EventHandlers:["userSwitched","sendIM","sendTyping","sendVideoChatInvite","sendVideoChatAccept"],init:function(){this.newSession();this.domain="pip.io";this.userPresences=new Hash();this.roomsDomain="rooms.pip.io";this.multicastDomain="multicast.pip.io";this.pubsubDomain="pubsub.pip.io";var connArgs={httpbase:"/pipio-tubes",timerval:60*20};this.conn=new JSJaCHttpBindingConnection(connArgs);this.setupListeners();this.isConnecting=false;},userSwitched:function(){if(this.isLoggedIn()){this.userLoggedIn();}else{this.userLoggedOut();}},userLoggedIn:function(){this.newSession();this.fireEvent("xmppConnecting");this.connect.delay(1000,this);},userLoggedOut:function(){this.disconnect();},newSession:function(){this.sessionId=$random(1000,9999);this.clientName="pipio"+this.sessionId;},connect:function(){if(this.isConnecting){return;}if($defined(this.connectTimer)){$clear(this.connectTimer);}this.isConnecting=true;this.call("pipio","token_get",{},this.tokenGetSuccess.bind(this),this.tokenGetFail.bind(this));},disconnect:function(){this.isConnecting=false;this.updateSelfPresence("",false);this.conn.disconnect();this.fireEvent("xmppDisconnected");},tokenGetSuccess:function(data){Logger().log("xmpp token success - "+data.token+", connecting...");this.username=this.getPrivateUser().username;this.password=data.token;this.isConnecting=false;var args={domain:this.domain,username:this.username,resource:this.clientName,pass:this.password,register:false};this.conn.connect(args);},tokenGetFail:function(){this.isConnecting=false;this.connectTimer=this.connect.delay(10*1000,this);},updateSelfPresence:function(show,online){var pres=new JSJaCPresence();pres.setShow(show);var video=this.videoEnabled();if(video){pres.setPriority(10);}else{pres.setPriority(5);}if(online){pres.setType("");}else{pres.setType("unavailable");}var videoEnabled=(video)?1:0;var pip=pres.getDoc().createElementNS("http://pip.io/videochat","pip");pip.setAttribute("video",videoEnabled);pres.appendNode(pip);this.conn.send(pres);},userPresenceReceived:function(username,show,online,session,video){Logger().log(username+" "+show+" - "+session);var trueOnline=online;if(online){if(!this.userPresences.has(username)){this.userPresences.set(username,new Hash());}this.userPresences.get(username).set(session,video);}else{if(this.userPresences.has(username)){this.userPresences.get(username).erase(session);}if(this.userPresences.get(username).getLength()==0){this.userPresences.erase(username);}}if(this.userPresences.has(username)){trueOnline=true;}else{trueOnline=false;}Logger().log("firing "+username+" online-"+trueOnline+" show -"+show);this.fireEvent("userPresenceReceived",username,show,trueOnline);if(trueOnline){var videoEnabled=false;this.userPresences.get(username).each(function(videoExists){if(videoExists){videoEnabled=true;}});this.fireEvent("userVideoEnabled",username,videoEnabled);}},selfPresenceReceived:function(show,online){this.fireEvent("selfPresenceReceived",show,online);},sendVideoChatInvite:function(user){if(!$defined(user)){return;}if(!this.videoEnabled()){return;}var stratusId=sim.GetNearID();var userJID=new JSJaCJID(this.getJID(user));var aMsg=new JSJaCMessage();aMsg.setTo(userJID);aMsg.setBody(stratusId);aMsg.setType("videoChat");var success=this.conn.send(aMsg);this.fireEvent("videoInUse",true);this.fireEvent("selfPresenceUpdate");},sendVideoChatAccept:function(user){if(!$defined(user)){return;}if(!this.videoEnabled()){return;}var stratusId=sim.GetNearID();var userJID=new JSJaCJID(this.getJID(user));var aMsg=new JSJaCMessage();aMsg.setTo(userJID);aMsg.setBody(stratusId);aMsg.setType("videoChatAccept");var success=this.conn.send(aMsg);this.fireEvent("videoInUse",true);this.fireEvent("selfPresenceUpdate");},sendIM:function(user,msg){if(!$defined(user)||!$defined(msg)){return;}var userJID=new JSJaCJID(this.getJID(user));var aMsg=new JSJaCMessage();aMsg.setTo(userJID);aMsg.setBody(msg);aMsg.setType("chat");var success=this.conn.send(aMsg);if(success){var msg=this.buildMessage(user,true,msg,new Date());this.fireEvent("chatMsgReceived",msg);}},sendTyping:function(user){if(!$defined(user)){return;}var userJID=new JSJaCJID(this.getJID(user));var aMsg=new JSJaCMessage();aMsg.setTo(userJID);aMsg.setType("typing");var success=this.conn.send(aMsg);},buildMessage:function(target,outbound,msg,date){return{target:target,outbound:outbound,msg:msg,timestamp:date};},getBody:function(packet){var bodyNode=packet.getChild("body");if(!bodyNode){return"";}if(typeof(bodyNode.textContent)!="undefined"){return bodyNode.textContent;}return bodyNode.firstChild.nodeValue;},getItem:function(packet){var itemNode=packet.getChild("item");if(!itemNode){return"";}if(typeof(itemNode.textContent)!="undefined"){return itemNode.textContent;}return itemNode.firstChild.nodeValue;},handleMessage:function(packet){if(packet.getType()=="chat"){var timestamp=new Date();var x=packet.getChild("x");if($defined(x)){timestamp=DateUtility.convertFromGMT(Date.parse(x.getAttribute("stamp")));}var username=packet.getFromJID().getNode();var user=this.getContact(username);var msg=this.buildMessage(user,false,packet.getBody(),timestamp);this.fireEvent("chatMsgReceived",msg);}else{if(packet.getType()=="videoChat"){var username=packet.getFromJID().getNode();var stratusId=packet.getBody();this.fireEvent("videoChatRequestReceived",username,stratusId);}else{if(packet.getType()=="videoChatAccept"){var username=packet.getFromJID().getNode();var stratusId=packet.getBody();this.fireEvent("videoChatRequestAccepted",username,stratusId);}else{if(packet.getType()=="typing"){var username=packet.getFromJID().getNode();this.fireEvent("chatTypingReceived",username);}else{if(packet.getType()=="event"&&packet.getFromJID().getNode()=="server"){var msg=this.getBody(packet);var item=JSON.decode(msg);Logger().log("unicast/multicast received");if($defined(item.eventName)&&$defined(item.data)){this.fireEvent(item.eventName,item.data);}else{Logger().log("unknown event captured");}}else{if(packet.getChild("event")!=null){Logger().log("broadcast received");var msg=this.getItem(packet);if(msg!=""){var item=JSON.decode(msg);if($defined(item.eventName)&&$defined(item.data)){this.fireEvent(item.eventName,item.data);}else{Logger().log("unknown event captured");}}}}}}}}},handlePresence:function(packet){var jid=packet.getFromJID();var username=jid.getNode();var session=jid.getResource();if(jid.getDomain()==this.domain){Logger().log(username+" presence received");if(!packet.getType()){if(username==this.getPrivateUser().username){var show=packet.getShow();this.selfPresenceReceived(show,true);return;}var show=packet.getShow();var video=false;var pip=packet.getChild("pip","*");if(pip){if(pip.getAttribute("video")==1){video=true;}}this.userPresenceReceived(username,show,true,session,video);}else{if(packet.getType()=="unavailable"){var username=jid.getNode();if(username==this.getPrivateUser().username){return;}var session=jid.getResource();this.userPresenceReceived(username,"",false,session,false);}}}},handleConnected:function(){Logger().log("connected");this.isConnecting=false;this.fireEvent("xmppConnected");this.updateSelfPresence("",true,false);window.onunload=this.disconnect.bind(this);},handleDisconnected:function(){Logger().log("disconnected");this.isConnecting=false;this.fireEvent("xmppDisconnected");this.connectTimer=this.connect.delay(3000,this);},handleError:function(e){this.reconnect();Logger().log(e.xml());},handleInPacket:function(aJSJaCPacket){Logger().log("in");Logger().log("packet:"+aJSJaCPacket.xml());},handleOutPacket:function(aJSJaCPacket){Logger().log("out");Logger().log("packet:"+aJSJaCPacket.xml());},setupListeners:function(){this.conn.registerHandler("message",this.handleMessage.bind(this));this.conn.registerHandler("presence",this.handlePresence.bind(this));this.conn.registerHandler("onconnect",this.handleConnected.bind(this));this.conn.registerHandler("onerror",this.handleError.bind(this));this.conn.registerHandler("ondisconnect",this.handleDisconnected.bind(this));},getJID:function(user){if($defined(user)){return user.username+"@"+this.domain;}else{return this.username+"@"+this.domain;}}});Pipio.implement({appList:[{id:1,name:"contacts",displayName:"Contacts",iconOptions:{iconName:"pipio"},classRef:Contacts},{id:2,name:"home",displayName:"Home",iconOptions:{iconName:"pipio"},classRef:Home},{id:3,name:"appstore",displayName:"Pip.io App Store",iconOptions:{iconName:"applications"},classRef:Appstore,autoDock:true},{id:4,name:"rss",displayName:"News Reader",iconOptions:{iconName:"rss"},classRef:Rss,autoDock:true},{id:5,name:"facebook",displayName:"Facebook",iconOptions:{iconName:"facebook"},classRef:Facebook,autoDock:true},{id:6,name:"twitter",displayName:"Twitter",iconOptions:{iconName:"twitter"},classRef:Twitter,autoDock:true}],instanceAppList:{user:{name:"user",classRef:User,autoDock:true},room:{name:"room",classRef:Room,autoDock:true},global:{name:"global",classRef:Global,autoDock:true}},initApps:function(){this.apps=new Hash();this.appsById=$H();this.appInstances=new Hash();this.appList.each(function(app){this.initApp(app);},this);},initInstalledApps:function(apps){this.installedApps=$H();if(!$defined(apps)){return;}apps.each(function(app){this.installedApps.set(app.app_id,{settings:app.settings});},this);this.updateAppsMenu();},appInstalled:function(data){if(!$defined(data.app_id)){return;}this.installedApps.set(data.app_id,data);this.updateAppsMenu();var app=this.getAppById(data.app_id);this.startApp(app.name,{settings:data.settings});},appUninstalled:function(data){if(!$defined(data.app_id)){return;}this.installedApps.erase(data.app_id);this.updateAppsMenu();},updateAppsMenu:function(){DomUtility.hide("app_menu_item_4");DomUtility.hide("app_menu_item_5");DomUtility.hide("app_menu_item_6");DomUtility.show("no_apps");if(this.installedApps.getLength()>0){DomUtility.hide("no_apps");this.installedApps.each(function(app,appId){DomUtility.show("app_menu_item_"+appId);},this);}},getAppById:function(appId){if(this.appsById.has(appId)){return this.appsById.get(appId);}else{return false;}},initApp:function(app){var o=new app.classRef(app);this.apps.set(app.name,o);this.appsById.set(app.id,app);},startApp:function(appName,options){if(!this.apps.has(appName)){return;}var appId=this.apps.get(appName).appId;if(this.installedApps.has(appId)){this.apps.get(appName).start(this.installedApps.get(appId));}else{this.apps.get(appName).start(options);}},startAppInstance:function(appName,instanceName,options){if(!$defined(this.instanceAppList[appName])){return;}var appId=appName+"_"+instanceName;if(this.appInstances.has(appId)){this.appInstances.get(appId).start(appId);return;}var app=this.instanceAppList[appName];var o=new app.classRef(app,options);this.appInstances.set(appId,o);o.start(appId);}});Pipio.implement({initConnectionEventHandlers:function(){this.registerHandler("connectionGroupAdded",this.connectionGroupAdded.bind(this));this.registerHandler("connectionGroupDeleted",this.connectionGroupDeleted.bind(this));this.registerHandler("connectionGroupMoved",this.connectionGroupMoved.bind(this));this.registerHandler("connectionAdded",this.connectionAdded.bind(this));this.registerHandler("connectionDeleted",this.connectionDeleted.bind(this));this.registerHandler("connectionRequestAdded",this.connectionRequestAdded.bind(this));this.registerHandler("connectionRequestDeleted",this.connectionRequestDeleted.bind(this));this.registerHandler("connectionRequestOutAdded",this.connectionRequestOutAdded.bind(this));this.registerHandler("connectionRequestOutDeleted",this.connectionRequestOutDeleted.bind(this));this.registerHandler("roomAdded",this.roomAdded.bind(this));this.registerHandler("roomDeleted",this.roomDeleted.bind(this));this.registerHandler("roomClosed",this.roomDeleted.bind(this));this.registerHandler("roomMembershipUpdated",this.roomMembershipUpdated.bind(this));this.registerHandler("roomStreamSubscriptionDeleted",this.roomStreamSubscriptionDeleted.bind(this));this.registerHandler("roomStreamSubscriptionAdded",this.roomStreamSubscriptionAdded.bind(this));this.registerHandler("profileUpdated",this.profileUpdated.bind(this));this.registerHandler("locationUpdated",this.locationUpdated.bind(this));this.registerHandler("locationCleared",this.locationCleared.bind(this));},initConnections:function(){this.connsByUsername=$H();this.userCache=$H();this.groups=$H();this.requestsByUsername=$H();this.requestsOutByUsername=$H();this.roomsByUsername=$H();this.roomCache=$H();},initLoggedInConnections:function(){this.initConnections();this.processConnections();},initLoggedOutConnections:function(){this.initConnections();},userAboutUpdated:function(data){if(!$defined(data.username)){return;}if(this.connsByUsername.has(data.username)){this.connsByUsername.get(data.username).about=data.about;}if(this.userCache.has(data.username)){this.userCache.get(data.username).about=data.about;}},processConnections:function(){Logger().log("processing user connections");user_data.groups.each(function(group){this.processGroup(group);},this);var unsorted={group_id:0,name:"Unsorted"};this.processGroup(unsorted);user_data.connections.each(function(user){this.processConnection(user);},this);user_data.connection_requests.each(function(user){this.processConnectionRequest(user);},this);user_data.connection_requests_out.each(function(user){this.processConnectionRequestOut(user);},this);user_data.rooms.each(function(room){this.processRoom(room);},this);},processGroup:function(group){group.users=new Hash();this.groups.set(parseInt(group.group_id),group);return group;},processRoom:function(room){room=UserUtility.processRoom(room);this.roomsByUsername.set(room.username,room);return room;},processConnection:function(user){user=UserUtility.processUser(user);this.connsByUsername.set(user.username,user);var group=this.getGroup(user.group_id);this.addUserToGroup(user,group);return user;},processConnectionRequest:function(user){user=UserUtility.processUser(user);this.requestsByUsername.set(user.username,user);return user;},processConnectionRequestOut:function(user){Logger().log("procesing out request "+user.username);user=UserUtility.processUser(user);this.requestsOutByUsername.set(user.username,user);return user;},roomAdded:function(data){if(!$defined(data.room)){return;}var room=this.processRoom(data.room);this.dispatchEvent("feedRoomAdded",room);},roomDeleted:function(data){if(!$defined(data.username)){return;}this.roomsByUsername.erase(data.username);this.roomCache.erase(data.username);this.dispatchEvent("feedRoomDeleted",data.username);},roomMembershipUpdated:function(data){if(!$defined(data.username)||!this.roomsByUsername.has(data.username)){return;}this.roomsByUsername.get(data.username).status=data.status;},roomStreamSubscriptionAdded:function(data){if(!$defined(data.room)||!this.roomsByUsername.has(data.room.username)){return;}this.roomsByUsername.get(data.room.username).subscribed=1;},roomStreamSubscriptionDeleted:function(data){if(!$defined(data.username)||!this.roomsByUsername.has(data.username)){return;}this.roomsByUsername.get(data.username).subscribed=0;},connectionAdded:function(data){if(!$defined(data.user)){return;}var user=this.processConnection(data.user);this.dispatchEvent("contactAdded",user);if(this.requestsByUsername.has(user.username)){this.requestsByUsername.erase(user.username);this.dispatchEvent("contactRequestDeleted",user.username);}if(this.requestsOutByUsername.has(user.username)){this.requestsOutByUsername.erase(user.username);}},connectionDeleted:function(data){if(!$defined(data.username)){return;}var group=this.getGroup(data.group_id);group.users.erase(data.username);this.connsByUsername.erase(data.username);this.dispatchEvent("contactDeleted",data.username,data.group_id);},connectionRequestAdded:function(data){if(!$defined(data.user)){return;}var user=this.processConnectionRequest(data.user);this.dispatchEvent("contactRequestAdded",user);},connectionRequestDeleted:function(data){if(!$defined(data.username)){return;}this.requestsByUsername.erase(data.username);this.dispatchEvent("contactRequestDeleted",data.username);},connectionRequestOutAdded:function(data){if(!$defined(data.user)){return;}var user=this.processConnectionRequestOut(data.user);this.dispatchEvent("contactRequestOutAdded",user);},connectionRequestOutDeleted:function(data){if(!$defined(data.username)){return;}this.requestsOutByUsername.erase(data.username);this.dispatchEvent("contactRequestOutDeleted",data.username);},connectionGroupAdded:function(data){if(!$defined(data.group)){return;}var group=this.processGroup(data.group);this.fireEvent("contactGroupAdded",group);},connectionGroupDeleted:function(data){if(!$defined(data.group_id)||!this.groups.has(data.group_id)){return;}var group=this.getGroup(data.group_id);group.users.each(function(user){this.connectionGroupMoved({username:user.username,group_id:0,old_group_id:data.group_id});group.users.erase(user.username);},this);this.groups.erase(data.group_id);this.fireEvent("contactGroupDeleted",group);},connectionGroupMoved:function(data){if(!$defined(data.group_id)||!$defined(data.username)||!$defined(data.old_group_id)){return;}var user=this.getContact(data.username);user.group_id=data.group_id;this.fireEvent("contactGroupMoved",user);},addUserToGroup:function(user,group){if(!group.users.has(user.username)){group.users.set(user.username,user);}},getGroup:function(group_id){return this.groups.get(parseInt(group_id));},getContact:function(username){return this.connsByUsername.get(username);},getRoom:function(username){if(this.roomsByUsername.has(username)){return this.roomsByUsername.get(username);}else{if(this.roomCache.has(username)){return this.roomCache.get(username);}else{return null;}}},getContactsByGroup:function(group_id){if(!this.groups.has(group_id)){return;}var group=this.getGroup(group_id);return group.users;},getUser:function(username){if(this.userCache.has(username)){return this.userCache.get(username);}else{return null;}},cacheUser:function(user){this.userCache.set(user.username,user);},cacheRoom:function(room){this.roomCache.set(room.username,room);}});Pipio.implement({registerApis:function(){this.requests.each(function(request){this.registerCall("pipio",request);},this);},requests:[{name:"user_login",params:["username","password","remember_me"],url:"/api/auth/user/login"},{name:"user_logout",url:"/api/auth/user/logout"},{name:"user_register",params:["username","password","first_name","last_name","email","dob_month","dob_year","dob_day","access_key"],url:"/api/auth/user/register"},{name:"user_password_resetrequest",params:["username"],url:"/api/auth/user/password/resetrequest"},{name:"user_password_reset",params:["token","new_password","verify_password","email"],url:"/api/auth/user/password/reset"},{name:"user_privacy_set",params:["is_public"],url:"/api/user/privacy/set"},{name:"user_password_change",params:["password","new_password","verify_password"],url:"/api/user/password/change"},{name:"user_email_change",params:["email"],url:"/api/user/email/change"},{name:"user_location_enabled",params:["location_enabled"],url:"/api/user/location/enabled"},{name:"user_location_save",params:["label","country_code","country","city","region","lat","lon","geohash"],url:"/api/user/location/save"},{name:"token_get",url:"/api/user/token/get"},{name:"publish_status",url:"/api/pipio/stream/publish/status",params:["body","res"]},{name:"publish_roomstatus",url:"/api/pipio/stream/publish/roomstatus",params:["username","body","res"]},{name:"user_profilepic_upload",url:"/api/user/profilepic/upload",params:[]},{name:"room_profilepic_upload",url:"/api/pipio/room/profilepic/upload",params:["username"]},{name:"room_members",url:"/api/pipio/room/members",params:["username","date_created"]},{name:"room_subscribers",url:"/api/pipio/room/subscribers",params:["username","date_created"]},{name:"room_requests",url:"/api/pipio/room/requests",params:["username","date_created"]},{name:"email_block",url:"/api/auth/email/block",params:["token","email"]},{name:"user_profile_update",url:"/api/user/profile/update",params:["bio","url","interests"]},{name:"ping",params:[],url:"/api/user/session/ping"},{name:"emailblock_load",url:"/api/user/emailblock/load"},{name:"emailblock_update",params:["email_type","blocked"],url:"/api/user/emailblock/update"}]});



		
		//initialize pipio core
			
		var pipio_version = '1.0.8';
		var user_data = {"logged_in":0};
		var user_content = "blah";
		
		//this outputs all templates
		var templates = new Hash();
		
		var pipio = new Pipio();
					
		



	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	



(function(){var aa="_gat",ba="_gaq",r=true,v=false,w=undefined,ca="4.6.5",x="length",y="cookie",A="location",B="&",C="=",D="__utma=",E="__utmb=",G="__utmc=",da="__utmk=",H="__utmv=",J="__utmz=",K="__utmx=",L="GASO=";var N=function(i){return w==i||"-"==i||""==i},ea=function(i){return i[x]>0&&" \n\r\t".indexOf(i)>-1},P=function(i,l,g){var t="-",k;if(!N(i)&&!N(l)&&!N(g)){k=i.indexOf(l);if(k>-1){g=i.indexOf(g,k);if(g<0)g=i[x];t=O(i,k+l.indexOf(C)+1,g)}}return t},Q=function(i){var l=v,g=0,t,k;if(!N(i)){l=r;for(t=0;t<i[x];t++){k=i.charAt(t);g+="."==k?1:0;l=l&&g<=1&&(0==t&&"-"==k||".0123456789".indexOf(k)>-1)}}return l},S=function(i,l){var g=encodeURIComponent;return g instanceof Function?l?encodeURI(i):g(i):escape(i)},
T=function(i,l){var g=decodeURIComponent,t;i=i.split("+").join(" ");if(g instanceof Function)try{t=l?decodeURI(i):g(i)}catch(k){t=unescape(i)}else t=unescape(i);return t},U=function(i,l){return i.indexOf(l)>-1},V=function(i,l){i[i[x]]=l},W=function(i){return i.toLowerCase()},X=function(i,l){return i.split(l)},fa=function(i,l){return i.indexOf(l)},O=function(i,l,g){g=w==g?i[x]:g;return i.substring(l,g)},ga=function(i,l){return i.join(l)},ia=function(i){var l=1,g=0,t;if(!N(i)){l=0;for(t=i[x]-1;t>=0;t--){g=
i.charCodeAt(t);l=(l<<6&268435455)+g+(g<<14);g=l&266338304;l=g!=0?l^g>>21:l}}return l},ja=function(){var i=window,l=w;if(i&&i.gaGlobal&&i.gaGlobal.hid)l=i.gaGlobal.hid;else{l=Y();i.gaGlobal=i.gaGlobal?i.gaGlobal:{};i.gaGlobal.hid=l}return l},Y=function(){return Math.round(Math.random()*2147483647)},Z={Ha:function(i,l){this.bb=i;this.nb=l},ib:v,_gasoDomain:w,_gasoCPath:w};Z.Gb=function(){function i(k){return new t(k[0],k[1])}function l(k){var p=[];k=k.split(",");var f;for(f=0;f<k.length;++f)p.push(i(k[f].split(":")));return p}var g=this,t=Z.Ha;g.Ia="utm_campaign";g.Ja="utm_content";g.Ka="utm_id";g.La="utm_medium";g.Ma="utm_nooverride";g.Na="utm_source";g.Oa="utm_term";g.Pa="gclid";g.ba=0;g.z=0;g.Ta=15768E6;g.sb=18E5;g.v=63072E6;g.ta=[];g.va=[];g.nc="cse";g.oc="q";g.ob=5;g.T=l("daum:q,eniro:search_word,naver:query,images.google:q,google:q,yahoo:p,msn:q,bing:q,aol:query,aol:encquery,lycos:query,ask:q,altavista:q,netscape:query,cnn:query,about:terms,mamma:query,alltheweb:q,voila:rdata,virgilio:qs,live:q,baidu:wd,alice:qs,yandex:text,najdi:q,aol:q,mama:query,seznam:q,search:q,wp:szukaj,onet:qt,szukacz:q,yam:k,pchome:q,kvasir:q,sesam:q,ozu:q,terra:query,mynet:q,ekolay:q,rambler:words");
g.t=w;g.lb=v;g.h="/";g.U=100;g.oa="/__utm.gif";g.ga=1;g.ha=1;g.u="|";g.fa=1;g.da=1;g.Ra=1;g.b="auto";g.I=1;g.ra=1E3;g.Jc=10;g.Pb=10;g.Kc=0.2;g.o=w;g.a=document;g.e=window};Z.Hb=function(i){function l(d,a,j,c){var n="",s=0;n=P(d,"2"+a,";");if(!N(n)){d=n.indexOf("^"+j+".");if(d<0)return["",0];n=O(n,d+j[x]+2);if(n.indexOf("^")>0)n=n.split("^")[0];j=n.split(":");n=j[1];s=parseInt(j[0],10);if(!c&&s<p.r)n=""}if(N(n))n="";return[n,s]}function g(d,a){return"^"+ga([[a,d[1]].join("."),d[0]],":")}function t(d,a){f.a[y]=d+"; path="+f.h+"; "+a+p.fb()}function k(d){var a=new Date;d=new Date(a.getTime()+d);return"expires="+d.toGMTString()+"; "}var p=this,f=i;p.r=(new Date).getTime();
var h=[D,E,G,J,H,K,L];p.k=function(){var d=f.a[y];return f.o?p.Wb(d,f.o):d};p.Wb=function(d,a){var j=[],c,n;for(c=0;c<h[x];c++){n=l(d,h[c],a)[0];N(n)||(j[j[x]]=h[c]+n+";")}return j.join("")};p.l=function(d,a,j){var c=j>0?k(j):"";if(f.o){a=p.kc(f.a[y],d,f.o,a,j);d="2"+d;c=j>0?k(f.v):""}t(d+a,c)};p.kc=function(d,a,j,c,n){var s="";n=n||f.v;c=g([c,p.r+n*1],j);s=P(d,"2"+a,";");if(!N(s)){d=g(l(d,a,j,r),j);s=ga(s.split(d),"");return s=c+s}return c};p.fb=function(){return N(f.b)?"":"domain="+f.b+";"}};Z.$=function(i){function l(b){b=b instanceof Array?b.join("."):"";return N(b)?"-":b}function g(b,e){var o=[];if(!N(b)){o=b.split(".");if(e)for(b=0;b<o[x];b++)Q(o[b])||(o[b]="-")}return o}function t(b,e,o){var m=c.M,q,u;for(q=0;q<m[x];q++){u=m[q][0];u+=N(e)?e:e+m[q][4];m[q][2](P(b,u,o))}}var k,p,f,h,d,a,j,c=this,n,s=i;c.j=new Z.Hb(i);c.kb=function(){return w==n||n==c.P()};c.k=function(){return c.j.k()};c.ma=function(){return d?d:"-"};c.vb=function(b){d=b};c.za=function(b){n=Q(b)?b*1:"-"};c.la=function(){return l(a)};
c.Aa=function(b){a=g(b)};c.Vb=function(){c.j.l(H,"",-1)};c.lc=function(){return n?n:"-"};c.fb=function(){return N(s.b)?"":"domain="+s.b+";"};c.ja=function(){return l(k)};c.tb=function(b){k=g(b,1)};c.C=function(){return l(p)};c.ya=function(b){p=g(b,1)};c.ka=function(){return l(f)};c.ub=function(b){f=g(b,1)};c.na=function(){return l(h)};c.wb=function(b){h=g(b);for(b=0;b<h[x];b++)if(b<4&&!Q(h[b]))h[b]="-"};c.fc=function(){return j};c.Dc=function(b){j=b};c.Sb=function(){k=[];p=[];f=[];h=[];d=w;a=[];n=
w};c.P=function(){var b="",e;for(e=0;e<c.M[x];e++)b+=c.M[e][1]();return ia(b)};c.ua=function(b){var e=c.k(),o=v;if(e){t(e,b,";");c.za(c.P());o=r}return o};c.zc=function(b){t(b,"",B);c.za(P(b,da,B))};c.Hc=function(){var b=c.M,e=[],o;for(o=0;o<b[x];o++)V(e,b[o][0]+b[o][1]());V(e,da+c.P());return e.join(B)};c.Nc=function(b,e){var o=c.M,m=s.h;c.ua(b);s.h=e;for(b=0;b<o[x];b++)N(o[b][1]())||o[b][3]();s.h=m};c.Cb=function(){c.j.l(D,c.ja(),s.v)};c.Ea=function(){c.j.l(E,c.C(),s.sb)};c.Db=function(){c.j.l(G,
c.ka(),0)};c.Ga=function(){c.j.l(J,c.na(),s.Ta)};c.Eb=function(){c.j.l(K,c.ma(),s.v)};c.Fa=function(){c.j.l(H,c.la(),s.v)};c.Oc=function(){c.j.l(L,c.fc(),0)};c.M=[[D,c.ja,c.tb,c.Cb,"."],[E,c.C,c.ya,c.Ea,""],[G,c.ka,c.ub,c.Db,""],[K,c.ma,c.vb,c.Eb,""],[J,c.na,c.wb,c.Ga,"."],[H,c.la,c.Aa,c.Fa,"."]]};Z.Kb=function(i){var l=this,g=i,t=new Z.$(g),k=function(){},p=function(f){var h=(new Date).getTime(),d;d=(h-f[3])*(g.Kc/1E3);if(d>=1){f[2]=Math.min(Math.floor(f[2]*1+d),g.Pb);f[3]=h}return f};l.H=function(f,h,d,a,j,c){var n,s=g.I,b=g.a[A];t.ua(d);n=X(t.C(),".");if(n[1]<500||a){if(j)n=p(n);if(a||!j||n[2]>=1){if(!a&&j)n[2]=n[2]*1-1;n[1]=n[1]*1+1;f="?utmwv="+ca+"&utmn="+Y()+(N(b.hostname)?"":"&utmhn="+S(b.hostname))+(g.U==100?"":"&utmsp="+S(g.U))+f;if(0==s||2==s){a=2==s?k:c||k;l.$a(g.oa+f,a)}if(1==s||
2==s){f=("https:"==b.protocol?"https://ssl.google-analytics.com/__utm.gif":"http://www.google-analytics.com/__utm.gif")+f+"&utmac="+h+"&utmcc="+l.ac(d);if(ka)f+="&gaq=1";l.$a(f,c)}}}t.ya(n.join("."));t.Ea()};l.$a=function(f,h){var d=new Image(1,1);d.src=f;d.onload=function(){d.onload=null;(h||k)()}};l.ac=function(f){var h=[],d=[D,J,H,K],a,j=t.k(),c;for(a=0;a<d[x];a++){c=P(j,d[a]+f,";");if(!N(c)){if(d[a]==H){c=X(c.split(f+".")[1],"|")[0];if(N(c))continue;c=f+"."+c}V(h,d[a]+c+";")}}return S(h.join("+"))}};Z.n=function(){var i=this;i.Y=[];i.hb=function(l){var g,t=i.Y,k;for(k=0;k<t.length;k++)g=l==t[k].q?t[k]:g;return g};i.Ob=function(l,g,t,k,p,f,h,d){var a=i.hb(l);if(w==a){a=new Z.n.Mb(l,g,t,k,p,f,h,d);V(i.Y,a)}else{a.Qa=g;a.Ab=t;a.zb=k;a.xb=p;a.Xa=f;a.yb=h;a.Za=d}return a}};Z.n.Lb=function(i,l,g,t,k,p){var f=this;f.Bb=i;f.Ba=l;f.D=g;f.Va=t;f.pb=k;f.qb=p;f.Ca=function(){return"&"+["utmt=item","tid="+S(f.Bb),"ipc="+S(f.Ba),"ipn="+S(f.D),"iva="+S(f.Va),"ipr="+S(f.pb),"iqt="+S(f.qb)].join("&utm")}};
Z.n.Mb=function(i,l,g,t,k,p,f,h){var d=this;d.q=i;d.Qa=l;d.Ab=g;d.zb=t;d.xb=k;d.Xa=p;d.yb=f;d.Za=h;d.R=[];d.Nb=function(a,j,c,n,s){var b=d.gc(a),e=d.q;if(w==b)V(d.R,new Z.n.Lb(e,a,j,c,n,s));else{b.Bb=e;b.Ba=a;b.D=j;b.Va=c;b.pb=n;b.qb=s}};d.gc=function(a){var j,c=d.R,n;for(n=0;n<c.length;n++)j=a==c[n].Ba?c[n]:j;return j};d.Ca=function(){return"&"+["utmt=tran","id="+S(d.q),"st="+S(d.Qa),"to="+S(d.Ab),"tx="+S(d.zb),"sp="+S(d.xb),"ci="+S(d.Xa),"rg="+S(d.yb),"co="+S(d.Za)].join("&utmt")}};Z.Fb=function(i){function l(){var f,h,d;h="ShockwaveFlash";var a="$version",j=k.d?k.d.plugins:w;if(j&&j[x]>0)for(f=0;f<j[x]&&!d;f++){h=j[f];if(U(h.name,"Shockwave Flash"))d=h.description.split("Shockwave Flash ")[1]}else{h=h+"."+h;try{f=new ActiveXObject(h+".7");d=f.GetVariable(a)}catch(c){}if(!d)try{f=new ActiveXObject(h+".6");d="WIN 6,0,21,0";f.AllowScriptAccess="always";d=f.GetVariable(a)}catch(n){}if(!d)try{f=new ActiveXObject(h);d=f.GetVariable(a)}catch(s){}if(d){d=X(d.split(" ")[1],",");d=d[0]+
"."+d[1]+" r"+d[2]}}return d?d:p}var g=i,t=g.e,k=this,p="-";k.V=t.screen;k.Sa=!k.V&&t.java?java.awt.Toolkit.getDefaultToolkit():w;k.d=t.navigator;k.W=p;k.xa=p;k.Wa=p;k.qa=p;k.pa=1;k.eb=p;k.bc=function(){var f;if(t.screen){k.W=k.V.width+"x"+k.V.height;k.xa=k.V.colorDepth+"-bit"}else if(k.Sa)try{f=k.Sa.getScreenSize();k.W=f.width+"x"+f.height}catch(h){}k.qa=W(k.d&&k.d.language?k.d.language:k.d&&k.d.browserLanguage?k.d.browserLanguage:p);k.pa=k.d&&k.d.javaEnabled()?1:0;k.eb=g.ha?l():p;k.Wa=S(g.a.characterSet?
g.a.characterSet:g.a.charset?g.a.charset:p)};k.Ic=function(){return B+"utm"+["cs="+S(k.Wa),"sr="+k.W,"sc="+k.xa,"ul="+k.qa,"je="+k.pa,"fl="+S(k.eb)].join("&utm")};k.$b=function(){var f=g.a,h=t.history[x];f=k.d.appName+k.d.version+k.qa+k.d.platform+k.d.userAgent+k.pa+k.W+k.xa+(f[y]?f[y]:"")+(f.referrer?f.referrer:"");for(var d=f[x];h>0;)f+=h--^d++;return ia(f)}};Z.m=function(i,l,g,t){function k(d){var a="";d=W(d.split("://")[1]);if(U(d,"/")){d=d.split("/")[1];if(U(d,"?"))a=d.split("?")[0]}return a}function p(d){var a="";a=W(d.split("://")[1]);if(U(a,"/"))a=a.split("/")[0];return a}var f=t,h=this;h.c=i;h.rb=l;h.r=g;h.ic=function(d){var a=h.gb();return new Z.m.w(P(d,f.Ka+C,B),P(d,f.Na+C,B),P(d,f.Pa+C,B),h.Q(d,f.Ia,"(not set)"),h.Q(d,f.La,"(not set)"),h.Q(d,f.Oa,a&&!N(a.K)?T(a.K):w),h.Q(d,f.Ja,w))};h.jb=function(d){var a=p(d),j=k(d);if(U(a,"google")){d=d.split("?").join(B);
if(U(d,B+f.oc+C))if(j==f.nc)return r}return v};h.gb=function(){var d,a=h.rb,j,c,n=f.T;if(!(N(a)||"0"==a||!U(a,"://")||h.jb(a))){d=p(a);for(j=0;j<n[x];j++){c=n[j];if(U(d,W(c.bb))){a=a.split("?").join(B);if(U(a,B+c.nb+C)){d=a.split(B+c.nb+C)[1];if(U(d,B))d=d.split(B)[0];return new Z.m.w(w,c.bb,w,"(organic)","organic",d,w)}}}}};h.Q=function(d,a,j){d=P(d,a+C,B);return j=!N(d)?T(d):!N(j)?j:"-"};h.uc=function(d){var a=f.ta,j=v,c;if(d&&"organic"==d.S){d=W(T(d.K));for(c=0;c<a[x];c++)j=j||W(a[c])==d}return j};
h.hc=function(){var d="",a="";d=h.rb;if(!(N(d)||"0"==d||!U(d,"://")||h.jb(d))){d=d.split("://")[1];if(U(d,"/")){a=O(d,d.indexOf("/"));a=a.split("?")[0];d=W(d.split("/")[0])}if(0==d.indexOf("www."))d=O(d,4);return new Z.m.w(w,d,w,"(referral)","referral",w,a)}};h.Xb=function(d){var a="";if(f.ba){a=d&&d.hash?d.href.substring(d.href.indexOf("#")):"";a=""!=a?a+B:a}a+=d.search;return a};h.dc=function(){return new Z.m.w(w,"(direct)",w,"(direct)","(none)",w,w)};h.vc=function(d){var a=v,j,c=f.va;if(d&&"referral"==
d.S){d=W(S(d.X));for(j=0;j<c[x];j++)a=a||U(d,W(c[j]))}return a};h.L=function(d){return w!=d&&d.mb()};h.cc=function(d,a){var j="",c="-",n,s=0,b,e,o=h.c;if(!d)return"";e=d.k();j=h.Xb(f.a[A]);if(f.z&&d.kb()){c=d.na();if(!N(c)&&!U(c,";")){d.Ga();return""}}c=P(e,J+o+".",";");n=h.ic(j);if(h.L(n)){j=P(j,f.Ma+C,B);if("1"==j&&!N(c))return""}if(!h.L(n)){n=h.gb();if(!N(c)&&h.uc(n))return""}if(!h.L(n)&&a){n=h.hc();if(!N(c)&&h.vc(n))return""}if(!h.L(n))if(N(c)&&a)n=h.dc();if(!h.L(n))return"";if(!N(c)){s=c.split(".");
b=new Z.m.w;b.Zb(s.slice(4).join("."));b=W(b.Da())==W(n.Da());s=s[3]*1}if(!b||a){a=P(e,D+o+".",";");e=a.lastIndexOf(".");a=e>9?O(a,e+1)*1:0;s++;a=0==a?1:a;d.wb([o,h.r,a,s,n.Da()].join("."));d.Ga();return B+"utmcn=1"}else return B+"utmcr=1"}};
Z.m.w=function(i,l,g,t,k,p,f){var h=this;h.q=i;h.X=l;h.ea=g;h.D=t;h.S=k;h.K=p;h.Ya=f;h.Da=function(){var d=[],a=[["cid",h.q],["csr",h.X],["gclid",h.ea],["ccn",h.D],["cmd",h.S],["ctr",h.K],["cct",h.Ya]],j,c;if(h.mb())for(j=0;j<a[x];j++)if(!N(a[j][1])){c=a[j][1].split("+").join("%20");c=c.split(" ").join("%20");V(d,"utm"+a[j][0]+C+c)}return d.join("|")};h.mb=function(){return!(N(h.q)&&N(h.X)&&N(h.ea))};h.Zb=function(d){var a=function(j){return T(P(d,"utm"+j+C,"|"))};h.q=a("cid");h.X=a("csr");h.ea=a("gclid");
h.D=a("ccn");h.S=a("cmd");h.K=a("ctr");h.Ya=a("cct")}};Z.Ib=function(i,l,g,t){function k(j,c,n){var s;if(!N(n)){n=n.split(",");for(var b=0;b<n[x];b++){s=n[b];if(!N(s)){s=s.split(h);if(s[x]==4)c[s[0]]=[s[1],s[2],j]}}}}var p=this,f=l,h=C,d=i,a=t;p.O=g;p.sa="";p.p={};p.tc=function(){var j;j=X(P(p.O.k(),H+f+".",";"),f+".")[1];if(!N(j)){j=j.split("|");k(1,p.p,j[1]);p.sa=j[0];p.Z()}};p.Z=function(){p.Qb();var j=p.sa,c,n,s="";for(c in p.p)if((n=p.p[c])&&1===n[2])s+=c+h+n[0]+h+n[1]+h+1+",";N(s)||(j+="|"+s);if(N(j))p.O.Vb();else{p.O.Aa(f+"."+j);p.O.Fa()}};p.Ec=
function(j){p.sa=j;p.Z()};p.Cc=function(j,c,n,s){if(1!=s&&2!=s&&3!=s)s=3;var b=v;if(c&&n&&j>0&&j<=d.ob){c=S(c);n=S(n);if(c[x]+n[x]<=64){p.p[j]=[c,n,s];p.Z();b=r}}return b};p.mc=function(j){if((j=p.p[j])&&1===j[2])return j[1]};p.Ub=function(j){var c=p.p;if(c[j]){delete c[j];p.Z()}};p.Qb=function(){a._clearKey(8);a._clearKey(9);a._clearKey(11);var j=p.p,c,n;for(n in j)if(c=j[n]){a._setKey(8,n,c[0]);a._setKey(9,n,c[1]);(c=c[2])&&3!=c&&a._setKey(11,n,""+c)}}};Z.N=function(){function i(m,q,u,z){if(w==f[m])f[m]={};if(w==f[m][q])f[m][q]=[];f[m][q][u]=z}function l(m,q){if(w!=f[m]&&w!=f[m][q]){f[m][q]=w;q=r;var u;for(u=0;u<a[x];u++)if(w!=f[m][a[u]]){q=v;break}if(q)f[m]=w}}function g(m){var q="",u=v,z,M;for(z=0;z<a[x];z++){M=m[a[z]];if(w!=M){if(u)q+=a[z];q+=t(M);u=v}else u=r}return q}function t(m){var q=[],u,z;for(z=0;z<m[x];z++)if(w!=m[z]){u="";if(z!=o&&w==m[z-1])u+=z.toString()+s;u+=k(m[z]);V(q,u)}return j+q.join(n)+c}function k(m){var q="",u,z,M;for(u=0;u<
m[x];u++){z=m.charAt(u);M=e[z];q+=w!=M?M:z}return q}var p=this,f={},h="k",d="v",a=[h,d],j="(",c=")",n="*",s="!",b="'",e={};e[b]="'0";e[c]="'1";e[n]="'2";e[s]="'3";var o=1;p.qc=function(m){return w!=f[m]};p.G=function(){var m="",q;for(q in f)if(w!=f[q])m+=q.toString()+g(f[q]);return m};p.Ac=function(m){if(m==w)return p.G();var q=m.G(),u;for(u in f)if(w!=f[u]&&!m.qc(u))q+=u.toString()+g(f[u]);return q};p._setKey=function(m,q,u){if(typeof u!="string")return v;i(m,h,q,u);return r};p._setValue=function(m,
q,u){if(typeof u!="number"&&(w==Number||!(u instanceof Number))||Math.round(u)!=u||u==NaN||u==Infinity)return v;i(m,d,q,u.toString());return r};p._getKey=function(m,q){return w!=f[m]&&w!=f[m][h]?f[m][h][q]:w};p._getValue=function(m,q){return w!=f[m]&&w!=f[m][d]?f[m][d][q]:w};p._clearKey=function(m){l(m,h)};p._clearValue=function(m){l(m,d)}};Z.Jb=function(i,l){var g=this;g.Qc=l;g.xc=i;g._trackEvent=function(t,k,p){return l._trackEvent(g.xc,t,k,p)}};Z.aa=function(i,l){function g(){if("auto"==c.b){var b=c.a.domain;if("www."==O(b,0,4))b=O(b,4);c.b=b}c.b=W(c.b)}function t(){var b=c.b,e=b.indexOf("www.google.")*b.indexOf(".google.")*b.indexOf("google.");return e||"/"!=c.h||b.indexOf("google.org")>-1}function k(b,e,o){if(N(b)||N(e)||N(o))return"-";b=P(b,D+a.c+".",e);if(!N(b)){b=b.split(".");b[5]=b[5]?b[5]*1+1:1;b[3]=b[4];b[4]=o;b=b.join(".")}return b}function p(){return"file:"!=c.a[A].protocol&&t()}function f(b){if(!b||""==b)return"";for(;ea(b.charAt(0));)b=
O(b,1);for(;ea(b.charAt(b[x]-1));)b=O(b,0,b[x]-1);return b}function h(b,e,o,m){if(!N(b())){e(m?T(b()):b());U(b(),";")||o()}}function d(b){var e,o=""!=b&&c.a[A].host!=b;if(o)for(e=0;e<c.t[x];e++)o=o&&fa(W(b),W(c.t[e]))==-1;return o}var a=this,j=w,c=new Z.Gb,n=v,s=w;a.e=window;a.r=Math.round((new Date).getTime()/1E3);a.s=i||"UA-XXXXX-X";a.ab=c.a.referrer;a.ia=w;a.f=w;a.B=w;a.F=v;a.A=w;a.Ua="";a.g=w;a.cb=w;a.c=w;a.i=w;c.o=l?S(l):w;a.wc=function(){var b=v;if(a.B)b=a.B.match(/^[0-9a-z-_.]{10,1200}$/i);
return b};a.jc=function(){return Y()^a.A.$b()&2147483647};a.ec=function(){if(!c.b||""==c.b||"none"==c.b){c.b="";return 1}g();return c.Ra?ia(c.b):1};a.Yb=function(b,e){if(N(b))b="-";else{e+=c.h&&"/"!=c.h?c.h:"";e=b.indexOf(e);b=e>=0&&e<=8?"0":"["==b.charAt(0)&&"]"==b.charAt(b[x]-1)?"-":b}return b};a.wa=function(b){var e="",o=c.a;e+=c.fa?a.A.Ic():"";e+=c.da?a.Ua:"";e+=c.ga&&!N(o.title)?"&utmdt="+S(o.title):"";e+="&utmhid="+ja()+"&utmr="+S(a.ia)+"&utmp="+S(a.Bc(b));return e};a.Bc=function(b){var e=c.a[A];
return b=w!=b&&""!=b?S(b,r):S(e.pathname+e.search,r)};a.Lc=function(b){if(a.J()){var e="";if(a.g!=w&&a.g.G()[x]>0)e+="&utme="+S(a.g.G());e+=a.wa(b);j.H(e,a.s,a.c)}};a.Tb=function(){var b=new Z.$(c);return b.ua(a.c)?b.Hc():w};a._getLinkerUrl=function(b,e){var o=b.split("#"),m=b,q=a.Tb();if(q)if(e&&1>=o[x])m+="#"+q;else if(!e||1>=o[x])if(1>=o[x])m+=(U(b,"?")?B:"?")+q;else m=o[0]+(U(b,"?")?B:"?")+q+"#"+o[1];return m};a.Fc=function(){var b;if(a.wc()){a.i.Dc(a.B);a.i.Oc();Z._gasoDomain=c.b;Z._gasoCPath=
c.h;b=c.a.createElement("script");b.type="text/javascript";b.id="_gasojs";b.src="https://www.google.com/analytics/reporting/overlay_js?gaso="+a.B+B+Y();c.a.getElementsByTagName("head")[0].appendChild(b)}};a.pc=function(){var b=a.r,e=a.i,o=e.k(),m=a.c+"",q=c.e,u=q?q.gaGlobal:w,z,M=U(o,D+m+"."),la=U(o,E+m),ma=U(o,G+m),F,I=[],R="",ha=v;o=N(o)?"":o;if(c.z){z=c.a[A]&&c.a[A].hash?c.a[A].href.substring(c.a[A].href.indexOf("#")):"";if(c.ba&&!N(z))R=z+B;R+=c.a[A].search;if(!N(R)&&U(R,D)){e.zc(R);e.kb()||e.Sb();
F=e.ja()}h(e.ma,e.vb,e.Eb,true);h(e.la,e.Aa,e.Fa)}if(N(F))if(M)if(!la||!ma){F=k(o,";",b);a.F=r}else{F=P(o,D+m+".",";");I=X(P(o,E+m,";"),".")}else{F=ga([m,a.jc(),b,b,b,1],".");ha=a.F=r}else if(N(e.C())||N(e.ka())){F=k(R,B,b);a.F=r}else{I=X(e.C(),".");m=I[0]}F=F.split(".");if(q&&u&&u.dh==m&&!c.o){F[4]=u.sid?u.sid:F[4];if(ha){F[3]=u.sid?u.sid:F[4];if(u.vid){b=u.vid.split(".");F[1]=b[0];F[2]=b[1]}}}e.tb(F.join("."));I[0]=m;I[1]=I[1]?I[1]:0;I[2]=w!=I[2]?I[2]:c.Jc;I[3]=I[3]?I[3]:F[4];e.ya(I.join("."));
e.ub(m);N(e.lc())||e.za(e.P());e.Cb();e.Ea();e.Db()};a.rc=function(){j=new Z.Kb(c)};a._initData=function(){var b;if(!n){if(!a.A){a.A=new Z.Fb(c);a.A.bc()}a.c=a.ec();a.i=new Z.$(c);a.g=new Z.N;s=new Z.Ib(c,a.c,a.i,a.g);a.rc()}if(p()){a.pc();s.tc()}if(!n){if(p()){a.ia=a.Yb(a.ab,c.a.domain);if(c.da){b=new Z.m(a.c,a.ia,a.r,c);a.Ua=b.cc(a.i,a.F)}}a.cb=new Z.N;n=r}Z.ib||a.sc()};a._visitCode=function(){a._initData();var b=P(a.i.k(),D+a.c+".",";");b=b.split(".");return b[x]<4?"":b[1]};a._cookiePathCopy=function(b){a._initData();
a.i&&a.i.Nc(a.c,b)};a.sc=function(){var b=c.a[A].hash;if(b&&1==b.indexOf("gaso="))b=P(b,"gaso=",B);else b=(b=c.e.name)&&0<=b.indexOf("gaso=")?P(b,"gaso=",B):P(a.i.k(),L,";");if(b[x]>=10){a.B=b;a.Fc()}Z.ib=r};a.J=function(){return a._visitCode()%1E4<c.U*100};a.Gc=function(){var b,e,o=c.a.links;if(!c.lb){b=c.a.domain;if("www."==O(b,0,4))b=O(b,4);c.t.push("."+b)}for(b=0;b<o[x]&&(c.ra==-1||b<c.ra);b++){e=o[b];if(d(e.host))if(!e.gatcOnclick){e.gatcOnclick=e.onclick?e.onclick:a.yc;e.onclick=function(m){var q=
!this.target||this.target=="_self"||this.target=="_top"||this.target=="_parent";q=q&&!a.Rb(m);a.Mc(m,this,q);return q?v:this.gatcOnclick?this.gatcOnclick(m):r}}}};a.yc=function(){};a._trackPageview=function(b){if(p()){a._initData();c.t&&a.Gc();a.Lc(b);a.F=v}};a._trackTrans=function(){var b=a.c,e=[],o,m,q;a._initData();if(a.f&&a.J()){for(o=0;o<a.f.Y[x];o++){m=a.f.Y[o];V(e,m.Ca());for(q=0;q<m.R[x];q++)V(e,m.R[q].Ca())}for(o=0;o<e[x];o++)j.H(e[o],a.s,b,r)}};a._setTrans=function(){var b=c.a,e,o,m;b=b.getElementById?
b.getElementById("utmtrans"):b.utmform&&b.utmform.utmtrans?b.utmform.utmtrans:w;a._initData();if(b&&b.value){a.f=new Z.n;m=b.value.split("UTM:");c.u=!c.u||""==c.u?"|":c.u;for(b=0;b<m[x];b++){m[b]=f(m[b]);e=m[b].split(c.u);for(o=0;o<e[x];o++)e[o]=f(e[o]);if("T"==e[0])a._addTrans(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]);else"I"==e[0]&&a._addItem(e[1],e[2],e[3],e[4],e[5],e[6])}}};a._addTrans=function(b,e,o,m,q,u,z,M){a.f=a.f?a.f:new Z.n;return a.f.Ob(b,e,o,m,q,u,z,M)};a._addItem=function(b,e,o,m,q,u){var z;
a.f=a.f?a.f:new Z.n;(z=a.f.hb(b))||(z=a._addTrans(b,"","","","","","",""));z.Nb(e,o,m,q,u)};a._setVar=function(b){if(b&&""!=b&&t()){a._initData();s.Ec(S(b));a.J()&&j.H("&utmt=var",a.s,a.c)}};a._setCustomVar=function(b,e,o,m){a._initData();return s.Cc(b,e,o,m)};a._deleteCustomVar=function(b){a._initData();s.Ub(b)};a._getVisitorCustomVar=function(b){a._initData();return s.mc(b)};a._setMaxCustomVariables=function(b){c.ob=b};a._link=function(b,e){if(c.z&&b){a._initData();c.a[A].href=a._getLinkerUrl(b,
e)}};a._linkByPost=function(b,e){if(c.z&&b&&b.action){a._initData();b.action=a._getLinkerUrl(b.action,e)}};a._setXKey=function(b,e,o){a.g._setKey(b,e,o)};a._setXValue=function(b,e,o){a.g._setValue(b,e,o)};a._getXKey=function(b,e){return a.g._getKey(b,e)};a._getXValue=function(b,e){return a.g.getValue(b,e)};a._clearXKey=function(b){a.g._clearKey(b)};a._clearXValue=function(b){a.g._clearValue(b)};a._createXObj=function(){a._initData();return new Z.N};a._sendXEvent=function(b){var e="";a._initData();
if(a.J()){e+="&utmt=event&utme="+S(a.g.Ac(b))+a.wa();j.H(e,a.s,a.c,v,r)}};a._createEventTracker=function(b){a._initData();return new Z.Jb(b,a)};a._trackEvent=function(b,e,o,m){var q=a.cb;if(w!=b&&w!=e&&""!=b&&""!=e){q._clearKey(5);q._clearValue(5);(b=q._setKey(5,1,b)&&q._setKey(5,2,e)&&(w==o||q._setKey(5,3,o))&&(w==m||q._setValue(5,1,m)))&&a._sendXEvent(q)}else b=v;return b};a.Mc=function(b,e,o){a._initData();if(a.J()){var m=new Z.N;m._setKey(6,1,e.href);var q=o?function(){a.db(b,e)}:w;j.H("&utmt=event&utme="+
S(m.G())+a.wa(),a.s,a.c,v,r,q);if(o){var u=this;c.e.setTimeout(function(){u.db(b,e)},500)}}};a.db=function(b,e){if(!b)b=c.e.event;var o=r;if(e.gatcOnclick)o=e.gatcOnclick(b);if(o||typeof o=="undefined")if(!e.target||e.target=="_self")c.e[A]=e.href;else if(e.target=="_top")c.e.top.document[A]=e.href;else if(e.target=="_parent")c.e.parent.document[A]=e.href};a.Rb=function(b){if(!b)b=c.e.event;var e=b.shiftKey||b.ctrlKey||b.altKey;if(!e)if(b.modifiers&&c.e.Event)e=b.modifiers&c.e.Event.CONTROL_MASK||
b.modifiers&c.e.Event.SHIFT_MASK||b.modifiers&c.e.Event.ALT_MASK;return e};a.Pc=function(){return c};a._setDomainName=function(b){c.b=b};a._addOrganic=function(b,e,o){c.T.splice(o?0:c.T.length,0,new Z.Ha(b,e))};a._clearOrganic=function(){c.T=[]};a._addIgnoredOrganic=function(b){V(c.ta,b)};a._clearIgnoredOrganic=function(){c.ta=[]};a._addIgnoredRef=function(b){V(c.va,b)};a._clearIgnoredRef=function(){c.va=[]};a._setAllowHash=function(b){c.Ra=b?1:0};a._setCampaignTrack=function(b){c.da=b?1:0};a._setClientInfo=
function(b){c.fa=b?1:0};a._getClientInfo=function(){return c.fa};a._setCookiePath=function(b){c.h=b};a._setTransactionDelim=function(b){c.u=b};a._setCookieTimeout=function(b){a._setCampaignCookieTimeout(b*1E3)};a._setCampaignCookieTimeout=function(b){c.Ta=b};a._setDetectFlash=function(b){c.ha=b?1:0};a._getDetectFlash=function(){return c.ha};a._setDetectTitle=function(b){c.ga=b?1:0};a._getDetectTitle=function(){return c.ga};a._setLocalGifPath=function(b){c.oa=b};a._getLocalGifPath=function(){return c.oa};
a._setLocalServerMode=function(){c.I=0};a._setRemoteServerMode=function(){c.I=1};a._setLocalRemoteServerMode=function(){c.I=2};a._getServiceMode=function(){return c.I};a._setSampleRate=function(b){c.U=b};a._setSessionTimeout=function(b){a._setSessionCookieTimeout(b*1E3)};a._setSessionCookieTimeout=function(b){c.sb=b};a._setAllowLinker=function(b){c.z=b?1:0};a._setAllowAnchor=function(b){c.ba=b?1:0};a._setCampNameKey=function(b){c.Ia=b};a._setCampContentKey=function(b){c.Ja=b};a._setCampIdKey=function(b){c.Ka=
b};a._setCampMediumKey=function(b){c.La=b};a._setCampNOKey=function(b){c.Ma=b};a._setCampSourceKey=function(b){c.Na=b};a._setCampTermKey=function(b){c.Oa=b};a._setCampCIdKey=function(b){c.Pa=b};a._getAccount=function(){return a.s};a._setAccount=function(b){a.s=b};a._setNamespace=function(b){c.o=b?S(b):w};a._getVersion=function(){return ca};a._setAutoTrackOutbound=function(b){c.t=[];if(b)c.t=b};a._setTrackOutboundSubdomains=function(b){c.lb=b};a._setHrefExamineLimit=function(b){c.ra=b};a._setReferrerOverride=
function(b){a.ab=b};a._setCookiePersistence=function(b){a._setVisitorCookieTimeout(b)};a._setVisitorCookieTimeout=function(b){c.v=b}};Z._getTracker=function(i,l){return new Z.aa(i,l)};var ka=v,$={ca:{},_createAsyncTracker:function(i,l){l=l||"";i=new Z.aa(i);$.ca[l]=i;ka=r;return i},_getAsyncTracker:function(i){i=i||"";var l=$.ca[i];if(!l){l=new Z.aa;$.ca[i]=l;ka=r}return l},push:function(){for(var i=arguments,l=0,g=0;g<i[x];g++)try{if(typeof i[g]==="function")i[g]();else{var t="",k=i[g][0],p=k.lastIndexOf(".");if(p>0){t=O(k,0,p);k=O(k,p+1)}var f=$._getAsyncTracker(t);f[k].apply(f,i[g].slice(1))}}catch(h){l++}return l}};window[aa]=Z;function na(){var i=window[ba],l=v;if(i&&typeof i.push=="function"){l=i.constructor==Array;if(!l)return}window[ba]=$;l&&$.push.apply($,i)}na();})()



	try {
	var pageTracker = _gat._getTracker("UA-8830181-1");
	pageTracker._trackPageview();
} catch(err) {}
